# Bug Fixes Summary - February 11, 2026

## Issues Addressed

### 1. **Pawns Refusing Jobs in Normal Mode** ✅ FIXED

**Problem:** Pawns were refusing to do jobs in Normal mode with penalties enabled, getting stuck with errors like:

```
[PreWork] Cancel Construct: missing ConstructionSpeed tool and no rescue queued
```

**Root Cause:** The `StatGatingHelper.ShouldBlockJobForStat()` method was blocking jobs for core work stats (construction, mining, harvesting, etc.) in ALL difficulty modes, even though it should only block in Hardcore/Nightmare modes. In Normal mode, pawns should be able to work without tools but suffer penalties.

**Fix:** Modified [StatGatingHelper.cs](f:\Source\SurvivalTools\Source\Helpers\StatGatingHelper.cs#L36-L54) to check difficulty mode before blocking jobs:

- Added check: `if (!settings.hardcoreMode && !settings.extraHardcoreMode) return false;`
- Now core work stats only gate in Hardcore or Nightmare mode
- In Normal mode, jobs proceed but StatPart_SurvivalTool applies penalties

### 2. **Right-Click Rescue Tool Not Available** ℹ️ EXPECTED BEHAVIOR

**User Report:** "Also i have no right-click rescue tool"

**Explanation:** Right-click rescue is **intentionally only available in Hardcore/Nightmare modes** because:

- In Normal mode (after fix #1), pawns are no longer blocked from working without tools
- They work slowly with penalties instead
- Right-click rescue is specifically for "blocked" jobs that can't start at all
- This is working as designed

**Code Location:** [FloatMenu_PrioritizeWithRescue.cs](f:\Source\SurvivalTools\Source\UI\RightClickRescue\FloatMenu_PrioritizeWithRescue.cs#L268-L273) checks mode before showing rescue options.

### 3. **Pawns Freezing After Forced Jobs** ✅ RESOLVED BY FIX #1

**User Report:** "Well, they generally freeze after a forced job, even with tools. I think I've found the problem: they freeze if the next job they would do requires a tool they don't have. No matter in which mode."

**Root Cause:** Same as issue #1 - pawns were getting blocked on their next job due to incorrect gating in Normal mode.

**Resolution:** With the StatGatingHelper fix, pawns in Normal mode will no longer be blocked on subsequent jobs, so the "freezing" behavior should be resolved.

### 4. **Tool Drop for Repair/Disassembly** ✅ NEW FEATURE ADDED

**User Request:** "Would it be possible to have the option to drop it freely for repair or disassembly?"

**Solution:** Created new float menu option system in [FloatMenu_DropToolOptions.cs](f:\Source\SurvivalTools\Source\UI\ToolManagement\FloatMenu_DropToolOptions.cs)

**Features:**

- Right-click on pawn or adjacent cell to see "Manage Tools" section
- Lists all carried survival tools with quality/HP info
- "Drop [tool]" option for each tool
- Prevents dropping forced tools (shows "forced - unforce first")
- Prevents dropping tools currently in use
- Uses existing `DropSurvivalTool` job system
- Tooltip: "Drop [tool] to make it available for repair, smelting, or disassembly"

**Usage:**

1. Select colonist
2. Right-click on the colonist (or adjacent cell)
3. Scroll to "Manage Tools" section
4. Click "Drop [tool name]"
5. Pawn will drop the tool at appropriate location (storage/stockpile/home area)

## Testing Recommendations

1. **Normal Mode Test:**
   - Start in Normal mode with penalties enabled
   - Remove all tools from a pawn
   - Give them construct/harvest/mine jobs
   - They should work slowly (0.4x speed) instead of refusing

2. **Hardcore Mode Test:**
   - Switch to Hardcore
   - Remove all tools from a pawn
   - Jobs should be blocked until tools are equipped
   - Right-click rescue option should appear

3. **Tool Drop Test:**
   - Select pawn with damaged tool
   - Right-click on pawn
   - Verify "Drop [tool]" appears in context menu
   - Drop tool, designate for repair
   - Pawn should repair it without trying to auto-equip it first

## Code Changes

### Modified Files:

1. `Source/Helpers/StatGatingHelper.cs` - Added difficulty mode check (lines 36-54)

### New Files:

1. `Source/UI/ToolManagement/FloatMenu_DropToolOptions.cs` - Tool drop context menu

## Migration Notes

- No save game compatibility issues
- Changes are runtime-only, no def changes
- Existing saves will benefit from fixes immediately after mod update
- No settings changes required

## Performance Impact

- Minimal: Added one boolean check (`hardcoreMode || extraHardcoreMode`) to hot path
- Tool drop menu: Only processes when right-clicking near pawn (not performance sensitive)

## Related Systems

These fixes interact with:

- **StatPart_SurvivalTool**: Applies penalties in Normal mode (now actually used)
- **JobGate**: May need verification that it respects new Normal mode behavior
- **PreWork_AutoEquip**: Still attempts upgrades in Normal mode, just doesn't block
- **NightmareCarryEnforcer**: Only active in Nightmare mode (unchanged)
