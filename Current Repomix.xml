This file is a merged representation of the entire codebase, combined into a single document by Repomix.
The content has been processed where empty lines have been removed, line numbers have been added, content has been compressed (code blocks are separated by ⋮---- delimiter).

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Empty lines have been removed from all files
- Line numbers have been added to the beginning of each line
- Content has been compressed - code blocks are separated by ⋮---- delimiter
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
1.6/Defs/JobDefs/Jobs_Misc.xml
1.6/Defs/JobDefs/Jobs_Work.xml
1.6/Defs/PawnColumnDefs/PawnColumns_Misc.xml
1.6/Defs/RecipeDefs/Recipes_Production.xml
1.6/Defs/SpecialThingFilterDefs/SpecialThingFilters.xml
1.6/Defs/Stats/StatCategories.xml
1.6/Defs/Stats/Stats_Pawn_WorkGeneral.xml
1.6/Defs/Stats/Stats_Tool_General.xml
1.6/Defs/ThingCategoryDefs/SurvivalTools_CleaningMaterials.xml
1.6/Defs/ThingCategoryDefs/ThingCategories.xml
1.6/Defs/ThingDefs/Apparel_Belts.xml
1.6/Defs/ThingDefs/Tools_Base.xml
1.6/Defs/ThingDefs/Tools.xml
1.6/Defs/ThingSetMakerDefs/ThingSetMakers_MapGen.xml
1.6/Defs/ThinkTreeDefs/SubTrees_Misc.xml
1.6/Defs/Tutor/Concepts_NotedOpportunistic.xml
1.6/Defs/Tutor/Concepts_NotedSelfshow.xml
1.6/Defs/WorkGiverDefs/WorkGivers.xml
1.6/Languages/ChineseSimplified/DefInjected/ConceptDef/Concepts_NotedOpportunistic.xml
1.6/Languages/ChineseSimplified/DefInjected/ConceptDef/Concepts_NotedSelfshow.xml
1.6/Languages/ChineseSimplified/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/ChineseSimplified/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/ChineseSimplified/DefInjected/PawnColumnDef/PawnColumns_Misc.xml
1.6/Languages/ChineseSimplified/DefInjected/RecipeDef/Recipes_Add_Make.xml
1.6/Languages/ChineseSimplified/DefInjected/RecipeDef/Recipes_Production.xml
1.6/Languages/ChineseSimplified/DefInjected/SpecialThingFilterDef/SpecialThingFilters.xml
1.6/Languages/ChineseSimplified/DefInjected/StatCategoryDef/StatCategories.xml
1.6/Languages/ChineseSimplified/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/ChineseSimplified/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/ChineseSimplified/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/ChineseSimplified/DefInjected/ThingDef/Apparel_Belts.xml
1.6/Languages/ChineseSimplified/DefInjected/ThingDef/Tools.xml
1.6/Languages/ChineseSimplified/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/ChineseSimplified/Keyed/Keys.xml
1.6/Languages/English/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/English/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/English/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/English/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/English/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/English/DefInjected/ThingDef/Tools.xml
1.6/Languages/English/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/English/keyed/Keys.xml
1.6/Languages/English/keyed/ST_Gating.xml
1.6/Languages/English/keyed/ST_GearTab.xml
1.6/Languages/French/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/French/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/French/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/French/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/French/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/French/DefInjected/ThingDef/Tools.xml
1.6/Languages/French/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/French/Keyed/Keys.xml
1.6/Languages/German/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/German/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/German/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/German/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/German/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/German/DefInjected/ThingDef/Tools.xml
1.6/Languages/German/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/German/Keyed/Keys.xml
1.6/Languages/Japanese/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/Japanese/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/Japanese/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/Japanese/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/Japanese/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/Japanese/DefInjected/ThingDef/Tools.xml
1.6/Languages/Japanese/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/Japanese/Keyed/Keys.xml
1.6/Languages/Russian/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/Russian/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/Russian/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/Russian/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/Russian/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/Russian/DefInjected/ThingDef/Tools.xml
1.6/Languages/Russian/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/Russian/Keyed/Keys.xml
1.6/Languages/Spanish/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/Spanish/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/Spanish/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/Spanish/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/Spanish/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/Spanish/DefInjected/ThingDef/Tools.xml
1.6/Languages/Spanish/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/Spanish/Keyed/Keys.xml
1.6/Patches/AlphaAnimals/Patch.xml
1.6/Patches/Anomaly/ThingDefs_Items/Items_Resource_Stuff.xml
1.6/Patches/AtlasMaterials/Patch.xml
1.6/Patches/CombatExtended/Patch.xml
1.6/Patches/Core/PawnTableDefs/PawnTables.xml
1.6/Patches/Core/Scenarios/Scenarios_Classic.xml
1.6/Patches/Core/Stats/Stats_Pawns_WorkGeneral.xml
1.6/Patches/Core/StuffProps_DLC.xml
1.6/Patches/Core/StuffProps_Fabric.xml
1.6/Patches/Core/ThingDefs_Items/CleaningMaterials_Category.xml
1.6/Patches/Core/ThingDefs_Items/Cloths_CleaningTool.xml
1.6/Patches/Core/ThingDefs_Items/Items_Resource_Stuff.xml
1.6/Patches/Core/ThingDefs_Misc/Various_Stone.xml
1.6/Patches/Core/ThingSetMakerDefs/ThingSetMakers_MapGen.xml
1.6/Patches/Core/TraderKindDefs/TraderKinds_Base_Neolithic.xml
1.6/Patches/Core/TraderKindDefs/TraderKinds_Base_Outlander.xml
1.6/Patches/Core/TraderKindDefs/TraderKinds_Caravan_Neolithic.xml
1.6/Patches/Core/TraderKindDefs/TraderKinds_Caravan_Outlander.xml
1.6/Patches/Core/TraderKindDefs/TraderKinds_Orbital_Misc.xml
1.6/Patches/Core/WorkGiverDefs/WorkGivers.xml
1.6/Patches/Crystalloid/Patch.xml
1.6/Patches/DarkAgesMedievalTools/DAMT_Patch.xml
1.6/Patches/ExpandedMaterials/Patch.xml
1.6/Patches/ExpandedWoodworking/Patch.xml
1.6/Patches/ExpandedWoodworkingVGP/Patch.xml
1.6/Patches/GlitterTech/Patch.xml
1.6/Patches/KurasExtraGems/Patch.xml
1.6/Patches/KurasExtraStones/Patch.xml
1.6/Patches/MechalitCore/Patch.xml
1.6/Patches/Mending/Patch.xml
1.6/Patches/MetalsPlus/Patch.xml
1.6/Patches/Odyssey/ThingDefs_Items/Items_Resource_Stuff.xml
1.6/Patches/PrimitiveTools/PT_Patch.xml
1.6/Patches/Quarry/Patch.xml
1.6/Patches/ResearchReinvented/FieldResearchSupport.xml
1.6/Patches/RightToolForTheJob/RTFTJ_Patch.xml
1.6/Patches/RimBees/Patch.xml
1.6/Patches/Rimefeller/Patch.xml
1.6/Patches/RimOfMadnessBones/Patch.xml
1.6/Patches/RimsenalFederation/Patch.xml
1.6/Patches/VegetableGarden/Patch.xml
1.6/Patches/VWEUTools/VWEUT_Patch.xml
1.6/Textures/Things/Item/Equipment/Tool/README_Textures.txt
About/About.xml
About/PublishedFileId.txt
docs/DesignTheory.md
docs/QUIRK_SYSTEM.md
docs/RefactorPlan.md
docs/summary.md
Legacy Repomix.xml
LICENSE
README.md
Source/AI/AutoToolPickup_UtilityIntegrated.cs
Source/AI/JobDriver_DropSurvivalTool.cs
Source/AI/JobDriver_FellTree_Designated.cs
Source/AI/JobDriver_FellTree.cs
Source/AI/JobDriver_HarvestTree_Designated.cs
Source/AI/JobDriver_HarvestTree.cs
Source/AI/JobDriver_PlantWork.cs
Source/AI/JobGiver_OptimizeSurvivalTools.cs
Source/AI/WorkGiver_FellTrees.cs
Source/Alerts/Alert_ColonistNeedsSurvivalTool.cs
Source/Alerts/Alert_SurvivalToolNeedsReplacing.cs
Source/Alerts/Alert_ToolGatedWork.cs
Source/Assign/AssignmentSearch.cs
Source/Assign/PreWork_AutoEquip.cs
Source/Compatibility/CommonSense/CommonSenseDebug.cs
Source/Compatibility/CommonSense/CommonSenseHelpers.cs
Source/Compatibility/CommonSense/CommonSensePatches.cs
Source/Compatibility/CompatAPI.cs
Source/Compatibility/PrimitiveTools/PTDebug.cs
Source/Compatibility/PrimitiveTools/PTHelpers.cs
Source/Compatibility/PrimitiveTools/PTPatches.cs
Source/Compatibility/ResearchReinvented/RRDebug.cs
Source/Compatibility/ResearchReinvented/RRHelpers.cs
Source/Compatibility/ResearchReinvented/RRPatches.cs
Source/Compatibility/SeparateTreeChopping/STCDebug.cs
Source/Compatibility/SeparateTreeChopping/STCHelpers.cs
Source/Compatibility/SeparateTreeChopping/STCPatches.cs
Source/Compatibility/SmarterConstruction/SmarterConstructionDebug.cs
Source/Compatibility/SmarterConstruction/SmarterConstructionHelpers.cs
Source/Compatibility/SmarterConstruction/SmarterConstructionPatches.cs
Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionDebug.cs
Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionHelpers.cs
Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionPatches.cs
Source/Compatibility/TDEnhancementPack/TDEnhancementPackDebug.cs
Source/Compatibility/TDEnhancementPack/TDEnhancementPackHelpers.cs
Source/Compatibility/TDEnhancementPack/TDEnhancementPackPatches.cs
Source/DebugTools/DebugAction_AssignmentSystem.cs
Source/DebugTools/DebugAction_DumpHarmonyPatches.cs
Source/DebugTools/DebugAction_DumpStatus.cs
Source/DebugTools/DebugAction_GearTabTools.cs
Source/DebugTools/DebugAction_SpawnSurvivalToolWithStuff.cs
Source/DebugTools/DebugAction_TestToolAssignment.cs
Source/DefOfs/ST_ConceptDefOf.cs
Source/DefOfs/ST_JobDefOf.cs
Source/DefOfs/ST_RecipeDefOf.cs
Source/DefOfs/ST_StatCategoryDefOf.cs
Source/DefOfs/ST_StatDefOf.cs
Source/DefOfs/ST_ThingCategoryDefOf.cs
Source/DefOfs/ST_ThingDefOf.cs
Source/DefOfs/ST_ThingSetMakerDefOf.cs
Source/DefOfs/ST_WorkGiverDefOf.cs
Source/Game/ST_GameComponent.cs
Source/GameComponent_SurvivalToolsValidation.cs
Source/Gating/GatingEnforcer.cs
Source/Gating/JobGate.cs
Source/Harmony/HarmonyPatches_CacheInvalidation.cs
Source/Harmony/ITab_Gear_ST.cs
Source/Harmony/Patch_EquipmentUtility_CanEquip_PacifistTools.cs
Source/Harmony/Patch_MassUtility.cs
Source/Harmony/Patch_Mineable_Notify_TookMiningDamage.cs
Source/Harmony/Patch_Pawn_InventoryTracker.cs
Source/Harmony/Patch_PawnRenderer.cs
Source/Harmony/Patch_RoofUtility_CanHandleBlockingThing.cs
Source/Harmony/Patch_SymbolResolver_AncientRuins_Resolve.cs
Source/Harmony/Patch_ThingDef_SpecialDisplayStats.cs
Source/Harmony/Patch_ThingFilter_SetFromPreset.cs
Source/Harmony/Patch_Toils_Haul_TakeToInventory.cs
Source/Harmony/Patch_ToolInvalidation.cs
Source/Harmony/Patch_WorkGiver_GrowerSow_JobOnCell.cs
Source/Harmony/Patch_WorkGiver_MissingRequiredCapacity.cs
Source/Harmony/Patch_WorkGiver_PlantsCut_JobOnThing.cs
Source/Harmony/Patch_WorkGiver_Scanner_ToolGate.cs
Source/Harmony/ST_PatchGuard.cs
Source/Harmony/WorkGiver_Gates.cs
Source/HarmonyPatches.cs
Source/Helpers/CollectionExtensions.cs
Source/Helpers/ConditionalRegistration.cs
Source/Helpers/JobDefToWorkGiverDefHelper.cs
Source/Helpers/JobUtils.cs
Source/Helpers/PawnToolValidator.cs
Source/Helpers/SafetyUtils.cs
Source/Helpers/ScoreCache.cs
Source/Helpers/ST_FileIO.cs
Source/Helpers/ST_Logging.cs
Source/Helpers/StatFilters.cs
Source/Helpers/StatGatingHelper.cs
Source/Helpers/SurvivalToolDiscovery.cs
Source/Helpers/SurvivalToolValidation.cs
Source/Helpers/ToolClassification.cs
Source/Helpers/ToolGateMoteHelper.cs
Source/Helpers/ToolQuirkApplier.cs
Source/Helpers/ToolStatResolver.cs
Source/Helpers/WorkSpeedGlobalHelper.cs
Source/ModCompatibilityCheck.cs
Source/ModExtensions/StuffPropsTool.cs
Source/ModExtensions/SurvivalToolProperties.cs
Source/ModExtensions/WorkGiverExtension.cs
Source/Scoring/ToolScoring.cs
Source/SpecialThingFilterWorker_NonSmeltableTools.cs
Source/StaticConstructorClass.cs
Source/Stats/StatPart_SurvivalTools.cs
Source/Stats/StatWorker_EstimatedLifespan.cs
Source/SurvivalTool.cs
Source/SurvivalToolForcedHandler.cs
Source/SurvivalToolsSettings.cs
Source/SurvivalToolUtility.cs
Source/ToolAssignments/Dialog_ManageSurvivalToolAssignments.cs
Source/ToolAssignments/Pawn_SurvivalToolAssignmentTracker.cs
Source/ToolAssignments/PawnColumnWorker_SurvivalToolAssignment.cs
Source/ToolAssignments/SurvivalToolAssignment.cs
Source/ToolAssignments/SurvivalToolAssignmentDatabase.cs
Source/ToolResolver.cs
Source/ToolUtility.cs
Source/UI/GearTab_ST.cs
Source/VirtualTool.cs
Source/WorkSpeedGlobalConfigWindow.cs
Source/WorldComponent_DelayedValidation.cs
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="1.6/Defs/JobDefs/Jobs_Misc.xml">
<Defs>
    <JobDef>
        <defName>DropSurvivalTool</defName>
        <driverClass>SurvivalTools.JobDriver_DropSurvivalTool</driverClass>
        <reportString>dropping TargetA.</reportString>
        <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
    </JobDef>
</Defs>
</file>

<file path="1.6/Defs/JobDefs/Jobs_Work.xml">
<Defs>
    <JobDef>
        <defName>FellTree</defName>
        <driverClass>SurvivalTools.JobDriver_FellTree</driverClass>
        <reportString>felling TargetA.</reportString>
        <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
    </JobDef>
    <JobDef>
        <defName>FellTreeDesignated</defName>
        <driverClass>SurvivalTools.JobDriver_FellTree_Designated</driverClass>
        <reportString>felling TargetA.</reportString>
        <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
    </JobDef>
    <JobDef>
    <defName>HarvestTree</defName>
    <driverClass>SurvivalTools.JobDriver_HarvestTree</driverClass>
    <reportString>felling TargetA.</reportString>
    <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
  </JobDef>
  <JobDef>
    <defName>HarvestTreeDesignated</defName>
    <driverClass>SurvivalTools.JobDriver_HarvestTree_Designated</driverClass>
    <reportString>felling TargetA.</reportString>
    <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
  </JobDef>
</Defs>
</file>

<file path="1.6/Defs/PawnColumnDefs/PawnColumns_Misc.xml">
<Defs>
    <PawnColumnDef>
        <defName>SurvivalToolAssignment</defName>
        <label>tool assignment</label>
        <workerClass>SurvivalTools.PawnColumnWorker_SurvivalToolAssignment</workerClass>
        <sortable>true</sortable>
    </PawnColumnDef>
</Defs>
</file>

<file path="1.6/Defs/RecipeDefs/Recipes_Production.xml">
<Defs>
    <!-- Added to workbenches via C# patching rather than XML to maximise compatibility -->
    <RecipeDef>
        <defName>SmeltSurvivalTool</defName>
        <label>smelt tool</label>
        <description>Use heat and strong electromagnets to break down tools into useful resources.</description>
        <jobString>Smelting tool.</jobString>
        <workAmount>1600</workAmount>
        <workSpeedStat>SmeltingSpeed</workSpeedStat>
        <effectWorking>Smelt</effectWorking>
        <soundWorking>Recipe_Smelt</soundWorking>
        <specialProducts>
            <li>Smelted</li>
        </specialProducts>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>SurvivalTools</li>
                    </categories>
                </filter>
                <count>1</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <categories>
                <li>SurvivalTools</li>
            </categories>
            <specialFiltersToDisallow>
                <li>SurvivalTools_AllowNonSmeltable</li>
            </specialFiltersToDisallow>
        </fixedIngredientFilter>
        <forceHiddenSpecialFilters>
            <li>AllowSmeltable</li>
        </forceHiddenSpecialFilters>
    </RecipeDef>
    <RecipeDef>
        <defName>DestroySurvivalTool</defName>
        <label>destroy tool</label>
        <description>Use heat to destroy unwanted tools. This process is faster than smelting, and works on non-smeltable items, but yields no resources.</description>
        <jobString>Destroying tool.</jobString>
        <workAmount>400</workAmount>
        <workSpeedStat>SmeltingSpeed</workSpeedStat>
        <effectWorking>Smelt</effectWorking>
        <soundWorking>Recipe_Smelt</soundWorking>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>SurvivalTools</li>
                    </categories>
                </filter>
                <count>1</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <categories>
                <li>SurvivalTools</li>
            </categories>
        </fixedIngredientFilter>
        <defaultIngredientFilter>
            <categories>
                <li>SurvivalTools</li>
            </categories>
            <disallowedThingDefs>
                <li>SurvivalTools_Multitool</li>
            </disallowedThingDefs>
        </defaultIngredientFilter>
    </RecipeDef>
</Defs>
</file>

<file path="1.6/Defs/SpecialThingFilterDefs/SpecialThingFilters.xml">
<Defs>
    <SpecialThingFilterDef>
        <defName>SurvivalTools_AllowSmeltable</defName>
        <label>allow smeltable</label>
        <parentCategory>SurvivalTools</parentCategory>
        <allowedByDefault>true</allowedByDefault>
        <saveKey>survivalTools_AllowSmeltable</saveKey>
        <workerClass>SpecialThingFilterWorker_Smeltable</workerClass>
    </SpecialThingFilterDef>
    <SpecialThingFilterDef>
        <defName>SurvivalTools_AllowNonSmeltable</defName>
        <label>allow non-smeltable</label>
        <parentCategory>SurvivalTools</parentCategory>
        <allowedByDefault>true</allowedByDefault>
        <saveKey>survivalTools_AllowNonSmeltable</saveKey>
        <workerClass>SurvivalTools.SpecialThingFilterWorker_NonSmeltableTools</workerClass>
    </SpecialThingFilterDef>
</Defs>
</file>

<file path="1.6/Defs/Stats/StatCategories.xml">
<Defs>
    <StatCategoryDef>
        <defName>SurvivalTool</defName>
        <label>Tool</label>
        <displayOrder>29</displayOrder>
        <displayAllByDefault>true</displayAllByDefault>
    </StatCategoryDef>
    <StatCategoryDef>
        <defName>SurvivalToolMaterial</defName>
        <label>Tool material effectiveness</label>
        <displayOrder>29</displayOrder>
        <displayAllByDefault>true</displayAllByDefault>
    </StatCategoryDef>
</Defs>
</file>

<file path="1.6/Defs/Stats/Stats_Tool_General.xml">
<Defs>
    <StatDef>
        <defName>ToolEstimatedLifespan</defName>
        <workerClass>SurvivalTools.StatWorker_EstimatedLifespan</workerClass>
        <label>estimated tool lifespan</label>
        <description>The amount of continuous use this tool can withstand before breaking. This doesn't take the current condition of the tool into account.</description>
        <category>SurvivalTool</category>
        <displayPriorityInCategory>20</displayPriorityInCategory>
        <minValue>0</minValue>
        <toStringStyle>FloatOne</toStringStyle>
        <formatString>{0} days</formatString>
        <parts>
            <li Class="StatPart_Quality">
                <factorAwful>0.7</factorAwful>
                <factorPoor>0.85</factorPoor>
                <factorNormal>1</factorNormal>
                <factorGood>1.2</factorGood>
                <factorExcellent>1.4</factorExcellent>
                <factorMasterwork>1.8</factorMasterwork>
                <factorLegendary>2.7</factorLegendary>
            </li>
        </parts>
    </StatDef>
    <StatDef>
        <defName>ToolEffectivenessFactor</defName>
        <label>tool effectiveness factor</label>
        <description>A global multiplier of this tool's stat modifiers.</description>
        <category>SurvivalTool</category>
        <displayPriorityInCategory>10</displayPriorityInCategory>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <showIfUndefined>false</showIfUndefined>
        <parts>
            <li Class="StatPart_Quality">
                <factorAwful>0.8</factorAwful>
                <factorPoor>0.9</factorPoor>
                <factorNormal>1</factorNormal>
                <factorGood>1.1</factorGood>
                <factorExcellent>1.2</factorExcellent>
                <factorMasterwork>1.35</factorMasterwork>
                <factorLegendary>1.6</factorLegendary>
            </li>
        </parts>
    </StatDef>
</Defs>
</file>

<file path="1.6/Defs/ThingCategoryDefs/SurvivalTools_CleaningMaterials.xml">
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <!-- Subcategory to surface cleaning tool-stuff (cloth, wools, etc.) in survival tool assignment UI -->
    <ThingCategoryDef>
        <defName>SurvivalToolsCleaningMaterials</defName>
        <label>cleaning materials</label>
        <parent>SurvivalTools</parent>
    </ThingCategoryDef>
</Defs>
</file>

<file path="1.6/Defs/ThingCategoryDefs/ThingCategories.xml">
<Defs>
    <ThingCategoryDef>
        <defName>SurvivalTools</defName>
        <label>tools</label>
        <parent>Root</parent>
    </ThingCategoryDef>
    <ThingCategoryDef>
        <defName>SurvivalToolsNeolithic</defName>
        <label>basic tools</label>
        <parent>SurvivalTools</parent>
    </ThingCategoryDef>
    <ThingCategoryDef>
        <defName>SurvivalToolsIndustrial</defName>
        <label>modern tools</label>
        <parent>SurvivalTools</parent>
    </ThingCategoryDef>
    <ThingCategoryDef>
        <defName>SurvivalToolsSpacer</defName>
        <label>advanced tools</label>
        <parent>SurvivalTools</parent>
    </ThingCategoryDef>
</Defs>
</file>

<file path="1.6/Defs/ThingDefs/Tools_Base.xml">
<Defs>
    <ThingDef Name="BaseSurvivalTool" Abstract="True">
        <!-- Inherits from ThingWithComps; properties are defined through the DefModExtension SurvivalToolProperties -->
        <thingClass>SurvivalTools.SurvivalTool</thingClass>
        <statBases>
            <MaxHitPoints>100</MaxHitPoints>
            <DeteriorationRate>2</DeteriorationRate>
            <Mass>2</Mass>
            <Flammability>1</Flammability>
            <Beauty>-7</Beauty>
            <ToolEffectivenessFactor>1</ToolEffectivenessFactor>
        </statBases>
        <graphicData>
            <onGroundRandomRotateAngle>35</onGroundRandomRotateAngle>
        </graphicData>
        <equippedAngleOffset>-65</equippedAngleOffset>
        <comps>
            <li Class="CompProperties_Forbiddable"/>
            <li>
                <compClass>CompEquippable</compClass>
            </li>
        </comps>
        <tickerType>Never</tickerType>
        <category>Item</category>
        <drawGUIOverlay>true</drawGUIOverlay>
        <equipmentType>Primary</equipmentType>
        <resourceReadoutPriority>Middle</resourceReadoutPriority>
        <selectable>true</selectable>
        <altitudeLayer>Item</altitudeLayer>
        <useHitPoints>true</useHitPoints>
        <alwaysHaulable>true</alwaysHaulable>
        <pathCost>15</pathCost>
    </ThingDef>
</Defs>
</file>

<file path="1.6/Defs/ThingSetMakerDefs/ThingSetMakers_MapGen.xml">
<Defs>
    <ThingSetMakerDef>
        <defName>MapGen_AncientRuinsSurvivalTools</defName>
        <root Class="ThingSetMaker_Sum">
            <options>
                <li>
                    <chance>0.4</chance>
                    <thingSetMaker Class="ThingSetMaker_Count">
                        <fixedParams>
                            <techLevel>Industrial</techLevel>
                            <filter>
                                <categories>
                                    <li>SurvivalTools</li>
                                </categories>
                            </filter>
                            <countRange>
                                <min>1</min>
                                <max>2</max>
                            </countRange>
                        </fixedParams>
                    </thingSetMaker>
                </li>
            </options>
        </root>
    </ThingSetMakerDef>
</Defs>
</file>

<file path="1.6/Defs/ThinkTreeDefs/SubTrees_Misc.xml">
<Defs>
    <ThinkTreeDef>
        <defName>OptimizeSurvivalTools</defName>
        <insertTag>Humanlike_PreMain</insertTag>
        <insertPriority>250</insertPriority>
        <thinkRoot Class="SurvivalTools.JobGiver_OptimizeSurvivalTools" />
    </ThinkTreeDef>
</Defs>
</file>

<file path="1.6/Defs/WorkGiverDefs/WorkGivers.xml">
<Defs>
    <WorkGiverDef>
        <defName>FellTrees</defName>
        <label>fell trees</label>
        <giverClass>SurvivalTools.WorkGiver_FellTrees</giverClass>
        <workType>PlantCutting</workType>
        <priorityInType>50</priorityInType>
        <verb>fell</verb>
        <gerund>felling</gerund>
        <requiredCapacities>
            <li>Manipulation</li>
        </requiredCapacities>
        <modExtensions>
            <li Class="SurvivalTools.WorkGiverExtension">
                <requiredStats>
                    <li>TreeFellingSpeed</li>
                </requiredStats>
            </li>
        </modExtensions>
    </WorkGiverDef>
</Defs>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/ConceptDef/Concepts_NotedOpportunistic.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <UsingSurvivalTools.label>基础工具：使用工具</UsingSurvivalTools.label>
  <UsingSurvivalTools.helpText>殖民者将自动使用任何工具，工作任务中的工具将从他们的主工具和他们的背包中寻找，并使用其中最好的。殖民者在使用的任何工具都将被标记为"使用中"。</UsingSurvivalTools.helpText>
  <SurvivalToolDegradation.label>基础工具：工具老化</SurvivalToolDegradation.label>
  <SurvivalToolDegradation.helpText>殖民者在使用他们主工具或背包里的工具时，这些工具会因过度使用而老化，并最终失效。\n\n你可以通过查看工具的信息栏来确认工具在失效前还能够使用多久,尽管这些读数并不影响工具的当前状态。</SurvivalToolDegradation.helpText>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/ConceptDef/Concepts_NotedSelfshow.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <EquippingSurvivalTools.label>基础工具：装备工具</EquippingSurvivalTools.label>
  <EquippingSurvivalTools.helpText>为了让殖民者能够有效地执行某些任务（例如，砍伐树木），他们需要一些顺手的工具(例如，砍伐树木的斧头)\n\n殖民者一次只能携带3个工具，所以请记住这一点。</EquippingSurvivalTools.helpText>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <DropSurvivalTool.reportString>丢下 TargetA.</DropSurvivalTool.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <FellTree.reportString>砍伐 TargetA。</FellTree.reportString>
  <FellTreeDesignated.reportString>砍伐 TargetA。</FellTreeDesignated.reportString>
  <HarvestTree.reportString>收割 TargetA。</HarvestTree.reportString>
  <HarvestTreeDesignated.reportString>收割 TargetA。</HarvestTreeDesignated.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/PawnColumnDef/PawnColumns_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <SurvivalToolAssignment.label>工具配置</SurvivalToolAssignment.label>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/RecipeDef/Recipes_Add_Make.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- SPECIAL: These Recipes from makeable ThingDefs (which include <recipeMaker>), generated by RimTrans -->
  <!-- Recipe Users: ElectricTailoringBench, HandTailoringBench -->
  <Make_SurvivalTools_ToolBelt.label>制作工具腰带</Make_SurvivalTools_ToolBelt.label>
  <Make_SurvivalTools_ToolBelt.description>制作工具腰带。</Make_SurvivalTools_ToolBelt.description>
  <Make_SurvivalTools_ToolBelt.jobString>正在制作工具腰带。</Make_SurvivalTools_ToolBelt.jobString>
  <!-- Recipe Users: CraftingSpot, ElectricSmithy, FueledSmithy -->
  <Make_SurvivalTools_Axe.label>制作斧头</Make_SurvivalTools_Axe.label>
  <Make_SurvivalTools_Axe.description>制作斧头。</Make_SurvivalTools_Axe.description>
  <Make_SurvivalTools_Axe.jobString>正在制作斧头。</Make_SurvivalTools_Axe.jobString>
  <Make_SurvivalTools_Pickaxe.label>制作十字镐</Make_SurvivalTools_Pickaxe.label>
  <Make_SurvivalTools_Pickaxe.description>制作十字镐。</Make_SurvivalTools_Pickaxe.description>
  <Make_SurvivalTools_Pickaxe.jobString>正在制作十字镐。</Make_SurvivalTools_Pickaxe.jobString>
  <Make_SurvivalTools_Hammer.label>制作锤子</Make_SurvivalTools_Hammer.label>
  <Make_SurvivalTools_Hammer.description>制作锤子。</Make_SurvivalTools_Hammer.description>
  <Make_SurvivalTools_Hammer.jobString>正在制作锤子。</Make_SurvivalTools_Hammer.jobString>
  <Make_SurvivalTools_Sickle.label>制作镰刀</Make_SurvivalTools_Sickle.label>
  <Make_SurvivalTools_Sickle.description>制作镰刀。</Make_SurvivalTools_Sickle.description>
  <Make_SurvivalTools_Sickle.jobString>正在制作镰刀。</Make_SurvivalTools_Sickle.jobString>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/RecipeDef/Recipes_Production.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- Added to workbenches via C# patching rather than XML to maximise compatibility -->
  <SmeltSurvivalTool.label>熔炼工具</SmeltSurvivalTool.label>
  <SmeltSurvivalTool.description>用强热和电磁把工具分解成有用的金属。</SmeltSurvivalTool.description>
  <SmeltSurvivalTool.jobString>正在熔炼工具。</SmeltSurvivalTool.jobString>
  <DestroySurvivalTool.label>销毁工具</DestroySurvivalTool.label>
  <DestroySurvivalTool.description>用超高温度销毁不需要的工具。比熔炼快，用于不可熔炼的物品，但不产出资源。</DestroySurvivalTool.description>
  <DestroySurvivalTool.jobString>正在销毁工具。</DestroySurvivalTool.jobString>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/SpecialThingFilterDef/SpecialThingFilters.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <SurvivalTools_AllowSmeltable.label>允许熔炼</SurvivalTools_AllowSmeltable.label>
  <SurvivalTools_AllowNonSmeltable.label>允许销毁</SurvivalTools_AllowNonSmeltable.label>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/StatCategoryDef/StatCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <SurvivalTool.label>工具</SurvivalTool.label>
  <SurvivalToolMaterial.label>工具材料的有效性</SurvivalToolMaterial.label>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <ToolEstimatedLifespan.label>工具寿命估算</ToolEstimatedLifespan.label>
  <ToolEstimatedLifespan.description>在损坏前连续使用此工具的量. 这并没有考虑到工具当前的使用情况.</ToolEstimatedLifespan.description>
  <ToolEstimatedLifespan.formatString>{0}天</ToolEstimatedLifespan.formatString>
  <ToolEffectivenessFactor.label>工具效果乘数</ToolEffectivenessFactor.label>
  <ToolEffectivenessFactor.description>这个工具的使用效果乘数。</ToolEffectivenessFactor.description>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <SurvivalTools.label>工具</SurvivalTools.label>
  <SurvivalToolsNeolithic.label>原始工具</SurvivalToolsNeolithic.label>
  <SurvivalToolsIndustrial.label>现代工具</SurvivalToolsIndustrial.label>
  <SurvivalToolsSpacer.label>先进工具</SurvivalToolsSpacer.label>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/ThingDef/Apparel_Belts.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <SurvivalTools_ToolBelt.label>工具腰带</SurvivalTools_ToolBelt.label>
  <SurvivalTools_ToolBelt.description>一种结实的皮带，穿上它将允许佩戴者额外携带两种工具。</SurvivalTools_ToolBelt.description>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <FellTrees.label>伐木</FellTrees.label>
  <FellTrees.verb>伐木</FellTrees.verb>
  <FellTrees.gerund>伐木中</FellTrees.gerund>
</LanguageData>
</file>

<file path="1.6/Languages/English/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>dropping TargetA.</DropSurvivalTool.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/English/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Pawn work stats -->
    <SurvivalToolCarryCapacity.label>tool carrying capacity</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>How many tools this pawn can carry in their inventory. If they have more tools than they can carry, they won't be able to use the excess tools.</SurvivalToolCarryCapacity.description>
    <!-- Mining-related -->
    <DiggingSpeed.label>digging speed</DiggingSpeed.label>
    <DiggingSpeed.description>The speed at which this person digs at walls.</DiggingSpeed.description>
    <MiningYieldDigging.label>mining yield (digging)</MiningYieldDigging.label>
    <MiningYieldDigging.description>The percentage of mined resources a miner will produce. This only applies to wall mining. This doesn't affect the production rate of rock chunks.</MiningYieldDigging.description>
    <!-- Plant-related -->
    <PlantHarvestingSpeed.label>plant harvesting speed</PlantHarvestingSpeed.label>
    <PlantHarvestingSpeed.description>The speed at which this person harvests plants.</PlantHarvestingSpeed.description>
    <SowingSpeed.label>sowing speed</SowingSpeed.label>
    <SowingSpeed.description>The speed at which this person sows seeds and plants crops.</SowingSpeed.description>
    <TreeFellingSpeed.label>tree felling speed</TreeFellingSpeed.label>
    <TreeFellingSpeed.description>The speed at which this person fells trees.</TreeFellingSpeed.description>
    <!-- Maintenance and repair-related -->
    <MaintenanceSpeed.label>maintenance speed</MaintenanceSpeed.label>
    <MaintenanceSpeed.description>The speed at which this person performs maintenance and repairs on buildings and equipment.</MaintenanceSpeed.description>
    <DeconstructionSpeed.label>deconstruction speed</DeconstructionSpeed.label>
    <DeconstructionSpeed.description>The speed at which this person deconstructs buildings and equipment.</DeconstructionSpeed.description>
    <!-- Research-related -->
    <ResearchSpeed.label>research speed</ResearchSpeed.label>
    <ResearchSpeed.description>The speed at which this person conducts research and experiments.</ResearchSpeed.description>
    <!-- Cleaning-related -->
    <CleaningSpeed.label>cleaning speed</CleaningSpeed.label>
    <CleaningSpeed.description>The speed at which this person cleans filth and debris. Anyone can clean, but it's much faster with proper tools.</CleaningSpeed.description>
    <!-- Medical-related -->
    <MedicalOperationSpeed.label>medical operation speed</MedicalOperationSpeed.label>
    <MedicalOperationSpeed.description>The speed at which this person performs medical operations and surgery.</MedicalOperationSpeed.description>
    <MedicalSurgerySuccessChance.label>medical surgery success chance</MedicalSurgerySuccessChance.label>
    <MedicalSurgerySuccessChance.description>The likelihood that this person's medical operations will succeed without complications.</MedicalSurgerySuccessChance.description>
    <!-- Butchery-related -->
    <ButcheryFleshSpeed.label>butchery speed</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>The speed at which this person butchers animals and processes meat.</ButcheryFleshSpeed.description>
    <ButcheryFleshEfficiency.label>butchery efficiency</ButcheryFleshEfficiency.label>
    <ButcheryFleshEfficiency.description>The amount of meat and other products this person can extract from animal carcasses.</ButcheryFleshEfficiency.description>
</LanguageData>
</file>

<file path="1.6/Languages/English/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Tool-related stats -->
    <ToolEstimatedLifespan.label>estimated tool lifespan</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>The amount of continuous use this tool can withstand before breaking. This doesn't take the current condition of the tool into account.</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>tool effectiveness factor</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>A global multiplier of this tool's stat modifiers.</ToolEffectivenessFactor.description>
</LanguageData>
</file>

<file path="1.6/Languages/English/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>tools</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>basic tools</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>modern tools</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>advanced tools</SurvivalToolsSpacer.label>
</LanguageData>
</file>

<file path="1.6/Languages/English/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>fell trees</FellTrees.label>
    <FellTrees.verb>fell</FellTrees.verb>
    <FellTrees.gerund>felling</FellTrees.gerund>
</LanguageData>
</file>

<file path="1.6/Languages/English/keyed/ST_GearTab.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Phase 7: Gear tab localization -->
    <!-- Header -->
    <ST_GearTab_Header>Tool Efficiency</ST_GearTab_Header>
    <!-- Tool categories -->
    <ST_GearTab_Mining>Mining</ST_GearTab_Mining>
    <ST_GearTab_Chopping>Chopping</ST_GearTab_Chopping>
    <ST_GearTab_Construction>Construction</ST_GearTab_Construction>
    <ST_GearTab_Cooking>Cooking</ST_GearTab_Cooking>
    <ST_GearTab_Medical>Medical</ST_GearTab_Medical>
    <ST_GearTab_Crafting>Crafting</ST_GearTab_Crafting>
    <ST_GearTab_Social>Social</ST_GearTab_Social>
    <!-- No tools message -->
    <ST_GearTab_NoTools>No suitable tools carried</ST_GearTab_NoTools>
    <!-- Tool tooltips -->
    <ST_GearTab_ToolTooltip_Base>Current efficiency: {0}</ST_GearTab_ToolTooltip_Base>
    <ST_GearTab_ToolTooltip_Quality>Quality: {0}</ST_GearTab_ToolTooltip_Quality>
    <ST_GearTab_ToolTooltip_Material>Material: {0}</ST_GearTab_ToolTooltip_Material>
    <ST_GearTab_ToolTooltip_Condition>Condition: {0}%</ST_GearTab_ToolTooltip_Condition>
    <ST_GearTab_ToolTooltip_StatDetail>
{0}:
  Base: {1}
  Quality: {2}
  Material: {3}
  Total: {4}
    </ST_GearTab_ToolTooltip_StatDetail>
    <!-- Score display -->
    <ST_GearTab_Score>Score: {0}</ST_GearTab_Score>
    <ST_GearTab_ScoreExcellent>Excellent</ST_GearTab_ScoreExcellent>
    <ST_GearTab_ScoreGood>Good</ST_GearTab_ScoreGood>
    <ST_GearTab_ScoreFair>Fair</ST_GearTab_ScoreFair>
    <ST_GearTab_ScorePoor>Poor</ST_GearTab_ScorePoor>
    <ST_GearTab_ScoreAwful>Awful</ST_GearTab_ScoreAwful>
    <!-- Why text for tool explanations -->
    <ST_GearTab_Why>{0} +{1}%</ST_GearTab_Why>
    <!-- Error states -->
    <ST_GearTab_Error>Tool panel error</ST_GearTab_Error>
    <ST_GearTab_Unavailable>Panel unavailable</ST_GearTab_Unavailable>
</LanguageData>
</file>

<file path="1.6/Languages/French/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>lâche TargetA.</DropSurvivalTool.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/French/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>abat TargetA.</FellTree.reportString>
    <FellTreeDesignated.reportString>abat TargetA.</FellTreeDesignated.reportString>
    <HarvestTree.reportString>récolte TargetA.</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>récolte TargetA.</HarvestTreeDesignated.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/French/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalToolCarryCapacity.label>capacité de transport d'outils</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>Combien d'outils ce personnage peut porter dans son inventaire. S'il a plus d'outils qu'il ne peut en porter, il ne pourra pas utiliser les outils en excès.</SurvivalToolCarryCapacity.description>
    <DiggingSpeed.label>vitesse de creusage</DiggingSpeed.label>
    <DiggingSpeed.description>La vitesse à laquelle cette personne creuse les murs.</DiggingSpeed.description>
    <CleaningSpeed.label>vitesse de nettoyage</CleaningSpeed.label>
    <CleaningSpeed.description>La vitesse à laquelle cette personne nettoie la saleté et les débris. N'importe qui peut nettoyer, mais c'est beaucoup plus rapide avec les bons outils.</CleaningSpeed.description>
    <ButcheryFleshSpeed.label>vitesse de boucherie</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>La vitesse à laquelle cette personne découpe les animaux et traite la viande.</ButcheryFleshSpeed.description>
</LanguageData>
</file>

<file path="1.6/Languages/French/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <ToolEstimatedLifespan.label>durée de vie estimée de l'outil</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>La quantité d'utilisation continue que cet outil peut supporter avant de se casser. Cela ne prend pas en compte l'état actuel de l'outil.</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>facteur d'efficacité de l'outil</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>Un multiplicateur global des modificateurs de statistiques de cet outil.</ToolEffectivenessFactor.description>
</LanguageData>
</file>

<file path="1.6/Languages/French/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>outils</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>outils de base</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>outils modernes</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>outils avancés</SurvivalToolsSpacer.label>
</LanguageData>
</file>

<file path="1.6/Languages/French/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>abattre des arbres</FellTrees.label>
    <FellTrees.verb>abattre</FellTrees.verb>
    <FellTrees.gerund>abattage</FellTrees.gerund>
</LanguageData>
</file>

<file path="1.6/Languages/German/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>lässt TargetA fallen.</DropSurvivalTool.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/German/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>fällt TargetA.</FellTree.reportString>
    <FellTreeDesignated.reportString>fällt TargetA.</FellTreeDesignated.reportString>
    <HarvestTree.reportString>erntet TargetA.</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>erntet TargetA.</HarvestTreeDesignated.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/German/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Pawn work stats -->
    <SurvivalToolCarryCapacity.label>Werkzeugtragekapazität</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>Wie viele Werkzeuge dieser Charakter in seinem Inventar tragen kann. Wenn er mehr Werkzeuge hat, als er tragen kann, kann er die überschüssigen Werkzeuge nicht verwenden.</SurvivalToolCarryCapacity.description>
    <!-- Mining-related -->
    <DiggingSpeed.label>Grabgeschwindigkeit</DiggingSpeed.label>
    <DiggingSpeed.description>Die Geschwindigkeit, mit der diese Person Wände ausgräbt.</DiggingSpeed.description>
    <MiningYieldDigging.label>Abbauertrag (Graben)</MiningYieldDigging.label>
    <MiningYieldDigging.description>Der Prozentsatz der abgebauten Ressourcen, den ein Bergarbeiter produziert. Dies gilt nur für den Wandabbau. Dies beeinflusst nicht die Produktionsrate von Gesteinsbrocken.</MiningYieldDigging.description>
    <!-- Plant-related -->
    <PlantHarvestingSpeed.label>Pflanzenernte-Geschwindigkeit</PlantHarvestingSpeed.label>
    <PlantHarvestingSpeed.description>Die Geschwindigkeit, mit der diese Person Pflanzen erntet.</PlantHarvestingSpeed.description>
    <SowingSpeed.label>Sägeschwindigkeit</SowingSpeed.label>
    <SowingSpeed.description>Die Geschwindigkeit, mit der diese Person Samen sät und Pflanzen anbaut.</SowingSpeed.description>
    <TreeFellingSpeed.label>Baumfällgeschwindigkeit</TreeFellingSpeed.label>
    <TreeFellingSpeed.description>Die Geschwindigkeit, mit der diese Person Bäume fällt.</TreeFellingSpeed.description>
    <!-- Maintenance and repair-related -->
    <MaintenanceSpeed.label>Wartungsgeschwindigkeit</MaintenanceSpeed.label>
    <MaintenanceSpeed.description>Die Geschwindigkeit, mit der diese Person Wartung und Reparaturen an Gebäuden und Ausrüstung durchführt.</MaintenanceSpeed.description>
    <DeconstructionSpeed.label>Abbaugeschwindigkeit</DeconstructionSpeed.label>
    <DeconstructionSpeed.description>Die Geschwindigkeit, mit der diese Person Gebäude und Ausrüstung abbaut.</DeconstructionSpeed.description>
    <!-- Research-related -->
    <ResearchSpeed.label>Forschungsgeschwindigkeit</ResearchSpeed.label>
    <ResearchSpeed.description>Die Geschwindigkeit, mit der diese Person Forschung und Experimente durchführt.</ResearchSpeed.description>
    <!-- Cleaning-related -->
    <CleaningSpeed.label>Reinigungsgeschwindigkeit</CleaningSpeed.label>
    <CleaningSpeed.description>Die Geschwindigkeit, mit der diese Person Schmutz und Trümmer reinigt. Jeder kann reinigen, aber es ist viel schneller mit den richtigen Werkzeugen.</CleaningSpeed.description>
    <!-- Medical-related -->
    <MedicalOperationSpeed.label>Medizinische Operationsgeschwindigkeit</MedicalOperationSpeed.label>
    <MedicalOperationSpeed.description>Die Geschwindigkeit, mit der diese Person medizinische Operationen und Chirurgie durchführt.</MedicalOperationSpeed.description>
    <MedicalSurgerySuccessChance.label>Medizinische Chirurgie-Erfolgsrate</MedicalSurgerySuccessChance.label>
    <MedicalSurgerySuccessChance.description>Die Wahrscheinlichkeit, dass die medizinischen Operationen dieser Person ohne Komplikationen erfolgreich sind.</MedicalSurgerySuccessChance.description>
    <!-- Butchery-related -->
    <ButcheryFleshSpeed.label>Schlachtgeschwindigkeit</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>Die Geschwindigkeit, mit der diese Person Tiere schlachtet und Fleisch verarbeitet.</ButcheryFleshSpeed.description>
    <ButcheryFleshEfficiency.label>Schlachteffizienz</ButcheryFleshEfficiency.label>
    <ButcheryFleshEfficiency.description>Die Menge an Fleisch und anderen Produkten, die diese Person aus Tierkadavern extrahieren kann.</ButcheryFleshEfficiency.description>
</LanguageData>
</file>

<file path="1.6/Languages/German/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Tool-related stats -->
    <ToolEstimatedLifespan.label>Geschätzte Werkzeuglebensdauer</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>Die Menge an kontinuierlicher Nutzung, die dieses Werkzeug aushalten kann, bevor es bricht. Dies berücksichtigt nicht den aktuellen Zustand des Werkzeugs.</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>Werkzeugeffektivitätsfaktor</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>Ein globaler Multiplikator der Statusmodifikatoren dieses Werkzeugs.</ToolEffectivenessFactor.description>
</LanguageData>
</file>

<file path="1.6/Languages/German/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>Werkzeuge</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>Grundwerkzeuge</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>Moderne Werkzeuge</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>Fortgeschrittene Werkzeuge</SurvivalToolsSpacer.label>
</LanguageData>
</file>

<file path="1.6/Languages/German/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>Bäume fällen</FellTrees.label>
    <FellTrees.verb>fällen</FellTrees.verb>
    <FellTrees.gerund>fällend</FellTrees.gerund>
</LanguageData>
</file>

<file path="1.6/Languages/Japanese/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>TargetAを落としています。</DropSurvivalTool.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/Japanese/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>TargetAを伐採しています。</FellTree.reportString>
    <FellTreeDesignated.reportString>TargetAを伐採しています。</FellTreeDesignated.reportString>
    <HarvestTree.reportString>TargetAを収穫しています。</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>TargetAを収穫しています。</HarvestTreeDesignated.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/Japanese/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Pawn work stats -->
    <SurvivalToolCarryCapacity.label>道具運搬能力</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>このポーンがインベントリに運ぶことができる道具の数。運搬能力を超える道具を持っている場合、余分な道具は使用できません。</SurvivalToolCarryCapacity.description>
    <!-- Mining-related -->
    <DiggingSpeed.label>掘削速度</DiggingSpeed.label>
    <DiggingSpeed.description>この人が壁を掘る速度。</DiggingSpeed.description>
    <MiningYieldDigging.label>採掘収量（掘削）</MiningYieldDigging.label>
    <MiningYieldDigging.description>採掘者が産出する採掘資源の割合。これは壁の採掘にのみ適用されます。岩塊の生産率には影響しません。</MiningYieldDigging.description>
    <!-- Plant-related -->
    <PlantHarvestingSpeed.label>植物収穫速度</PlantHarvestingSpeed.label>
    <PlantHarvestingSpeed.description>この人が植物を収穫する速度。</PlantHarvestingSpeed.description>
    <SowingSpeed.label>播種速度</SowingSpeed.label>
    <SowingSpeed.description>この人が種を播き、作物を植える速度。</SowingSpeed.description>
    <TreeFellingSpeed.label>伐木速度</TreeFellingSpeed.label>
    <TreeFellingSpeed.description>この人が木を伐採する速度。</TreeFellingSpeed.description>
    <!-- Maintenance and repair-related -->
    <MaintenanceSpeed.label>保守速度</MaintenanceSpeed.label>
    <MaintenanceSpeed.description>この人が建物や設備の保守・修理を行う速度。</MaintenanceSpeed.description>
    <DeconstructionSpeed.label>解体速度</DeconstructionSpeed.label>
    <DeconstructionSpeed.description>この人が建物や設備を解体する速度。</DeconstructionSpeed.description>
    <!-- Research-related -->
    <ResearchSpeed.label>研究速度</ResearchSpeed.label>
    <ResearchSpeed.description>この人が研究や実験を行う速度。</ResearchSpeed.description>
    <!-- Cleaning-related -->
    <CleaningSpeed.label>清掃速度</CleaningSpeed.label>
    <CleaningSpeed.description>この人が汚れや破片を清掃する速度。誰でも清掃はできますが、適切な道具があればはるかに速くなります。</CleaningSpeed.description>
    <!-- Medical-related -->
    <MedicalOperationSpeed.label>医療手術速度</MedicalOperationSpeed.label>
    <MedicalOperationSpeed.description>この人が医療手術や外科手術を行う速度。</MedicalOperationSpeed.description>
    <MedicalSurgerySuccessChance.label>医療手術成功率</MedicalSurgerySuccessChance.label>
    <MedicalSurgerySuccessChance.description>この人の医療手術が合併症なく成功する可能性。</MedicalSurgerySuccessChance.description>
    <!-- Butchery-related -->
    <ButcheryFleshSpeed.label>屠殺速度</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>この人が動物を屠殺し、肉を処理する速度。</ButcheryFleshSpeed.description>
    <ButcheryFleshEfficiency.label>屠殺効率</ButcheryFleshEfficiency.label>
    <ButcheryFleshEfficiency.description>この人が動物の死骸から抽出できる肉やその他の製品の量。</ButcheryFleshEfficiency.description>
</LanguageData>
</file>

<file path="1.6/Languages/Japanese/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Tool-related stats -->
    <ToolEstimatedLifespan.label>道具の推定寿命</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>この道具が壊れるまでに耐えられる連続使用時間。道具の現在の状態は考慮されません。</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>道具効果係数</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>この道具の能力値修正の全体的な倍率。</ToolEffectivenessFactor.description>
</LanguageData>
</file>

<file path="1.6/Languages/Japanese/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>道具</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>基本道具</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>現代道具</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>先進道具</SurvivalToolsSpacer.label>
</LanguageData>
</file>

<file path="1.6/Languages/Japanese/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>木を伐採</FellTrees.label>
    <FellTrees.verb>伐採</FellTrees.verb>
    <FellTrees.gerund>伐採中</FellTrees.gerund>
</LanguageData>
</file>

<file path="1.6/Languages/Russian/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>бросает TargetA.</DropSurvivalTool.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/Russian/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>рубит TargetA.</FellTree.reportString>
    <FellTreeDesignated.reportString>рубит TargetA.</FellTreeDesignated.reportString>
    <HarvestTree.reportString>собирает TargetA.</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>собирает TargetA.</HarvestTreeDesignated.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/Russian/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalToolCarryCapacity.label>грузоподъёмность инструментов</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>Сколько инструментов этот персонаж может нести в своём инвентаре. Если у него больше инструментов, чем он может нести, он не сможет использовать лишние инструменты.</SurvivalToolCarryCapacity.description>
    <DiggingSpeed.label>скорость копания</DiggingSpeed.label>
    <DiggingSpeed.description>Скорость, с которой этот человек копает стены.</DiggingSpeed.description>
    <CleaningSpeed.label>скорость уборки</CleaningSpeed.label>
    <CleaningSpeed.description>Скорость, с которой этот человек убирает грязь и мусор. Любой может убираться, но с правильными инструментами это намного быстрее.</CleaningSpeed.description>
    <ButcheryFleshSpeed.label>скорость разделки</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>Скорость, с которой этот человек разделывает животных и обрабатывает мясо.</ButcheryFleshSpeed.description>
</LanguageData>
</file>

<file path="1.6/Languages/Russian/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <ToolEstimatedLifespan.label>предполагаемый срок службы инструмента</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>Количество непрерывного использования, которое этот инструмент может выдержать до поломки. Это не учитывает текущее состояние инструмента.</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>фактор эффективности инструмента</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>Глобальный множитель модификаторов характеристик этого инструмента.</ToolEffectivenessFactor.description>
</LanguageData>
</file>

<file path="1.6/Languages/Russian/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>инструменты</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>базовые инструменты</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>современные инструменты</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>продвинутые инструменты</SurvivalToolsSpacer.label>
</LanguageData>
</file>

<file path="1.6/Languages/Russian/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>рубить деревья</FellTrees.label>
    <FellTrees.verb>рубить</FellTrees.verb>
    <FellTrees.gerund>рубка</FellTrees.gerund>
</LanguageData>
</file>

<file path="1.6/Languages/Spanish/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>soltando TargetA.</DropSurvivalTool.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/Spanish/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>talando TargetA.</FellTree.reportString>
    <FellTreeDesignated.reportString>talando TargetA.</FellTreeDesignated.reportString>
    <HarvestTree.reportString>cosechando TargetA.</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>cosechando TargetA.</HarvestTreeDesignated.reportString>
</LanguageData>
</file>

<file path="1.6/Languages/Spanish/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalToolCarryCapacity.label>capacidad de carga de herramientas</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>Cuántas herramientas puede llevar este personaje en su inventario. Si tiene más herramientas de las que puede cargar, no podrá usar las herramientas excedentes.</SurvivalToolCarryCapacity.description>
    <DiggingSpeed.label>velocidad de excavación</DiggingSpeed.label>
    <DiggingSpeed.description>La velocidad a la que esta persona excava paredes.</DiggingSpeed.description>
    <CleaningSpeed.label>velocidad de limpieza</CleaningSpeed.label>
    <CleaningSpeed.description>La velocidad a la que esta persona limpia suciedad y escombros. Cualquiera puede limpiar, pero es mucho más rápido con las herramientas adecuadas.</CleaningSpeed.description>
    <ButcheryFleshSpeed.label>velocidad de carnicería</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>La velocidad a la que esta persona sacrifica animales y procesa carne.</ButcheryFleshSpeed.description>
</LanguageData>
</file>

<file path="1.6/Languages/Spanish/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <ToolEstimatedLifespan.label>vida útil estimada de la herramienta</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>La cantidad de uso continuo que esta herramienta puede soportar antes de romperse. Esto no tiene en cuenta el estado actual de la herramienta.</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>factor de efectividad de la herramienta</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>Un multiplicador global de los modificadores de estadísticas de esta herramienta.</ToolEffectivenessFactor.description>
</LanguageData>
</file>

<file path="1.6/Languages/Spanish/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>herramientas</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>herramientas básicas</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>herramientas modernas</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>herramientas avanzadas</SurvivalToolsSpacer.label>
</LanguageData>
</file>

<file path="1.6/Languages/Spanish/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>talar árboles</FellTrees.label>
    <FellTrees.verb>talar</FellTrees.verb>
    <FellTrees.gerund>talando</FellTrees.gerund>
</LanguageData>
</file>

<file path="1.6/Patches/AlphaAnimals/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Alpha Animals</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Red Wood -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="GU_RedWood"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.55</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.55</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Sky Steel -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="AA_SkySteel"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
                <PlantHarvestingSpeed>1.1</PlantHarvestingSpeed>
                <DiggingSpeed>1.1</DiggingSpeed>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/Anomaly/ThingDefs_Items/Items_Resource_Stuff.xml">
<Patch>
    <!-- Apply StuffPropsTool directly to Bioferrite without mod detection -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Bioferrite"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>1.1</TreeFellingSpeed>
                    <PlantHarvestingSpeed>1.1</PlantHarvestingSpeed>
                    <DiggingSpeed>1.2</DiggingSpeed>
                    <MiningYieldDigging>1.15</MiningYieldDigging>
                    <ConstructionSpeed>1.1</ConstructionSpeed>
                    <MaintenanceSpeed>1.1</MaintenanceSpeed>
                    <DeconstructionSpeed>1.1</DeconstructionSpeed>
                    <ResearchSpeed>1.2</ResearchSpeed>
                    <CleaningSpeed>1.0</CleaningSpeed>
                    <MedicalOperationSpeed>1.1</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>1.05</MedicalSurgerySuccessChance>
                    <ButcheryFleshSpeed>1.1</ButcheryFleshSpeed>
                    <ButcheryFleshEfficiency>1.05</ButcheryFleshEfficiency>
                    <SowingSpeed>1.1</SowingSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/AtlasMaterials/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>[1.0] Atlas' Materials</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Blocks_BrickAM -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Blocks_BrickAM"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Blocks_MudAM -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Blocks_MudAM"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.2</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.2</PlantHarvestingSpeed>
                <DiggingSpeed>0.65</DiggingSpeed>
                <MiningYieldDigging>0.83</MiningYieldDigging>
                <ConstructionSpeed>0.65</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Stuff_ConcreteAM -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Stuff_ConcreteAM"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Stuff_RefConcreteAM -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Stuff_RefConcreteAM"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.65</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                <DiggingSpeed>1.1</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Stuff_PlasterAM -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Stuff_PlasterAM"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.2</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.2</PlantHarvestingSpeed>
                <DiggingSpeed>0.5</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.5</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- AM_MixedPlastic -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="AM_MixedPlastic"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.5</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.5</PlantHarvestingSpeed>
                <DiggingSpeed>0.9</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.9</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- AM_UHMWPlastic -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="AM_UHMWPlastic"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <DiggingSpeed>0.9</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.9</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- AM_Acrylic -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="AM_Acrylic"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.9</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.9</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- AM_LWood -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="AM_LWood"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.45</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.45</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/CombatExtended/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Combat Extended</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Axe (cd = 2.4s) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]</xpath>
          <match Class="PatchOperationSequence">
            <operations>
              <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]/tools</xpath>
                <value>
                  <tools>
                    <li Class="CombatExtended.ToolCE">
                      <label>handle</label>
                      <capacities>
                        <li>Poke</li>
                      </capacities>
                      <power>8</power>
                      <armorPenetration>0.075</armorPenetration>
                      <cooldownTime>2.4</cooldownTime>
                      <linkedBodyPartsGroup>Handle</linkedBodyPartsGroup>
                    </li>
                    <li Class="CombatExtended.ToolCE">
                      <label>head</label>
                      <capacities>
                        <li>Cut</li>
                      </capacities>
                      <chanceFactor>1.33</chanceFactor>
                      <power>14</power>
                      <armorPenetration>0.142</armorPenetration>
                      <cooldownTime>2.4</cooldownTime>
                      <linkedBodyPartsGroup>Head</linkedBodyPartsGroup>
                    </li>
                  </tools>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]</xpath>
                <value>
                  <equippedStatOffsets>
                    <MeleeCritChance>0.375</MeleeCritChance>
                    <MeleeParryChance>0.375</MeleeParryChance>
                  </equippedStatOffsets>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]/statBases</xpath>
                <value>
                  <Bulk>4.5</Bulk>
                  <MeleeCounterParryBonus>1.25</MeleeCounterParryBonus>
                </value>
              </li>
            </operations>
          </match>
        </li>
        <!-- Pickaxe (cd = 2.4s) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]</xpath>
          <match Class="PatchOperationSequence">
            <operations>
              <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]/tools</xpath>
                <value>
                  <tools>
                    <li Class="CombatExtended.ToolCE">
                      <label>handle</label>
                      <capacities>
                        <li>Poke</li>
                      </capacities>
                      <power>8</power>
                      <armorPenetration>0.075</armorPenetration>
                      <cooldownTime>2.4</cooldownTime>
                      <linkedBodyPartsGroup>Handle</linkedBodyPartsGroup>
                    </li>
                    <li Class="CombatExtended.ToolCE">
                      <label>head</label>
                      <capacities>
                        <li>Stab</li>
                      </capacities>
                      <chanceFactor>1.33</chanceFactor>
                      <power>14</power>
                      <armorPenetration>0.266</armorPenetration>
                      <cooldownTime>2.4</cooldownTime>
                      <linkedBodyPartsGroup>Head</linkedBodyPartsGroup>
                    </li>
                  </tools>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]</xpath>
                <value>
                  <equippedStatOffsets>
                    <MeleeCritChance>0.375</MeleeCritChance>
                    <MeleeParryChance>0.375</MeleeParryChance>
                  </equippedStatOffsets>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]/statBases</xpath>
                <value>
                  <Bulk>4.5</Bulk>
                  <MeleeCounterParryBonus>1.25</MeleeCounterParryBonus>
                </value>
              </li>
            </operations>
          </match>
        </li>
        <!-- Hammer (cd = 1.85s) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]</xpath>
          <match Class="PatchOperationSequence">
            <operations>
              <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]/tools</xpath>
                <value>
                  <tools>
                    <li Class="CombatExtended.ToolCE">
                      <label>handle</label>
                      <capacities>
                        <li>Blunt</li>
                      </capacities>
                      <power>6</power>
                      <armorPenetration>0.087</armorPenetration>
                      <cooldownTime>1.85</cooldownTime>
                      <linkedBodyPartsGroup>Handle</linkedBodyPartsGroup>
                    </li>
                    <li Class="CombatExtended.ToolCE">
                      <label>head</label>
                      <capacities>
                        <li>Blunt</li>
                      </capacities>
                      <chanceFactor>1.33</chanceFactor>
                      <power>10.7</power>
                      <armorPenetration>0.123</armorPenetration>
                      <cooldownTime>1.85</cooldownTime>
                      <linkedBodyPartsGroup>Head</linkedBodyPartsGroup>
                    </li>
                  </tools>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]</xpath>
                <value>
                  <equippedStatOffsets>
                    <MeleeCritChance>0.25</MeleeCritChance>
                    <MeleeParryChance>0.25</MeleeParryChance>
                  </equippedStatOffsets>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]/statBases</xpath>
                <value>
                  <Bulk>1.5</Bulk>
                </value>
              </li>
            </operations>
          </match>
        </li>
        <!-- Sickle (cd = 1.85s) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]</xpath>
          <match Class="PatchOperationSequence">
            <operations>
              <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]/tools</xpath>
                <value>
                  <tools>
                    <li Class="CombatExtended.ToolCE">
                      <label>handle</label>
                      <capacities>
                        <li>Blunt</li>
                      </capacities>
                      <power>6</power>
                      <armorPenetration>0.087</armorPenetration>
                      <cooldownTime>1.85</cooldownTime>
                      <linkedBodyPartsGroup>Handle</linkedBodyPartsGroup>
                    </li>
                    <li Class="CombatExtended.ToolCE">
                      <label>blade</label>
                      <capacities>
                        <li>Cut</li>
                      </capacities>
                      <chanceFactor>1.33</chanceFactor>
                      <power>10.7</power>
                      <armorPenetration>0.119</armorPenetration>
                      <cooldownTime>1.85</cooldownTime>
                      <linkedBodyPartsGroup>Blade</linkedBodyPartsGroup>
                    </li>
                  </tools>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]</xpath>
                <value>
                  <equippedStatOffsets>
                    <MeleeCritChance>0.25</MeleeCritChance>
                    <MeleeParryChance>0.25</MeleeParryChance>
                  </equippedStatOffsets>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]/statBases</xpath>
                <value>
                  <Bulk>1.5</Bulk>
                </value>
              </li>
            </operations>
          </match>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/PawnTableDefs/PawnTables.xml">
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Auto tool switcher</li>
        </mods>
        <nomatch Class="PatchOperationInsert">
            <xpath>Defs/PawnTableDef[defName="Assign"]/columns/li[text()="Outfit"]</xpath>
            <order>Append</order>
            <value>
                <li>SurvivalToolAssignment</li>
                <li>GapTiny</li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/Scenarios/Scenarios_Classic.xml">
<Patch>
    <!-- Crashlanded -->
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ScenarioDef[defName="Crashlanded"]/scenario/parts</xpath>
        <value>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Axe</thingDef>
                <stuff>Steel</stuff>
            </li>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Hammer</thingDef>
                <stuff>Steel</stuff>
            </li>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Pickaxe</thingDef>
                <stuff>Steel</stuff>
            </li>
        </value>
    </Operation>
    <!-- Lost Tribe -->
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ScenarioDef[defName="LostTribe"]/scenario/parts</xpath>
        <value>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Axe</thingDef>
                <stuff>WoodLog</stuff>
                <count>2</count>
            </li>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Hammer</thingDef>
                <stuff>WoodLog</stuff>
                <count>2</count>
            </li>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Sickle</thingDef>
                <stuff>BlocksSlate</stuff>
                <count>2</count>
            </li>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Pickaxe</thingDef>
                <stuff>Steel</stuff>
            </li>
        </value>
    </Operation>
    <!-- Rich Explorer -->
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ScenarioDef[defName="TheRichExplorer"]/scenario/parts</xpath>
        <value>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Multitool</thingDef>
            </li>
        </value>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/StuffProps_DLC.xml">
<?xml version="1.0" encoding="utf-8" ?>
<Patch>
    <!-- DLC materials require conditional patches -->
    <Operation Class="PatchOperationSequence">
        <operations>
            <!-- WoolMastodon from Odyssey DLC -->
            <li Class="PatchOperationConditional">
                <xpath>/Defs/ThingDef[defName="WoolMastodon"]</xpath>
                <match Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[defName="WoolMastodon"]</xpath>
                    <value>
                        <stuffProps>
                            <statFactors>
                                <StuffPower_Armor_Sharp>0.85</StuffPower_Armor_Sharp>
                            </statFactors>
                        </stuffProps>
                    </value>
                </match>
            </li>
            <!-- WoolMuskox from Odyssey DLC -->
            <li Class="PatchOperationConditional">
                <xpath>/Defs/ThingDef[defName="WoolMuskox"]</xpath>
                <match Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[defName="WoolMuskox"]</xpath>
                    <value>
                        <stuffProps>
                            <statFactors>
                                <StuffPower_Armor_Sharp>0.9</StuffPower_Armor_Sharp>
                            </statFactors>
                        </stuffProps>
                    </value>
                </match>
            </li>
            <!-- BlocksVacstone from Odyssey DLC -->
            <li Class="PatchOperationConditional">
                <xpath>/Defs/ThingDef[defName="BlocksVacstone"]</xpath>
                <match Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[defName="BlocksVacstone"]</xpath>
                    <value>
                        <stuffProps>
                            <statFactors>
                                <StuffPower_Armor_Sharp>1.3</StuffPower_Armor_Sharp>
                            </statFactors>
                        </stuffProps>
                    </value>
                </match>
            </li>
        </operations>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/StuffProps_Fabric.xml">
<?xml version="1.0" encoding="utf-8" ?>
<Patch>
    <Operation Class="PatchOperationSequence">
        <operations>
            <!-- Add StuffProps to Cloth -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="Cloth"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.75</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to Synthread -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="Synthread"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>1.0</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to DevilstrandCloth -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="DevilstrandCloth"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>1.2</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to Hyperweave -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="Hyperweave"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>1.5</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to WoolSheep -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="WoolSheep"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.6</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to WoolAlpaca -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="WoolAlpaca"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.65</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to WoolMegasloth -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="WoolMegasloth"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.8</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to WoolMuffalo -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="WoolMuffalo"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.7</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to WoolBison -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="WoolBison"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.75</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
        </operations>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/ThingDefs_Items/CleaningMaterials_Category.xml">
<?xml version="1.0" encoding="utf-8"?>
<Patch>
    <!-- Simple adds with success=Always so missing defs (DLC not loaded) don't spam errors -->
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='Cloth']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='DevilstrandCloth']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='Hyperweave']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='Synthread']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <!-- Wools (some gated by DLC) -->
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='WoolSheep']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='WoolAlpaca']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='WoolMegasloth']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='WoolMuffalo']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='WoolBison']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/ThingDefs_Misc/Various_Stone.xml">
<Patch>
    <!-- If you want to apply to all stone blocks via the abstract base:
  <Operation Class="PatchOperationAddModExtension">
    <xpath>Defs/ThingDef[@Name="StoneBlocksBase"]</xpath>
    <value>
      <li Class="SurvivalTools.StuffPropsTool">
        <toolStatFactors>
          <li><stat>TreeFellingSpeed</stat><value>0.8</value></li>
          <li><stat>PlantHarvestingSpeed</stat><value>0.8</value></li>
          <li><stat>DiggingSpeed</stat><value>0.8</value></li>
          <li><stat>MiningYieldDigging</stat><value>0.9</value></li>
          <li><stat>ConstructionSpeed</stat><value>0.8</value></li>
        </toolStatFactors>
        <wearFactorMultiplier>1.3</wearFactorMultiplier>
      </li>
    </value>
  </Operation> -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="BlocksSandstone"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.7</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                    <DiggingSpeed>0.8</DiggingSpeed>
                    <MiningYieldDigging>0.9</MiningYieldDigging>
                    <ConstructionSpeed>0.8</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="BlocksGranite"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.85</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                    <DiggingSpeed>0.8</DiggingSpeed>
                    <MiningYieldDigging>0.9</MiningYieldDigging>
                    <ConstructionSpeed>0.8</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="BlocksLimestone"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.8</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                    <DiggingSpeed>0.8</DiggingSpeed>
                    <MiningYieldDigging>0.9</MiningYieldDigging>
                    <ConstructionSpeed>0.8</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="BlocksSlate"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.8</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                    <DiggingSpeed>0.7</DiggingSpeed>
                    <MiningYieldDigging>0.9</MiningYieldDigging>
                    <ConstructionSpeed>0.7</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="BlocksMarble"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.7</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                    <DiggingSpeed>0.7</DiggingSpeed>
                    <MiningYieldDigging>0.85</MiningYieldDigging>
                    <ConstructionSpeed>0.7</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
        </value>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/ThingSetMakerDefs/ThingSetMakers_MapGen.xml">
<Patch>
    <Operation Class="PatchOperationConditional">
        <xpath>            
            Defs/ThingSetMakerDef[defName="MapGen_AncientTempleContents"]
            /root[@Class="ThingSetMaker_Sum"]
            /options/li[
            thingSetMaker[@Class="ThingSetMaker_Count"]
            /fixedParams/filter/thingDefs/li[normalize-space(.)='SurvivalTools_Multitool']
            ]
        </xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>                
                Defs/ThingSetMakerDef[defName="MapGen_AncientTempleContents"]
                /root[@Class="ThingSetMaker_Sum"]/options
            </xpath>
            <value>
                <li>
                    <chance>0.6</chance>
                    <thingSetMaker Class="ThingSetMaker_Count">
                        <fixedParams>
                            <countRange>1~1</countRange>
                            <filter>
                                <thingDefs>
                                    <li>SurvivalTools_Multitool</li>
                                </thingDefs>
                            </filter>
                        </fixedParams>
                    </thingSetMaker>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/TraderKindDefs/TraderKinds_Base_Neolithic.xml">
<Patch>
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Base_Neolithic_Standard"]/stockGenerators/li[categoryDef="SurvivalToolsNeolithic"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Base_Neolithic_Standard"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsNeolithic</categoryDef>
                    <countRange>
                        <min>2</min>
                        <max>6</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/TraderKindDefs/TraderKinds_Base_Outlander.xml">
<Patch>
    <!-- Add Neolithic survival tools to Outlander Standard, if not present -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Base_Outlander_Standard"]/stockGenerators/li[categoryDef="SurvivalToolsNeolithic"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Base_Outlander_Standard"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsNeolithic</categoryDef>
                    <countRange>
                        <min>3</min>
                        <max>6</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
    <!-- Add Spacer survival tools to Outlander Standard, if not present -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Base_Outlander_Standard"]/stockGenerators/li[categoryDef="SurvivalToolsSpacer"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Base_Outlander_Standard"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsSpacer</categoryDef>
                    <countRange>
                        <min>0</min>
                        <max>1</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/TraderKindDefs/TraderKinds_Caravan_Neolithic.xml">
<Patch>
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Caravan_Neolithic_BulkGoods"]/stockGenerators/li[categoryDef="SurvivalToolsNeolithic"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Caravan_Neolithic_BulkGoods"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsNeolithic</categoryDef>
                    <countRange>
                        <min>2</min>
                        <max>4</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/TraderKindDefs/TraderKinds_Caravan_Outlander.xml">
<Patch>
    <!-- Outlander Bulk Goods: add Neolithic survival tools if missing -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Caravan_Outlander_BulkGoods"]/stockGenerators/li[categoryDef="SurvivalToolsNeolithic"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Caravan_Outlander_BulkGoods"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsNeolithic</categoryDef>
                    <countRange>
                        <min>2</min>
                        <max>4</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
    <!-- Outlander Exotic: add Spacer survival tools if missing -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Caravan_Outlander_Exotic"]/stockGenerators/li[categoryDef="SurvivalToolsSpacer"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Caravan_Outlander_Exotic"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsSpacer</categoryDef>
                    <!-- Use 0..1 instead of negative min; IntRange expects non-negative -->
                    <countRange>
                        <min>0</min>
                        <max>1</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/TraderKindDefs/TraderKinds_Orbital_Misc.xml">
<Patch>
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Orbital_Exotic"]/stockGenerators/li[categoryDef="SurvivalToolsSpacer"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Orbital_Exotic"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsSpacer</categoryDef>
                    <countRange>
                        <min>0</min>
                        <max>2</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Crystalloid/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Crystalloid (Rewrite)</li>
      <li>Crystalloid</li>
    </mods>
    <match Class="PatchOperationConditional">
      <!-- If Crysteel exists and already has our StuffPropsTool, do nothing -->
      <xpath>Defs/ThingDef[defName="Crysteel"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
      <nomatch Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Crysteel"]</xpath>
        <value>
          <li Class="SurvivalTools.StuffPropsTool">
            <toolStatFactors>
              <TreeFellingSpeed>1.4</TreeFellingSpeed>
              <PlantHarvestingSpeed>1.4</PlantHarvestingSpeed>
              <DiggingSpeed>1.1</DiggingSpeed>
              <MiningYieldDigging>0.9</MiningYieldDigging>
              <ConstructionSpeed>1.1</ConstructionSpeed>
            </toolStatFactors>
          </li>
        </value>
      </nomatch>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/ExpandedMaterials/Patch.xml">
<?xml version="1.0" encoding="utf-8"?>
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Expanded Materials - Metals</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Copper -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_Copper"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.75</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.75</PlantHarvestingSpeed>
                <DiggingSpeed>0.7</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.7</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.2</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Lead -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_Lead"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.65</DiggingSpeed>
                <MiningYieldDigging>0.85</MiningYieldDigging>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.25</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Bronze -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_Bronze"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.15</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Iron (add MiningYieldDigging for consistency) -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_Iron"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.9</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.9</PlantHarvestingSpeed>
                <DiggingSpeed>0.9</DiggingSpeed>
                <MiningYieldDigging>0.95</MiningYieldDigging>
                <ConstructionSpeed>0.9</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Mild Steel -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_MildSteel"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.95</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.95</PlantHarvestingSpeed>
                <DiggingSpeed>0.95</DiggingSpeed>
                <ConstructionSpeed>0.95</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Stainless Steel -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_StainlessSteel"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
                <PlantHarvestingSpeed>1.1</PlantHarvestingSpeed>
                <DiggingSpeed>1.05</DiggingSpeed>
                <ConstructionSpeed>1.05</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Tempered Steel -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_TemperedSteel"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                  <TreeFellingSpeed>1.25</TreeFellingSpeed>
                  <PlantHarvestingSpeed>1.25</PlantHarvestingSpeed>
                  <DiggingSpeed>1.1</DiggingSpeed>
                  <MiningYieldDigging>1.1</MiningYieldDigging>
                  <ConstructionSpeed>1.1</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>0.9</wearFactorMultiplier>
              </li>
            </value>
        </li>
        <!-- Titanium -->
        <li Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="EM_Titanium"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>1.3</TreeFellingSpeed>
                  <PlantHarvestingSpeed>1.3</PlantHarvestingSpeed>
                  <DiggingSpeed>0.95</DiggingSpeed>
                  <ConstructionSpeed>0.95</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/ExpandedWoodworking/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Expanded Woodworking</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Processed birch lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberBirch"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.55</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                <DiggingSpeed>0.55</DiggingSpeed>
                <MiningYieldDigging>0.75</MiningYieldDigging>
                <ConstructionSpeed>0.55</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed black palm lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberPalm"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed cecropia lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberCecropia"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.55</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                <DiggingSpeed>0.55</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.55</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed cocoawood lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberCocoa"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed cypress lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberCypress"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed drago lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberDrago"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed maple lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberMaple"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.55</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                <DiggingSpeed>0.55</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.55</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed oak lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberOak"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.65</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                <DiggingSpeed>0.65</DiggingSpeed>
                <MiningYieldDigging>0.85</MiningYieldDigging>
                <ConstructionSpeed>0.65</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed pine lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberPine"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed poplar lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberPoplar"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed teak lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberTeak"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.65</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                <DiggingSpeed>0.65</DiggingSpeed>
                <MiningYieldDigging>0.85</MiningYieldDigging>
                <ConstructionSpeed>0.65</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed willow lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberWillow"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed bamboo lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberBamboo"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.5</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.5</PlantHarvestingSpeed>
                <DiggingSpeed>0.5</DiggingSpeed>
                <MiningYieldDigging>0.7</MiningYieldDigging>
                <ConstructionSpeed>0.5</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/ExpandedWoodworkingVGP/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Expanded Woodworking for Vegetable Garden Project</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Nested: VGP Xtra Trees and Flowers -->
        <li Class="PatchOperationFindMod">
          <mods>
            <li>VGP Xtra Trees and Flowers</li>
          </mods>
          <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>
              <!-- LumberAcacia -->
              <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="LumberAcacia"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
                <nomatch Class="PatchOperationAddModExtension">
                  <xpath>Defs/ThingDef[defName="LumberAcacia"]</xpath>
                  <value>
                    <li Class="SurvivalTools.StuffPropsTool">
                      <toolStatFactors>
                        <TreeFellingSpeed>0.65</TreeFellingSpeed>
                        <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                        <DiggingSpeed>0.65</DiggingSpeed>
                        <MiningYieldDigging>0.85</MiningYieldDigging>
                        <ConstructionSpeed>0.65</ConstructionSpeed>
                      </toolStatFactors>
                    </li>
                  </value>
                </nomatch>
              </li>
              <!-- LumberCamellia -->
              <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="LumberCamellia"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
                <nomatch Class="PatchOperationAddModExtension">
                  <xpath>Defs/ThingDef[defName="LumberCamellia"]</xpath>
                  <value>
                    <li Class="SurvivalTools.StuffPropsTool">
                      <toolStatFactors>
                        <TreeFellingSpeed>0.55</TreeFellingSpeed>
                        <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                        <DiggingSpeed>0.55</DiggingSpeed>
                        <MiningYieldDigging>0.75</MiningYieldDigging>
                        <ConstructionSpeed>0.55</ConstructionSpeed>
                      </toolStatFactors>
                    </li>
                  </value>
                </nomatch>
              </li>
              <!-- LumberCherryBlossom -->
              <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="LumberCherryBlossom"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
                <nomatch Class="PatchOperationAddModExtension">
                  <xpath>Defs/ThingDef[defName="LumberCherryBlossom"]</xpath>
                  <value>
                    <li Class="SurvivalTools.StuffPropsTool">
                      <toolStatFactors>
                        <TreeFellingSpeed>0.6</TreeFellingSpeed>
                        <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                        <DiggingSpeed>0.6</DiggingSpeed>
                        <MiningYieldDigging>0.8</MiningYieldDigging>
                        <ConstructionSpeed>0.6</ConstructionSpeed>
                      </toolStatFactors>
                    </li>
                  </value>
                </nomatch>
              </li>
              <!-- LumberJapaneseMaple -->
              <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="LumberJapaneseMaple"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
                <nomatch Class="PatchOperationAddModExtension">
                  <xpath>Defs/ThingDef[defName="LumberJapaneseMaple"]</xpath>
                  <value>
                    <li Class="SurvivalTools.StuffPropsTool">
                      <toolStatFactors>
                        <TreeFellingSpeed>0.55</TreeFellingSpeed>
                        <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                        <DiggingSpeed>0.55</DiggingSpeed>
                        <MiningYieldDigging>0.8</MiningYieldDigging>
                        <ConstructionSpeed>0.55</ConstructionSpeed>
                      </toolStatFactors>
                    </li>
                  </value>
                </nomatch>
              </li>
              <!-- LumberRedMaple -->
              <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="LumberRedMaple"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
                <nomatch Class="PatchOperationAddModExtension">
                  <xpath>Defs/ThingDef[defName="LumberRedMaple"]</xpath>
                  <value>
                    <li Class="SurvivalTools.StuffPropsTool">
                      <toolStatFactors>
                        <TreeFellingSpeed>0.55</TreeFellingSpeed>
                        <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                        <DiggingSpeed>0.55</DiggingSpeed>
                        <MiningYieldDigging>0.8</MiningYieldDigging>
                        <ConstructionSpeed>0.55</ConstructionSpeed>
                      </toolStatFactors>
                    </li>
                  </value>
                </nomatch>
              </li>
            </operations>
          </match>
        </li>
        <!-- LumberIronwood -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberIronwood"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberIronwood"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.7</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                  <DiggingSpeed>0.7</DiggingSpeed>
                  <MiningYieldDigging>0.85</MiningYieldDigging>
                  <ConstructionSpeed>0.7</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberApple -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberApple"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberApple"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.6</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                  <DiggingSpeed>0.6</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberCherry -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberCherry"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberCherry"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.6</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                  <DiggingSpeed>0.6</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberDatePalm -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberDatePalm"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberDatePalm"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.65</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                  <DiggingSpeed>0.65</DiggingSpeed>
                  <MiningYieldDigging>0.85</MiningYieldDigging>
                  <ConstructionSpeed>0.65</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberFig -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberFig"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberFig"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.6</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                  <DiggingSpeed>0.6</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberOrange -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberOrange"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberOrange"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.55</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                  <DiggingSpeed>0.55</DiggingSpeed>
                  <MiningYieldDigging>0.75</MiningYieldDigging>
                  <ConstructionSpeed>0.55</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberPeach -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberPeach"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberPeach"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.6</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                  <DiggingSpeed>0.6</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberCoconut (red palm) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberCoconut"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberCoconut"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.65</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                  <DiggingSpeed>0.65</DiggingSpeed>
                  <MiningYieldDigging>0.85</MiningYieldDigging>
                  <ConstructionSpeed>0.65</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/GlitterTech/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Glitter Tech</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Titanium -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="Titanium"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="Titanium"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>2.0</TreeFellingSpeed>
                  <PlantHarvestingSpeed>2.0</PlantHarvestingSpeed>
                  <DiggingSpeed>1.6</DiggingSpeed>
                  <MiningYieldDigging>1.1</MiningYieldDigging>
                  <ConstructionSpeed>1.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- AlphaPoly -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="AlphaPoly"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="AlphaPoly"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>1.8</TreeFellingSpeed>
                  <PlantHarvestingSpeed>1.8</PlantHarvestingSpeed>
                  <DiggingSpeed>2.0</DiggingSpeed>
                  <MiningYieldDigging>1.3</MiningYieldDigging>
                  <ConstructionSpeed>2.0</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- BetaPoly -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="BetaPoly"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="BetaPoly"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>8.0</TreeFellingSpeed>
                  <PlantHarvestingSpeed>8.0</PlantHarvestingSpeed>
                  <DiggingSpeed>8.6</DiggingSpeed>
                  <MiningYieldDigging>2.0</MiningYieldDigging>
                  <ConstructionSpeed>8.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/KurasExtraGems/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Kura's Extra Gems</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Most gem ThingDefs -->
        <li Class="PatchOperationAddModExtension">
          <xpath>
            Defs/ThingDef[
              defName="Amber" or defName="Amethyst" or defName="Aquamarine" or defName="Benitoite" or defName="Bixbite" or defName="Dioptase" or
              defName="Ekanite" or defName="Emerald" or defName="Garnet" or defName="Heliodor" or defName="Kunzite" or defName="Larimar" or
              defName="Iolite" or defName="Malachite" or defName="Morganite" or defName="Padparadscha" or defName="Peridot" or
              defName="Prasiolite" or defName="Quartz" or defName="Ruby" or defName="Sapphire" or defName="Scapolite" or defName="Tanzanite" or
              defName="Tsavorite" or defName="Sunstone"
            ]
          </xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.9</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.9</PlantHarvestingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <DiggingSpeed>1.1</DiggingSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Diamond (kept explicit in case it differs in other packs) -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Diamond"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.9</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.9</PlantHarvestingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <DiggingSpeed>1.1</DiggingSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/KurasExtraStones/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Kura's Extra Stone</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksDunite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksEmperadordark"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksAndesite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksBlueschist"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksSerpentinite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksObsidian"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksAnorthosite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksBasalt"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksCharnockite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksDacite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksGabbro"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksLherzolite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksMonzonite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksRhyolite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksScoria"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksSovite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksChalk"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksJaspillite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksLignite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksSiltstone"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksGreenSchist"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksMigmatite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/MechalitCore/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Mechalit Core 1.0</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Tisnit"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <DiggingSpeed>1.2</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
                <ConstructionSpeed>1.2</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Simerium"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>1.4</TreeFellingSpeed>
                <PlantHarvestingSpeed>1.4</PlantHarvestingSpeed>
                <DiggingSpeed>1.1</DiggingSpeed>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Phasarium"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Eftam"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.65</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                <DiggingSpeed>0.75</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.75</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Myrithium"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
                <PlantHarvestingSpeed>1.1</PlantHarvestingSpeed>
                <DiggingSpeed>1.3</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
                <ConstructionSpeed>1.3</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Vilanit"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.93</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.93</PlantHarvestingSpeed>
                <DiggingSpeed>0.93</DiggingSpeed>
                <ConstructionSpeed>0.93</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Elementx"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>2.5</TreeFellingSpeed>
                <PlantHarvestingSpeed>2.5</PlantHarvestingSpeed>
                <DiggingSpeed>2.67</DiggingSpeed>
                <MiningYieldDigging>1.3</MiningYieldDigging>
                <ConstructionSpeed>2.67</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Teachmat"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.08</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.08</PlantHarvestingSpeed>
                <DiggingSpeed>0.08</DiggingSpeed>
                <MiningYieldDigging>0.3</MiningYieldDigging>
                <ConstructionSpeed>0.08</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/Mending/Patch.xml">
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>MendAndRecycle</li>
        </mods>
        <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>
                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <RecipeDef ParentName="MendBase">
                            <defName>MendNeolithicSurvivalTool</defName>
                            <label>repair basic tool</label>
                            <description>Repair tool.</description>
                            <jobString>Repairing.</jobString>
                            <workAmount>50</workAmount>
                            <effectWorking>Smith</effectWorking>
                            <soundWorking>Recipe_Smith</soundWorking>
                            <ingredients>
                                <li>
                                    <filter>
                                        <categories>
                                            <li>SurvivalToolsNeolithic</li>
                                        </categories>
                                    </filter>
                                    <count>1</count>
                                </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <allowedHitPointsPercents>
                                    <min>0</min>
                                    <max>0.99</max>
                                </allowedHitPointsPercents>
                                <categories>
                                    <li>SurvivalToolsNeolithic</li>
                                </categories>
                            </fixedIngredientFilter>
                            <skillRequirements>
                                <Crafting>4</Crafting>
                            </skillRequirements>
                        </RecipeDef>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <RecipeDef ParentName="MendBase">
                            <defName>MendIndustrialSurvivalTool</defName>
                            <label>repair modern tool</label>
                            <description>Repair tool.</description>
                            <jobString>Repairing.</jobString>
                            <workAmount>100</workAmount>
                            <effectWorking>Smith</effectWorking>
                            <soundWorking>Recipe_Smith</soundWorking>
                            <ingredients>
                                <li>
                                    <filter>
                                        <categories>
                                            <li>SurvivalToolsIndustrial</li>
                                        </categories>
                                    </filter>
                                    <count>1</count>
                                </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <allowedHitPointsPercents>
                                    <min>0</min>
                                    <max>0.99</max>
                                </allowedHitPointsPercents>
                                <categories>
                                    <li>SurvivalToolsIndustrial</li>
                                </categories>
                            </fixedIngredientFilter>
                            <skillRequirements>
                                <Crafting>6</Crafting>
                            </skillRequirements>
                        </RecipeDef>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <RecipeDef ParentName="MendBase">
                            <defName>MendSpacerSurvivalTool</defName>
                            <label>repair advanced tool</label>
                            <description>Repair tool.</description>
                            <jobString>Repairing.</jobString>
                            <workAmount>200</workAmount>
                            <effectWorking>Smith</effectWorking>
                            <soundWorking>Recipe_Smith</soundWorking>
                            <ingredients>
                                <li>
                                    <filter>
                                        <categories>
                                            <li>SurvivalToolsSpacer</li>
                                        </categories>
                                    </filter>
                                    <count>1</count>
                                </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <allowedHitPointsPercents>
                                    <min>0</min>
                                    <max>0.99</max>
                                </allowedHitPointsPercents>
                                <categories>
                                    <li>SurvivalToolsSpacer</li>
                                </categories>
                            </fixedIngredientFilter>
                            <skillRequirements>
                                <Crafting>8</Crafting>
                            </skillRequirements>
                        </RecipeDef>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/MetalsPlus/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Metals+</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Copper -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Copper"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.75</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.75</PlantHarvestingSpeed>
                <DiggingSpeed>0.83</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.83</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.2</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Tin -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Tin"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <DiggingSpeed>1.1</DiggingSpeed>
                <MiningYieldDigging>0.85</MiningYieldDigging>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.25</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Iron (add MiningYieldDigging for consistency) -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Iron"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.9</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.9</PlantHarvestingSpeed>
                <DiggingSpeed>0.9</DiggingSpeed>
                <MiningYieldDigging>0.95</MiningYieldDigging>
                <ConstructionSpeed>0.9</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Titanium (only add if no extension exists) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="Titanium"]/modExtensions</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="Titanium"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>1.25</TreeFellingSpeed>
                  <PlantHarvestingSpeed>1.25</PlantHarvestingSpeed>
                  <DiggingSpeed>1.1</DiggingSpeed>
                  <ConstructionSpeed>1.1</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>0.9</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- Bronze -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Bronze"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.15</wearFactorMultiplier>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/Odyssey/ThingDefs_Items/Items_Resource_Stuff.xml">
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Ludeon.RimWorld.Odyssey</li>
        </mods>
        <match Class="PatchOperationSequence">
            <operations>
                <!-- BlocksVacstone -->
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="BlocksVacstone"]</xpath>
                    <value>
                        <li Class="SurvivalTools.StuffPropsTool">
                            <toolStatFactors>
                                <TreeFellingSpeed>1.0</TreeFellingSpeed>
                                <PlantHarvestingSpeed>1.0</PlantHarvestingSpeed>
                                <DiggingSpeed>1.0</DiggingSpeed>
                                <MiningYieldDigging>1.0</MiningYieldDigging>
                                <ConstructionSpeed>1.0</ConstructionSpeed>
                            </toolStatFactors>
                        </li>
                    </value>
                </li>
                <!-- Obsidian (if you want to buff/nerf it too) -->
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="Obsidian"]</xpath>
                    <value>
                        <li Class="SurvivalTools.StuffPropsTool">
                            <toolStatFactors>
                                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                                <DiggingSpeed>0.9</DiggingSpeed>
                                <MiningYieldDigging>0.95</MiningYieldDigging>
                                <ConstructionSpeed>0.8</ConstructionSpeed>
                                <MaintenanceSpeed>0.8</MaintenanceSpeed>
                                <DeconstructionSpeed>0.9</DeconstructionSpeed>
                                <ResearchSpeed>0.9</ResearchSpeed>
                                <CleaningSpeed>1.0</CleaningSpeed>
                                <MedicalOperationSpeed>1.2</MedicalOperationSpeed>
                                <MedicalSurgerySuccessChance>1.1</MedicalSurgerySuccessChance>
                                <ButcheryFleshSpeed>1.3</ButcheryFleshSpeed>
                                <ButcheryFleshEfficiency>1.1</ButcheryFleshEfficiency>
                                <SowingSpeed>0.8</SowingSpeed>
                            </toolStatFactors>
                        </li>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Quarry/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Quarry</li>
      <!-- If you know the packageId, prefer this op instead:
      <li Class="PatchOperationFindModByPackageId">
        <mods><li>sarg.quarry</li></mods>
        <match Class="PatchOperationSequence"> ... </match>
      </li>
      -->
    </mods>
    <match Class="PatchOperationConditional">
      <xpath>Defs/WorkGiverDef[defName="QRY_MineQuarry"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
      <!-- If not already present, add our extension -->
      <nomatch Class="PatchOperationAddModExtension">
        <xpath>Defs/WorkGiverDef[defName="QRY_MineQuarry"]</xpath>
        <value>
          <li Class="SurvivalTools.WorkGiverExtension">
            <requiredStats>
              <li>DiggingSpeed</li>
              <li>MiningYieldDigging</li>
            </requiredStats>
          </li>
        </value>
      </nomatch>
      <!-- If already present, do nothing -->
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/ResearchReinvented/FieldResearchSupport.xml">
<?xml version="1.0" encoding="utf-8" ?>
<!-- 
  Research Reinvented Compatibility Patch
  This patch adds FieldResearchSpeedMultiplier stat to our research tools
  when Research Reinvented is loaded, enabling field research functionality.
-->
<Patch>
    <!-- Add FieldResearchSpeedMultiplier to Abacus when RR is loaded -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>PeteTimesSix.ResearchReinvented</li>
        </mods>
        <match Class="PatchOperationSequence">
            <operations>
                <!-- Add FieldResearchSpeedMultiplier to Abacus -->
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="SurvivalTools_Abacus"]/modExtensions/li[@Class="SurvivalTools.SurvivalToolProperties"]/baseWorkStatFactors</xpath>
                    <value>
                        <FieldResearchSpeedMultiplier>0.7</FieldResearchSpeedMultiplier>
                    </value>
                </li>
                <!-- Add FieldResearchSpeedMultiplier to Microscope -->
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="SurvivalTools_Microscope"]/modExtensions/li[@Class="SurvivalTools.SurvivalToolProperties"]/baseWorkStatFactors</xpath>
                    <value>
                        <FieldResearchSpeedMultiplier>1.4</FieldResearchSpeedMultiplier>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Rimefeller/Patch.xml">
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Rimefeller</li>
        </mods>
        <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[@Name="SynthyleneBase"]</xpath>
                    <value>
                        <li Class="SurvivalTools.StuffPropsTool">
                            <toolStatFactors>
                                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                                <DiggingSpeed>0.9</DiggingSpeed>
                                <MiningYieldDigging>0.9</MiningYieldDigging>
                                <ConstructionSpeed>0.9</ConstructionSpeed>
                            </toolStatFactors>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[@Name="FiberCompositeBase"]</xpath>
                    <value>
                        <li Class="SurvivalTools.StuffPropsTool">
                            <toolStatFactors>
                                <TreeFellingSpeed>1.2</TreeFellingSpeed>
                                <PlantHarvestingSpeed>1.2</PlantHarvestingSpeed>
                                <MiningYieldDigging>0.9</MiningYieldDigging>
                            </toolStatFactors>
                        </li>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/RimOfMadnessBones/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Rim of Madness - Bones</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- BoneItem -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="BoneItem"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="BoneItem"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.5</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.5</PlantHarvestingSpeed>
                  <DiggingSpeed>0.6</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- Bonecrete -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="Bonecrete"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="Bonecrete"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.45</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.45</PlantHarvestingSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- BonePlastic -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="BonePlastic"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="BonePlastic"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.3</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.3</PlantHarvestingSpeed>
                  <DiggingSpeed>0.3</DiggingSpeed>
                  <MiningYieldDigging>0.5</MiningYieldDigging>
                  <ConstructionSpeed>0.3</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- BoneChina -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="BoneChina"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="BoneChina"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.12</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.12</PlantHarvestingSpeed>
                  <DiggingSpeed>0.12</DiggingSpeed>
                  <MiningYieldDigging>0.25</MiningYieldDigging>
                  <ConstructionSpeed>0.12</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/RimsenalFederation/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Rimsenal - Federation</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Foerum -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="Foerum"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="Foerum"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>1.3</TreeFellingSpeed>
                  <PlantHarvestingSpeed>1.3</PlantHarvestingSpeed>
                  <DiggingSpeed>0.7</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.7</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/VegetableGarden/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>VGP Vegetable Garden</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Bamboo -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="Bamboo"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="Bamboo"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.5</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.5</PlantHarvestingSpeed>
                  <DiggingSpeed>0.5</DiggingSpeed>
                  <MiningYieldDigging>0.7</MiningYieldDigging>
                  <ConstructionSpeed>0.5</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- Ironwood log -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="VG_IronWoodLog"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="VG_IronWoodLog"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.7</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                  <DiggingSpeed>0.7</DiggingSpeed>
                  <MiningYieldDigging>0.85</MiningYieldDigging>
                  <ConstructionSpeed>0.7</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="docs/DesignTheory.md">
SurvivalTools — Design Theory (Phases 0–7, no animations)
Purpose

Refactor SurvivalTools to a single-brain, single-surface architecture that keeps saves stable, keeps the game booting clean at every step, and replaces scattered logic with one fast, deterministic pipeline. Everything shipped so far preserves gameplay balance unless a difficulty mode or setting explicitly changes behavior.

North-star principles (what guided every decision)

One brain: a single resolver + scoring layer provides all math (what a tool does, how well, when it matters).

One door: a tiny, stable Compat API is the only entry point for integrations (register required stats, aliases, quirks).

One resolver: tools are discovered and interpreted once at startup—no XML sprawl or duplicated inference.

One UI surface: the Gear iTab is the sole place to read tool effects (plus normal Stat Explanation).

Always-Boot: every phase must load and keep prior behavior intact until the new path fully replaces it.

Performance discipline: no LINQ or allocations in hot paths; pooled buffers; explicit cache invalidation.

Save safety: no renames to package id/defNames/public types; only additive changes.

Determinism: same inputs → same outputs (important for explainability, caching, and debugging).

What’s implemented (by phase)
Phase 0 — Safety scaffolding

File dump helper and a dev-only DebugAction that writes status to Desktop.

No behavior changes; all debug output goes to files, not spammy logs.

Phase 1 — Compat & Registry

Minimal Compat API with fast indices:

RegisterWorkGiverRequirement, RegisterJobRequirement, RegisterStatAlias, RegisterToolQuirk(...).

Forwarders in place so old code keeps working; no deletions yet.

Phase 2 — Resolver (single source of truth)

ToolStatResolver catalogs tools once at startup with a strict precedence:

explicit tool tags/properties

statBases that intersect registered work stats

conservative name/verb hints

safe defaults

Per (toolDef, stuffDef, stat) ToolStatInfo is cached; clamping ensures a material never trails toolless baseline on Normal.

Quirk system (predicate + applier) injected after inference, before clamping for lightweight, additive adjustments.

Resolver Version integer increments on rebuild/quirk changes; anything versioned (e.g., scores) auto-invalidates.

Phase 3 — Scoring & caches

ToolScoring: deterministic, zero-alloc scoring; best-tool lookup; top-contributors for UI/explanations.

ScoreCache: struct keys (Pawn, Thing, StatDef, difficultySeed, ResolverVersion); explicit invalidation on:

inventory/equipment change; tool HP/quality change; settings change; resolver version bump.

Bench/debug actions verify performance (10k loop, 0 GC).

Phase 4 — StatPart (single math path)

StatPart_SurvivalTools is now the only way bonuses/penalties enter vanilla stat math.

Same numbers as legacy logic; concise ExplanationPart uses TopContributors.

Harmony patches trigger cache invalidation on inventory/equipment changes.

Phase 5 — Job gating (behavioral change by mode)

JobGate checks WorkGiver/Job required stats against the pawn’s best tool:

Normal: never blocks; penalties only (StatPart).

Hardcore/Nightmare: blocks jobs missing an appropriate tool with a keyed reason string.

WorkGiver_Scanner postfix/prefix patches perform authoritative gating with context-menu reasons.

Alert_ToolGatedWork surfaces why pawns idle (throttled, optional).

GatingEnforcer cancels now-illegal jobs and prunes queues on mode change and save load (quiet by default).

Phase 6 — Assignment (auto-equip before work)

AssignmentSearch.TryUpgradeFor scans inventory/nearby/stocks within radius & path budget, respecting:

min gain threshold; carry limits per difficulty; hysteresis to avoid ping-pong; reservations.

PreWork_AutoEquip prefix tries to equip before a job starts (and before gating blocks), deferring the job cleanly.

Settings expose thresholds; hot paths are allocation-free.

Phase 7 — Gear iTab (single, readable panel)

Right-side panel inside vanilla Gear tab shows:

header (mode, carry, settings),

two-line rows per tool: name+score, then why (top contributors),

tooltips reusing resolver math.

Accurate, alloc-free draw; numbers match Stat Explanation; no virtual-tool noise.

Cross-cutting: PatchGuard, XML, and DefOf correctness

ST_PatchGuard: at runtime, inspects Harmony patches on hotspots and removes legacy ST prefixes/postfixes not on an allowlist (without touching third-party mods). Prevents collisions with the new PreWork/Gear iTab paths.

XML repairs and DefOf elimination: fixed malformed XML; removed all early DefOf access by switching to OnAfterDefsLoaded/lazy initialization. Boots clean with no “Uninitialized DefOf” warnings.

Desktop-only debugging: all dumps and benches write to files; runtime logs stay minimal and use existing ST_Logging.

Architecture (how it fits together)

Startup

Compat registry builds the required-stat maps.

Resolver scans tools → applies quirks → clamps → caches rows; bumps Version.

During play

StatPart uses resolver data for every supported work stat; explanations show the same contributors as the UI.

ToolScoring & ScoreCache provide O(1) best-tool selection and per-tool scores, invalidating on the explicit triggers.

JobGate enforces difficulty policy at WorkGiver level.

AssignmentSearch equips a better/required tool just-in-time to avoid blocks.

Gear iTab visualizes the same math for players.

Alerts/Enforcer explain and enforce mode shifts without spam.

Design rationale (why this shape)

Determinism > cleverness: deterministic math enables explainable UI, stable caching, and reproducible debugging.

Strangler pattern: forwarders first, call-site migration second, deletions last—the game stays playable every commit.

Single source of truth: resolver + scoring remove drift between UI, stat math, and gating.

Small Harmony surface: patch only where value is highest (StatPart, WorkGiver gates, pre-work hook, gear tab draw). Fewer hooks = fewer conflicts.

User clarity: gating reasons, alerts, and the Gear iTab reduce “pawn won’t work” confusion.

Performance discipline: zero-alloc steady-state loops and explicit invalidation prevent GC spikes in renderer/job/scoring paths.

Interop safety: Compat API provides stable, tiny hooks; guarded PatchOps no-op when targets/mods are missing.

Invariants & guarantees

Always-Boot: no red errors; behavior changes are gated strictly by difficulty setting.

Save compatibility: package id, defNames, and public types unchanged; XML stays stable.

Localization: every .Translate() has a key under 1.6/Languages/English/Keyed/.

No motes: visual feedback (today: UI/alerts; later: overlays) never replaces vanilla weapon draw.

Hot paths: StatPart, pre-work hook, WorkGiver gates, Gear iTab draw are allocation-free.

Current user-visible impact

Normal: identical gameplay feel, but better explanations/UI.

Hardcore/Nightmare: tool-gated work is blocked with clear reasons; auto-equip often resolves blocks automatically.

Gear iTab: players can see scores and top contributors per tool, consistent with Stat Explanation.

Alerts: concise, throttled warning when pawns are gated (configurable).

Mode flips / save loads: invalid current/queued jobs cancel quietly; pawns won’t keep doing illegal work.

What’s intentionally not done yet

Animations/overlays (Phase 8).

Deleting all legacy files—PatchGuard isolates them; removal is staged after extended play-testing.

Powered tools & batteries; virtual resource tiers (later milestones).

Deep compat patches beyond the small guarded surface in Patches/.

Open follow-ups (post-Phase 7)

Kill-List deletions: remove legacy auto-equip/gating/UI guts now that the new paths are stable (keep [Obsolete(false)] shims if needed).

UI polish: optional highlight/sort by focused stat; grey out tools at/below baseline.

Perf audit: short profiler passes on large colonies to validate no GC in StatPart/WorkGiver/PreWork/GearTab steady state.

Telemetry (dev-only): count cache hit/miss; single-file desktop dump to spot pathological maps.

Acceptance snapshot (what we verify regularly)

Mining on Nightmare without a pickaxe → job blocked; alert line explains the missing stat/tool.

Normal/Hardcore: Stat Explanation and Gear iTab numbers match for Mining/Construction/Plants.

Auto-equip: before starting mining, a pawn near a clearly better pick equips it (within radius/budget); no ping-pong.

Debug actions produce clean Desktop files; no runtime log spam.

No GC during repeated scoring, pre-work checks, and gear tab scrolling.

This is the foundation the rest of the refactor will sit on: one resolver, one scoring & cache brain, one UI surface, and a minimal Harmony perimeter—deterministic, explainable, and safe to extend.
</file>

<file path="docs/QUIRK_SYSTEM.md">
# Tool Quirk System

The tool quirk system provides a flexible way to apply custom modifications to tool stat factors during resolution. Quirks are applied after the normal stat inference hierarchy but before the final clamping step.

**Key Features:**

- **Deterministic Ordering**: Quirks are processed in exact registration order
- **No Allocations**: Zero allocations during quirk application
- **Safe API**: Validated modifications with debug tracking
- **Performance**: Efficient predicate checking and minimal overhead

## Registration Order

Quirks are processed in **exact registration order** for deterministic behavior. Each quirk receives a monotonic sequence number when registered. This ensures consistent behavior across game sessions and mod load orders.

## Usage

### Register a Quirk

```csharp
using SurvivalTools.Compat;

// Register quirk in your mod's initialization
CompatAPI.RegisterToolQuirk(
    predicate: toolDef => toolDef.label?.Contains("axe") == true,
    action: applier =>
    {
        if (applier.Stat == ST_StatDefOf.TreeFellingSpeed)
        {
            applier.MultiplyFactor(1.15f, "quality axe");
        }
    }
);
```

### Legacy Overload (Obsolete)

````csharp
// Legacy string-based registration (forwards to new system)
CompatAPI.RegisterToolQuirk("MasterworkAxe", "masterwork tool");
```### Predicate Examples

```csharp
// By tool name/label
toolDef => toolDef.label?.ToLowerInvariant().Contains("masterwork") == true

// By tech level
toolDef => toolDef.techLevel >= TechLevel.Spacer

// By mod extension
toolDef => toolDef.GetModExtension<MyCustomToolExtension>() != null

// By stuff category
toolDef => toolDef.MadeFromStuff &&
           toolDef.stuffCategories?.Contains(StuffCategoryDefOf.Precious) == true
````

### Applier Methods

```csharp
// Multiply factor
applier.MultiplyFactor(1.2f, "quality bonus");

// Add flat bonus
applier.AddBonus(0.1f, "skill bonus");

// Set to specific value
applier.SetFactor(1.5f, "override");

// Conditional modifications
applier.MultiplyIf(applier.IsTechLevel(TechLevel.Spacer), 1.3f, "spacer tech");
applier.AddIf(applier.StuffLabelContains("plasteel"), 0.2f, "plasteel bonus");

// Clamping
applier.ClampMax(2.0f, "balance limit");
applier.ClampMin(0.5f, "minimum effectiveness");
applier.ClampRange(0.8f, 1.8f, "balanced range");
```

### Helper Methods

```csharp
// Tool checks
applier.ToolLabelContains("masterwork")
applier.IsTechLevel(TechLevel.Industrial)
applier.IsTechLevelAtLeast(TechLevel.Medieval)
applier.HasModExtension<SurvivalToolProperties>()

// Stuff checks
applier.StuffLabelContains("steel")
applier.StuffHasModExtension<MyStuffExtension>()

// Current values
float currentFactor = applier.Factor;
StatDef currentStat = applier.Stat;
ThingDef tool = applier.ToolDef;
ThingDef stuff = applier.StuffDef;
```

## Example Quirks

### Quality Tool Bonus

```csharp
CompatAPI.RegisterToolQuirk(
    toolDef => toolDef.label?.ToLowerInvariant().Contains("masterwork") == true,
    applier => applier.MultiplyFactor(1.25f, "masterwork quality")
);
```

### Material-Specific Bonuses

```csharp
CompatAPI.RegisterToolQuirk(
    toolDef => toolDef.MadeFromStuff,
    applier =>
    {
        if (applier.StuffLabelContains("plasteel"))
            applier.MultiplyFactor(1.2f, "plasteel efficiency");
        else if (applier.StuffLabelContains("steel"))
            applier.MultiplyFactor(1.1f, "steel durability");
    }
);
```

### Stat-Specific Modifications

```csharp
CompatAPI.RegisterToolQuirk(
    toolDef => toolDef.techLevel >= TechLevel.Spacer,
    applier =>
    {
        switch (applier.Stat?.defName)
        {
            case "TreeFellingSpeed":
                applier.MultiplyFactor(1.3f, "advanced cutting");
                break;
            case "DiggingSpeed":
                applier.MultiplyFactor(1.4f, "powered digging");
                break;
            case "ConstructionSpeed":
                applier.MultiplyFactor(1.2f, "precision tools");
                break;
        }
    }
);
```

## Debug Testing

⚠️ **Dev Mode Required**: Debug actions only function when `Prefs.DevMode` is enabled.

Use the debug action "Test tool quirk system" to register example quirks and save results to Desktop.

Use "Dump resolver comparison" to see quirk applications in the generated report file (limited to 5 sample entries).

All debug output is saved to Desktop via `ST_FileIO` for examination.

## Integration Tips

1. Register quirks in your mod's initialization (e.g., static constructor or patch)
2. Use descriptive tags to help with debugging
3. Predicates should be fast since they're called frequently
4. Quirk actions should be safe and handle edge cases
5. Multiple quirks can apply to the same tool - they stack in registration order
6. **Deterministic Order**: Quirks are processed in exact registration order
7. **No Allocations**: Quirk application uses pre-allocated lists for zero GC pressure
8. **Internal API**: Only use `CompatAPI.RegisterToolQuirk()` - resolver methods are internal
</file>

<file path="docs/RefactorPlan.md">
# Always‑Boot Contract (applies to *every* phase)
- Game must boot clean, no red errors or exceptions.
- Existing behavior remains intact until the slice specifically says it’s refactored.
- PackageId, defNames, public classes, XML roots unchanged. Only add; do not rename/remove until a phase’s **Kill List** says so.
- Harmony signatures match RimWorld 1.6 exactly; one `PatchAll()` in the static ctor.
- No LINQ/allocations in hot paths (per‑tick, draw, `StatPart`); use pooled lists.
- All Dev/debug dumps write **to a Desktop file** (or platform fallback), not to the log. Regular logs stay quiet and deduped via `ST_Logging`.

---

# Phase 0 — Safety scaffolding (no behavior change)
**Goal:** add tiny utilities + a one‑click smoke test while keeping the game identical.

## 0.1 Add file I/O helper (new file)
**Path:** `Source/Helpers/ST_FileIO.cs`
```csharp
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ST_FileIO.cs
using System;
using System.IO;
using System.Text;
using UnityEngine;
using Verse;

namespace SurvivalTools
{
    internal static class ST_FileIO
    {
        internal static string DesktopPath()
        {
            try
            {
                var p = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);
                if (!string.IsNullOrEmpty(p)) return p;
            }
            catch { /* ignore */ }
            // Fallbacks for platforms without a Desktop
            return Application.persistentDataPath ?? GenFilePaths.SaveDataFolderPath;
        }

        internal static string WriteUtf8Atomic(string fileName, string content)
        {
            var dir = DesktopPath();
            try { Directory.CreateDirectory(dir); } catch { }
            var path = Path.Combine(dir, fileName);
            var tmp = path + ".tmp";
            File.WriteAllText(tmp, content, new UTF8Encoding(encoderShouldEmitUTF8Identifier: false));
            try { if (File.Exists(path)) File.Delete(path); } catch { }
            File.Move(tmp, path);
            return path;
        }
    }
}
```

## 0.2 Add a dev‑only smoke test DebugAction (new file)
**Path:** `Source/DebugTools/DebugAction_DumpStatus.cs`
```csharp
// RimWorld 1.6 / C# 7.3
// Source/DebugTools/DebugAction_DumpStatus.cs
using System.Text;
using RimWorld;
using Verse;

namespace SurvivalTools
{
    internal static class ST_DebugActions
    {
        [DebugAction("ST", "Dump ST status → Desktop", allowedGameStates: AllowedGameStates.PlayingOnMap)]
        private static void DumpStatus()
        {
            var sb = new StringBuilder(4096);
            sb.AppendLine("[SurvivalTools] Status dump");
            sb.AppendLine("----------------------------");
            try { sb.AppendLine($"Settings: hardcore={(Settings?.hardcoreMode==true)} extraHardcore={(Settings?.extraHardcoreMode==true)}"); } catch { }
            try { sb.AppendLine($"Tools present: {DefDatabase<ThingDef>.AllDefsListForReading?.FindAll(t=>t!=null && t.IsSurvivalTool()).Count}"); } catch { }
            try { sb.AppendLine($"WorkSpeedGlobal jobs discovered: {Helpers.WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs().Count}"); } catch { }
            try { sb.AppendLine("Active mods carrying ST hooks:"); sb.AppendLine(CompatLine()); } catch { }
            sb.AppendLine();
            sb.AppendLine("Tip: use this after loading a save and mining a tile to verify wear/penalties.");
            var path = ST_FileIO.WriteUtf8Atomic($"ST_Status_{System.DateTime.Now:yyyyMMdd_HHmmss}.txt", sb.ToString());
            try { Messages.Message("Survival Tools: wrote " + path, MessageTypeDefOf.TaskCompletion); } catch { }
        }

        private static string CompatLine()
        {
            try { return string.Join(", ", Helpers.WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs()); } catch { return "(n/a)"; }
        }
    }
}
```
> This does **not** add any new logging framework. It only writes debug dumps to a file. All runtime/event logging continues to go through `ST_Logging`.

## 0.3 Phase 0 acceptance
- Boots clean.
- New `ST → Dump ST status → Desktop` action present and writes a file.
- No functional changes to gameplay.

---

# Strangler Consolidation Track (append to *every* phase)
At the **end** of each phase, run these three Copilot prompts (paste verbatim):

### A) Forwarders (non‑breaking)
```
Find public methods duplicating tool bonuses/gating outside SurvivalToolUtility/StatPart/CompatAPI.
For each, add [Obsolete(false)] forwarders that call the new API with identical behavior.
XML doc: "Forwarder during refactor. Do not extend."
```

### B) Call‑site migration
```
Replace all direct calls to <OldMethod> with <NewMethod> in this slice.
Compile the solution and fix type/using mismatches without changing behavior.
```

### C) Deletion pass (Kill List)
```
Delete the following now‑redundant methods/types. Remove usings, keep build green:
<PHASE_KILL_LIST>
```
> The **Kill List** appears at the end of each phase section with concrete symbols. No “maybe later”.

---

# Phase 1 — Registry & Compat surface tighten‑up (no behavior change)
**Goal:** keep the current `CompatAPI`/helpers but lock down the single entry points: `RegisterWorkGiverRequirement`, `RegisterJobRequirement`, `RegisterStatAlias`, `(rare) RegisterToolQuirk`.

**Copilot work items**
- Add no‑op overloads matching current call sites so existing compat modules build untouched.
- Make registry indices O(1) lookups (Dict keyed by `WorkGiverDef`/`JobDef` and `StatDef`).
- Keep `OnAfterDefsLoaded(Action)` and `IsModActive(packageId)` as is.

**Kill List (Phase 1)**
- Any duplicated WG/job requirement maps in `Helpers`/compat modules once registry answers them.

**Acceptance**
- Boots clean; compat modules still function.
- DebugAction still writes file.

---

# Phase 2 — Resolver hardening (no behavior change)
**Goal:** finish the startup resolver so tool stats are cataloged once, with safe defaults.

**Copilot work items**
- Prefer explicit tool tags/properties; else intersect `statBases` with registered work stats; final fallback: name/verb hints.
- Cache per `(toolDef, stuffDef, stat)` factors and expose a safe row for `SpecialDisplayStats`.
- Clamp material beats “no tool” baseline on Normal.

**Kill List (Phase 2)**
- Any ad‑hoc stat inference duplicated in `ToolResolver` or scattered helpers once centralized.

**Acceptance**
- Boots clean; existing tools still behave the same.

---

# Phase 3 — Scoring & caches (partial redirect)
**Goal:** unify scoring in `SurvivalToolUtility` (already central). Expose `GetBestTool(pawn, stat)` and top‑pair data for UI.

**Copilot work items**
- Ensure caches keyed by `(pawn, tool, difficultySeed)`; invalidate on inventory/HP/quality/priorities.
- Respect difficulty multipliers and carry/mass penalties (but *don’t* change numbers yet).

**Kill List (Phase 3)**
- Redundant scoring in `AutoToolPickup_UtilityIntegrated`, `JobGiver_OptimizeSurvivalTools` (leave flow, replace guts).

**Acceptance**
- Boots clean; optimizer still acts the same.

---

# Phase 4 — StatPart as single math path
**Goal:** all bonuses/penalties come from `StatPart_SurvivalTool` for vanilla work stats.

**Copilot work items**
- Confirm it’s the only place multiplying work stats; no LINQ/allocs.
- Keep current penalty values. Hook deterministic wear ticks in here only when the job actually uses the stat.

**Kill List (Phase 4)**
- Any lingering per‑job math outside the StatPart.

**Acceptance**
- Boots clean; vanilla Stat Explanation matches, numbers unchanged.

---

# Phase 5 — Job gating (Nightmare/Hardcore/Normal)
**Goal:** gating checks before work starts. Normal applies baseline penalties only; Hardcore/Nightmare block.

**Copilot work items**
- Keep the existing `WorkGiver_Scanner` prefixes and `MissingRequiredCapacity` postfixes intact; route the decision through `StatGatingHelper`.
- Map difficulty: Normal(allowed, carry 3), Hardcore(gated, carry 2), Nightmare(gated++, carry 1; toolbelt up to 3). Add the migration mapping “Extra Hardcore → Nightmare”.

**Kill List (Phase 5)**
- Reflection fallback hooks in `Patch_Pawn_JobTracker_ExtraHardcore` once WG‑level gating fully covers it.

**Acceptance**
- Boots clean; “Mining on Nightmare without pickaxe → job blocked with clear reason”.

---

# Phase 6 — Assignment (auto‑equip without ping‑pong)
**Goal:** pre‑work hook asks `AssignmentSearch` to equip a clearly better tool within budget/radius; respect carry limits and reservations.

**Copilot work items**
- Pull order: inventory → storage/stockpile → home → nearby world.
- Drop worst surplus when over limit; add hysteresis to avoid ping‑pong.

**Kill List (Phase 6)**
- Duplicated assignment logic in optimizer once the pre‑work hook covers it.

**Acceptance**
- Boots clean; pawn auto‑equips a better pick within radius.

---

# Phase 7 — Gear iTab (single readable panel)
**Goal:** keep vanilla tab, draw our panel inside a child group; two‑line rows (name/score + short why), tooltips match SpecialDisplayStats.

**Copilot work items**
- Widen area (~360–420px). Consume mouse/scroll only inside our rect.
- Show difficulty, carry, gating status, buttons to open settings.

**Kill List (Phase 7)**
- Old label tweaks/transpiler if the new panel supersedes them.

**Acceptance**
- Boots clean; gear panel shows scores + why; numbers match Stat Explanation.

---

# Phase 8 — Animations (mining + melee, overlay‑only)
**Goal:** code‑only sprite transforms; zero allocations during draw.

**Copilot work items**
- Data‑driven frame lists; precompute per facing.
- Renderer postfix draws overlay last via `RenderPawnInternal(PawnDrawParms)`.
- Melee trigger from `Verb_MeleeAttack.TryCastShot` postfix; disable if CE/DualWield active.

**Kill List (Phase 8)**
- Any text motes for penalties/feedback (we’re “no motes”). Replace with subtle overlay cues.

**Acceptance**
- Boots clean; mining gesture plays & stops correctly; CE/DualWield do not double‑draw.

---

# Global: Debug dumps to Desktop (guidance)
- Any `DebugAction` must write files using `ST_FileIO.WriteUtf8Atomic`.
- Keep runtime logs quiet and deduped through **existing** `ST_Logging`.
- For repeated denials, rely on `ST_Logging.LogToolGateEvent(...)` (already deduped) and avoid `Log.Message` spam.

---

# Copilot paste‑blocks (use at the end of each phase)
**Hot‑path cleanup**
```
Search for LINQ/allocations inside draw, per‑tick, and StatPart paths.
Replace with pooled lists and for‑loops. Add comment: // HOT PATH – no LINQ.
```

**Kill List template**
```
// Remove now:
- <Namespace.Class.Method or file path>
// Rationale:
- <why it’s redundant>
```

---

# End‑to‑end acceptance (mining slice)
- Normal/Hardcore/Nightmare behave as specified; carry limits enforced; migration maps Extra Hardcore → Nightmare.
- Wear drains only while working; virtual stacks consume; tools destroy at 0; caches invalidate.
- Assignment upgrades within radius and avoids ping‑pong.
- Gear panel + Stat Explanation agree.
- Optional patches are fully guarded (FindMod + Conditional) and no‑op safely when missing.
- No GC spikes from StatPart, renderer, or assignment scans.

> When you complete Phases 0–2, jump to 4–5 to prove the loop, then 6–8 for the mining slice. After that, clone the pattern to construction/plants/etc.
</file>

<file path="Legacy Repomix.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.
The content has been processed where empty lines have been removed, content has been compressed (code blocks are separated by ⋮---- delimiter).
<file_summary>
This section contains a summary of this file.
<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>
<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>
<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>
<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Empty lines have been removed from all files
- Content has been compressed - code blocks are separated by ⋮---- delimiter
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>
</file_summary>
<directory_structure>
.gitignore
1.6/Defs/JobDefs/Jobs_Misc.xml
1.6/Defs/JobDefs/Jobs_Work.xml
1.6/Defs/PawnColumnDefs/PawnColumns_Misc.xml
1.6/Defs/RecipeDefs/Recipes_Production.xml
1.6/Defs/SpecialThingFilterDefs/SpecialThingFilters.xml
1.6/Defs/Stats/StatCategories.xml
1.6/Defs/Stats/Stats_Pawn_WorkGeneral.xml
1.6/Defs/Stats/Stats_Tool_General.xml
1.6/Defs/ThingCategoryDefs/SurvivalTools_CleaningMaterials.xml
1.6/Defs/ThingCategoryDefs/ThingCategories.xml
1.6/Defs/ThingDefs/Apparel_Belts.xml
1.6/Defs/ThingDefs/Tools_Base.xml
1.6/Defs/ThingDefs/Tools.xml
1.6/Defs/ThingSetMakerDefs/ThingSetMakers_MapGen.xml
1.6/Defs/ThinkTreeDefs/SubTrees_Misc.xml
1.6/Defs/Tutor/Concepts_NotedOpportunistic.xml
1.6/Defs/Tutor/Concepts_NotedSelfshow.xml
1.6/Defs/WorkGiverDefs/WorkGivers.xml
1.6/Languages/ChineseSimplified/DefInjected/ConceptDef/Concepts_NotedOpportunistic.xml
1.6/Languages/ChineseSimplified/DefInjected/ConceptDef/Concepts_NotedSelfshow.xml
1.6/Languages/ChineseSimplified/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/ChineseSimplified/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/ChineseSimplified/DefInjected/PawnColumnDef/PawnColumns_Misc.xml
1.6/Languages/ChineseSimplified/DefInjected/RecipeDef/Recipes_Add_Make.xml
1.6/Languages/ChineseSimplified/DefInjected/RecipeDef/Recipes_Production.xml
1.6/Languages/ChineseSimplified/DefInjected/SpecialThingFilterDef/SpecialThingFilters.xml
1.6/Languages/ChineseSimplified/DefInjected/StatCategoryDef/StatCategories.xml
1.6/Languages/ChineseSimplified/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/ChineseSimplified/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/ChineseSimplified/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/ChineseSimplified/DefInjected/ThingDef/Apparel_Belts.xml
1.6/Languages/ChineseSimplified/DefInjected/ThingDef/Tools.xml
1.6/Languages/ChineseSimplified/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/ChineseSimplified/Keyed/Keys.xml
1.6/Languages/English/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/English/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/English/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/English/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/English/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/English/DefInjected/ThingDef/Tools.xml
1.6/Languages/English/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/English/keyed/Keys.xml
1.6/Languages/French/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/French/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/French/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/French/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/French/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/French/DefInjected/ThingDef/Tools.xml
1.6/Languages/French/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/French/Keyed/Keys.xml
1.6/Languages/German/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/German/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/German/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/German/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/German/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/German/DefInjected/ThingDef/Tools.xml
1.6/Languages/German/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/German/Keyed/Keys.xml
1.6/Languages/Japanese/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/Japanese/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/Japanese/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/Japanese/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/Japanese/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/Japanese/DefInjected/ThingDef/Tools.xml
1.6/Languages/Japanese/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/Japanese/Keyed/Keys.xml
1.6/Languages/Russian/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/Russian/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/Russian/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/Russian/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/Russian/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/Russian/DefInjected/ThingDef/Tools.xml
1.6/Languages/Russian/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/Russian/Keyed/Keys.xml
1.6/Languages/Spanish/DefInjected/JobDef/Jobs_Misc.xml
1.6/Languages/Spanish/DefInjected/JobDef/Jobs_Work.xml
1.6/Languages/Spanish/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml
1.6/Languages/Spanish/DefInjected/StatDef/Stats_Tool_General.xml
1.6/Languages/Spanish/DefInjected/ThingCategoryDef/ThingCategories.xml
1.6/Languages/Spanish/DefInjected/ThingDef/Tools.xml
1.6/Languages/Spanish/DefInjected/WorkGiverDef/WorkGivers.xml
1.6/Languages/Spanish/Keyed/Keys.xml
1.6/Patches/AlphaAnimals/Patch.xml
1.6/Patches/Anomaly/ThingDefs_Items/Items_Resource_Stuff.xml
1.6/Patches/AtlasMaterials/Patch.xml
1.6/Patches/CombatExtended/Patch.xml
1.6/Patches/Core/PawnTableDefs/PawnTables.xml
1.6/Patches/Core/Scenarios/Scenarios_Classic.xml
1.6/Patches/Core/Stats/Stats_Pawns_WorkGeneral.xml
1.6/Patches/Core/StuffProps_DLC.xml
1.6/Patches/Core/StuffProps_Fabric.xml
1.6/Patches/Core/ThingDefs_Items/CleaningMaterials_Category.xml
1.6/Patches/Core/ThingDefs_Items/Cloths_CleaningTool.xml
1.6/Patches/Core/ThingDefs_Items/Items_Resource_Stuff.xml
1.6/Patches/Core/ThingDefs_Misc/Various_Stone.xml
1.6/Patches/Core/ThingSetMakerDefs/ThingSetMakers_MapGen.xml
1.6/Patches/Core/TraderKindDefs/TraderKinds_Base_Neolithic.xml
1.6/Patches/Core/TraderKindDefs/TraderKinds_Base_Outlander.xml
1.6/Patches/Core/TraderKindDefs/TraderKinds_Caravan_Neolithic.xml
1.6/Patches/Core/TraderKindDefs/TraderKinds_Caravan_Outlander.xml
1.6/Patches/Core/TraderKindDefs/TraderKinds_Orbital_Misc.xml
1.6/Patches/Core/WorkGiverDefs/WorkGivers.xml
1.6/Patches/Crystalloid/Patch.xml
1.6/Patches/DarkAgesMedievalTools/DAMT_Patch.xml
1.6/Patches/ExpandedMaterials/Patch.xml
1.6/Patches/ExpandedWoodworking/Patch.xml
1.6/Patches/ExpandedWoodworkingVGP/Patch.xml
1.6/Patches/GlitterTech/Patch.xml
1.6/Patches/KurasExtraGems/Patch.xml
1.6/Patches/KurasExtraStones/Patch.xml
1.6/Patches/MechalitCore/Patch.xml
1.6/Patches/Mending/Patch.xml
1.6/Patches/MetalsPlus/Patch.xml
1.6/Patches/Odyssey/ThingDefs_Items/Items_Resource_Stuff.xml
1.6/Patches/PrimitiveTools/PT_Patch.xml
1.6/Patches/Quarry/Patch.xml
1.6/Patches/ResearchReinvented/FieldResearchSupport.xml
1.6/Patches/RightToolForTheJob/RTFTJ_Patch.xml
1.6/Patches/RimBees/Patch.xml
1.6/Patches/Rimefeller/Patch.xml
1.6/Patches/RimOfMadnessBones/Patch.xml
1.6/Patches/RimsenalFederation/Patch.xml
1.6/Patches/VegetableGarden/Patch.xml
1.6/Patches/VWEUTools/VWEUT_Patch.xml
1.6/Textures/Things/Item/Equipment/Tool/README_Textures.txt
About/About.xml
About/PublishedFileId.txt
LICENSE
README.md
Source/AI/AutoToolPickup_UtilityIntegrated.cs
Source/AI/JobDriver_DropSurvivalTool.cs
Source/AI/JobDriver_FellTree_Designated.cs
Source/AI/JobDriver_FellTree.cs
Source/AI/JobDriver_HarvestTree_Designated.cs
Source/AI/JobDriver_HarvestTree.cs
Source/AI/JobDriver_PlantWork.cs
Source/AI/JobGiver_OptimizeSurvivalTools.cs
Source/AI/WorkGiver_FellTrees.cs
Source/Alerts/Alert_ColonistNeedsSurvivalTool.cs
Source/Alerts/Alert_SurvivalToolNeedsReplacing.cs
Source/Compatibility/CommonSense/CommonSenseDebug.cs
Source/Compatibility/CommonSense/CommonSenseHelpers.cs
Source/Compatibility/CommonSense/CommonSensePatches.cs
Source/Compatibility/CompatAPI.cs
Source/Compatibility/PrimitiveTools/PTDebug.cs
Source/Compatibility/PrimitiveTools/PTHelpers.cs
Source/Compatibility/PrimitiveTools/PTPatches.cs
Source/Compatibility/ResearchReinvented/RRDebug.cs
Source/Compatibility/ResearchReinvented/RRHelpers.cs
Source/Compatibility/ResearchReinvented/RRPatches.cs
Source/Compatibility/SeparateTreeChopping/STCDebug.cs
Source/Compatibility/SeparateTreeChopping/STCHelpers.cs
Source/Compatibility/SeparateTreeChopping/STCPatches.cs
Source/Compatibility/SmarterConstruction/SmarterConstructionDebug.cs
Source/Compatibility/SmarterConstruction/SmarterConstructionHelpers.cs
Source/Compatibility/SmarterConstruction/SmarterConstructionPatches.cs
Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionDebug.cs
Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionHelpers.cs
Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionPatches.cs
Source/Compatibility/TDEnhancementPack/TDEnhancementPackDebug.cs
Source/Compatibility/TDEnhancementPack/TDEnhancementPackHelpers.cs
Source/Compatibility/TDEnhancementPack/TDEnhancementPackPatches.cs
Source/DebugTools/DebugAction_SpawnSurvivalToolWithStuff.cs
Source/DebugTools/PrimitiveToolsPatchLogger.cs
Source/DebugTools/ResearchReinventedPatchLogger.cs
Source/DebugTools/SeparateTreeChoppingPatchLogger.cs
Source/DefOfs/ST_ConceptDefOf.cs
Source/DefOfs/ST_JobDefOf.cs
Source/DefOfs/ST_RecipeDefOf.cs
Source/DefOfs/ST_StatCategoryDefOf.cs
Source/DefOfs/ST_StatDefOf.cs
Source/DefOfs/ST_ThingCategoryDefOf.cs
Source/DefOfs/ST_ThingDefOf.cs
Source/DefOfs/ST_ThingSetMakerDefOf.cs
Source/DefOfs/ST_WorkGiverDefOf.cs
Source/GameComponent_SurvivalToolsValidation.cs
Source/Harmony/Patch_EquipmentUtility_CanEquip_PacifistTools.cs
Source/Harmony/Patch_ITab_Pawn_Gear_DrawThingRow.cs
Source/Harmony/Patch_MassUtility.cs
Source/Harmony/Patch_Mineable_Notify_TookMiningDamage.cs
Source/Harmony/Patch_Pawn_InventoryTracker.cs
Source/Harmony/Patch_Pawn_JobTracker_ExtraHardcore.cs
Source/Harmony/Patch_PawnRenderer.cs
Source/Harmony/Patch_RoofUtility_CanHandleBlockingThing.cs
Source/Harmony/Patch_SymbolResolver_AncientRuins_Resolve.cs
Source/Harmony/Patch_ThingDef_SpecialDisplayStats.cs
Source/Harmony/Patch_ThingFilter_SetFromPreset.cs
Source/Harmony/Patch_Toils_Haul_TakeToInventory.cs
Source/Harmony/Patch_ToolInvalidation.cs
Source/Harmony/Patch_WorkGiver_GrowerSow_JobOnCell.cs
Source/Harmony/Patch_WorkGiver_MissingRequiredCapacity.cs
Source/Harmony/Patch_WorkGiver_PlantsCut_JobOnThing.cs
Source/Harmony/Patch_WorkGiver_Scanner_ToolGate.cs
Source/HarmonyPatches.cs
Source/Helpers/CollectionExtensions.cs
Source/Helpers/ConditionalRegistration.cs
Source/Helpers/JobDefToWorkGiverDefHelper.cs
Source/Helpers/JobUtils.cs
Source/Helpers/PawnToolValidator.cs
Source/Helpers/SafetyUtils.cs
Source/Helpers/ST_Logging.cs
Source/Helpers/StatFilters.cs
Source/Helpers/StatGatingHelper.cs
Source/Helpers/SurvivalToolDiscovery.cs
Source/Helpers/SurvivalToolValidation.cs
Source/Helpers/ToolClassification.cs
Source/Helpers/ToolGateMoteHelper.cs
Source/Helpers/WorkSpeedGlobalHelper.cs
Source/ModCompatibilityCheck.cs
Source/ModExtensions/StuffPropsTool.cs
Source/ModExtensions/SurvivalToolProperties.cs
Source/ModExtensions/WorkGiverExtension.cs
Source/SpecialThingFilterWorker_NonSmeltableTools.cs
Source/StaticConstructorClass.cs
Source/Stats/StatPart_SurvivalTool.cs
Source/Stats/StatWorker_EstimatedLifespan.cs
Source/SurvivalTool.cs
Source/SurvivalToolForcedHandler.cs
Source/SurvivalToolsSettings.cs
Source/SurvivalToolUtility.cs
Source/ToolAssignments/Dialog_ManageSurvivalToolAssignments.cs
Source/ToolAssignments/Pawn_SurvivalToolAssignmentTracker.cs
Source/ToolAssignments/PawnColumnWorker_SurvivalToolAssignment.cs
Source/ToolAssignments/SurvivalToolAssignment.cs
Source/ToolAssignments/SurvivalToolAssignmentDatabase.cs
Source/ToolResolver.cs
Source/ToolUtility.cs
Source/VirtualTool.cs
Source/WorkSpeedGlobalConfigWindow.cs
Source/WorldComponent_DelayedValidation.cs
</directory_structure>
<files>
This section contains the contents of the repository's files.
<file path="1.6/Defs/JobDefs/Jobs_Misc.xml">
<Defs>
    <JobDef>
        <defName>DropSurvivalTool</defName>
        <driverClass>SurvivalTools.JobDriver_DropSurvivalTool</driverClass>
        <reportString>dropping TargetA.</reportString>
        <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
    </JobDef>
</Defs>
</file>
<file path="1.6/Defs/JobDefs/Jobs_Work.xml">
<Defs>
    <JobDef>
        <defName>FellTree</defName>
        <driverClass>SurvivalTools.JobDriver_FellTree</driverClass>
        <reportString>felling TargetA.</reportString>
        <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
    </JobDef>
    <JobDef>
        <defName>FellTreeDesignated</defName>
        <driverClass>SurvivalTools.JobDriver_FellTree_Designated</driverClass>
        <reportString>felling TargetA.</reportString>
        <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
    </JobDef>
    <JobDef>
    <defName>HarvestTree</defName>
    <driverClass>SurvivalTools.JobDriver_HarvestTree</driverClass>
    <reportString>felling TargetA.</reportString>
    <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
  </JobDef>
  <JobDef>
    <defName>HarvestTreeDesignated</defName>
    <driverClass>SurvivalTools.JobDriver_HarvestTree_Designated</driverClass>
    <reportString>felling TargetA.</reportString>
    <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
  </JobDef>
</Defs>
</file>
<file path="1.6/Defs/PawnColumnDefs/PawnColumns_Misc.xml">
<Defs>
    <PawnColumnDef>
        <defName>SurvivalToolAssignment</defName>
        <label>tool assignment</label>
        <workerClass>SurvivalTools.PawnColumnWorker_SurvivalToolAssignment</workerClass>
        <sortable>true</sortable>
    </PawnColumnDef>
</Defs>
</file>
<file path="1.6/Defs/RecipeDefs/Recipes_Production.xml">
<Defs>
    <!-- Added to workbenches via C# patching rather than XML to maximise compatibility -->
    <RecipeDef>
        <defName>SmeltSurvivalTool</defName>
        <label>smelt tool</label>
        <description>Use heat and strong electromagnets to break down tools into useful resources.</description>
        <jobString>Smelting tool.</jobString>
        <workAmount>1600</workAmount>
        <workSpeedStat>SmeltingSpeed</workSpeedStat>
        <effectWorking>Smelt</effectWorking>
        <soundWorking>Recipe_Smelt</soundWorking>
        <specialProducts>
            <li>Smelted</li>
        </specialProducts>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>SurvivalTools</li>
                    </categories>
                </filter>
                <count>1</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <categories>
                <li>SurvivalTools</li>
            </categories>
            <specialFiltersToDisallow>
                <li>SurvivalTools_AllowNonSmeltable</li>
            </specialFiltersToDisallow>
        </fixedIngredientFilter>
        <forceHiddenSpecialFilters>
            <li>AllowSmeltable</li>
        </forceHiddenSpecialFilters>
    </RecipeDef>
    <RecipeDef>
        <defName>DestroySurvivalTool</defName>
        <label>destroy tool</label>
        <description>Use heat to destroy unwanted tools. This process is faster than smelting, and works on non-smeltable items, but yields no resources.</description>
        <jobString>Destroying tool.</jobString>
        <workAmount>400</workAmount>
        <workSpeedStat>SmeltingSpeed</workSpeedStat>
        <effectWorking>Smelt</effectWorking>
        <soundWorking>Recipe_Smelt</soundWorking>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>SurvivalTools</li>
                    </categories>
                </filter>
                <count>1</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <categories>
                <li>SurvivalTools</li>
            </categories>
        </fixedIngredientFilter>
        <defaultIngredientFilter>
            <categories>
                <li>SurvivalTools</li>
            </categories>
            <disallowedThingDefs>
                <li>SurvivalTools_Multitool</li>
            </disallowedThingDefs>
        </defaultIngredientFilter>
    </RecipeDef>
</Defs>
</file>
<file path="1.6/Defs/SpecialThingFilterDefs/SpecialThingFilters.xml">
<Defs>
    <SpecialThingFilterDef>
        <defName>SurvivalTools_AllowSmeltable</defName>
        <label>allow smeltable</label>
        <parentCategory>SurvivalTools</parentCategory>
        <allowedByDefault>true</allowedByDefault>
        <saveKey>survivalTools_AllowSmeltable</saveKey>
        <workerClass>SpecialThingFilterWorker_Smeltable</workerClass>
    </SpecialThingFilterDef>
    <SpecialThingFilterDef>
        <defName>SurvivalTools_AllowNonSmeltable</defName>
        <label>allow non-smeltable</label>
        <parentCategory>SurvivalTools</parentCategory>
        <allowedByDefault>true</allowedByDefault>
        <saveKey>survivalTools_AllowNonSmeltable</saveKey>
        <workerClass>SurvivalTools.SpecialThingFilterWorker_NonSmeltableTools</workerClass>
    </SpecialThingFilterDef>
</Defs>
</file>
<file path="1.6/Defs/Stats/StatCategories.xml">
<Defs>
    <StatCategoryDef>
        <defName>SurvivalTool</defName>
        <label>Tool</label>
        <displayOrder>29</displayOrder>
        <displayAllByDefault>true</displayAllByDefault>
    </StatCategoryDef>
    <StatCategoryDef>
        <defName>SurvivalToolMaterial</defName>
        <label>Tool material effectiveness</label>
        <displayOrder>29</displayOrder>
        <displayAllByDefault>true</displayAllByDefault>
    </StatCategoryDef>
</Defs>
</file>
<file path="1.6/Defs/Stats/Stats_Tool_General.xml">
<Defs>
    <StatDef>
        <defName>ToolEstimatedLifespan</defName>
        <workerClass>SurvivalTools.StatWorker_EstimatedLifespan</workerClass>
        <label>estimated tool lifespan</label>
        <description>The amount of continuous use this tool can withstand before breaking. This doesn't take the current condition of the tool into account.</description>
        <category>SurvivalTool</category>
        <displayPriorityInCategory>20</displayPriorityInCategory>
        <minValue>0</minValue>
        <toStringStyle>FloatOne</toStringStyle>
        <formatString>{0} days</formatString>
        <parts>
            <li Class="StatPart_Quality">
                <factorAwful>0.7</factorAwful>
                <factorPoor>0.85</factorPoor>
                <factorNormal>1</factorNormal>
                <factorGood>1.2</factorGood>
                <factorExcellent>1.4</factorExcellent>
                <factorMasterwork>1.8</factorMasterwork>
                <factorLegendary>2.7</factorLegendary>
            </li>
        </parts>
    </StatDef>
    <StatDef>
        <defName>ToolEffectivenessFactor</defName>
        <label>tool effectiveness factor</label>
        <description>A global multiplier of this tool's stat modifiers.</description>
        <category>SurvivalTool</category>
        <displayPriorityInCategory>10</displayPriorityInCategory>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <showIfUndefined>false</showIfUndefined>
        <parts>
            <li Class="StatPart_Quality">
                <factorAwful>0.8</factorAwful>
                <factorPoor>0.9</factorPoor>
                <factorNormal>1</factorNormal>
                <factorGood>1.1</factorGood>
                <factorExcellent>1.2</factorExcellent>
                <factorMasterwork>1.35</factorMasterwork>
                <factorLegendary>1.6</factorLegendary>
            </li>
        </parts>
    </StatDef>
</Defs>
</file>
<file path="1.6/Defs/ThingCategoryDefs/SurvivalTools_CleaningMaterials.xml">
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <!-- Subcategory to surface cleaning tool-stuff (cloth, wools, etc.) in survival tool assignment UI -->
    <ThingCategoryDef>
        <defName>SurvivalToolsCleaningMaterials</defName>
        <label>cleaning materials</label>
        <parent>SurvivalTools</parent>
    </ThingCategoryDef>
</Defs>
</file>
<file path="1.6/Defs/ThingCategoryDefs/ThingCategories.xml">
<Defs>
    <ThingCategoryDef>
        <defName>SurvivalTools</defName>
        <label>tools</label>
        <parent>Root</parent>
    </ThingCategoryDef>
    <ThingCategoryDef>
        <defName>SurvivalToolsNeolithic</defName>
        <label>basic tools</label>
        <parent>SurvivalTools</parent>
    </ThingCategoryDef>
    <ThingCategoryDef>
        <defName>SurvivalToolsIndustrial</defName>
        <label>modern tools</label>
        <parent>SurvivalTools</parent>
    </ThingCategoryDef>
    <ThingCategoryDef>
        <defName>SurvivalToolsSpacer</defName>
        <label>advanced tools</label>
        <parent>SurvivalTools</parent>
    </ThingCategoryDef>
</Defs>
</file>
<file path="1.6/Defs/ThingDefs/Tools_Base.xml">
<Defs>
    <ThingDef Name="BaseSurvivalTool" Abstract="True">
        <!-- Inherits from ThingWithComps; properties are defined through the DefModExtension SurvivalToolProperties -->
        <thingClass>SurvivalTools.SurvivalTool</thingClass>
        <statBases>
            <MaxHitPoints>100</MaxHitPoints>
            <DeteriorationRate>2</DeteriorationRate>
            <Mass>2</Mass>
            <Flammability>1</Flammability>
            <Beauty>-7</Beauty>
            <ToolEffectivenessFactor>1</ToolEffectivenessFactor>
        </statBases>
        <graphicData>
            <onGroundRandomRotateAngle>35</onGroundRandomRotateAngle>
        </graphicData>
        <equippedAngleOffset>-65</equippedAngleOffset>
        <comps>
            <li Class="CompProperties_Forbiddable"/>
            <li>
                <compClass>CompEquippable</compClass>
            </li>
        </comps>
        <tickerType>Never</tickerType>
        <category>Item</category>
        <drawGUIOverlay>true</drawGUIOverlay>
        <equipmentType>Primary</equipmentType>
        <resourceReadoutPriority>Middle</resourceReadoutPriority>
        <selectable>true</selectable>
        <altitudeLayer>Item</altitudeLayer>
        <useHitPoints>true</useHitPoints>
        <alwaysHaulable>true</alwaysHaulable>
        <pathCost>15</pathCost>
    </ThingDef>
</Defs>
</file>
<file path="1.6/Defs/ThingSetMakerDefs/ThingSetMakers_MapGen.xml">
<Defs>
    <ThingSetMakerDef>
        <defName>MapGen_AncientRuinsSurvivalTools</defName>
        <root Class="ThingSetMaker_Sum">
            <options>
                <li>
                    <chance>0.4</chance>
                    <thingSetMaker Class="ThingSetMaker_Count">
                        <fixedParams>
                            <techLevel>Industrial</techLevel>
                            <filter>
                                <categories>
                                    <li>SurvivalTools</li>
                                </categories>
                            </filter>
                            <countRange>
                                <min>1</min>
                                <max>2</max>
                            </countRange>
                        </fixedParams>
                    </thingSetMaker>
                </li>
            </options>
        </root>
    </ThingSetMakerDef>
</Defs>
</file>
<file path="1.6/Defs/ThinkTreeDefs/SubTrees_Misc.xml">
<Defs>
    <ThinkTreeDef>
        <defName>OptimizeSurvivalTools</defName>
        <insertTag>Humanlike_PreMain</insertTag>
        <insertPriority>250</insertPriority>
        <thinkRoot Class="SurvivalTools.JobGiver_OptimizeSurvivalTools" />
    </ThinkTreeDef>
</Defs>
</file>
<file path="1.6/Defs/WorkGiverDefs/WorkGivers.xml">
<Defs>
    <WorkGiverDef>
        <defName>FellTrees</defName>
        <label>fell trees</label>
        <giverClass>SurvivalTools.WorkGiver_FellTrees</giverClass>
        <workType>PlantCutting</workType>
        <priorityInType>50</priorityInType>
        <verb>fell</verb>
        <gerund>felling</gerund>
        <requiredCapacities>
            <li>Manipulation</li>
        </requiredCapacities>
        <modExtensions>
            <li Class="SurvivalTools.WorkGiverExtension">
                <requiredStats>
                    <li>TreeFellingSpeed</li>
                </requiredStats>
            </li>
        </modExtensions>
    </WorkGiverDef>
</Defs>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/ConceptDef/Concepts_NotedOpportunistic.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <UsingSurvivalTools.label>基础工具：使用工具</UsingSurvivalTools.label>
  <UsingSurvivalTools.helpText>殖民者将自动使用任何工具，工作任务中的工具将从他们的主工具和他们的背包中寻找，并使用其中最好的。殖民者在使用的任何工具都将被标记为"使用中"。</UsingSurvivalTools.helpText>
  <SurvivalToolDegradation.label>基础工具：工具老化</SurvivalToolDegradation.label>
  <SurvivalToolDegradation.helpText>殖民者在使用他们主工具或背包里的工具时，这些工具会因过度使用而老化，并最终失效。\n\n你可以通过查看工具的信息栏来确认工具在失效前还能够使用多久,尽管这些读数并不影响工具的当前状态。</SurvivalToolDegradation.helpText>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/ConceptDef/Concepts_NotedSelfshow.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <EquippingSurvivalTools.label>基础工具：装备工具</EquippingSurvivalTools.label>
  <EquippingSurvivalTools.helpText>为了让殖民者能够有效地执行某些任务（例如，砍伐树木），他们需要一些顺手的工具(例如，砍伐树木的斧头)\n\n殖民者一次只能携带3个工具，所以请记住这一点。</EquippingSurvivalTools.helpText>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <DropSurvivalTool.reportString>丢下 TargetA.</DropSurvivalTool.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <FellTree.reportString>砍伐 TargetA。</FellTree.reportString>
  <FellTreeDesignated.reportString>砍伐 TargetA。</FellTreeDesignated.reportString>
  <HarvestTree.reportString>收割 TargetA。</HarvestTree.reportString>
  <HarvestTreeDesignated.reportString>收割 TargetA。</HarvestTreeDesignated.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/PawnColumnDef/PawnColumns_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <SurvivalToolAssignment.label>工具配置</SurvivalToolAssignment.label>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/RecipeDef/Recipes_Add_Make.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- SPECIAL: These Recipes from makeable ThingDefs (which include <recipeMaker>), generated by RimTrans -->
  <!-- Recipe Users: ElectricTailoringBench, HandTailoringBench -->
  <Make_SurvivalTools_ToolBelt.label>制作工具腰带</Make_SurvivalTools_ToolBelt.label>
  <Make_SurvivalTools_ToolBelt.description>制作工具腰带。</Make_SurvivalTools_ToolBelt.description>
  <Make_SurvivalTools_ToolBelt.jobString>正在制作工具腰带。</Make_SurvivalTools_ToolBelt.jobString>
  <!-- Recipe Users: CraftingSpot, ElectricSmithy, FueledSmithy -->
  <Make_SurvivalTools_Axe.label>制作斧头</Make_SurvivalTools_Axe.label>
  <Make_SurvivalTools_Axe.description>制作斧头。</Make_SurvivalTools_Axe.description>
  <Make_SurvivalTools_Axe.jobString>正在制作斧头。</Make_SurvivalTools_Axe.jobString>
  <Make_SurvivalTools_Pickaxe.label>制作十字镐</Make_SurvivalTools_Pickaxe.label>
  <Make_SurvivalTools_Pickaxe.description>制作十字镐。</Make_SurvivalTools_Pickaxe.description>
  <Make_SurvivalTools_Pickaxe.jobString>正在制作十字镐。</Make_SurvivalTools_Pickaxe.jobString>
  <Make_SurvivalTools_Hammer.label>制作锤子</Make_SurvivalTools_Hammer.label>
  <Make_SurvivalTools_Hammer.description>制作锤子。</Make_SurvivalTools_Hammer.description>
  <Make_SurvivalTools_Hammer.jobString>正在制作锤子。</Make_SurvivalTools_Hammer.jobString>
  <Make_SurvivalTools_Sickle.label>制作镰刀</Make_SurvivalTools_Sickle.label>
  <Make_SurvivalTools_Sickle.description>制作镰刀。</Make_SurvivalTools_Sickle.description>
  <Make_SurvivalTools_Sickle.jobString>正在制作镰刀。</Make_SurvivalTools_Sickle.jobString>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/RecipeDef/Recipes_Production.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- Added to workbenches via C# patching rather than XML to maximise compatibility -->
  <SmeltSurvivalTool.label>熔炼工具</SmeltSurvivalTool.label>
  <SmeltSurvivalTool.description>用强热和电磁把工具分解成有用的金属。</SmeltSurvivalTool.description>
  <SmeltSurvivalTool.jobString>正在熔炼工具。</SmeltSurvivalTool.jobString>
  <DestroySurvivalTool.label>销毁工具</DestroySurvivalTool.label>
  <DestroySurvivalTool.description>用超高温度销毁不需要的工具。比熔炼快，用于不可熔炼的物品，但不产出资源。</DestroySurvivalTool.description>
  <DestroySurvivalTool.jobString>正在销毁工具。</DestroySurvivalTool.jobString>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/SpecialThingFilterDef/SpecialThingFilters.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <SurvivalTools_AllowSmeltable.label>允许熔炼</SurvivalTools_AllowSmeltable.label>
  <SurvivalTools_AllowNonSmeltable.label>允许销毁</SurvivalTools_AllowNonSmeltable.label>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/StatCategoryDef/StatCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <SurvivalTool.label>工具</SurvivalTool.label>
  <SurvivalToolMaterial.label>工具材料的有效性</SurvivalToolMaterial.label>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <ToolEstimatedLifespan.label>工具寿命估算</ToolEstimatedLifespan.label>
  <ToolEstimatedLifespan.description>在损坏前连续使用此工具的量. 这并没有考虑到工具当前的使用情况.</ToolEstimatedLifespan.description>
  <ToolEstimatedLifespan.formatString>{0}天</ToolEstimatedLifespan.formatString>
  <ToolEffectivenessFactor.label>工具效果乘数</ToolEffectivenessFactor.label>
  <ToolEffectivenessFactor.description>这个工具的使用效果乘数。</ToolEffectivenessFactor.description>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <SurvivalTools.label>工具</SurvivalTools.label>
  <SurvivalToolsNeolithic.label>原始工具</SurvivalToolsNeolithic.label>
  <SurvivalToolsIndustrial.label>现代工具</SurvivalToolsIndustrial.label>
  <SurvivalToolsSpacer.label>先进工具</SurvivalToolsSpacer.label>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/ThingDef/Apparel_Belts.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <SurvivalTools_ToolBelt.label>工具腰带</SurvivalTools_ToolBelt.label>
  <SurvivalTools_ToolBelt.description>一种结实的皮带，穿上它将允许佩戴者额外携带两种工具。</SurvivalTools_ToolBelt.description>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <FellTrees.label>伐木</FellTrees.label>
  <FellTrees.verb>伐木</FellTrees.verb>
  <FellTrees.gerund>伐木中</FellTrees.gerund>
</LanguageData>
</file>
<file path="1.6/Languages/English/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>dropping TargetA.</DropSurvivalTool.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/English/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Pawn work stats -->
    <SurvivalToolCarryCapacity.label>tool carrying capacity</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>How many tools this pawn can carry in their inventory. If they have more tools than they can carry, they won't be able to use the excess tools.</SurvivalToolCarryCapacity.description>
    <!-- Mining-related -->
    <DiggingSpeed.label>digging speed</DiggingSpeed.label>
    <DiggingSpeed.description>The speed at which this person digs at walls.</DiggingSpeed.description>
    <MiningYieldDigging.label>mining yield (digging)</MiningYieldDigging.label>
    <MiningYieldDigging.description>The percentage of mined resources a miner will produce. This only applies to wall mining. This doesn't affect the production rate of rock chunks.</MiningYieldDigging.description>
    <!-- Plant-related -->
    <PlantHarvestingSpeed.label>plant harvesting speed</PlantHarvestingSpeed.label>
    <PlantHarvestingSpeed.description>The speed at which this person harvests plants.</PlantHarvestingSpeed.description>
    <SowingSpeed.label>sowing speed</SowingSpeed.label>
    <SowingSpeed.description>The speed at which this person sows seeds and plants crops.</SowingSpeed.description>
    <TreeFellingSpeed.label>tree felling speed</TreeFellingSpeed.label>
    <TreeFellingSpeed.description>The speed at which this person fells trees.</TreeFellingSpeed.description>
    <!-- Maintenance and repair-related -->
    <MaintenanceSpeed.label>maintenance speed</MaintenanceSpeed.label>
    <MaintenanceSpeed.description>The speed at which this person performs maintenance and repairs on buildings and equipment.</MaintenanceSpeed.description>
    <DeconstructionSpeed.label>deconstruction speed</DeconstructionSpeed.label>
    <DeconstructionSpeed.description>The speed at which this person deconstructs buildings and equipment.</DeconstructionSpeed.description>
    <!-- Research-related -->
    <ResearchSpeed.label>research speed</ResearchSpeed.label>
    <ResearchSpeed.description>The speed at which this person conducts research and experiments.</ResearchSpeed.description>
    <!-- Cleaning-related -->
    <CleaningSpeed.label>cleaning speed</CleaningSpeed.label>
    <CleaningSpeed.description>The speed at which this person cleans filth and debris. Anyone can clean, but it's much faster with proper tools.</CleaningSpeed.description>
    <!-- Medical-related -->
    <MedicalOperationSpeed.label>medical operation speed</MedicalOperationSpeed.label>
    <MedicalOperationSpeed.description>The speed at which this person performs medical operations and surgery.</MedicalOperationSpeed.description>
    <MedicalSurgerySuccessChance.label>medical surgery success chance</MedicalSurgerySuccessChance.label>
    <MedicalSurgerySuccessChance.description>The likelihood that this person's medical operations will succeed without complications.</MedicalSurgerySuccessChance.description>
    <!-- Butchery-related -->
    <ButcheryFleshSpeed.label>butchery speed</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>The speed at which this person butchers animals and processes meat.</ButcheryFleshSpeed.description>
    <ButcheryFleshEfficiency.label>butchery efficiency</ButcheryFleshEfficiency.label>
    <ButcheryFleshEfficiency.description>The amount of meat and other products this person can extract from animal carcasses.</ButcheryFleshEfficiency.description>
</LanguageData>
</file>
<file path="1.6/Languages/English/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Tool-related stats -->
    <ToolEstimatedLifespan.label>estimated tool lifespan</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>The amount of continuous use this tool can withstand before breaking. This doesn't take the current condition of the tool into account.</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>tool effectiveness factor</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>A global multiplier of this tool's stat modifiers.</ToolEffectivenessFactor.description>
</LanguageData>
</file>
<file path="1.6/Languages/English/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>tools</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>basic tools</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>modern tools</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>advanced tools</SurvivalToolsSpacer.label>
</LanguageData>
</file>
<file path="1.6/Languages/English/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>fell trees</FellTrees.label>
    <FellTrees.verb>fell</FellTrees.verb>
    <FellTrees.gerund>felling</FellTrees.gerund>
</LanguageData>
</file>
<file path="1.6/Languages/French/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>lâche TargetA.</DropSurvivalTool.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/French/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>abat TargetA.</FellTree.reportString>
    <FellTreeDesignated.reportString>abat TargetA.</FellTreeDesignated.reportString>
    <HarvestTree.reportString>récolte TargetA.</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>récolte TargetA.</HarvestTreeDesignated.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/French/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalToolCarryCapacity.label>capacité de transport d'outils</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>Combien d'outils ce personnage peut porter dans son inventaire. S'il a plus d'outils qu'il ne peut en porter, il ne pourra pas utiliser les outils en excès.</SurvivalToolCarryCapacity.description>
    <DiggingSpeed.label>vitesse de creusage</DiggingSpeed.label>
    <DiggingSpeed.description>La vitesse à laquelle cette personne creuse les murs.</DiggingSpeed.description>
    <CleaningSpeed.label>vitesse de nettoyage</CleaningSpeed.label>
    <CleaningSpeed.description>La vitesse à laquelle cette personne nettoie la saleté et les débris. N'importe qui peut nettoyer, mais c'est beaucoup plus rapide avec les bons outils.</CleaningSpeed.description>
    <ButcheryFleshSpeed.label>vitesse de boucherie</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>La vitesse à laquelle cette personne découpe les animaux et traite la viande.</ButcheryFleshSpeed.description>
</LanguageData>
</file>
<file path="1.6/Languages/French/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <ToolEstimatedLifespan.label>durée de vie estimée de l'outil</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>La quantité d'utilisation continue que cet outil peut supporter avant de se casser. Cela ne prend pas en compte l'état actuel de l'outil.</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>facteur d'efficacité de l'outil</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>Un multiplicateur global des modificateurs de statistiques de cet outil.</ToolEffectivenessFactor.description>
</LanguageData>
</file>
<file path="1.6/Languages/French/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>outils</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>outils de base</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>outils modernes</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>outils avancés</SurvivalToolsSpacer.label>
</LanguageData>
</file>
<file path="1.6/Languages/French/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>abattre des arbres</FellTrees.label>
    <FellTrees.verb>abattre</FellTrees.verb>
    <FellTrees.gerund>abattage</FellTrees.gerund>
</LanguageData>
</file>
<file path="1.6/Languages/German/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>lässt TargetA fallen.</DropSurvivalTool.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/German/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>fällt TargetA.</FellTree.reportString>
    <FellTreeDesignated.reportString>fällt TargetA.</FellTreeDesignated.reportString>
    <HarvestTree.reportString>erntet TargetA.</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>erntet TargetA.</HarvestTreeDesignated.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/German/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Pawn work stats -->
    <SurvivalToolCarryCapacity.label>Werkzeugtragekapazität</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>Wie viele Werkzeuge dieser Charakter in seinem Inventar tragen kann. Wenn er mehr Werkzeuge hat, als er tragen kann, kann er die überschüssigen Werkzeuge nicht verwenden.</SurvivalToolCarryCapacity.description>
    <!-- Mining-related -->
    <DiggingSpeed.label>Grabgeschwindigkeit</DiggingSpeed.label>
    <DiggingSpeed.description>Die Geschwindigkeit, mit der diese Person Wände ausgräbt.</DiggingSpeed.description>
    <MiningYieldDigging.label>Abbauertrag (Graben)</MiningYieldDigging.label>
    <MiningYieldDigging.description>Der Prozentsatz der abgebauten Ressourcen, den ein Bergarbeiter produziert. Dies gilt nur für den Wandabbau. Dies beeinflusst nicht die Produktionsrate von Gesteinsbrocken.</MiningYieldDigging.description>
    <!-- Plant-related -->
    <PlantHarvestingSpeed.label>Pflanzenernte-Geschwindigkeit</PlantHarvestingSpeed.label>
    <PlantHarvestingSpeed.description>Die Geschwindigkeit, mit der diese Person Pflanzen erntet.</PlantHarvestingSpeed.description>
    <SowingSpeed.label>Sägeschwindigkeit</SowingSpeed.label>
    <SowingSpeed.description>Die Geschwindigkeit, mit der diese Person Samen sät und Pflanzen anbaut.</SowingSpeed.description>
    <TreeFellingSpeed.label>Baumfällgeschwindigkeit</TreeFellingSpeed.label>
    <TreeFellingSpeed.description>Die Geschwindigkeit, mit der diese Person Bäume fällt.</TreeFellingSpeed.description>
    <!-- Maintenance and repair-related -->
    <MaintenanceSpeed.label>Wartungsgeschwindigkeit</MaintenanceSpeed.label>
    <MaintenanceSpeed.description>Die Geschwindigkeit, mit der diese Person Wartung und Reparaturen an Gebäuden und Ausrüstung durchführt.</MaintenanceSpeed.description>
    <DeconstructionSpeed.label>Abbaugeschwindigkeit</DeconstructionSpeed.label>
    <DeconstructionSpeed.description>Die Geschwindigkeit, mit der diese Person Gebäude und Ausrüstung abbaut.</DeconstructionSpeed.description>
    <!-- Research-related -->
    <ResearchSpeed.label>Forschungsgeschwindigkeit</ResearchSpeed.label>
    <ResearchSpeed.description>Die Geschwindigkeit, mit der diese Person Forschung und Experimente durchführt.</ResearchSpeed.description>
    <!-- Cleaning-related -->
    <CleaningSpeed.label>Reinigungsgeschwindigkeit</CleaningSpeed.label>
    <CleaningSpeed.description>Die Geschwindigkeit, mit der diese Person Schmutz und Trümmer reinigt. Jeder kann reinigen, aber es ist viel schneller mit den richtigen Werkzeugen.</CleaningSpeed.description>
    <!-- Medical-related -->
    <MedicalOperationSpeed.label>Medizinische Operationsgeschwindigkeit</MedicalOperationSpeed.label>
    <MedicalOperationSpeed.description>Die Geschwindigkeit, mit der diese Person medizinische Operationen und Chirurgie durchführt.</MedicalOperationSpeed.description>
    <MedicalSurgerySuccessChance.label>Medizinische Chirurgie-Erfolgsrate</MedicalSurgerySuccessChance.label>
    <MedicalSurgerySuccessChance.description>Die Wahrscheinlichkeit, dass die medizinischen Operationen dieser Person ohne Komplikationen erfolgreich sind.</MedicalSurgerySuccessChance.description>
    <!-- Butchery-related -->
    <ButcheryFleshSpeed.label>Schlachtgeschwindigkeit</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>Die Geschwindigkeit, mit der diese Person Tiere schlachtet und Fleisch verarbeitet.</ButcheryFleshSpeed.description>
    <ButcheryFleshEfficiency.label>Schlachteffizienz</ButcheryFleshEfficiency.label>
    <ButcheryFleshEfficiency.description>Die Menge an Fleisch und anderen Produkten, die diese Person aus Tierkadavern extrahieren kann.</ButcheryFleshEfficiency.description>
</LanguageData>
</file>
<file path="1.6/Languages/German/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Tool-related stats -->
    <ToolEstimatedLifespan.label>Geschätzte Werkzeuglebensdauer</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>Die Menge an kontinuierlicher Nutzung, die dieses Werkzeug aushalten kann, bevor es bricht. Dies berücksichtigt nicht den aktuellen Zustand des Werkzeugs.</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>Werkzeugeffektivitätsfaktor</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>Ein globaler Multiplikator der Statusmodifikatoren dieses Werkzeugs.</ToolEffectivenessFactor.description>
</LanguageData>
</file>
<file path="1.6/Languages/German/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>Werkzeuge</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>Grundwerkzeuge</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>Moderne Werkzeuge</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>Fortgeschrittene Werkzeuge</SurvivalToolsSpacer.label>
</LanguageData>
</file>
<file path="1.6/Languages/German/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>Bäume fällen</FellTrees.label>
    <FellTrees.verb>fällen</FellTrees.verb>
    <FellTrees.gerund>fällend</FellTrees.gerund>
</LanguageData>
</file>
<file path="1.6/Languages/Japanese/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>TargetAを落としています。</DropSurvivalTool.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/Japanese/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>TargetAを伐採しています。</FellTree.reportString>
    <FellTreeDesignated.reportString>TargetAを伐採しています。</FellTreeDesignated.reportString>
    <HarvestTree.reportString>TargetAを収穫しています。</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>TargetAを収穫しています。</HarvestTreeDesignated.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/Japanese/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Pawn work stats -->
    <SurvivalToolCarryCapacity.label>道具運搬能力</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>このポーンがインベントリに運ぶことができる道具の数。運搬能力を超える道具を持っている場合、余分な道具は使用できません。</SurvivalToolCarryCapacity.description>
    <!-- Mining-related -->
    <DiggingSpeed.label>掘削速度</DiggingSpeed.label>
    <DiggingSpeed.description>この人が壁を掘る速度。</DiggingSpeed.description>
    <MiningYieldDigging.label>採掘収量（掘削）</MiningYieldDigging.label>
    <MiningYieldDigging.description>採掘者が産出する採掘資源の割合。これは壁の採掘にのみ適用されます。岩塊の生産率には影響しません。</MiningYieldDigging.description>
    <!-- Plant-related -->
    <PlantHarvestingSpeed.label>植物収穫速度</PlantHarvestingSpeed.label>
    <PlantHarvestingSpeed.description>この人が植物を収穫する速度。</PlantHarvestingSpeed.description>
    <SowingSpeed.label>播種速度</SowingSpeed.label>
    <SowingSpeed.description>この人が種を播き、作物を植える速度。</SowingSpeed.description>
    <TreeFellingSpeed.label>伐木速度</TreeFellingSpeed.label>
    <TreeFellingSpeed.description>この人が木を伐採する速度。</TreeFellingSpeed.description>
    <!-- Maintenance and repair-related -->
    <MaintenanceSpeed.label>保守速度</MaintenanceSpeed.label>
    <MaintenanceSpeed.description>この人が建物や設備の保守・修理を行う速度。</MaintenanceSpeed.description>
    <DeconstructionSpeed.label>解体速度</DeconstructionSpeed.label>
    <DeconstructionSpeed.description>この人が建物や設備を解体する速度。</DeconstructionSpeed.description>
    <!-- Research-related -->
    <ResearchSpeed.label>研究速度</ResearchSpeed.label>
    <ResearchSpeed.description>この人が研究や実験を行う速度。</ResearchSpeed.description>
    <!-- Cleaning-related -->
    <CleaningSpeed.label>清掃速度</CleaningSpeed.label>
    <CleaningSpeed.description>この人が汚れや破片を清掃する速度。誰でも清掃はできますが、適切な道具があればはるかに速くなります。</CleaningSpeed.description>
    <!-- Medical-related -->
    <MedicalOperationSpeed.label>医療手術速度</MedicalOperationSpeed.label>
    <MedicalOperationSpeed.description>この人が医療手術や外科手術を行う速度。</MedicalOperationSpeed.description>
    <MedicalSurgerySuccessChance.label>医療手術成功率</MedicalSurgerySuccessChance.label>
    <MedicalSurgerySuccessChance.description>この人の医療手術が合併症なく成功する可能性。</MedicalSurgerySuccessChance.description>
    <!-- Butchery-related -->
    <ButcheryFleshSpeed.label>屠殺速度</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>この人が動物を屠殺し、肉を処理する速度。</ButcheryFleshSpeed.description>
    <ButcheryFleshEfficiency.label>屠殺効率</ButcheryFleshEfficiency.label>
    <ButcheryFleshEfficiency.description>この人が動物の死骸から抽出できる肉やその他の製品の量。</ButcheryFleshEfficiency.description>
</LanguageData>
</file>
<file path="1.6/Languages/Japanese/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Tool-related stats -->
    <ToolEstimatedLifespan.label>道具の推定寿命</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>この道具が壊れるまでに耐えられる連続使用時間。道具の現在の状態は考慮されません。</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>道具効果係数</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>この道具の能力値修正の全体的な倍率。</ToolEffectivenessFactor.description>
</LanguageData>
</file>
<file path="1.6/Languages/Japanese/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>道具</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>基本道具</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>現代道具</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>先進道具</SurvivalToolsSpacer.label>
</LanguageData>
</file>
<file path="1.6/Languages/Japanese/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>木を伐採</FellTrees.label>
    <FellTrees.verb>伐採</FellTrees.verb>
    <FellTrees.gerund>伐採中</FellTrees.gerund>
</LanguageData>
</file>
<file path="1.6/Languages/Russian/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>бросает TargetA.</DropSurvivalTool.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/Russian/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>рубит TargetA.</FellTree.reportString>
    <FellTreeDesignated.reportString>рубит TargetA.</FellTreeDesignated.reportString>
    <HarvestTree.reportString>собирает TargetA.</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>собирает TargetA.</HarvestTreeDesignated.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/Russian/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalToolCarryCapacity.label>грузоподъёмность инструментов</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>Сколько инструментов этот персонаж может нести в своём инвентаре. Если у него больше инструментов, чем он может нести, он не сможет использовать лишние инструменты.</SurvivalToolCarryCapacity.description>
    <DiggingSpeed.label>скорость копания</DiggingSpeed.label>
    <DiggingSpeed.description>Скорость, с которой этот человек копает стены.</DiggingSpeed.description>
    <CleaningSpeed.label>скорость уборки</CleaningSpeed.label>
    <CleaningSpeed.description>Скорость, с которой этот человек убирает грязь и мусор. Любой может убираться, но с правильными инструментами это намного быстрее.</CleaningSpeed.description>
    <ButcheryFleshSpeed.label>скорость разделки</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>Скорость, с которой этот человек разделывает животных и обрабатывает мясо.</ButcheryFleshSpeed.description>
</LanguageData>
</file>
<file path="1.6/Languages/Russian/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <ToolEstimatedLifespan.label>предполагаемый срок службы инструмента</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>Количество непрерывного использования, которое этот инструмент может выдержать до поломки. Это не учитывает текущее состояние инструмента.</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>фактор эффективности инструмента</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>Глобальный множитель модификаторов характеристик этого инструмента.</ToolEffectivenessFactor.description>
</LanguageData>
</file>
<file path="1.6/Languages/Russian/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>инструменты</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>базовые инструменты</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>современные инструменты</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>продвинутые инструменты</SurvivalToolsSpacer.label>
</LanguageData>
</file>
<file path="1.6/Languages/Russian/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>рубить деревья</FellTrees.label>
    <FellTrees.verb>рубить</FellTrees.verb>
    <FellTrees.gerund>рубка</FellTrees.gerund>
</LanguageData>
</file>
<file path="1.6/Languages/Spanish/DefInjected/JobDef/Jobs_Misc.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <DropSurvivalTool.reportString>soltando TargetA.</DropSurvivalTool.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/Spanish/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>talando TargetA.</FellTree.reportString>
    <FellTreeDesignated.reportString>talando TargetA.</FellTreeDesignated.reportString>
    <HarvestTree.reportString>cosechando TargetA.</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>cosechando TargetA.</HarvestTreeDesignated.reportString>
</LanguageData>
</file>
<file path="1.6/Languages/Spanish/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalToolCarryCapacity.label>capacidad de carga de herramientas</SurvivalToolCarryCapacity.label>
    <SurvivalToolCarryCapacity.description>Cuántas herramientas puede llevar este personaje en su inventario. Si tiene más herramientas de las que puede cargar, no podrá usar las herramientas excedentes.</SurvivalToolCarryCapacity.description>
    <DiggingSpeed.label>velocidad de excavación</DiggingSpeed.label>
    <DiggingSpeed.description>La velocidad a la que esta persona excava paredes.</DiggingSpeed.description>
    <CleaningSpeed.label>velocidad de limpieza</CleaningSpeed.label>
    <CleaningSpeed.description>La velocidad a la que esta persona limpia suciedad y escombros. Cualquiera puede limpiar, pero es mucho más rápido con las herramientas adecuadas.</CleaningSpeed.description>
    <ButcheryFleshSpeed.label>velocidad de carnicería</ButcheryFleshSpeed.label>
    <ButcheryFleshSpeed.description>La velocidad a la que esta persona sacrifica animales y procesa carne.</ButcheryFleshSpeed.description>
</LanguageData>
</file>
<file path="1.6/Languages/Spanish/DefInjected/StatDef/Stats_Tool_General.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <ToolEstimatedLifespan.label>vida útil estimada de la herramienta</ToolEstimatedLifespan.label>
    <ToolEstimatedLifespan.description>La cantidad de uso continuo que esta herramienta puede soportar antes de romperse. Esto no tiene en cuenta el estado actual de la herramienta.</ToolEstimatedLifespan.description>
    <ToolEffectivenessFactor.label>factor de efectividad de la herramienta</ToolEffectivenessFactor.label>
    <ToolEffectivenessFactor.description>Un multiplicador global de los modificadores de estadísticas de esta herramienta.</ToolEffectivenessFactor.description>
</LanguageData>
</file>
<file path="1.6/Languages/Spanish/DefInjected/ThingCategoryDef/ThingCategories.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <SurvivalTools.label>herramientas</SurvivalTools.label>
    <SurvivalToolsNeolithic.label>herramientas básicas</SurvivalToolsNeolithic.label>
    <SurvivalToolsIndustrial.label>herramientas modernas</SurvivalToolsIndustrial.label>
    <SurvivalToolsSpacer.label>herramientas avanzadas</SurvivalToolsSpacer.label>
</LanguageData>
</file>
<file path="1.6/Languages/Spanish/DefInjected/WorkGiverDef/WorkGivers.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTrees.label>talar árboles</FellTrees.label>
    <FellTrees.verb>talar</FellTrees.verb>
    <FellTrees.gerund>talando</FellTrees.gerund>
</LanguageData>
</file>
<file path="1.6/Patches/AlphaAnimals/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Alpha Animals</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Red Wood -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="GU_RedWood"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.55</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.55</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Sky Steel -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="AA_SkySteel"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
                <PlantHarvestingSpeed>1.1</PlantHarvestingSpeed>
                <DiggingSpeed>1.1</DiggingSpeed>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/Anomaly/ThingDefs_Items/Items_Resource_Stuff.xml">
<Patch>
    <!-- Apply StuffPropsTool directly to Bioferrite without mod detection -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Bioferrite"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>1.1</TreeFellingSpeed>
                    <PlantHarvestingSpeed>1.1</PlantHarvestingSpeed>
                    <DiggingSpeed>1.2</DiggingSpeed>
                    <MiningYieldDigging>1.15</MiningYieldDigging>
                    <ConstructionSpeed>1.1</ConstructionSpeed>
                    <MaintenanceSpeed>1.1</MaintenanceSpeed>
                    <DeconstructionSpeed>1.1</DeconstructionSpeed>
                    <ResearchSpeed>1.2</ResearchSpeed>
                    <CleaningSpeed>1.0</CleaningSpeed>
                    <MedicalOperationSpeed>1.1</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>1.05</MedicalSurgerySuccessChance>
                    <ButcheryFleshSpeed>1.1</ButcheryFleshSpeed>
                    <ButcheryFleshEfficiency>1.05</ButcheryFleshEfficiency>
                    <SowingSpeed>1.1</SowingSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/AtlasMaterials/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>[1.0] Atlas' Materials</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Blocks_BrickAM -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Blocks_BrickAM"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Blocks_MudAM -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Blocks_MudAM"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.2</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.2</PlantHarvestingSpeed>
                <DiggingSpeed>0.65</DiggingSpeed>
                <MiningYieldDigging>0.83</MiningYieldDigging>
                <ConstructionSpeed>0.65</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Stuff_ConcreteAM -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Stuff_ConcreteAM"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Stuff_RefConcreteAM -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Stuff_RefConcreteAM"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.65</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                <DiggingSpeed>1.1</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Stuff_PlasterAM -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Stuff_PlasterAM"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.2</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.2</PlantHarvestingSpeed>
                <DiggingSpeed>0.5</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.5</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- AM_MixedPlastic -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="AM_MixedPlastic"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.5</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.5</PlantHarvestingSpeed>
                <DiggingSpeed>0.9</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.9</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- AM_UHMWPlastic -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="AM_UHMWPlastic"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <DiggingSpeed>0.9</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.9</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- AM_Acrylic -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="AM_Acrylic"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.9</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.9</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- AM_LWood -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="AM_LWood"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.45</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.45</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/CombatExtended/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Combat Extended</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Axe (cd = 2.4s) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]</xpath>
          <match Class="PatchOperationSequence">
            <operations>
              <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]/tools</xpath>
                <value>
                  <tools>
                    <li Class="CombatExtended.ToolCE">
                      <label>handle</label>
                      <capacities>
                        <li>Poke</li>
                      </capacities>
                      <power>8</power>
                      <armorPenetration>0.075</armorPenetration>
                      <cooldownTime>2.4</cooldownTime>
                      <linkedBodyPartsGroup>Handle</linkedBodyPartsGroup>
                    </li>
                    <li Class="CombatExtended.ToolCE">
                      <label>head</label>
                      <capacities>
                        <li>Cut</li>
                      </capacities>
                      <chanceFactor>1.33</chanceFactor>
                      <power>14</power>
                      <armorPenetration>0.142</armorPenetration>
                      <cooldownTime>2.4</cooldownTime>
                      <linkedBodyPartsGroup>Head</linkedBodyPartsGroup>
                    </li>
                  </tools>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]</xpath>
                <value>
                  <equippedStatOffsets>
                    <MeleeCritChance>0.375</MeleeCritChance>
                    <MeleeParryChance>0.375</MeleeParryChance>
                  </equippedStatOffsets>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Axe"]/statBases</xpath>
                <value>
                  <Bulk>4.5</Bulk>
                  <MeleeCounterParryBonus>1.25</MeleeCounterParryBonus>
                </value>
              </li>
            </operations>
          </match>
        </li>
        <!-- Pickaxe (cd = 2.4s) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]</xpath>
          <match Class="PatchOperationSequence">
            <operations>
              <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]/tools</xpath>
                <value>
                  <tools>
                    <li Class="CombatExtended.ToolCE">
                      <label>handle</label>
                      <capacities>
                        <li>Poke</li>
                      </capacities>
                      <power>8</power>
                      <armorPenetration>0.075</armorPenetration>
                      <cooldownTime>2.4</cooldownTime>
                      <linkedBodyPartsGroup>Handle</linkedBodyPartsGroup>
                    </li>
                    <li Class="CombatExtended.ToolCE">
                      <label>head</label>
                      <capacities>
                        <li>Stab</li>
                      </capacities>
                      <chanceFactor>1.33</chanceFactor>
                      <power>14</power>
                      <armorPenetration>0.266</armorPenetration>
                      <cooldownTime>2.4</cooldownTime>
                      <linkedBodyPartsGroup>Head</linkedBodyPartsGroup>
                    </li>
                  </tools>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]</xpath>
                <value>
                  <equippedStatOffsets>
                    <MeleeCritChance>0.375</MeleeCritChance>
                    <MeleeParryChance>0.375</MeleeParryChance>
                  </equippedStatOffsets>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Pickaxe"]/statBases</xpath>
                <value>
                  <Bulk>4.5</Bulk>
                  <MeleeCounterParryBonus>1.25</MeleeCounterParryBonus>
                </value>
              </li>
            </operations>
          </match>
        </li>
        <!-- Hammer (cd = 1.85s) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]</xpath>
          <match Class="PatchOperationSequence">
            <operations>
              <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]/tools</xpath>
                <value>
                  <tools>
                    <li Class="CombatExtended.ToolCE">
                      <label>handle</label>
                      <capacities>
                        <li>Blunt</li>
                      </capacities>
                      <power>6</power>
                      <armorPenetration>0.087</armorPenetration>
                      <cooldownTime>1.85</cooldownTime>
                      <linkedBodyPartsGroup>Handle</linkedBodyPartsGroup>
                    </li>
                    <li Class="CombatExtended.ToolCE">
                      <label>head</label>
                      <capacities>
                        <li>Blunt</li>
                      </capacities>
                      <chanceFactor>1.33</chanceFactor>
                      <power>10.7</power>
                      <armorPenetration>0.123</armorPenetration>
                      <cooldownTime>1.85</cooldownTime>
                      <linkedBodyPartsGroup>Head</linkedBodyPartsGroup>
                    </li>
                  </tools>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]</xpath>
                <value>
                  <equippedStatOffsets>
                    <MeleeCritChance>0.25</MeleeCritChance>
                    <MeleeParryChance>0.25</MeleeParryChance>
                  </equippedStatOffsets>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Hammer"]/statBases</xpath>
                <value>
                  <Bulk>1.5</Bulk>
                </value>
              </li>
            </operations>
          </match>
        </li>
        <!-- Sickle (cd = 1.85s) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]</xpath>
          <match Class="PatchOperationSequence">
            <operations>
              <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]/tools</xpath>
                <value>
                  <tools>
                    <li Class="CombatExtended.ToolCE">
                      <label>handle</label>
                      <capacities>
                        <li>Blunt</li>
                      </capacities>
                      <power>6</power>
                      <armorPenetration>0.087</armorPenetration>
                      <cooldownTime>1.85</cooldownTime>
                      <linkedBodyPartsGroup>Handle</linkedBodyPartsGroup>
                    </li>
                    <li Class="CombatExtended.ToolCE">
                      <label>blade</label>
                      <capacities>
                        <li>Cut</li>
                      </capacities>
                      <chanceFactor>1.33</chanceFactor>
                      <power>10.7</power>
                      <armorPenetration>0.119</armorPenetration>
                      <cooldownTime>1.85</cooldownTime>
                      <linkedBodyPartsGroup>Blade</linkedBodyPartsGroup>
                    </li>
                  </tools>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]</xpath>
                <value>
                  <equippedStatOffsets>
                    <MeleeCritChance>0.25</MeleeCritChance>
                    <MeleeParryChance>0.25</MeleeParryChance>
                  </equippedStatOffsets>
                </value>
              </li>
              <li Class="PatchOperationAdd">
                <xpath>Defs/ThingDef[defName="SurvivalTools_Sickle"]/statBases</xpath>
                <value>
                  <Bulk>1.5</Bulk>
                </value>
              </li>
            </operations>
          </match>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/PawnTableDefs/PawnTables.xml">
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Auto tool switcher</li>
        </mods>
        <nomatch Class="PatchOperationInsert">
            <xpath>Defs/PawnTableDef[defName="Assign"]/columns/li[text()="Outfit"]</xpath>
            <order>Append</order>
            <value>
                <li>SurvivalToolAssignment</li>
                <li>GapTiny</li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/Scenarios/Scenarios_Classic.xml">
<Patch>
    <!-- Crashlanded -->
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ScenarioDef[defName="Crashlanded"]/scenario/parts</xpath>
        <value>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Axe</thingDef>
                <stuff>Steel</stuff>
            </li>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Hammer</thingDef>
                <stuff>Steel</stuff>
            </li>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Pickaxe</thingDef>
                <stuff>Steel</stuff>
            </li>
        </value>
    </Operation>
    <!-- Lost Tribe -->
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ScenarioDef[defName="LostTribe"]/scenario/parts</xpath>
        <value>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Axe</thingDef>
                <stuff>WoodLog</stuff>
                <count>2</count>
            </li>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Hammer</thingDef>
                <stuff>WoodLog</stuff>
                <count>2</count>
            </li>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Sickle</thingDef>
                <stuff>BlocksSlate</stuff>
                <count>2</count>
            </li>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Pickaxe</thingDef>
                <stuff>Steel</stuff>
            </li>
        </value>
    </Operation>
    <!-- Rich Explorer -->
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ScenarioDef[defName="TheRichExplorer"]/scenario/parts</xpath>
        <value>
            <li Class="ScenPart_StartingThing_Defined">
                <def>StartingThing_Defined</def>
                <thingDef>SurvivalTools_Multitool</thingDef>
            </li>
        </value>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/StuffProps_DLC.xml">
<?xml version="1.0" encoding="utf-8" ?>
<Patch>
    <!-- DLC materials require conditional patches -->
    <Operation Class="PatchOperationSequence">
        <operations>
            <!-- WoolMastodon from Odyssey DLC -->
            <li Class="PatchOperationConditional">
                <xpath>/Defs/ThingDef[defName="WoolMastodon"]</xpath>
                <match Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[defName="WoolMastodon"]</xpath>
                    <value>
                        <stuffProps>
                            <statFactors>
                                <StuffPower_Armor_Sharp>0.85</StuffPower_Armor_Sharp>
                            </statFactors>
                        </stuffProps>
                    </value>
                </match>
            </li>
            <!-- WoolMuskox from Odyssey DLC -->
            <li Class="PatchOperationConditional">
                <xpath>/Defs/ThingDef[defName="WoolMuskox"]</xpath>
                <match Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[defName="WoolMuskox"]</xpath>
                    <value>
                        <stuffProps>
                            <statFactors>
                                <StuffPower_Armor_Sharp>0.9</StuffPower_Armor_Sharp>
                            </statFactors>
                        </stuffProps>
                    </value>
                </match>
            </li>
            <!-- BlocksVacstone from Odyssey DLC -->
            <li Class="PatchOperationConditional">
                <xpath>/Defs/ThingDef[defName="BlocksVacstone"]</xpath>
                <match Class="PatchOperationAdd">
                    <xpath>/Defs/ThingDef[defName="BlocksVacstone"]</xpath>
                    <value>
                        <stuffProps>
                            <statFactors>
                                <StuffPower_Armor_Sharp>1.3</StuffPower_Armor_Sharp>
                            </statFactors>
                        </stuffProps>
                    </value>
                </match>
            </li>
        </operations>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/StuffProps_Fabric.xml">
<?xml version="1.0" encoding="utf-8" ?>
<Patch>
    <Operation Class="PatchOperationSequence">
        <operations>
            <!-- Add StuffProps to Cloth -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="Cloth"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.75</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to Synthread -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="Synthread"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>1.0</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to DevilstrandCloth -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="DevilstrandCloth"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>1.2</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to Hyperweave -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="Hyperweave"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>1.5</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to WoolSheep -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="WoolSheep"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.6</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to WoolAlpaca -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="WoolAlpaca"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.65</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to WoolMegasloth -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="WoolMegasloth"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.8</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to WoolMuffalo -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="WoolMuffalo"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.7</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
            <!-- Add StuffProps to WoolBison -->
            <li Class="PatchOperationAdd">
                <xpath>/Defs/ThingDef[defName="WoolBison"]</xpath>
                <value>
                    <stuffProps>
                        <statFactors>
                            <StuffPower_Armor_Sharp>0.75</StuffPower_Armor_Sharp>
                        </statFactors>
                    </stuffProps>
                </value>
            </li>
        </operations>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/ThingDefs_Items/CleaningMaterials_Category.xml">
<?xml version="1.0" encoding="utf-8"?>
<Patch>
    <!-- Simple adds with success=Always so missing defs (DLC not loaded) don't spam errors -->
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='Cloth']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='DevilstrandCloth']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='Hyperweave']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='Synthread']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <!-- Wools (some gated by DLC) -->
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='WoolSheep']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='WoolAlpaca']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='WoolMegasloth']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='WoolMuffalo']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <success>Always</success>
        <xpath>/Defs/ThingDef[defName='WoolBison']/thingCategories</xpath>
        <value>
            <li>SurvivalToolsCleaningMaterials</li>
        </value>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/ThingDefs_Misc/Various_Stone.xml">
<Patch>
    <!-- If you want to apply to all stone blocks via the abstract base:
  <Operation Class="PatchOperationAddModExtension">
    <xpath>Defs/ThingDef[@Name="StoneBlocksBase"]</xpath>
    <value>
      <li Class="SurvivalTools.StuffPropsTool">
        <toolStatFactors>
          <li><stat>TreeFellingSpeed</stat><value>0.8</value></li>
          <li><stat>PlantHarvestingSpeed</stat><value>0.8</value></li>
          <li><stat>DiggingSpeed</stat><value>0.8</value></li>
          <li><stat>MiningYieldDigging</stat><value>0.9</value></li>
          <li><stat>ConstructionSpeed</stat><value>0.8</value></li>
        </toolStatFactors>
        <wearFactorMultiplier>1.3</wearFactorMultiplier>
      </li>
    </value>
  </Operation> -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="BlocksSandstone"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.7</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                    <DiggingSpeed>0.8</DiggingSpeed>
                    <MiningYieldDigging>0.9</MiningYieldDigging>
                    <ConstructionSpeed>0.8</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="BlocksGranite"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.85</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                    <DiggingSpeed>0.8</DiggingSpeed>
                    <MiningYieldDigging>0.9</MiningYieldDigging>
                    <ConstructionSpeed>0.8</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="BlocksLimestone"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.8</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                    <DiggingSpeed>0.8</DiggingSpeed>
                    <MiningYieldDigging>0.9</MiningYieldDigging>
                    <ConstructionSpeed>0.8</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="BlocksSlate"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.8</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                    <DiggingSpeed>0.7</DiggingSpeed>
                    <MiningYieldDigging>0.9</MiningYieldDigging>
                    <ConstructionSpeed>0.7</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
        </value>
    </Operation>
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="BlocksMarble"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.7</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                    <DiggingSpeed>0.7</DiggingSpeed>
                    <MiningYieldDigging>0.85</MiningYieldDigging>
                    <ConstructionSpeed>0.7</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
        </value>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/ThingSetMakerDefs/ThingSetMakers_MapGen.xml">
<Patch>
    <Operation Class="PatchOperationConditional">
        <xpath>            
            Defs/ThingSetMakerDef[defName="MapGen_AncientTempleContents"]
            /root[@Class="ThingSetMaker_Sum"]
            /options/li[
            thingSetMaker[@Class="ThingSetMaker_Count"]
            /fixedParams/filter/thingDefs/li[normalize-space(.)='SurvivalTools_Multitool']
            ]
        </xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>                
                Defs/ThingSetMakerDef[defName="MapGen_AncientTempleContents"]
                /root[@Class="ThingSetMaker_Sum"]/options
            </xpath>
            <value>
                <li>
                    <chance>0.6</chance>
                    <thingSetMaker Class="ThingSetMaker_Count">
                        <fixedParams>
                            <countRange>1~1</countRange>
                            <filter>
                                <thingDefs>
                                    <li>SurvivalTools_Multitool</li>
                                </thingDefs>
                            </filter>
                        </fixedParams>
                    </thingSetMaker>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/TraderKindDefs/TraderKinds_Base_Neolithic.xml">
<Patch>
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Base_Neolithic_Standard"]/stockGenerators/li[categoryDef="SurvivalToolsNeolithic"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Base_Neolithic_Standard"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsNeolithic</categoryDef>
                    <countRange>
                        <min>2</min>
                        <max>6</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/TraderKindDefs/TraderKinds_Base_Outlander.xml">
<Patch>
    <!-- Add Neolithic survival tools to Outlander Standard, if not present -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Base_Outlander_Standard"]/stockGenerators/li[categoryDef="SurvivalToolsNeolithic"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Base_Outlander_Standard"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsNeolithic</categoryDef>
                    <countRange>
                        <min>3</min>
                        <max>6</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
    <!-- Add Spacer survival tools to Outlander Standard, if not present -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Base_Outlander_Standard"]/stockGenerators/li[categoryDef="SurvivalToolsSpacer"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Base_Outlander_Standard"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsSpacer</categoryDef>
                    <countRange>
                        <min>0</min>
                        <max>1</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/TraderKindDefs/TraderKinds_Caravan_Neolithic.xml">
<Patch>
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Caravan_Neolithic_BulkGoods"]/stockGenerators/li[categoryDef="SurvivalToolsNeolithic"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Caravan_Neolithic_BulkGoods"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsNeolithic</categoryDef>
                    <countRange>
                        <min>2</min>
                        <max>4</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/TraderKindDefs/TraderKinds_Caravan_Outlander.xml">
<Patch>
    <!-- Outlander Bulk Goods: add Neolithic survival tools if missing -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Caravan_Outlander_BulkGoods"]/stockGenerators/li[categoryDef="SurvivalToolsNeolithic"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Caravan_Outlander_BulkGoods"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsNeolithic</categoryDef>
                    <countRange>
                        <min>2</min>
                        <max>4</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
    <!-- Outlander Exotic: add Spacer survival tools if missing -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Caravan_Outlander_Exotic"]/stockGenerators/li[categoryDef="SurvivalToolsSpacer"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Caravan_Outlander_Exotic"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsSpacer</categoryDef>
                    <!-- Use 0..1 instead of negative min; IntRange expects non-negative -->
                    <countRange>
                        <min>0</min>
                        <max>1</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/TraderKindDefs/TraderKinds_Orbital_Misc.xml">
<Patch>
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/TraderKindDef[defName="Orbital_Exotic"]/stockGenerators/li[categoryDef="SurvivalToolsSpacer"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/TraderKindDef[defName="Orbital_Exotic"]/stockGenerators</xpath>
            <value>
                <li Class="StockGenerator_Category">
                    <categoryDef>SurvivalToolsSpacer</categoryDef>
                    <countRange>
                        <min>0</min>
                        <max>2</max>
                    </countRange>
                </li>
            </value>
        </nomatch>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Crystalloid/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Crystalloid (Rewrite)</li>
      <li>Crystalloid</li>
    </mods>
    <match Class="PatchOperationConditional">
      <!-- If Crysteel exists and already has our StuffPropsTool, do nothing -->
      <xpath>Defs/ThingDef[defName="Crysteel"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
      <nomatch Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Crysteel"]</xpath>
        <value>
          <li Class="SurvivalTools.StuffPropsTool">
            <toolStatFactors>
              <TreeFellingSpeed>1.4</TreeFellingSpeed>
              <PlantHarvestingSpeed>1.4</PlantHarvestingSpeed>
              <DiggingSpeed>1.1</DiggingSpeed>
              <MiningYieldDigging>0.9</MiningYieldDigging>
              <ConstructionSpeed>1.1</ConstructionSpeed>
            </toolStatFactors>
          </li>
        </value>
      </nomatch>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/ExpandedMaterials/Patch.xml">
<?xml version="1.0" encoding="utf-8"?>
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Expanded Materials - Metals</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Copper -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_Copper"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.75</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.75</PlantHarvestingSpeed>
                <DiggingSpeed>0.7</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.7</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.2</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Lead -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_Lead"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.65</DiggingSpeed>
                <MiningYieldDigging>0.85</MiningYieldDigging>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.25</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Bronze -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_Bronze"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.15</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Iron (add MiningYieldDigging for consistency) -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_Iron"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.9</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.9</PlantHarvestingSpeed>
                <DiggingSpeed>0.9</DiggingSpeed>
                <MiningYieldDigging>0.95</MiningYieldDigging>
                <ConstructionSpeed>0.9</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Mild Steel -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_MildSteel"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.95</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.95</PlantHarvestingSpeed>
                <DiggingSpeed>0.95</DiggingSpeed>
                <ConstructionSpeed>0.95</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Stainless Steel -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_StainlessSteel"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
                <PlantHarvestingSpeed>1.1</PlantHarvestingSpeed>
                <DiggingSpeed>1.05</DiggingSpeed>
                <ConstructionSpeed>1.05</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Tempered Steel -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="EM_TemperedSteel"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                  <TreeFellingSpeed>1.25</TreeFellingSpeed>
                  <PlantHarvestingSpeed>1.25</PlantHarvestingSpeed>
                  <DiggingSpeed>1.1</DiggingSpeed>
                  <MiningYieldDigging>1.1</MiningYieldDigging>
                  <ConstructionSpeed>1.1</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>0.9</wearFactorMultiplier>
              </li>
            </value>
        </li>
        <!-- Titanium -->
        <li Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="EM_Titanium"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>1.3</TreeFellingSpeed>
                  <PlantHarvestingSpeed>1.3</PlantHarvestingSpeed>
                  <DiggingSpeed>0.95</DiggingSpeed>
                  <ConstructionSpeed>0.95</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/ExpandedWoodworking/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Expanded Woodworking</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Processed birch lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberBirch"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.55</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                <DiggingSpeed>0.55</DiggingSpeed>
                <MiningYieldDigging>0.75</MiningYieldDigging>
                <ConstructionSpeed>0.55</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed black palm lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberPalm"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed cecropia lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberCecropia"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.55</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                <DiggingSpeed>0.55</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.55</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed cocoawood lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberCocoa"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed cypress lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberCypress"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed drago lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberDrago"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed maple lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberMaple"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.55</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                <DiggingSpeed>0.55</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.55</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed oak lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberOak"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.65</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                <DiggingSpeed>0.65</DiggingSpeed>
                <MiningYieldDigging>0.85</MiningYieldDigging>
                <ConstructionSpeed>0.65</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed pine lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberPine"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed poplar lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberPoplar"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed teak lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberTeak"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.65</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                <DiggingSpeed>0.65</DiggingSpeed>
                <MiningYieldDigging>0.85</MiningYieldDigging>
                <ConstructionSpeed>0.65</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed willow lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberWillow"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Processed bamboo lumber... -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="LumberBamboo"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.5</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.5</PlantHarvestingSpeed>
                <DiggingSpeed>0.5</DiggingSpeed>
                <MiningYieldDigging>0.7</MiningYieldDigging>
                <ConstructionSpeed>0.5</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/ExpandedWoodworkingVGP/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Expanded Woodworking for Vegetable Garden Project</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Nested: VGP Xtra Trees and Flowers -->
        <li Class="PatchOperationFindMod">
          <mods>
            <li>VGP Xtra Trees and Flowers</li>
          </mods>
          <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>
              <!-- LumberAcacia -->
              <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="LumberAcacia"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
                <nomatch Class="PatchOperationAddModExtension">
                  <xpath>Defs/ThingDef[defName="LumberAcacia"]</xpath>
                  <value>
                    <li Class="SurvivalTools.StuffPropsTool">
                      <toolStatFactors>
                        <TreeFellingSpeed>0.65</TreeFellingSpeed>
                        <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                        <DiggingSpeed>0.65</DiggingSpeed>
                        <MiningYieldDigging>0.85</MiningYieldDigging>
                        <ConstructionSpeed>0.65</ConstructionSpeed>
                      </toolStatFactors>
                    </li>
                  </value>
                </nomatch>
              </li>
              <!-- LumberCamellia -->
              <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="LumberCamellia"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
                <nomatch Class="PatchOperationAddModExtension">
                  <xpath>Defs/ThingDef[defName="LumberCamellia"]</xpath>
                  <value>
                    <li Class="SurvivalTools.StuffPropsTool">
                      <toolStatFactors>
                        <TreeFellingSpeed>0.55</TreeFellingSpeed>
                        <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                        <DiggingSpeed>0.55</DiggingSpeed>
                        <MiningYieldDigging>0.75</MiningYieldDigging>
                        <ConstructionSpeed>0.55</ConstructionSpeed>
                      </toolStatFactors>
                    </li>
                  </value>
                </nomatch>
              </li>
              <!-- LumberCherryBlossom -->
              <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="LumberCherryBlossom"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
                <nomatch Class="PatchOperationAddModExtension">
                  <xpath>Defs/ThingDef[defName="LumberCherryBlossom"]</xpath>
                  <value>
                    <li Class="SurvivalTools.StuffPropsTool">
                      <toolStatFactors>
                        <TreeFellingSpeed>0.6</TreeFellingSpeed>
                        <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                        <DiggingSpeed>0.6</DiggingSpeed>
                        <MiningYieldDigging>0.8</MiningYieldDigging>
                        <ConstructionSpeed>0.6</ConstructionSpeed>
                      </toolStatFactors>
                    </li>
                  </value>
                </nomatch>
              </li>
              <!-- LumberJapaneseMaple -->
              <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="LumberJapaneseMaple"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
                <nomatch Class="PatchOperationAddModExtension">
                  <xpath>Defs/ThingDef[defName="LumberJapaneseMaple"]</xpath>
                  <value>
                    <li Class="SurvivalTools.StuffPropsTool">
                      <toolStatFactors>
                        <TreeFellingSpeed>0.55</TreeFellingSpeed>
                        <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                        <DiggingSpeed>0.55</DiggingSpeed>
                        <MiningYieldDigging>0.8</MiningYieldDigging>
                        <ConstructionSpeed>0.55</ConstructionSpeed>
                      </toolStatFactors>
                    </li>
                  </value>
                </nomatch>
              </li>
              <!-- LumberRedMaple -->
              <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="LumberRedMaple"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
                <nomatch Class="PatchOperationAddModExtension">
                  <xpath>Defs/ThingDef[defName="LumberRedMaple"]</xpath>
                  <value>
                    <li Class="SurvivalTools.StuffPropsTool">
                      <toolStatFactors>
                        <TreeFellingSpeed>0.55</TreeFellingSpeed>
                        <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                        <DiggingSpeed>0.55</DiggingSpeed>
                        <MiningYieldDigging>0.8</MiningYieldDigging>
                        <ConstructionSpeed>0.55</ConstructionSpeed>
                      </toolStatFactors>
                    </li>
                  </value>
                </nomatch>
              </li>
            </operations>
          </match>
        </li>
        <!-- LumberIronwood -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberIronwood"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberIronwood"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.7</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                  <DiggingSpeed>0.7</DiggingSpeed>
                  <MiningYieldDigging>0.85</MiningYieldDigging>
                  <ConstructionSpeed>0.7</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberApple -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberApple"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberApple"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.6</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                  <DiggingSpeed>0.6</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberCherry -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberCherry"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberCherry"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.6</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                  <DiggingSpeed>0.6</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberDatePalm -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberDatePalm"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberDatePalm"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.65</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                  <DiggingSpeed>0.65</DiggingSpeed>
                  <MiningYieldDigging>0.85</MiningYieldDigging>
                  <ConstructionSpeed>0.65</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberFig -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberFig"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberFig"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.6</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                  <DiggingSpeed>0.6</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberOrange -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberOrange"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberOrange"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.55</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.55</PlantHarvestingSpeed>
                  <DiggingSpeed>0.55</DiggingSpeed>
                  <MiningYieldDigging>0.75</MiningYieldDigging>
                  <ConstructionSpeed>0.55</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberPeach -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberPeach"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberPeach"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.6</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                  <DiggingSpeed>0.6</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- LumberCoconut (red palm) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="LumberCoconut"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="LumberCoconut"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.65</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                  <DiggingSpeed>0.65</DiggingSpeed>
                  <MiningYieldDigging>0.85</MiningYieldDigging>
                  <ConstructionSpeed>0.65</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/GlitterTech/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Glitter Tech</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Titanium -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="Titanium"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="Titanium"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>2.0</TreeFellingSpeed>
                  <PlantHarvestingSpeed>2.0</PlantHarvestingSpeed>
                  <DiggingSpeed>1.6</DiggingSpeed>
                  <MiningYieldDigging>1.1</MiningYieldDigging>
                  <ConstructionSpeed>1.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- AlphaPoly -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="AlphaPoly"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="AlphaPoly"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>1.8</TreeFellingSpeed>
                  <PlantHarvestingSpeed>1.8</PlantHarvestingSpeed>
                  <DiggingSpeed>2.0</DiggingSpeed>
                  <MiningYieldDigging>1.3</MiningYieldDigging>
                  <ConstructionSpeed>2.0</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- BetaPoly -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="BetaPoly"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="BetaPoly"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>8.0</TreeFellingSpeed>
                  <PlantHarvestingSpeed>8.0</PlantHarvestingSpeed>
                  <DiggingSpeed>8.6</DiggingSpeed>
                  <MiningYieldDigging>2.0</MiningYieldDigging>
                  <ConstructionSpeed>8.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/KurasExtraGems/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Kura's Extra Gems</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Most gem ThingDefs -->
        <li Class="PatchOperationAddModExtension">
          <xpath>
            Defs/ThingDef[
              defName="Amber" or defName="Amethyst" or defName="Aquamarine" or defName="Benitoite" or defName="Bixbite" or defName="Dioptase" or
              defName="Ekanite" or defName="Emerald" or defName="Garnet" or defName="Heliodor" or defName="Kunzite" or defName="Larimar" or
              defName="Iolite" or defName="Malachite" or defName="Morganite" or defName="Padparadscha" or defName="Peridot" or
              defName="Prasiolite" or defName="Quartz" or defName="Ruby" or defName="Sapphire" or defName="Scapolite" or defName="Tanzanite" or
              defName="Tsavorite" or defName="Sunstone"
            ]
          </xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.9</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.9</PlantHarvestingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <DiggingSpeed>1.1</DiggingSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Diamond (kept explicit in case it differs in other packs) -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Diamond"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.9</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.9</PlantHarvestingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <DiggingSpeed>1.1</DiggingSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/KurasExtraStones/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Kura's Extra Stone</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksDunite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksEmperadordark"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksAndesite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.7</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksBlueschist"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksSerpentinite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksObsidian"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksAnorthosite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksBasalt"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksCharnockite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksDacite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksGabbro"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksLherzolite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksMonzonite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksRhyolite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksScoria"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksSovite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksChalk"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                <DiggingSpeed>0.6</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.6</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksJaspillite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksLignite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksSiltstone"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksGreenSchist"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="BlocksMigmatite"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.3</wearFactorMultiplier>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/MechalitCore/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Mechalit Core 1.0</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Tisnit"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <DiggingSpeed>1.2</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
                <ConstructionSpeed>1.2</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Simerium"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>1.4</TreeFellingSpeed>
                <PlantHarvestingSpeed>1.4</PlantHarvestingSpeed>
                <DiggingSpeed>1.1</DiggingSpeed>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Phasarium"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Eftam"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.65</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.65</PlantHarvestingSpeed>
                <DiggingSpeed>0.75</DiggingSpeed>
                <MiningYieldDigging>0.8</MiningYieldDigging>
                <ConstructionSpeed>0.75</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Myrithium"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
                <PlantHarvestingSpeed>1.1</PlantHarvestingSpeed>
                <DiggingSpeed>1.3</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
                <ConstructionSpeed>1.3</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Vilanit"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.93</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.93</PlantHarvestingSpeed>
                <DiggingSpeed>0.93</DiggingSpeed>
                <ConstructionSpeed>0.93</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Elementx"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>2.5</TreeFellingSpeed>
                <PlantHarvestingSpeed>2.5</PlantHarvestingSpeed>
                <DiggingSpeed>2.67</DiggingSpeed>
                <MiningYieldDigging>1.3</MiningYieldDigging>
                <ConstructionSpeed>2.67</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Teachmat"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.08</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.08</PlantHarvestingSpeed>
                <DiggingSpeed>0.08</DiggingSpeed>
                <MiningYieldDigging>0.3</MiningYieldDigging>
                <ConstructionSpeed>0.08</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/Mending/Patch.xml">
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>MendAndRecycle</li>
        </mods>
        <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>
                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <RecipeDef ParentName="MendBase">
                            <defName>MendNeolithicSurvivalTool</defName>
                            <label>repair basic tool</label>
                            <description>Repair tool.</description>
                            <jobString>Repairing.</jobString>
                            <workAmount>50</workAmount>
                            <effectWorking>Smith</effectWorking>
                            <soundWorking>Recipe_Smith</soundWorking>
                            <ingredients>
                                <li>
                                    <filter>
                                        <categories>
                                            <li>SurvivalToolsNeolithic</li>
                                        </categories>
                                    </filter>
                                    <count>1</count>
                                </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <allowedHitPointsPercents>
                                    <min>0</min>
                                    <max>0.99</max>
                                </allowedHitPointsPercents>
                                <categories>
                                    <li>SurvivalToolsNeolithic</li>
                                </categories>
                            </fixedIngredientFilter>
                            <skillRequirements>
                                <Crafting>4</Crafting>
                            </skillRequirements>
                        </RecipeDef>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <RecipeDef ParentName="MendBase">
                            <defName>MendIndustrialSurvivalTool</defName>
                            <label>repair modern tool</label>
                            <description>Repair tool.</description>
                            <jobString>Repairing.</jobString>
                            <workAmount>100</workAmount>
                            <effectWorking>Smith</effectWorking>
                            <soundWorking>Recipe_Smith</soundWorking>
                            <ingredients>
                                <li>
                                    <filter>
                                        <categories>
                                            <li>SurvivalToolsIndustrial</li>
                                        </categories>
                                    </filter>
                                    <count>1</count>
                                </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <allowedHitPointsPercents>
                                    <min>0</min>
                                    <max>0.99</max>
                                </allowedHitPointsPercents>
                                <categories>
                                    <li>SurvivalToolsIndustrial</li>
                                </categories>
                            </fixedIngredientFilter>
                            <skillRequirements>
                                <Crafting>6</Crafting>
                            </skillRequirements>
                        </RecipeDef>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs</xpath>
                    <value>
                        <RecipeDef ParentName="MendBase">
                            <defName>MendSpacerSurvivalTool</defName>
                            <label>repair advanced tool</label>
                            <description>Repair tool.</description>
                            <jobString>Repairing.</jobString>
                            <workAmount>200</workAmount>
                            <effectWorking>Smith</effectWorking>
                            <soundWorking>Recipe_Smith</soundWorking>
                            <ingredients>
                                <li>
                                    <filter>
                                        <categories>
                                            <li>SurvivalToolsSpacer</li>
                                        </categories>
                                    </filter>
                                    <count>1</count>
                                </li>
                            </ingredients>
                            <fixedIngredientFilter>
                                <allowedHitPointsPercents>
                                    <min>0</min>
                                    <max>0.99</max>
                                </allowedHitPointsPercents>
                                <categories>
                                    <li>SurvivalToolsSpacer</li>
                                </categories>
                            </fixedIngredientFilter>
                            <skillRequirements>
                                <Crafting>8</Crafting>
                            </skillRequirements>
                        </RecipeDef>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/MetalsPlus/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Metals+</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Copper -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Copper"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.75</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.75</PlantHarvestingSpeed>
                <DiggingSpeed>0.83</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.83</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.2</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Tin -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Tin"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <DiggingSpeed>1.1</DiggingSpeed>
                <MiningYieldDigging>0.85</MiningYieldDigging>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.25</wearFactorMultiplier>
            </li>
          </value>
        </li>
        <!-- Iron (add MiningYieldDigging for consistency) -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Iron"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.9</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.9</PlantHarvestingSpeed>
                <DiggingSpeed>0.9</DiggingSpeed>
                <MiningYieldDigging>0.95</MiningYieldDigging>
                <ConstructionSpeed>0.9</ConstructionSpeed>
              </toolStatFactors>
            </li>
          </value>
        </li>
        <!-- Titanium (only add if no extension exists) -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="Titanium"]/modExtensions</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="Titanium"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>1.25</TreeFellingSpeed>
                  <PlantHarvestingSpeed>1.25</PlantHarvestingSpeed>
                  <DiggingSpeed>1.1</DiggingSpeed>
                  <ConstructionSpeed>1.1</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>0.9</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- Bronze -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="Bronze"]</xpath>
          <value>
            <li Class="SurvivalTools.StuffPropsTool">
              <toolStatFactors>
                <TreeFellingSpeed>0.85</TreeFellingSpeed>
                <PlantHarvestingSpeed>0.85</PlantHarvestingSpeed>
                <DiggingSpeed>0.8</DiggingSpeed>
                <MiningYieldDigging>0.9</MiningYieldDigging>
                <ConstructionSpeed>0.8</ConstructionSpeed>
              </toolStatFactors>
              <wearFactorMultiplier>1.15</wearFactorMultiplier>
            </li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/Odyssey/ThingDefs_Items/Items_Resource_Stuff.xml">
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Ludeon.RimWorld.Odyssey</li>
        </mods>
        <match Class="PatchOperationSequence">
            <operations>
                <!-- BlocksVacstone -->
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="BlocksVacstone"]</xpath>
                    <value>
                        <li Class="SurvivalTools.StuffPropsTool">
                            <toolStatFactors>
                                <TreeFellingSpeed>1.0</TreeFellingSpeed>
                                <PlantHarvestingSpeed>1.0</PlantHarvestingSpeed>
                                <DiggingSpeed>1.0</DiggingSpeed>
                                <MiningYieldDigging>1.0</MiningYieldDigging>
                                <ConstructionSpeed>1.0</ConstructionSpeed>
                            </toolStatFactors>
                        </li>
                    </value>
                </li>
                <!-- Obsidian (if you want to buff/nerf it too) -->
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="Obsidian"]</xpath>
                    <value>
                        <li Class="SurvivalTools.StuffPropsTool">
                            <toolStatFactors>
                                <TreeFellingSpeed>0.8</TreeFellingSpeed>
                                <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                                <DiggingSpeed>0.9</DiggingSpeed>
                                <MiningYieldDigging>0.95</MiningYieldDigging>
                                <ConstructionSpeed>0.8</ConstructionSpeed>
                                <MaintenanceSpeed>0.8</MaintenanceSpeed>
                                <DeconstructionSpeed>0.9</DeconstructionSpeed>
                                <ResearchSpeed>0.9</ResearchSpeed>
                                <CleaningSpeed>1.0</CleaningSpeed>
                                <MedicalOperationSpeed>1.2</MedicalOperationSpeed>
                                <MedicalSurgerySuccessChance>1.1</MedicalSurgerySuccessChance>
                                <ButcheryFleshSpeed>1.3</ButcheryFleshSpeed>
                                <ButcheryFleshEfficiency>1.1</ButcheryFleshEfficiency>
                                <SowingSpeed>0.8</SowingSpeed>
                            </toolStatFactors>
                        </li>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Quarry/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Quarry</li>
      <!-- If you know the packageId, prefer this op instead:
      <li Class="PatchOperationFindModByPackageId">
        <mods><li>sarg.quarry</li></mods>
        <match Class="PatchOperationSequence"> ... </match>
      </li>
      -->
    </mods>
    <match Class="PatchOperationConditional">
      <xpath>Defs/WorkGiverDef[defName="QRY_MineQuarry"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
      <!-- If not already present, add our extension -->
      <nomatch Class="PatchOperationAddModExtension">
        <xpath>Defs/WorkGiverDef[defName="QRY_MineQuarry"]</xpath>
        <value>
          <li Class="SurvivalTools.WorkGiverExtension">
            <requiredStats>
              <li>DiggingSpeed</li>
              <li>MiningYieldDigging</li>
            </requiredStats>
          </li>
        </value>
      </nomatch>
      <!-- If already present, do nothing -->
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/ResearchReinvented/FieldResearchSupport.xml">
<?xml version="1.0" encoding="utf-8" ?>
<!-- 
  Research Reinvented Compatibility Patch
  This patch adds FieldResearchSpeedMultiplier stat to our research tools
  when Research Reinvented is loaded, enabling field research functionality.
-->
<Patch>
    <!-- Add FieldResearchSpeedMultiplier to Abacus when RR is loaded -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>PeteTimesSix.ResearchReinvented</li>
        </mods>
        <match Class="PatchOperationSequence">
            <operations>
                <!-- Add FieldResearchSpeedMultiplier to Abacus -->
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="SurvivalTools_Abacus"]/modExtensions/li[@Class="SurvivalTools.SurvivalToolProperties"]/baseWorkStatFactors</xpath>
                    <value>
                        <FieldResearchSpeedMultiplier>0.7</FieldResearchSpeedMultiplier>
                    </value>
                </li>
                <!-- Add FieldResearchSpeedMultiplier to Microscope -->
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="SurvivalTools_Microscope"]/modExtensions/li[@Class="SurvivalTools.SurvivalToolProperties"]/baseWorkStatFactors</xpath>
                    <value>
                        <FieldResearchSpeedMultiplier>1.4</FieldResearchSpeedMultiplier>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Rimefeller/Patch.xml">
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Rimefeller</li>
        </mods>
        <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[@Name="SynthyleneBase"]</xpath>
                    <value>
                        <li Class="SurvivalTools.StuffPropsTool">
                            <toolStatFactors>
                                <TreeFellingSpeed>0.6</TreeFellingSpeed>
                                <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                                <DiggingSpeed>0.9</DiggingSpeed>
                                <MiningYieldDigging>0.9</MiningYieldDigging>
                                <ConstructionSpeed>0.9</ConstructionSpeed>
                            </toolStatFactors>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[@Name="FiberCompositeBase"]</xpath>
                    <value>
                        <li Class="SurvivalTools.StuffPropsTool">
                            <toolStatFactors>
                                <TreeFellingSpeed>1.2</TreeFellingSpeed>
                                <PlantHarvestingSpeed>1.2</PlantHarvestingSpeed>
                                <MiningYieldDigging>0.9</MiningYieldDigging>
                            </toolStatFactors>
                        </li>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/RimOfMadnessBones/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Rim of Madness - Bones</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- BoneItem -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="BoneItem"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="BoneItem"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.5</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.5</PlantHarvestingSpeed>
                  <DiggingSpeed>0.6</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- Bonecrete -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="Bonecrete"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="Bonecrete"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.45</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.45</PlantHarvestingSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- BonePlastic -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="BonePlastic"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="BonePlastic"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.3</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.3</PlantHarvestingSpeed>
                  <DiggingSpeed>0.3</DiggingSpeed>
                  <MiningYieldDigging>0.5</MiningYieldDigging>
                  <ConstructionSpeed>0.3</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- BoneChina -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="BoneChina"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="BoneChina"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.12</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.12</PlantHarvestingSpeed>
                  <DiggingSpeed>0.12</DiggingSpeed>
                  <MiningYieldDigging>0.25</MiningYieldDigging>
                  <ConstructionSpeed>0.12</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/RimsenalFederation/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Rimsenal - Federation</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Foerum -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="Foerum"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="Foerum"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>1.3</TreeFellingSpeed>
                  <PlantHarvestingSpeed>1.3</PlantHarvestingSpeed>
                  <DiggingSpeed>0.7</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.7</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/VegetableGarden/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>VGP Vegetable Garden</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Bamboo -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="Bamboo"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="Bamboo"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.5</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.5</PlantHarvestingSpeed>
                  <DiggingSpeed>0.5</DiggingSpeed>
                  <MiningYieldDigging>0.7</MiningYieldDigging>
                  <ConstructionSpeed>0.5</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- Ironwood log -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="VG_IronWoodLog"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="VG_IronWoodLog"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.7</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                  <DiggingSpeed>0.7</DiggingSpeed>
                  <MiningYieldDigging>0.85</MiningYieldDigging>
                  <ConstructionSpeed>0.7</ConstructionSpeed>
                </toolStatFactors>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="LICENSE">
MIT License
Copyright (c) 2018 XeoNovaDan
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>
<file path="Source/Compatibility/CommonSense/CommonSenseDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/CommonSense/CommonSenseDebug.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
/// <summary>
/// Debug helpers for CommonSense compatibility.
/// Use to output detailed diagnostic info when developing compat code.
/// </summary>
internal static class CommonSenseDebug
⋮----
public static void Log(string msg)
⋮----
if (!CommonSenseHelpers.IsCommonSenseActive()) return;
⋮----
// swallow
</file>
<file path="Source/Compatibility/CommonSense/CommonSenseHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/CommonSense/CommonSenseHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
/// <summary>
/// Helper utilities for CommonSense compatibility.
/// All methods are defensive and safe to call when CommonSense is not loaded.
/// </summary>
public static class CommonSenseHelpers
⋮----
/// Returns true if CommonSense mod is active/available.
/// Use this before calling any CommonSense-specific APIs.
⋮----
public static bool IsCommonSenseActive()
⋮----
// Safe check via ModLister if available at runtime
return Verse.ModLister.GetActiveModWithIdentifier("com.rimworld.caister.commonsense") != null;
⋮----
/// Centralized check whether a pawn should be exempt from SurvivalTools logic
/// when CommonSense provides alternate handling (e.g. wanderers, gear UI overrides).
⋮----
public static bool ShouldBypassForCommonSense(Pawn pawn)
⋮----
// Placeholder for future CommonSense-specific heuristics.
</file>
<file path="Source/Compatibility/CommonSense/CommonSensePatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/CommonSense/CommonSensePatches.cs
⋮----
/// <summary>
/// Compatibility module for CommonSense mod.
/// Implements ICompatibilityModule so CompatAPI can discover and initialize it.
/// All operations are defensive and safe to run when the mod is not present.
/// </summary>
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
internal sealed class CommonSenseCompatibilityModule : ICompatibilityModule
⋮----
private Harmony _harmony;
⋮----
public bool IsModActive => CommonSenseHelpers.IsCommonSenseActive();
public void Initialize()
⋮----
_harmony = new Harmony("com.jellypowered.survivaltools.compat.commonsense");
// Example patch: intercept CommonSense.JobDriver_Ingest.PrepareToIngestToils
var jobType = AccessTools.TypeByName("CommonSense.JobDriver_Ingest");
⋮----
var method = AccessTools.Method(jobType, "PrepareToIngestToils");
⋮----
var prefix = new HarmonyMethod(typeof(CommonSenseCompatibilityModule).GetMethod(nameof(Prefix_PrepareToIngestToils)));
var postfix = new HarmonyMethod(typeof(CommonSenseCompatibilityModule).GetMethod(nameof(Postfix_PrepareToIngestToils)));
_harmony.Patch(method, prefix, postfix);
⋮----
public List<StatDef> GetCompatibilityStats()
⋮----
// CommonSense does not add stats relevant to SurvivalTools by default.
⋮----
public Dictionary<string, string> GetDebugInfo()
⋮----
var info = new Dictionary<string, string> { ["Active"] = IsModActive.ToString() };
⋮----
// Prefix - safe no-op unless CommonSense is active
public static bool Prefix_PrepareToIngestToils(object __instance)
⋮----
if (!CommonSenseHelpers.IsCommonSenseActive()) return true;
// Allow SurvivalTools to harmonize gear/drug policy interactions here.
return true; // continue original
⋮----
public static void Postfix_PrepareToIngestToils(object __instance)
⋮----
if (!CommonSenseHelpers.IsCommonSenseActive()) return;
// Reconcile SurvivalTools state after CommonSense sets up toils.
</file>
<file path="Source/Compatibility/SmarterConstruction/SmarterConstructionDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterConstruction/SmarterConstructionDebug.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
internal static class SmarterConstructionDebug
⋮----
public static void D(string msg)
⋮----
if (!SmarterConstructionHelpers.IsSmarterConstructionActive()) return;
</file>
<file path="Source/Compatibility/SmarterConstruction/SmarterConstructionHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterConstruction/SmarterConstructionHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Helpers for SmarterConstruction compatibility.
/// Defensive, minimal surface area for reflection lookups.
/// </summary>
internal static class SmarterConstructionHelpers
⋮----
public static bool IsSmarterConstructionActive()
⋮----
return ModLister.GetActiveModWithIdentifier("smarterconstruction.author") != null;
⋮----
/// Safe type lookup for SmarterConstruction job driver types.
⋮----
public static Type GetJobDriverConstructType()
⋮----
try { return AccessTools.TypeByName("SmarterConstruction.JobDriver_ConstructFinishFrame"); }
</file>
<file path="Source/Compatibility/SmarterConstruction/SmarterConstructionPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterConstruction/SmarterConstructionPatches.cs
⋮----
/// <summary>
/// Harmony patches for SmarterConstruction compat.
/// Ensures roofing jobs don't loop and tooling hooks degrade gracefully.
/// Integrates with core gating/blacklist helpers and applies tiered penalties via WorkSpeedGlobalHelper.
/// </summary>
internal sealed class SmarterConstructionCompatibilityModule : ICompatibilityModule
⋮----
private Harmony _harmony;
⋮----
public bool IsModActive => SmarterConstructionHelpers.IsSmarterConstructionActive();
public void Initialize()
⋮----
_harmony = new Harmony("com.jellypowered.survivaltools.compat.smarterconstruction");
// Patch JobOnThing if present
var type = AccessTools.TypeByName("SmarterConstruction.WorkGiver_Construct");
⋮----
var method = AccessTools.Method(type, "JobOnThing");
⋮----
try { _harmony.Patch(method, prefix: new HarmonyMethod(typeof(SmarterConstructionCompatibilityModule).GetMethod(nameof(Prefix_JobOnThing)))); }
⋮----
// Patch constructor finish toils (prevent infinite loops and respect tiers)
var jdType = AccessTools.TypeByName("SmarterConstruction.JobDriver_ConstructFinishFrame");
⋮----
var m = AccessTools.Method(jdType, "MakeNewToils");
⋮----
try { _harmony.Patch(m, prefix: new HarmonyMethod(typeof(SmarterConstructionCompatibilityModule).GetMethod(nameof(Prefix_MakeNewToils)))); }
⋮----
public List<StatDef> GetCompatibilityStats() => new List<StatDef>();
public Dictionary<string, string> GetDebugInfo() => new Dictionary<string, string> { ["Active"] = IsModActive.ToString() };
// Prefix to safeguard JobOnThing and avoid infinite roofing loops
public static bool Prefix_JobOnThing(object __instance, Thing t, Pawn pawn, ref Job __result)
⋮----
if (!SmarterConstructionHelpers.IsSmarterConstructionActive()) return true;
⋮----
// Respect core blacklist — if pawn is blacklisted, allow original behaviour
if (!PawnToolValidator.CanUseSurvivalTools(pawn)) return true;
// Basic roofing loop guard: if job targets a roofed cell but roofing job already exists, skip.
⋮----
if (t.def != null && t.def.building != null && t.Position.Roofed(t.Map))
⋮----
// scan all pawns on the map and check their current job for a RemoveRoof targeting same thing/cell
⋮----
catch { /* swallow */ }
// Additionally, gate roofing early if settings/hardcore require construction tools
⋮----
WorkGiverDef wgDef = null;
try { wgDef = DefDatabase<WorkGiverDef>.GetNamedSilentFail("BuildRoofs"); } catch { }
// Prefer StatGatingHelper to keep parity with core gating rules
⋮----
if (StatGatingHelper.ShouldBlockBuildRoof(pawn, out string scKey, t.Position))
⋮----
if (ST_Logging.IsCompatLogging())
⋮----
// Prefix to inspect MakeNewToils and avoid endless toil spawns
public static bool Prefix_MakeNewToils(object __instance)
⋮----
// Defensive: ensure any JobDriver toils that rely on SurvivalTools are aware of current pawn/tool state
// (Heavy instrumentation or tiered penalty registration would be done in StatPart_SurvivalTool via GetStatValue)
</file>
<file path="Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionDebug.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
internal static class SmarterDeconstructionDebug
⋮----
public static void D(string msg)
⋮----
if (!SmarterDeconstructionHelpers.IsSmarterDeconstructionActive()) return;
</file>
<file path="Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
internal static class SmarterDeconstructionHelpers
⋮----
public static bool IsSmarterDeconstructionActive()
⋮----
try { return ModLister.GetActiveModWithIdentifier("smarterdeconstruction.author") != null; }
⋮----
public static bool IsTDEnhancementPackActive()
⋮----
try { return ModLister.GetActiveModWithIdentifier("td.enhancement.pack") != null; }
⋮----
/// <summary>
/// Determines if SmarterDeconstruction should be considered the authoritative owner for WorkGiver_Scanner compatibility hooks.
/// This helps deduplicate patches when multiple mods (e.g., TD Enhancement Pack) attempt to patch the same targets.
/// </summary>
public static bool ShouldOwnWorkGiverScannerHooks()
⋮----
// Default to true when SmarterDeconstruction is active. Other compat modules can check CompatibilityRegistry to decide.
</file>
<file path="Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionPatches.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Patches to integrate with SmarterDeconstruction and related mods.
/// Handles pacifist equip logic, roof handling, mining damage tuning, and gating.
/// </summary>
internal sealed class SmarterDeconstructionCompatibilityModule : ICompatibilityModule
⋮----
// Indicates whether SmarterDeconstruction compat applied the WorkGiver_Scanner hooks.
⋮----
private Harmony _harmony;
⋮----
public bool IsModActive => SmarterDeconstructionHelpers.IsSmarterDeconstructionActive();
public void Initialize()
⋮----
_harmony = new Harmony("com.jellypowered.survivaltools.compat.smarterdeconstruction");
// Pacifist equip logic is provided by core SurvivalTools (Patch_EquipmentUtility_CanEquip_PacifistTools).
// Do not apply a duplicate CanEquip postfix here; rely on core behaviour instead.
// Patch WorkGiver_PlantsCut.JobOnThing to gate survival tool checks
var wgType = AccessTools.TypeByName("SmarterDeconstruction.WorkGiver_PlantsCut");
⋮----
var m = AccessTools.Method(wgType, "JobOnThing");
⋮----
try { _harmony.Patch(m, prefix: new HarmonyMethod(typeof(SmarterDeconstructionCompatibilityModule).GetMethod(nameof(Prefix_JobOnThing)))); }
⋮----
// SmarterDeconstruction relies on the core WorkGiver_Scanner gating patch (Patch_WorkGiver_Scanner_ToolGate.cs)
// to avoid duplicating scanner-level hooks. We keep per-WG patches (e.g., WorkGiver_PlantsCut) above.
⋮----
public List<StatDef> GetCompatibilityStats() => new List<StatDef>();
public Dictionary<string, string> GetDebugInfo() => new Dictionary<string, string> { ["Active"] = IsModActive.ToString() };
// Pacifist equip logic is handled by core SurvivalTools; no postfix required here.
public static bool Prefix_JobOnThing(object __instance)
⋮----
if (!SmarterDeconstructionHelpers.IsSmarterDeconstructionActive()) return true;
⋮----
/// Canonical prefix for WorkGiver_Scanner.JobOnThing.
/// Gates jobs that SurvivalTools wants to block when the pawn lacks appropriate survival tools.
/// Returns true to continue original when allowed, false to skip job creation.
⋮----
public static bool Prefix_WorkGiverScanner_JobOnThing(object __instance, Pawn pawn, Thing t)
⋮----
// Determine the WorkGiverDef from the instance if possible
WorkGiverDef wgDef = null;
try { wgDef = (WorkGiverDef)AccessTools.Field(__instance.GetType(), "def").GetValue(__instance); } catch { }
// If this job should be gated by SurvivalTools, enforce pawn must have a survival tool for the job's main stat
⋮----
JobDef jobDef = null;
try { jobDef = (JobDef)AccessTools.Field(__instance.GetType(), "def").GetValue(__instance); } catch { }
// Use SurvivalToolUtility heuristics: ShouldGateByDefault(WorkGiverDef) and PawnHasSurvivalTool
⋮----
if (SurvivalToolUtility.ShouldGateByDefault(wgDef))
⋮----
// Determine required stats for this workgiver/job
var requiredStats = SurvivalToolUtility.RelevantStatsFor(wgDef, jobDef ?? (JobDef)null) ?? new List<StatDef>();
// If research stats are relevant, honor Research tools via CompatAPI
if ((requiredStats == null || requiredStats.Count == 0) && CompatAPI.PawnHasResearchTools(pawn))
⋮----
// Pawn already satisfied by research tools
⋮----
// Always call central blacklist / capability check first
if (!PawnToolValidator.CanUseSurvivalTools(pawn))
⋮----
// Pawn is blacklisted by core rules (mechanoid/quest/other) — allow original behaviour
⋮----
// Use the unified gating helper which respects hardcore mode and settings
if (!pawn.MeetsWorkGiverStatRequirements(requiredStats, wgDef, jobDef))
⋮----
if (ST_Logging.ShouldLogJobForPawn(pawn, jobDef ?? JobDefOf.Refuel))
⋮----
// Avoid LINQ in this hot-path logging: build a short comma-separated list
⋮----
// Hook into Pawn_JobTracker.TryTakeOrderedJob to gate jobs requiring survival tools
public static bool Prefix_TryTakeOrderedJob(Pawn_JobTracker __instance)
⋮----
// Let original run; could add gating logic here to check survival tool availability.
⋮----
// Example mining damage adjustment hook (placeholder). Ensure mechanoids are blacklisted.
public static void Postfix_AdjustMiningDamage(ref float __result, Pawn pawn, ThingDef target)
⋮----
if (!SmarterDeconstructionHelpers.IsSmarterDeconstructionActive()) return;
⋮----
if (pawn.RaceProps.IsMechanoid) return; // do not modify mechanoid behavior
// Placeholder: reduce mining damage if survival tool has wear or stats
</file>
<file path="Source/Compatibility/TDEnhancementPack/TDEnhancementPackDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/TDEnhancementPack/TDEnhancementPackDebug.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
internal static class TDEnhancementPackDebug
⋮----
public static void LogStatus()
⋮----
Log.Message($"[SurvivalTools Compat] TD Enhancement Pack active: {TDEnhancementPackHelpers.IsTDEnhancementPackActive()}");
⋮----
public static void D(string msg)
⋮----
if (!TDEnhancementPackHelpers.IsTDEnhancementPackActive()) return;
</file>
<file path="Source/Compatibility/TDEnhancementPack/TDEnhancementPackHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/TDEnhancementPack/TDEnhancementPackHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Helper utilities for TD Enhancement Pack compatibility.
/// Uses safe mod detection via ModLister and routes logs through ST_Logging.
/// </summary>
internal static class TDEnhancementPackHelpers
⋮----
/// Returns true when TD Enhancement Pack is active. Safe no-op if ModLister API is unavailable.
⋮----
public static bool IsTDEnhancementPackActive()
⋮----
try { return Verse.ModLister.GetActiveModWithIdentifier("td.enhancement.pack") != null; }
⋮----
// Fallback: be conservative and treat mod as not present.
⋮----
/// Wrapper to log compatibility messages consistently.
⋮----
public static void LogCompat(string message)
⋮----
try { ST_Logging.LogCompatMessage(message); }
catch { /* swallow logging failures */ }
</file>
<file path="Source/Compatibility/TDEnhancementPack/TDEnhancementPackPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/TDEnhancementPack/TDEnhancementPackPatches.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Harmony patches for TD Enhancement Pack compatibility.
/// Patches are safe no-ops when the mod is absent.
/// </summary>
⋮----
internal static class TDEnhancementPackPatches
⋮----
if (!TDEnhancementPackHelpers.IsTDEnhancementPackActive())
⋮----
var harmony = new Harmony("com.survivaltools.compat.tdenhancementpack");
// Placeholder for any early static patches that are safe to apply.
// Most hooks are registered via the ICompatibilityModule below to allow dedup logic.
⋮----
/// TD Enhancement Pack compatibility. Deduplicates overlapping hooks with SmarterDeconstruction.
⋮----
internal sealed class TDEnhancementPackCompatibilityModule : ICompatibilityModule
⋮----
private Harmony _harmony;
⋮----
public bool IsModActive => TDEnhancementPackHelpers.IsTDEnhancementPackActive();
public void Initialize()
⋮----
_harmony = new Harmony("com.jellypowered.survivaltools.compat.tdenhancementpack");
// If SmarterDeconstruction compat is present, avoid duplicating WorkGiver_Scanner hooks.
var sdModule = CompatibilityRegistry.GetModule("SmarterDeconstruction");
⋮----
// Prefer the helper method on SmarterDeconstruction for a robust ownership check
if (SmarterDeconstruction.SmarterDeconstructionHelpers.ShouldOwnWorkGiverScannerHooks())
⋮----
catch { /* ignore and proceed to apply TD hooks if needed */ }
⋮----
// Apply TD-specific hooks here. Keep them defensive and lightweight.
// Parity: ensure TD's build-roof logic respects SurvivalTools gating in extra-hardcore.
⋮----
var t = AccessTools.TypeByName("WorkGiver_BuildRoof") ?? AccessTools.TypeByName("WorkGiver_BuildRoofs");
⋮----
var hasCell = AccessTools.Method(t, "HasJobOnCell", new Type[] { typeof(Pawn), typeof(IntVec3), typeof(bool) });
⋮----
var prefix = new HarmonyMethod(typeof(TDEnhancementPackCompatibilityModule).GetMethod(nameof(Prefix_BuildRoof_HasJobOnCell), BindingFlags.NonPublic | BindingFlags.Static));
_harmony.Patch(hasCell, prefix: prefix);
⋮----
var jobOnCell = AccessTools.Method(t, "JobOnCell", new Type[] { typeof(Pawn), typeof(IntVec3) });
⋮----
var prefix2 = new HarmonyMethod(typeof(TDEnhancementPackCompatibilityModule).GetMethod(nameof(Prefix_BuildRoof_JobOnCell), BindingFlags.NonPublic | BindingFlags.Static));
_harmony.Patch(jobOnCell, prefix: prefix2);
⋮----
// Lightweight prefixes are defined in class scope below.
⋮----
public List<StatDef> GetCompatibilityStats() => new List<StatDef>();
public Dictionary<string, string> GetDebugInfo() => new Dictionary<string, string> { ["Active"] = IsModActive.ToString() };
// Lightweight prefixes to keep TD's roofing behavior in parity with core gating
// These mirror the core gating: deny BuildRoof assignment in extra-hardcore when pawn lacks construction tools.
private static bool Prefix_BuildRoof_HasJobOnCell(object __instance, Pawn pawn, IntVec3 c, bool forced, ref bool __result)
⋮----
if (StatGatingHelper.ShouldBlockBuildRoof(pawn, out string sk, c))
⋮----
try { if (ShouldLogWithCooldown(sk)) Log.Message($"[SurvivalTools.ToolGate] TD: denying BuildRoof for {pawn.LabelShort} at {c}"); } catch { }
⋮----
private static bool Prefix_BuildRoof_JobOnCell(object __instance, Pawn pawn, IntVec3 c, ref Job __result)
⋮----
if (StatGatingHelper.ShouldBlockBuildRoof(pawn, out string sk2, c))
⋮----
try { if (ShouldLogWithCooldown(sk2)) Log.Message($"[SurvivalTools.ToolGate] TD: skipping BuildRoof.JobOnCell for {pawn.LabelShort} at {c}"); } catch { }
</file>
<file path="Source/DebugTools/SeparateTreeChoppingPatchLogger.cs">
// RimWorld 1.6 / C# 7.3
// Source/DebugTools/SeparateTreeChoppingPatchLogger.cs
//
// Logs ThingDefs with SurvivalToolProperties and dumps Harmony patches that look
// like they're from Separate Tree Chopping. Intended for debug/compat troubleshooting.
⋮----
// Usage: Enable both SurvivalTools debug logging and compat logging to see output.
⋮----
public static class SeparateTreeChoppingPatchLogger
⋮----
// Only run when both debug and compat logging are enabled
if (!ST_Logging.IsDebugLoggingEnabled || !ST_Logging.IsCompatLogging())
⋮----
// 1) Try to find known STC assemblies and types
⋮----
Assembly stcAssembly = null;
⋮----
stcAssembly = AppDomain.CurrentDomain.GetAssemblies()
.FirstOrDefault(a => a.GetName().Name?.IndexOf(asmName, StringComparison.OrdinalIgnoreCase) >= 0);
⋮----
// Look for common STC types/methods to analyze
⋮----
// 2) Also check for tree-related WorkGivers and JobDefs that might conflict
⋮----
public static void DumpPatchesByHeuristics()
⋮----
var methods = HarmonyLib.Harmony.GetAllPatchedMethods()?.ToList();
⋮----
var substrings = new[] { "tree", "chopping", "separate", "fell", "harvest" }; // case-insensitive
⋮----
var info = HarmonyLib.Harmony.GetPatchInfo(tgt);
⋮----
if (PatchLooksLikeSTC(p, substrings)) matches.Add((p, "PREFIX"));
⋮----
if (PatchLooksLikeSTC(p, substrings)) matches.Add((p, "POSTFIX"));
⋮----
if (PatchLooksLikeSTC(p, substrings)) matches.Add((p, "TRANSPILER"));
⋮----
LogInfo($"[SurvivalTools] DumpSTCHeur: target -> {tgt.FullDescriptionSafe()}");
⋮----
string pmDesc = p?.PatchMethod != null ? p.PatchMethod.FullDescriptionSafe() : "(unknown)";
⋮----
// helper
⋮----
if (subs.Any(s => owner.IndexOf(s, StringComparison.OrdinalIgnoreCase) >= 0)) return true;
⋮----
if (subs.Any(s => asm.IndexOf(s, StringComparison.OrdinalIgnoreCase) >= 0)) return true;
if (subs.Any(s => typeFull.IndexOf(s, StringComparison.OrdinalIgnoreCase) >= 0)) return true;
⋮----
// Try to find and analyze types from the STC assembly
private static void TryDumpSeparateTreeChoppingTypes(Assembly stcAssembly)
⋮----
var types = stcAssembly.GetTypes();
⋮----
foreach (var type in types.Take(20)) // Limit output
⋮----
// Check if this type has any patched methods
var methods = type.GetMethods(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Static | BindingFlags.Instance);
foreach (var method in methods.Take(5)) // Limit to first few methods
⋮----
var patches = Harmony.GetPatchInfo(method);
if (patches != null && (patches.Prefixes.Any() || patches.Postfixes.Any() || patches.Transpilers.Any()))
⋮----
// Look for tree-related WorkGivers and JobDefs that might conflict
private static void DumpTreeRelatedDefs()
⋮----
// Look for tree-related WorkGivers
⋮----
.Where(wg => wg.defName != null && (
wg.defName.IndexOf("tree", StringComparison.OrdinalIgnoreCase) >= 0 ||
wg.defName.IndexOf("fell", StringComparison.OrdinalIgnoreCase) >= 0 ||
wg.defName.IndexOf("harvest", StringComparison.OrdinalIgnoreCase) >= 0 ||
wg.defName.IndexOf("plant", StringComparison.OrdinalIgnoreCase) >= 0))
.ToList();
⋮----
foreach (var wg in treeWorkGivers.Take(10)) // Limit output
⋮----
// Look for tree-related JobDefs
⋮----
.Where(job => job.defName != null && (
job.defName.IndexOf("tree", StringComparison.OrdinalIgnoreCase) >= 0 ||
job.defName.IndexOf("fell", StringComparison.OrdinalIgnoreCase) >= 0 ||
job.defName.IndexOf("harvest", StringComparison.OrdinalIgnoreCase) >= 0 ||
job.defName.IndexOf("plant", StringComparison.OrdinalIgnoreCase) >= 0))
⋮----
foreach (var job in treeJobs.Take(10)) // Limit output
⋮----
// Look for tree-related ThingDefs (tools that might be used for tree work)
⋮----
.Where(d => d.GetModExtension<SurvivalToolProperties>() != null)
.Where(d =>
⋮----
foreach (var def in treeToolDefs.Take(10)) // Limit output
⋮----
?.Select(f => f.stat.defName).ToList() ?? new List<string>();
LogInfo($"  {def.defName} (mod: {modName}, stats: {string.Join(", ", relevantStats)})");
⋮----
// Report current tree felling system status
⋮----
// Fallback: enumerate all patched methods and print patches that look like they come from STC
private static void DumpAllLikelySTCPatches()
⋮----
var patchedMethods = Harmony.GetAllPatchedMethods()?.ToList();
⋮----
var info = Harmony.GetPatchInfo(method);
⋮----
if (IsLikelySTCPatch(p)) stcPatches.Add((p, "PREFIX"));
⋮----
if (IsLikelySTCPatch(p)) stcPatches.Add((p, "POSTFIX"));
⋮----
if (IsLikelySTCPatch(p)) stcPatches.Add((p, "TRANSPILER"));
⋮----
LogInfo($"[SurvivalTools] SeparateTreeChoppingPatchLogger: STC-style patches on target -> {method.FullDescriptionSafe()}");
⋮----
// Heuristic checks to see whether a Harmony.Patch likely originates from Separate Tree Chopping
private static bool IsLikelySTCPatch(Patch p)
⋮----
// 1) owner string often holds harmonyId passed when the author created the Harmony instance
if (!string.IsNullOrEmpty(p.owner) &&
(p.owner.IndexOf("separatetreechopping", StringComparison.OrdinalIgnoreCase) >= 0 ||
p.owner.IndexOf("treechopping", StringComparison.OrdinalIgnoreCase) >= 0 ||
p.owner.IndexOf("separate", StringComparison.OrdinalIgnoreCase) >= 0))
⋮----
// 2) fallback: inspect declaring assembly / type name of the patch method
⋮----
if (!string.IsNullOrEmpty(asmName) &&
(asmName.IndexOf("separatetreechopping", StringComparison.OrdinalIgnoreCase) >= 0 ||
asmName.IndexOf("treechopping", StringComparison.OrdinalIgnoreCase) >= 0))
⋮----
if (!string.IsNullOrEmpty(typeFullName) &&
(typeFullName.IndexOf("SeparateTreeChopping", StringComparison.OrdinalIgnoreCase) >= 0 ||
typeFullName.IndexOf("TreeChopping", StringComparison.OrdinalIgnoreCase) >= 0))
⋮----
// ignore reflection failures and treat as non-match
⋮----
// -------------------------
// Reflection helper methods
⋮----
private static string FullDescriptionSafe(this MethodBase mb)
⋮----
var paramDesc = string.Join(", ", mi.GetParameters().Select(p => p.ParameterType.Name + " " + p.Name));
⋮----
var parms = string.Join(", ", mb.GetParameters().Select(p => p.ParameterType.Name));
⋮----
return mb.ToString();
</file>
<file path="Source/Helpers/ToolGateMoteHelper.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ToolGateMoteHelper.cs
// Provides unified, rate-limited spawning of denial / slowdown motes for tool-gated work.
// Edge considerations:
//  - Per pawn+stat cooldown (default 3s) to avoid spam when WorkGiver queries repeat.
//  - Skips if settings.showDenialMotes == false.
//  - Avoids duplicating existing Cleaning/WorkSpeedGlobal penalty motes (caller should skip those or pass skipCleaningAndGlobal=true).
//  - Builds text using translation keys + stat category description for player clarity.
//  - Normal mode slowdown: show slowed factor; hardcore block: show blocked message.
//  - Combined message (Needs + Slowed) available for future hybrid cases.
⋮----
namespace SurvivalTools
⋮----
public static class ToolGateMoteHelper
⋮----
public bool Equals(Key other) => PawnId == other.PawnId && StatId == other.StatId;
public override bool Equals(object obj) => obj is Key k && Equals(k);
public override int GetHashCode() => (PawnId * 397) ^ StatId;
⋮----
private const int CooldownTicks = 1800; // 30 seconds at 60 TPS
private static bool CanShow(Pawn pawn, StatDef stat)
⋮----
var key = new Key(pawn.thingIDNumber, stat.index);
⋮----
if (_lastShownTick.TryGetValue(key, out float last) && (curTick - last) < CooldownTicks)
⋮----
private static string GetCategoryLabel(StatDef stat)
⋮----
return SurvivalToolUtility.GetStatCategoryDescription(stat) ?? stat?.label ?? stat?.defName ?? "?";
⋮----
public static void TryShowBlockedMote(Pawn pawn, StatDef stat)
⋮----
string text = "SurvivalTools_Mote_Blocked".Translate(cat);
MoteMaker.ThrowText(pawn.DrawPos, pawn.Map, text, 3.5f);
⋮----
public static void TryShowSlowedMote(Pawn pawn, StatDef stat, float factor)
⋮----
string text = "SurvivalTools_Mote_Slowed".Translate(factor.ToString("F2"));
⋮----
public static void TryShowNeedsAndSlowedMote(Pawn pawn, StatDef stat, float factor)
⋮----
string text = "SurvivalTools_Mote_NeedsAndSlowed".Translate(cat, factor.ToString("F2"));
</file>
<file path=".gitignore">
/.vscode/obj
/*.sln 
/*/RR Compat
# /*/Assemblies
# /*/Assemblies/*.pdb
# /.vscode
# /Source
</file>
<file path="1.6/Defs/ThingDefs/Apparel_Belts.xml">
<Defs>
    <ThingDef ParentName="ApparelMakeableBase">
        <defName>SurvivalTools_ToolBelt</defName>
        <label>tool belt</label>
        <description>A sturdy leather belt that allows the wearer to carry two additional tools.</description>
        <thingClass>Apparel</thingClass>
        <graphicData>
            <texPath>Things/Pawn/Humanlike/Apparel/ToolBelt/ToolBelt</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <comps Inherit="False">
            <li Class="CompProperties_Forbiddable"/>
            <li>
                <compClass>CompColorable</compClass>
            </li>
            <li>
                <compClass>CompQuality</compClass>
            </li>
        </comps>
        <statBases>
            <Mass>0.5</Mass>
            <WorkToMake>2700</WorkToMake>
            <Flammability>1.0</Flammability>
            <EquipDelay>2</EquipDelay>
        </statBases>
        <equippedStatOffsets>
            <SurvivalToolCarryCapacity>2</SurvivalToolCarryCapacity>
        </equippedStatOffsets>
        <costStuffCount>40</costStuffCount>
        <stuffCategories>
            <li>Leathery</li>
        </stuffCategories>
        <costList>
            <Steel>10</Steel>
        </costList>
        <thingCategories>
            <li>Apparel</li>
        </thingCategories>
        <recipeMaker>
            <researchPrerequisite>Smithing</researchPrerequisite>
        </recipeMaker>
        <apparel>
            <careIfWornByCorpse>false</careIfWornByCorpse>
            <bodyPartGroups>
                <li>Waist</li>
            </bodyPartGroups>
            <layers>
                <li>Belt</li>
            </layers>
            <defaultOutfitTags>
                <li>Worker</li>
            </defaultOutfitTags>
        </apparel>
    </ThingDef>
</Defs>
</file>
<file path="1.6/Defs/Tutor/Concepts_NotedOpportunistic.xml">
<Defs>
    <ConceptDef>
        <defName>UsingSurvivalTools</defName>
        <label>Survival Tools: Intelligent Tool Usage</label>
        <priority>50</priority>
        <helpText>The mod features advanced tool management systems that maximize efficiency and productivity:
AUTOMATIC OPTIMIZATION:
• Colonists automatically select the best available tools for each task
• They prioritize equipped tools over inventory tools when multiple options exist
• Tools currently being used are marked as 'in use' to prevent conflicts
SMART FEATURES:
• Pre-work tool pickup: Colonists acquire optimal tools before starting jobs
• Automatic tool swapping: They'll upgrade to better tools when available
• Intelligent inventory management: Excess or inferior tools are dropped as needed
This creates a seamless workflow where colonists always work with the most effective equipment available.</helpText>
        <needsOpportunity>true</needsOpportunity>
    </ConceptDef>
    <ConceptDef>
        <defName>SurvivalToolDegradation</defName>
        <label>Survival Tools: Maintenance and Durability</label>
        <priority>50</priority>
        <helpText>Tools are not permanent and require ongoing maintenance to remain effective:
DEGRADATION MECHANICS:
• Tools wear down with each use, eventually breaking completely
• Degradation rate varies by difficulty mode (up to 87.5% faster in Extra Hardcore)
• Different materials and tool quality affect durability significantly
MANAGEMENT STRATEGIES:
• Check tool condition via info cards to plan replacements
• Maintain backup tools for critical tasks
• Monitor the "Tools need replacing" alert for tools near failure
• Consider material choice when crafting - better materials last longer
The estimated lifespan shown on tool info cards reflects continuous usage but doesn't account for current condition, so damaged tools will break sooner than indicated.</helpText>
        <needsOpportunity>true</needsOpportunity>
    </ConceptDef>
</Defs>
</file>
<file path="1.6/Defs/Tutor/Concepts_NotedSelfshow.xml">
<Defs>
    <ConceptDef>
        <defName>EquippingSurvivalTools</defName>
        <label>Survival Tools: Essential Equipment Management</label>
        <priority>30</priority>
        <helpText>Proper tools are crucial for effective colony operations and survival. Without the right equipment, colonists may work inefficiently or become completely unable to perform critical tasks.
TO EQUIP TOOLS:
• Select a colonist and right-click any tool
• Choose to equip it in their main hand or add to inventory
• Colonists can carry up to 2-3 tools in inventory simultaneously
• Tool belts (crafted at tailoring benches) increase carrying capacity
STRATEGIC CONSIDERATIONS:
• Different tools excel at specific tasks (axes for trees, pickaxes for mining)
• Tool quality and material significantly affect performance
• In Hardcore modes, many tasks become impossible without proper tools
• Plan tool distribution among colonists based on their work assignments</helpText>
    </ConceptDef>
</Defs>
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- Tool Carrying Capacity -->
  <SurvivalToolCarryCapacity.label>工具载量</SurvivalToolCarryCapacity.label>
  <SurvivalToolCarryCapacity.description>殖民者被允许携带工具的数量。如果他们携带的工具超过允许的数量，多余的工具将不被允许装备或拾起。</SurvivalToolCarryCapacity.description>
  <!-- Mining-related -->
  <DiggingSpeed.label>挖掘速度</DiggingSpeed.label>
  <DiggingSpeed.description>殖民者在矿石上挖掘的速度.</DiggingSpeed.description>
  <MiningYieldDigging.label>开采量（挖掘）</MiningYieldDigging.label>
  <MiningYieldDigging.description>矿工开采矿石的百分比.这只适用于矿石的开采,并不影响岩石块的生产速率.</MiningYieldDigging.description>
  <!-- Plant-related -->
  <PlantHarvestingSpeed.label>植物收获速度</PlantHarvestingSpeed.label>
  <PlantHarvestingSpeed.description>殖民者收获植物的速度.</PlantHarvestingSpeed.description>
  <SowingSpeed.label>播种速度</SowingSpeed.label>
  <SowingSpeed.description>殖民者播种和种植作物的速度.</SowingSpeed.description>
  <TreeFellingSpeed.label>伐木速度</TreeFellingSpeed.label>
  <TreeFellingSpeed.description>殖民者砍伐树木的速度.</TreeFellingSpeed.description>
  <!-- Maintenance and repair-related -->
  <MaintenanceSpeed.label>维护速度</MaintenanceSpeed.label>
  <MaintenanceSpeed.description>殖民者对建筑物和设备进行维护和修理的速度.</MaintenanceSpeed.description>
  <DeconstructionSpeed.label>拆除速度</DeconstructionSpeed.label>
  <DeconstructionSpeed.description>殖民者拆除建筑物和设备的速度.</DeconstructionSpeed.description>
  <!-- Research-related -->
  <ResearchSpeed.label>研究速度</ResearchSpeed.label>
  <ResearchSpeed.description>殖民者进行研究和实验的速度.</ResearchSpeed.description>
  <!-- Cleaning-related -->
  <CleaningSpeed.label>清洁速度</CleaningSpeed.label>
  <CleaningSpeed.description>殖民者清理污垢和杂物的速度。任何人都可以清洁，但使用合适的工具会更快.</CleaningSpeed.description>
  <!-- Medical-related -->
  <MedicalOperationSpeed.label>医疗手术速度</MedicalOperationSpeed.label>
  <MedicalOperationSpeed.description>殖民者进行医疗手术的速度.</MedicalOperationSpeed.description>
  <MedicalSurgerySuccessChance.label>医疗手术成功率</MedicalSurgerySuccessChance.label>
  <MedicalSurgerySuccessChance.description>殖民者的医疗手术成功而无并发症的可能性.</MedicalSurgerySuccessChance.description>
  <!-- Butchery-related -->
  <ButcheryFleshSpeed.label>屠宰速度</ButcheryFleshSpeed.label>
  <ButcheryFleshSpeed.description>殖民者屠宰动物和处理肉类的速度.</ButcheryFleshSpeed.description>
  <ButcheryFleshEfficiency.label>屠宰效率</ButcheryFleshEfficiency.label>
  <ButcheryFleshEfficiency.description>殖民者从动物尸体中提取肉类和其他产品的数量.</ButcheryFleshEfficiency.description>
</LanguageData>
</file>
<file path="1.6/Languages/English/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>felling TargetA.</FellTree.reportString>
    <FellTreeDesignated.reportString>felling TargetA.</FellTreeDesignated.reportString>
    <HarvestTree.reportString>felling TargetA.</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>felling TargetA.</HarvestTreeDesignated.reportString>
</LanguageData>
</file>
<file path="1.6/Patches/Core/ThingDefs_Items/Cloths_CleaningTool.xml">
<?xml version="1.0" encoding="utf-8"?>
<Patch>
    <!-- Cloth (Basic) - 40% effectiveness -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="Cloth"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.4</CleaningSpeed>
                    <MedicalOperationSpeed>0.4</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.4</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.75</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Synthread (Synthetic) - 55% effectiveness -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="Synthread"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.55</CleaningSpeed>
                    <MedicalOperationSpeed>0.55</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.55</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.5</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Devilstrand Cloth (Premium Natural) - 70% effectiveness -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="DevilstrandCloth"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.7</CleaningSpeed>
                    <MedicalOperationSpeed>0.7</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.7</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.0</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Hyperweave (Ultra-tech) - 85% effectiveness -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="Hyperweave"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.85</CleaningSpeed>
                    <MedicalOperationSpeed>0.85</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.85</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>1.5</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Sheep Wool - 35% -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="WoolSheep"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.35</CleaningSpeed>
                    <MedicalOperationSpeed>0.35</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.35</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>3.5</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Alpaca Wool - 40% -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="WoolAlpaca"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.4</CleaningSpeed>
                    <MedicalOperationSpeed>0.4</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.4</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>3.0</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Megasloth Wool - 60% -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="WoolMegasloth"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.6</CleaningSpeed>
                    <MedicalOperationSpeed>0.6</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.6</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.2</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Muffalo Wool - 45% -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="WoolMuffalo"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.45</CleaningSpeed>
                    <MedicalOperationSpeed>0.45</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.45</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.8</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Bison Wool - 50% -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="WoolBison"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.5</CleaningSpeed>
                    <MedicalOperationSpeed>0.5</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.5</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.5</toolWearFactor>
            </li>
        </value>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/Core/WorkGiverDefs/WorkGivers.xml">
<Patch>
    <!-- ===== Mine ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="Mine"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <!-- Ensure our extension exists -->
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Mine"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="Mine"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>DiggingSpeed</li>
                                    <li>MiningYieldDigging</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <!-- Add missing stats if extension already present -->
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Mine"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="DiggingSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="Mine"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>DiggingSpeed</li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Mine"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="MiningYieldDigging"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="Mine"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>MiningYieldDigging</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== All Construction WorkGivers ===== -->
    <Operation Class="PatchOperationSequence">
        <success>Always</success>
        <operations>
            <!-- Add extension everywhere it's missing -->
            <li Class="PatchOperationAddModExtension">
                <xpath>Defs/WorkGiverDef[workType="Construction" and not(modExtensions/li[@Class='SurvivalTools.WorkGiverExtension'])]</xpath>
                <value>
                    <li Class="SurvivalTools.WorkGiverExtension">
                        <requiredStats>
                            <li>ConstructionSpeed</li>
                        </requiredStats>
                    </li>
                </value>
            </li>
            <!-- Append missing stat if extension exists but lacks it -->
            <li Class="PatchOperationAdd">
                <xpath>Defs/WorkGiverDef[workType="Construction"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats[not(li[text()='ConstructionSpeed'])]</xpath>
                <value>
                    <li>ConstructionSpeed</li>
                </value>
            </li>
        </operations>
    </Operation>
    <!-- ===== GrowerHarvest ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="GrowerHarvest"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="GrowerHarvest"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="GrowerHarvest"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>PlantHarvestingSpeed</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="GrowerHarvest"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="PlantHarvestingSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="GrowerHarvest"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>PlantHarvestingSpeed</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== PlantsCut ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="PlantsCut"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="PlantsCut"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="PlantsCut"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>PlantHarvestingSpeed</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="PlantsCut"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="PlantHarvestingSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="PlantsCut"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>PlantHarvestingSpeed</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== GrowerSow ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="GrowerSow"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="GrowerSow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="GrowerSow"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>SowingSpeed</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="GrowerSow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="SowingSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="GrowerSow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>SowingSpeed</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== Research ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="Research"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Research"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="Research"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>ResearchSpeed</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Research"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="ResearchSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="Research"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>ResearchSpeed</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== Cleaning ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="CleanFilth" or defName="CleanClearSnow"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="CleanFilth" or defName="CleanClearSnow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="CleanFilth" or defName="CleanClearSnow"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>CleaningSpeed</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="CleanFilth" or defName="CleanClearSnow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="CleaningSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="CleanFilth" or defName="CleanClearSnow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>CleaningSpeed</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== Butchery ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>ButcheryFleshSpeed</li>
                                    <li>ButcheryFleshEfficiency</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="ButcheryFleshSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>ButcheryFleshSpeed</li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="ButcheryFleshEfficiency"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>ButcheryFleshEfficiency</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== Medical Operations ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>MedicalOperationSpeed</li>
                                    <li>MedicalSurgerySuccessChance</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="MedicalOperationSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>MedicalOperationSpeed</li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="MedicalSurgerySuccessChance"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>MedicalSurgerySuccessChance</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== Medical Tending (Doctor work type) ===== -->
    <Operation Class="PatchOperationSequence">
        <success>Always</success>
        <operations>
            <!-- Add extension everywhere it's missing for Doctor workType -->
            <li Class="PatchOperationAddModExtension">
                <xpath>Defs/WorkGiverDef[workType="Doctor" and not(modExtensions/li[@Class='SurvivalTools.WorkGiverExtension'])]</xpath>
                <value>
                    <li Class="SurvivalTools.WorkGiverExtension">
                        <requiredStats>
                            <li>MedicalOperationSpeed</li>
                            <li>MedicalSurgerySuccessChance</li>
                        </requiredStats>
                    </li>
                </value>
            </li>
            <!-- Append missing stats if extension exists but lacks them -->
            <li Class="PatchOperationAdd">
                <xpath>Defs/WorkGiverDef[workType="Doctor"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats[not(li[text()='MedicalOperationSpeed'])]</xpath>
                <value>
                    <li>MedicalOperationSpeed</li>
                </value>
            </li>
            <li Class="PatchOperationAdd">
                <xpath>Defs/WorkGiverDef[workType="Doctor"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats[not(li[text()='MedicalSurgerySuccessChance'])]</xpath>
                <value>
                    <li>MedicalSurgerySuccessChance</li>
                </value>
            </li>
        </operations>
    </Operation>
    <!-- ===== Animal Slaughter ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="Slaughter"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Slaughter"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="Slaughter"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>ButcheryFleshSpeed</li>
                                    <li>ButcheryFleshEfficiency</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Slaughter"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="ButcheryFleshSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="Slaughter"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>ButcheryFleshSpeed</li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Slaughter"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="ButcheryFleshEfficiency"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="Slaughter"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>ButcheryFleshEfficiency</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/RimBees/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Alpha Bees</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- RB_Beeswax -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="RB_Beeswax"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="RB_Beeswax"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.3</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.3</PlantHarvestingSpeed>
                  <DiggingSpeed>0.4</DiggingSpeed>
                  <MiningYieldDigging>0.7</MiningYieldDigging>
                  <ConstructionSpeed>0.4</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.6</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- RB_Brittlewax -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="RB_Brittlewax"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="RB_Brittlewax"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.25</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.25</PlantHarvestingSpeed>
                  <DiggingSpeed>0.3</DiggingSpeed>
                  <MiningYieldDigging>0.6</MiningYieldDigging>
                  <ConstructionSpeed>0.3</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.7</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- RB_RedBeeswax -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="RB_RedBeeswax"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="RB_RedBeeswax"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.4</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.4</PlantHarvestingSpeed>
                  <DiggingSpeed>0.5</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.5</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.5</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- RB_WhiteBeeswax -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="RB_WhiteBeeswax"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="RB_WhiteBeeswax"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.35</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.35</PlantHarvestingSpeed>
                  <DiggingSpeed>0.45</DiggingSpeed>
                  <MiningYieldDigging>0.75</MiningYieldDigging>
                  <ConstructionSpeed>0.45</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.55</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- RB_BlackBeeswax -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="RB_BlackBeeswax"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="RB_BlackBeeswax"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.3</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.3</PlantHarvestingSpeed>
                  <DiggingSpeed>0.4</DiggingSpeed>
                  <MiningYieldDigging>0.7</MiningYieldDigging>
                  <ConstructionSpeed>0.4</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.6</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="README.md">
# Survival Tools Reborn
A comprehensive survival tools mod for RimWorld that adds essential equipment to enhance colonist efficiency across all work types.
## Overview
Survival Tools introduces a progression-based tool system with 18 different tools spanning from primitive bone implements to advanced glitterworld technology. Each tool provides meaningful bonuses to specific work types while maintaining game balance through research requirements and material costs.
## Tool Categories
### 🗿 Primitive Tier (Stonecutting Research)
**Basic survival tools for early colonies**
- **Axe** - Essential for tree felling and forestry work
- **Pickaxe** - Improves mining speed and yield
- **Hammer** - Boosts construction speed
- **Sickle** - Enhances plant harvesting efficiency
- **Hoe** - Increases sowing speed for farming
- **Knife** - Basic tool for butchery and medical work
- **Hand Saw** - Manual lumber processing and construction
- **Bone Sickle** - Primitive harvesting tool (lower durability)
- **Pry Bar** - Basic leverage tool for maintenance/deconstruction
- **Abacus** - Ancient calculating device for research
### 🔧 Industrial Tier (Smithing Research)
**Advanced steel tools for established colonies**
- **Steel Knife** - Superior butchery and medical tool
- **Crosscut Saw** - Industrial-grade construction and lumber processing
### ⚙️ Precision Tier (Machining Research)
**High-tech tools for advanced operations**
- **Wrench** - Precision mechanical maintenance tool
- **Carbide Pickaxe** - Advanced mining with superior durability
- **Precision Scalpel** - Expert medical instrument
- **Power Drill** - Mechanized construction and drilling
- **Microscope** - Advanced research instrument
### 🌟 Spacer Tier (Advanced Fabrication Research)
**Glitterworld technology for ultimate efficiency**
- **Glitterworld Multitool** - Universal tool for all work types
## Key Features
### 🎯 **Balanced Progression System**
- Tools unlock through research progression
- Material costs scale with tool effectiveness
- Higher-tier tools offer better performance but require advanced resources
### 🛠️ **Flexible Crafting**
- Most tools can be made from multiple material types (wood, stone, metal)
- Recipe flexibility ensures compatibility with different map types
- Quality system affects tool effectiveness
### 🔄 **Tool Assignment System**
- Automatic tool optimization for colonists
- Manual assignment options for precise control
- Tools integrate seamlessly with vanilla work priorities
### 🌍 **Full Localization Support**
- Complete translations for multiple languages
- Consistent terminology across all game elements
## Installation
1. Subscribe to the mod on Steam Workshop
2. Ensure Harmony is installed (required dependency)
3. Add to your mod list and enjoy enhanced colony efficiency
## Compatibility
- **RimWorld Version**: 1.6+
- **Required Mods**: Harmony
- **Compatible with most mods** including Combat Extended, VGP, and popular overhauls
- Extensive patch system for material and recipe compatibility
## Development Status
- ✅ Core tool system complete
- ✅ Research progression implemented
- ✅ Localization complete
- ⏳ Commissioned artwork in progress (placeholder textures currently)
- ⏳ Additional tool varieties under consideration
## Contributing
Found a bug or have suggestions? Please report issues on the Steam Workshop page or GitHub repository.
---
_Transform your colony's efficiency with the right tools for every job!_
</file>
<file path="Source/Compatibility/PrimitiveTools/PTDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/PrimitiveTools/PTDebug.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// Minimal debug helpers for PrimitiveTools compatibility.
public static class PrimitiveToolsDebug
⋮----
public static void LogStatus()
⋮----
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.IsCompatLogging())
⋮----
ST_Logging.LogCompatMessage($"PrimitiveTools active={PrimitiveToolsHelpers.IsPrimitiveToolsActive()}");
</file>
<file path="Source/Compatibility/PrimitiveTools/PTHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/PrimitiveTools/PrimitiveToolsHelpers.cs
// Canonical helpers file for Primitive Tools compatibility (renamed from PrimitiveToolsCompat.cs)
// The canonical public class name is `PrimitiveToolsHelpers`.
⋮----
public static class PrimitiveToolsHelpers
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// Known/fallback defNames (kept from your original)
⋮----
// Package ID fingerprints (normalized)
⋮----
"vby.primitivetools",        // canonical-ish
"primitivetools",            // generic substring
"virusbombay.primitivetools" // safety alias if mod renames
⋮----
public static void ResetCaches()
⋮----
public static bool IsPrimitiveToolsActive()
⋮----
// 1) Identifier-based probe (fast path)
⋮----
// Prefer ModLister API when available; fall back to ModsConfig enumeration
// Guarded in try/catch for cross-version safety.
⋮----
var pid = (m.PackageId ?? string.Empty).ToLowerInvariant();
var name = (m.Name ?? string.Empty).ToLowerInvariant();
if (PackageIdHints.Any(h => pid.Contains(h)) ||
name.Contains("primitive tools"))
⋮----
catch { /* swallow */ }
// 2) Content verification: any ThingDef from the suspected pack?
⋮----
var anyFromPack = DefDatabase<ThingDef>.AllDefsListForReading.Any(d =>
⋮----
return PackageIdHints.Any(h => pkg.Contains(h)) ||
⋮----
// 3) Final verification: at least one known def exists (super cheap and stable)
bool hasKnownDef = KnownPrimitiveToolDefNames.Any(n => DefDatabase<ThingDef>.GetNamedSilentFail(n) != null);
⋮----
if (ST_Logging.IsCompatLogging() && ST_Logging.IsDebugLoggingEnabled)
ST_Logging.LogCompatMessage($"[PT-Compat] Active={_isActive} (foundMod={foundMod}, content={contentMatches}, knownDef={hasKnownDef})");
⋮----
Log.Error($"[SurvivalTools PT-Compat] Exception during detection: {ex}");
⋮----
public static List<ThingDef> GetPrimitiveToolDefs()
⋮----
if (_primitiveToolDefs != null) return _primitiveToolDefs.ToList();
⋮----
return _primitiveToolDefs.ToList();
⋮----
// A) Dynamic discovery by content pack + tool identity
⋮----
bool fromPT = PackageIdHints.Any(h => pkg.Contains(h)) ||
⋮----
// Treat as a PT survival tool if:
//  - Has SurvivalToolProperties extension, OR
//  - thingClass is SurvivalTool (or subclass).
⋮----
(def.thingClass != null && typeof(SurvivalTool).IsAssignableFrom(def.thingClass));
⋮----
_primitiveToolDefs.Add(def);
⋮----
// B) Fallback: include explicitly-known defs
⋮----
var d = DefDatabase<ThingDef>.GetNamedSilentFail(name);
if (d != null) _primitiveToolDefs.Add(d);
⋮----
ST_Logging.LogCompatMessage($"[PT-Compat] Discovered {_primitiveToolDefs.Count} primitive tool defs");
⋮----
Log.Error($"[SurvivalTools PT-Compat] Exception while gathering defs: {ex}");
⋮----
public static bool IsPrimitiveTool(ThingDef def)
⋮----
// Lazy hydrate outside lock (safe enough), then re-check under lock if still null.
⋮----
if (set != null && set.Contains(def)) return true;
// One-shot heuristic if cache missed (no allocation)
⋮----
bool clsOk = def.thingClass != null && typeof(SurvivalTool).IsAssignableFrom(def.thingClass);
⋮----
public static bool IsPrimitiveTool(Thing thing) => thing?.def != null && IsPrimitiveTool(thing.def);
⋮----
public static bool PawnHasPrimitiveTools(Pawn pawn)
⋮----
// Equipped
⋮----
// Inventory
⋮----
Log.Error($"[SurvivalTools PT-Compat] Exception checking pawn tools: {ex}");
⋮----
public static List<Thing> GetPawnPrimitiveTools(Pawn pawn)
⋮----
if (eq != null && IsPrimitiveTool(eq)) result.Add(eq);
⋮----
if (IsPrimitiveTool(t)) result.Add(t);
⋮----
Log.Error($"[SurvivalTools PT-Compat] Exception collecting pawn tools: {ex}");
⋮----
public static bool ShouldOptimizeForPrimitiveTools()
⋮----
/// <summary>
/// Get stat defs that Primitive Tools contribute to.
/// Returns only valid StatDefs (null-safe).
/// </summary>
public static List<StatDef> GetPrimitiveToolStats()
⋮----
if (def != null) stats.Add(def);
⋮----
// Custom ST defs
⋮----
// Vanilla defs
⋮----
public static List<string> CheckForConflicts()
⋮----
var isSTClass = d.thingClass != null && typeof(SurvivalTool).IsAssignableFrom(d.thingClass);
⋮----
conflicts.Add($"{d.defName} missing SurvivalToolProperties and not a SurvivalTool thingClass");
⋮----
conflicts.Add($"{d.defName} has SurvivalToolProperties but no baseWorkStatFactors");
⋮----
Log.Error($"[SurvivalTools PT-Compat] Exception in conflict check: {ex}");
conflicts.Add($"Exception during conflict check: {ex.Message}");
</file>
<file path="Source/Compatibility/PrimitiveTools/PTPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/PrimitiveTools/PTPatches.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// Placeholder for future Harmony patches targeting Primitive Tools integration.
// Kept minimal so the file exists for documentation and extension.
⋮----
public static class PrimitiveToolsPatches
⋮----
// Intentionally empty; patches will be added when required.
</file>
<file path="Source/Compatibility/ResearchReinvented/RRDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/ResearchReinvented/RRDebug.cs
⋮----
public static class RRDebug
⋮----
public static void DumpResearchReinventedPatches_DebugAction() => DumpResearchReinventedPatches();
⋮----
public static void DumpResearchReinventedPatches()
⋮----
Verse.Log.Message("[SurvivalTools] ResearchReinventedPatchLogger: starting debug dump...");
var patchedMethods = Harmony.GetAllPatchedMethods()?.ToList();
⋮----
Verse.Log.Message("[SurvivalTools] DumpRR: no patched methods found at all.");
Verse.Log.Message("[SurvivalTools] ResearchReinventedPatchLogger: debug dump complete.");
⋮----
var info = Harmony.GetPatchInfo(method);
⋮----
if (IsLikelyRRPatch(p)) rrPatches.Add((p, "PREFIX"));
⋮----
if (IsLikelyRRPatch(p)) rrPatches.Add((p, "POSTFIX"));
⋮----
if (IsLikelyRRPatch(p)) rrPatches.Add((p, "TRANSPILER"));
⋮----
Verse.Log.Message($"[SurvivalTools] DumpRRHeur: target -> {FormatMethodFullDescription(method)}");
⋮----
Verse.Log.Message($"   {kind}: {patchDesc} (owner={patch.owner}, priority={patch.priority}, index={patch.index})");
⋮----
Verse.Log.Message("[SurvivalTools] DumpRRHeur: No Research Reinvented patches found (owner/name filters).");
⋮----
Verse.Log.Message($"[SurvivalTools] DumpRRHeur: found {targetsFound} target(s) with RR-like patches.");
⋮----
Verse.Log.Error($"[SurvivalTools] DumpRR: failed to enumerate patches: {e}");
⋮----
private static bool IsLikelyRRPatch(HarmonyLib.Patch p)
⋮----
if (!string.IsNullOrEmpty(p.owner))
⋮----
if (owner.IndexOf("researchreinvented", StringComparison.OrdinalIgnoreCase) >= 0) return true;
if (owner.IndexOf("petetimesix", StringComparison.OrdinalIgnoreCase) >= 0) return true;
⋮----
if (asmName.IndexOf("researchreinvented", StringComparison.OrdinalIgnoreCase) >= 0) return true;
⋮----
if (fullName.IndexOf("ResearchReinvented", StringComparison.OrdinalIgnoreCase) >= 0) return true;
if (fullName.IndexOf("PeteTimesSix", StringComparison.OrdinalIgnoreCase) >= 0) return true;
⋮----
public static string FormatMethodFullDescription(MethodBase mb)
⋮----
var parameters = mi.GetParameters();
var paramStr = string.Join(", ", parameters.Select(p => $"{p.ParameterType.Name} {p.Name}"));
⋮----
var parameters = ci.GetParameters();
⋮----
catch { return mb.ToString(); }
</file>
<file path="Source/Compatibility/ResearchReinvented/RRHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/ResearchReinvented/RRHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
public static class RRHelpers
⋮----
// ---- detection cache ------------------------------------------------
⋮----
bool byPkg = ModLister.GetActiveModWithIdentifier("PeteTimesSix.ResearchReinvented", true) != null;
bool byType = AccessTools.TypeByName("PeteTimesSix.ResearchReinvented.Utilities.PawnExtensions") != null;
⋮----
// ---- reflection targets --------------------------------------------
private static Type _pawnExtensionsType;
private static MethodInfo _miCanEverDoResearch;
private static MethodInfo _miCanNowDoResearch;
private static bool TryResolve()
⋮----
_pawnExtensionsType = AccessTools.TypeByName("PeteTimesSix.ResearchReinvented.Utilities.PawnExtensions");
⋮----
_miCanEverDoResearch = AccessTools.Method(_pawnExtensionsType, "CanEverDoResearch", new[] { typeof(Pawn) });
_miCanNowDoResearch = AccessTools.Method(_pawnExtensionsType, "CanNowDoResearch", new[] { typeof(Pawn) });
⋮----
public static void Initialize()
⋮----
var h = new Harmony("SurvivalTools.Compat.ResearchReinvented");
⋮----
Log.Message("[SurvivalTools Compat] RRHelpers.Initialize() completed.");
⋮----
Log.Warning($"[SurvivalTools Compat] RRHelpers.Initialize() failed: {e}");
⋮----
public static Dictionary<string, string> GetReflectionStatus()
⋮----
["IsActive"] = IsRRActive.ToString(),
⋮----
["HasCanEver"] = (_miCanEverDoResearch != null).ToString(),
["HasCanNow"] = (_miCanNowDoResearch != null).ToString()
⋮----
public static void ApplyHarmonyHooks(Harmony h)
⋮----
Log.Warning("[SurvivalTools Compat] RR types/methods not found; skipping RR patches.");
⋮----
var postfix = new HarmonyMethod(typeof(RRPostfixes), nameof(RRPostfixes.CanEverDoResearch_Postfix));
h.Patch(_miCanEverDoResearch, postfix: postfix);
⋮----
var postfix = new HarmonyMethod(typeof(RRPostfixes), nameof(RRPostfixes.CanNowDoResearch_Postfix));
h.Patch(_miCanNowDoResearch, postfix: postfix);
⋮----
// ---- runtime adapters ------------------------------------------------
public static class Runtime
⋮----
public static bool PawnHasResearchTools(Pawn p) => CompatAPI.PawnHasResearchTools(p);
public static List<StatDef> RequiredResearchStatsFor(WorkGiverDef wgd, Job jobOrNull)
⋮----
return SurvivalToolUtility.RelevantStatsFor(wgd, jobOrNull);
return SurvivalToolUtility.RelevantStatsFor(wgd, (JobDef)null);
⋮----
// ---- helper queries used by patches ---------------------------------
public static WorkGiverDef ResolveWorkGiverForJob(Job job)
=> job?.def != null ? JobDefToWorkGiverDefHelper.GetWorkGiverDefForJob(job.def) : null;
public static WorkGiverDef ResolveWorkGiverForJob(JobDef jobDef)
=> JobDefToWorkGiverDefHelper.GetWorkGiverDefForJob(jobDef);
public static List<StatDef> GetRequiredStatsForWorkGiver(WorkGiverDef wgd, Job job = null)
⋮----
if (job != null) return SurvivalToolUtility.RelevantStatsFor(wgd, job);
⋮----
public static bool IsRRWorkGiver(WorkGiverDef wgd)
⋮----
string defName = wgd.defName.ToLower();
return defName.Contains("research") && !defName.Contains("field");
⋮----
public static bool IsFieldResearchWorkGiver(WorkGiverDef wgd)
⋮----
return defName.Contains("fieldresearch") || defName.Contains("survey");
⋮----
public static bool RequiresResearchTools(WorkGiverDef wgDef)
⋮----
if (ext == null || ext.requiredStats.NullOrEmpty()) return false;
var researchStat = CompatAPI.GetResearchSpeedStat() ?? ST_StatDefOf.ResearchSpeed;
if (researchStat != null && ext.requiredStats.Contains(researchStat)) return true;
var fieldStat = CompatAPI.GetFieldResearchSpeedStat() ??
DefDatabase<StatDef>.GetNamedSilentFail("FieldResearchSpeedMultiplier");
if (fieldStat != null && ext.requiredStats.Contains(fieldStat)) return true;
⋮----
// ---- RR settings bridge ---------------------------------------------
public static class Settings
⋮----
public static bool IsRRStatRequiredInExtraHardcore(StatDef stat)
⋮----
if (stat == CompatAPI.GetResearchSpeedStat()) return TreatResearchAsRequiredInExtraHardcore;
if (stat == CompatAPI.GetFieldResearchSpeedStat()) return TreatFieldResearchAsRequiredInExtraHardcore;
⋮----
public static bool IsRRStatOptional(StatDef stat)
⋮----
return stat == CompatAPI.GetResearchSpeedStat() || stat == CompatAPI.GetFieldResearchSpeedStat();
⋮----
// ---- AutoTool helpers (thin, cached by defName) ----------------------
⋮----
public static List<StatDef> GetRequiredStatsForWorkGiverCached(WorkGiverDef wgd, Job jobOrNull)
⋮----
if (_requiredStatsCache.TryGetValue(key, out var cached)) return cached;
⋮----
public static void ClearCachesOnDefsChanged()
⋮----
_requiredStatsCache.Clear();
⋮----
// ---- postfixes ------------------------------------------------------
internal static class RRPostfixes
⋮----
// Use the deduplicated tool-gate logger to avoid spamming ResearchReinvented's frequent checks.
// Keyed by pawn+job/stat, the logger immediately emits the first denial and suppresses repeats for
// a short window, then prints a summary when suppressed counts exist.
public static void CanEverDoResearch_Postfix(Pawn __0, ref bool __result)
⋮----
if (!CompatAPI.PawnHasResearchTools(__0) && ShouldRRReturnFalseWhenNoTool())
⋮----
// Use ResearchSpeed stat where available
var stat = CompatAPI.GetResearchSpeedStat() ?? ST_StatDefOf.ResearchSpeed;
ST_Logging.LogToolGateEvent(__0, null, stat, "missing research tool (RR CanEverDoResearch)");
⋮----
public static void CanNowDoResearch_Postfix(Pawn __0, ref bool __result)
⋮----
ST_Logging.LogToolGateEvent(__0, null, stat, "missing research tool (RR CanNowDoResearch)");
⋮----
internal static bool ShouldRRReturnFalseWhenNoTool() => SurvivalTools.Settings?.extraHardcoreMode == true;
</file>
<file path="Source/Compatibility/ResearchReinvented/RRPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/ResearchReinvented/RRPatches.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
internal static class RRPatches
⋮----
private static readonly Harmony harmony;
⋮----
harmony = new Harmony(HARMONY_ID);
⋮----
// Patch RR pawn extension methods (postfixes are applied by RRHelpers.Initialize which calls ApplyHarmonyHooks)
RRHelpers.Initialize();
// Patch base WorkGiver_Scanner methods to gate jobs early when hardcore enforcement is active
⋮----
var miThing = AccessTools.Method(baseType, "HasJobOnThing");
⋮----
harmony.Patch(miThing,
prefix: new HarmonyMethod(typeof(RRPatches), nameof(Prefix_WorkGiverScanner_HasJobOnThing)) { priority = Priority.First });
⋮----
var miCell = AccessTools.Method(baseType, "HasJobOnCell");
⋮----
harmony.Patch(miCell,
prefix: new HarmonyMethod(typeof(RRPatches), nameof(Prefix_WorkGiverScanner_HasJobOnCell)) { priority = Priority.First });
⋮----
// Patch recipe toils so research/crafting progress respects tool tiers (defensive)
var toilsType = AccessTools.TypeByName("Toils_Recipe");
⋮----
var doWork = AccessTools.Method(toilsType, "DoRecipeWork");
⋮----
harmony.Patch(doWork, prefix: new HarmonyMethod(typeof(RRPatches), nameof(Prefix_Toils_Recipe_DoRecipeWork)));
⋮----
var makeUnfinished = AccessTools.Method(toilsType, "MakeUnfinishedThingIfNeeded");
⋮----
harmony.Patch(makeUnfinished, prefix: new HarmonyMethod(typeof(RRPatches), nameof(Prefix_Toils_Recipe_MakeUnfinishedThingIfNeeded)));
⋮----
Log.Error($"[SurvivalTools Compat] RR gating patch init failed: {e}");
⋮----
private static bool Prefix_WorkGiverScanner_HasJobOnThing(WorkGiver_Scanner __instance, Pawn pawn, Thing t, ref bool __result)
⋮----
private static bool Prefix_WorkGiverScanner_HasJobOnCell(WorkGiver_Scanner __instance, Pawn pawn, IntVec3 c, ref bool __result)
⋮----
private static bool CheckWorkGiverGate(WorkGiverDef wgDef, Pawn pawn, ref bool __result, string context)
⋮----
if (!RRHelpers.RequiresResearchTools(wgDef)) return true;
if (!CompatAPI.PawnHasResearchTools(pawn))
⋮----
// Defensive prefix for Toils_Recipe.DoRecipeWork – adjust or block progress when research tools are required
private static bool Prefix_Toils_Recipe_DoRecipeWork(object __instance, JobDriver __state)
⋮----
// Attempt to locate the pawn performing the toil
Pawn pawn = null;
try { pawn = (Pawn)AccessTools.Field(__instance.GetType(), "actor").GetValue(__instance); } catch { }
⋮----
// Resolve the job/workgiver context
Job job = pawn.CurJob;
var wgd = RRHelpers.ResolveWorkGiverForJob(job);
// Required stats for RR-sensitive workgivers
var required = RRHelpers.GetRequiredStatsForWorkGiverCached(wgd, job);
⋮----
// If in extra-hardcore RR mode and pawn lacks research tools, block
⋮----
if (RRHelpers.Settings.IsRRStatRequiredInExtraHardcore(st) && !CompatAPI.PawnHasResearchTools(pawn))
⋮----
return false; // skip original toil
⋮----
// Otherwise allow original and let StatPart_SurvivalTool / WorkSpeedGlobal adjust speed
⋮----
// Defensive prefix for Toils_Recipe.MakeUnfinishedThingIfNeeded – block creation of unfinished items if research tools are missing under extra-hardcore
private static bool Prefix_Toils_Recipe_MakeUnfinishedThingIfNeeded(object __instance)
</file>
<file path="Source/Compatibility/SeparateTreeChopping/STCDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SeparateTreeChopping/STCDebug.cs
⋮----
public static class SeparateTreeChoppingDebug
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
public static void LogStatus()
⋮----
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.IsCompatLogging())
ST_Logging.LogCompatMessage($"SeparateTreeChopping active={SeparateTreeChoppingHelpers.IsSeparateTreeChoppingActive()}");
</file>
<file path="Source/Compatibility/SeparateTreeChopping/STCHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SeparateTreeChopping/STCHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Compatibility module for Separate Tree Chopping (Continued) mod.
/// Handles conflict detection, resolution strategies, and feature coordination.
/// </summary>
public static class SeparateTreeChoppingHelpers
⋮----
/// Check if Separate Tree Chopping (Continued) mod is currently active.
⋮----
public static bool IsSeparateTreeChoppingActive()
⋮----
bool hasSeparateTreeMod = activeMods.Any(mod =>
⋮----
string name = (mod?.Name ?? string.Empty).ToLowerInvariant();
string id = (mod?.PackageId ?? string.Empty).ToLowerInvariant();
return name.Contains("separate tree chopping") ||
name.Contains("separatetreechopping") ||
id.Contains("separatetreechopping") ||
id.Contains("treechopping");
⋮----
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.IsCompatLogging())
ST_Logging.LogCompatMessage($"Separate Tree Chopping detection: {_isSeparateTreeChoppingActive}");
⋮----
ST_Logging.LogCompatError($"Exception during Separate Tree Chopping detection: {ex}");
⋮----
/// Check if there are conflicts between SurvivalTools tree felling and Separate Tree Chopping.
⋮----
public static bool HasTreeFellingConflict()
⋮----
/// Get recommended resolution strategy for tree felling conflicts.
⋮----
public static TreeFellingConflictResolution GetRecommendedResolution()
⋮----
/// Apply the recommended conflict resolution automatically.
⋮----
public static bool ApplyRecommendedResolution()
⋮----
ST_Logging.LogCompatMessage("Auto-disabled SurvivalTools tree felling due to Separate Tree Chopping conflict");
⋮----
/// Describe current conflict state in plain text.
⋮----
private static string DescribeConflict()
⋮----
/// Check for all potential conflicts and return detailed information.
⋮----
public static List<string> CheckForConflicts()
⋮----
conflicts.Add("Both SurvivalTools and Separate Tree Chopping handle tree felling  may cause duplicate jobs");
var fellTreesWorkGiver = DefDatabase<WorkGiverDef>.GetNamedSilentFail("ST_FellTrees");
⋮----
conflicts.Add("SurvivalTools FellTrees WorkGiver may overlap with Separate Tree Chopping");
⋮----
ST_Logging.LogCompatError($"Exception checking Separate Tree Chopping conflicts: {ex}");
conflicts.Add($"Exception during conflict check: {ex.Message}");
⋮----
public static bool ShouldAutoDisableSTTreeFelling()
⋮----
public static string GetTreeFellingDisabledMessage()
⋮----
public static List<string> GetUserRecommendations()
⋮----
recs.Add("Separate Tree Chopping detected.");
⋮----
recs.Add("Recommendation: Disable 'Enable Tree Felling System' in SurvivalTools settings.");
recs.Add("This allows Separate Tree Chopping to handle tree cutting without conflicts.");
recs.Add("SurvivalTools tools (axes etc.) still give stat bonuses.");
⋮----
recs.Add("No tree felling conflicts detected. Both mods should work together smoothly.");
⋮----
/// Conflict resolution strategies for tree felling systems.
⋮----
DisableSeparateTreeChopping, // Not recommended
UserChoice // Let user decide manually
</file>
<file path="Source/Compatibility/SeparateTreeChopping/STCPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SeparateTreeChopping/STCPatches.cs
⋮----
public static class SeparateTreeChoppingPatches
⋮----
// Placeholder for future Harmony integrations.
</file>
<file path="Source/DebugTools/DebugAction_SpawnSurvivalToolWithStuff.cs">
// RimWorld 1.6 / C# 7.3
// Source/DebugTools/DebugAction_SpawnSurvivalToolWithStuff.cs
⋮----
public static class DebugAction_SpawnSurvivalToolWithStuff
⋮----
public static void SpawnToolWithStuff()
⋮----
.Where(def => def.IsSurvivalTool())
.OrderBy(def => def.modContentPack?.Name ?? "Unknown")
.ThenBy(def => def.label)
.ToList();
if (!toolDefs.Any())
⋮----
Messages.Message("No survival tool definitions found.", MessageTypeDefOf.RejectInput);
⋮----
toolOptions.Add(new DebugMenuOption(displayName, DebugMenuOptionMode.Action, () =>
⋮----
// Check if this tool can be made from stuff
⋮----
// For things that can't be made from stuff (like cloth, raw materials, etc.)
// spawn them directly
⋮----
Find.WindowStack.Add(new Dialog_DebugOptionListLister(toolOptions));
⋮----
private static void ShowStuffPicker(ThingDef toolDef)
⋮----
.Where(def => def.IsStuff && def.stuffProps != null && toolDef.MadeFromStuff)
.OrderBy(def => def.label)
⋮----
if (!stuffDefs.Any())
⋮----
Messages.Message($"{toolDef.LabelCap} cannot be made from stuff.", MessageTypeDefOf.RejectInput);
⋮----
// Add a separator for materials with StuffPropsTool
var stuffPropsStuff = stuffDefs.Where(def => def.GetModExtension<StuffPropsTool>() != null).ToList();
if (stuffPropsStuff.Any())
⋮----
stuffOptions.Add(new DebugMenuOption("=== Materials with StuffPropsTool ===", DebugMenuOptionMode.Action, () => { }));
⋮----
stuffOptions.Add(new DebugMenuOption($"{stuffDef.LabelCap} ({statCount} tool stats)", DebugMenuOptionMode.Action, () =>
⋮----
stuffOptions.Add(new DebugMenuOption("", DebugMenuOptionMode.Action, () => { }));
⋮----
// Add materials with SurvivalToolProperties (virtual tools)
var virtualToolStuff = stuffDefs.Where(def => def.GetModExtension<SurvivalToolProperties>() != null).ToList();
if (virtualToolStuff.Any())
⋮----
stuffOptions.Add(new DebugMenuOption("=== Materials with SurvivalToolProperties ===", DebugMenuOptionMode.Action, () => { }));
⋮----
// Add regular materials
var regularStuff = stuffDefs.Where(def =>
⋮----
if (regularStuff.Any())
⋮----
stuffOptions.Add(new DebugMenuOption("=== Regular Materials ===", DebugMenuOptionMode.Action, () => { }));
⋮----
stuffOptions.Add(new DebugMenuOption(stuffDef.LabelCap, DebugMenuOptionMode.Action, () =>
⋮----
Find.WindowStack.Add(new Dialog_DebugOptionListLister(stuffOptions));
⋮----
private static void PrepareToolSpawn(ThingDef toolDef, ThingDef stuffDef)
⋮----
var tool = ThingMaker.MakeThing(toolDef, stuffDef);
⋮----
Messages.Message(errorMessage, MessageTypeDefOf.RejectInput);
⋮----
// Show info about what we're about to spawn
⋮----
// Check if the tool itself has SurvivalToolProperties (virtual tool)
⋮----
Messages.Message(infoMessage, MessageTypeDefOf.NeutralEvent);
// Set up the placement tool
DebugTool placementTool = new DebugTool($"Place {tool.LabelCap}", delegate
⋮----
Messages.Message("No current map.", MessageTypeDefOf.RejectInput);
⋮----
IntVec3 pos = UI.MouseCell();
if (pos.InBounds(map))
⋮----
GenSpawn.Spawn(tool, pos, map);
Messages.Message($"Spawned {tool.LabelCap}", MessageTypeDefOf.TaskCompletion);
</file>
<file path="Source/DefOfs/ST_ConceptDefOf.cs">
//Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_ConceptDefOf.cs
⋮----
/// <summary>
/// ConceptDefs used by SurvivalTools.
/// Initialized automatically by RimWorld's DefOf system.
/// </summary>
⋮----
public static class ST_ConceptDefOf
⋮----
/// <summary>Concept tutorial shown when pawns first use survival tools.</summary>
public static ConceptDef UsingSurvivalTools;
/// <summary>Concept tutorial explaining tool degradation mechanics.</summary>
public static ConceptDef SurvivalToolDegradation;
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_ConceptDefOf));
</file>
<file path="Source/DefOfs/ST_JobDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_JobDefOf.cs
⋮----
/// <summary>
/// JobDefs used by SurvivalTools.
/// Initialized automatically by RimWorld's DefOf system.
/// </summary>
⋮----
public static class ST_JobDefOf
⋮----
/// <summary>Job: Fell a tree using survival tools (non-designated).</summary>
public static JobDef FellTree;
/// <summary>Job: Fell a tree that has been explicitly designated.</summary>
public static JobDef FellTreeDesignated;
/// <summary>Job: Harvest usable wood from a tree (non-designated).</summary>
public static JobDef HarvestTree;
/// <summary>Job: Harvest usable wood from a designated tree.</summary>
public static JobDef HarvestTreeDesignated;
/// <summary>Job: Drop a carried survival tool.</summary>
public static JobDef DropSurvivalTool;
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_JobDefOf));
</file>
<file path="Source/DefOfs/ST_RecipeDefOf.cs">
// RimWorld 1.6 / C# 7.3
// Source/DefOfs/ST_RecipeDefOf.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// RecipeDefs used by SurvivalTools.
/// Initialized automatically by RimWorld's DefOf system.
/// </summary>
⋮----
public static class ST_RecipeDefOf
⋮----
/// <summary>Recipe: Smelt survival tool into raw materials.</summary>
public static RecipeDef SmeltSurvivalTool;
/// <summary>Recipe: Destroy survival tool (no material return).</summary>
public static RecipeDef DestroySurvivalTool;
/// <summary>Recipe: Smelt weapon into raw materials.</summary>
public static RecipeDef SmeltWeapon;
/// <summary>Recipe: Destroy weapon (no material return).</summary>
public static RecipeDef DestroyWeapon;
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_RecipeDefOf));
</file>
<file path="Source/DefOfs/ST_StatCategoryDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_StatCategoryDefOf.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Stat categories used by SurvivalTools.
/// These group survival tool stats into logical sections in the UI.
/// </summary>
⋮----
public static class ST_StatCategoryDefOf
⋮----
/// General survival tool stats (e.g. efficiency, wear).
⋮----
public static StatCategoryDef SurvivalTool;
⋮----
/// Material-based survival tool stats (e.g. durability, modifiers).
⋮----
public static StatCategoryDef SurvivalToolMaterial;
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_StatCategoryDefOf));
</file>
<file path="Source/DefOfs/ST_ThingCategoryDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_ThingCategoryDefOf.cs
⋮----
namespace SurvivalTools
⋮----
public static class ST_ThingCategoryDefOf
⋮----
// -------------------------------
// Custom SurvivalTools categories
⋮----
public static ThingCategoryDef SurvivalTools;           // root category
public static ThingCategoryDef SurvivalToolsNeolithic;  // primitive / early tech
public static ThingCategoryDef SurvivalToolsIndustrial; // industrial tier
public static ThingCategoryDef SurvivalToolsSpacer;     // spacer / advanced tier
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_ThingCategoryDefOf));
</file>
<file path="Source/DefOfs/ST_ThingDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_ThingDefOf.cs
⋮----
namespace SurvivalTools
⋮----
public static class ST_ThingDefOf
⋮----
// -------------------------------
// Custom SurvivalTools ThingDefs
⋮----
public static ThingDef SurvivalTools_Multitool; // advanced spacer-tier survival tool
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_ThingDefOf));
</file>
<file path="Source/DefOfs/ST_ThingSetMakerDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_ThingSetMakerDefOf.cs
⋮----
namespace SurvivalTools
⋮----
public static class ST_ThingSetMakerDefOf
⋮----
// -------------------------------
// Custom SurvivalTools ThingSetMakers
⋮----
public static ThingSetMakerDef MapGen_AncientRuinsSurvivalTools;
// Custom: spawns survival tools as part of ancient ruins map generation
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_ThingSetMakerDefOf));
</file>
<file path="Source/DefOfs/ST_WorkGiverDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_WorkGiverDefOf.cs
⋮----
namespace SurvivalTools
⋮----
public static class ST_WorkGiverDefOf
⋮----
// -------------------------------
// Custom SurvivalTools WorkGivers
⋮----
public static WorkGiverDef FellTrees;
// Custom: SurvivalTools WorkGiver for tree felling jobs
// (conflicts with Separate Tree Chopping if both enabled, handled by compat layer)
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_WorkGiverDefOf));
</file>
<file path="Source/Helpers/JobUtils.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/JobUtils.cs
⋮----
/// <summary>
/// Centralized helper methods for Job management:
/// - cloning (shallow vs deep)
/// - type checks (inventory/tool jobs)
/// - validation & logging utilities
/// </summary>
public static class JobUtils
⋮----
/// Create a shallow clone of a Job for immediate execution.
/// Preserves references (queues, lists, etc.) from the original.
/// âš ï¸ Only use this if the clone is short-lived and wonâ€™t be mutated
/// in parallel with the original.
⋮----
public static Job ShallowClone(Job originalJob)
⋮----
var clone = new Job(originalJob.def, originalJob.targetA, originalJob.targetB, originalJob.targetC)
⋮----
def = originalJob.def // redundant but explicit
⋮----
/// Create a deep clone of a Job for queue storage.
/// Clones collections (queues/lists) so the copy is safe to enqueue
/// without being affected by mutations to the original.
⋮----
public static Job CloneJobForQueue(Job originalJob)
⋮----
// Deep copy mutable collections
⋮----
/// True if job is related to inventory hauling and shouldnâ€™t be re-queued.
⋮----
public static bool IsInventoryJob(Job job)
⋮----
/// True if job is survival tool management (drop/equip).
/// Used to avoid conflicts with auto-tool logic.
⋮----
public static bool IsToolManagementJob(Job job)
⋮----
/// Build a compact string description for debug logging.
⋮----
public static string GetJobDescription(Job job)
⋮----
/// Returns true if this job requires any survival-tool-relevant stats.
/// Caller gets the resolved stat list.
⋮----
public static bool RequiresSurvivalToolStats(Job job, out List<StatDef> requiredStats)
⋮----
requiredStats = SurvivalToolUtility.StatsForJob(job);
⋮----
// Defensive: donâ€™t propagate exceptions from stat resolution
⋮----
/// Validate that a job is still executable:
/// - targets exist, are not destroyed, and are on the same map
/// - job def is still defined (protects against mod unloads)
⋮----
public static bool IsJobStillValid(Job job, Pawn pawn)
⋮----
// Check primary target
⋮----
!job.targetA.Cell.InBounds(pawn.Map))
⋮----
// Ensure the JobDef still exists (def removal compatibility guard)
return DefDatabase<JobDef>.AllDefs.Any(def => def == job.def);
</file>
<file path="Source/Helpers/PawnToolValidator.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/PawnToolValidator.cs
⋮----
/// <summary>
/// Centralized pawn capability and policy validation for tool usage.
/// Contains methods that were scattered throughout the codebase to validate
/// whether pawns can use tools, acquire tools, or have tools assigned.
///
/// 🔒 Note:
/// - Mechanoids are excluded here (RaceProps.IsMechanoid).
///   They have built-in “tools” and should never interact with SurvivalTools.
///   This prevents edge cases with Biotech mechs or modded mechanoids.
/// - If a future mod adds humanoid mechanoids *intended* to use real tools,
///   add a settings toggle here to re-enable them.
/// </summary>
public static class PawnToolValidator
⋮----
/// Core check if a pawn can use survival tools.
/// This method is used extensively throughout the mod.
⋮----
public static bool CanUseSurvivalTools(Pawn pawn)
⋮----
// Exclude animals entirely as a safeguard regardless of faction
⋮----
!pawn.RaceProps.IsMechanoid &&    // 🚫 Block all mechs
⋮----
/// Determines if a tool meets the policy requirements for acquisition.
/// Used in tool acquisition logic throughout the AI system.
⋮----
public static bool ToolIsAcquirableByPolicy(Pawn pawn, Thing tool)
⋮----
// Basic checks
if (tool.IsForbidden(pawn) || !pawn.CanReach(tool, PathEndMode.ClosestTouch, Danger.Deadly))
⋮----
// Only survival tools or tool-stuff are considered valid
return ToolClassification.IsSurvivalTool(tool) || tool.def.IsToolStuff();
⋮----
/// Check if a pawn is allowed to automatically drop a tool after completing a job.
/// Used in auto-optimization and job completion logic.
⋮----
public static bool AllowedToAutomaticallyDrop(Pawn pawn, Thing toolThing)
⋮----
// Never drop forced items
⋮----
// Check tool assignment rules
⋮----
// If the assignment does not allow this tool, it can be dropped
return !tracker.CurrentSurvivalToolAssignment.Allows(toolThing);
⋮----
// Default: allow dropping if not forced
⋮----
/// Check if a tool is forced for a specific pawn (via forced items or assignment).
⋮----
public static bool IsToolForced(Pawn pawn, Thing toolThing)
⋮----
/// Basic validation that a pawn can reasonably use a survival tool.
/// Includes mental state, capability, faction, and mechanoid checks.
⋮----
/// 🔒 Difference from CanUseSurvivalTools:
/// - Looser: doesn’t require player faction.
/// - Still excludes mechs, downed, dead, and mental pawns.
/// - Useful for utility functions where faction doesn’t matter.
⋮----
public static bool CanUseTools(Pawn pawn)
⋮----
if (pawn.RaceProps?.IsMechanoid == true) return false; // 🚫 Block all mechs
// Exclude animals as a safeguard (consistent with CanUseSurvivalTools)
⋮----
/// Check if a pawn would benefit from using the specified tool.
/// Utility for relevance checks (used in auto-tool pickup logic).
⋮----
public static bool WouldBenefitFromTool(Pawn pawn, Thing tool)
⋮----
// If it's a survival tool wrapper, always potentially beneficial
if (ToolClassification.IsSurvivalTool(tool)) return true;
// If it's tool-stuff, check if it has relevant properties
if (tool.def.IsToolStuff())
</file>
<file path="Source/Helpers/SafetyUtils.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/SafetyUtils.cs
⋮----
/// <summary>
/// Utility class providing safe operations and null-safe extensions
/// to reduce crashes and improve error handling.
///
/// Future idea:
/// - Add overloads with context-sensitive logging (e.g. debug vs release).
/// - Add async-safe versions if ever integrating with tasks/threads.
/// - Optionally collect/report recurring exceptions instead of spamming the log.
/// </summary>
public static class SafetyUtils
⋮----
// ---------------------------
// Collection helpers
⋮----
/// Safely gets the count of a collection, returning 0 if null.
⋮----
public static int SafeCount<T>(this ICollection<T> collection)
⋮----
/// Safely gets the count of an enumerable, returning 0 if null.
⋮----
public static int SafeCount<T>(this IEnumerable<T> enumerable)
⋮----
return enumerable == null ? 0 : enumerable.Count();
⋮----
/// Safely gets the first element or default value.
⋮----
public static T SafeFirstOrDefault<T>(this IEnumerable<T> enumerable)
⋮----
return enumerable == null ? default(T) : enumerable.FirstOrDefault();
⋮----
/// Safely gets the first element matching predicate or default value.
⋮----
public static T SafeFirstOrDefault<T>(this IEnumerable<T> enumerable, Func<T, bool> predicate)
⋮----
return (enumerable == null || predicate == null) ? default(T) : enumerable.FirstOrDefault(predicate);
⋮----
/// Safely accesses an element by index, returning default if null or out of bounds.
⋮----
public static T SafeElementAt<T>(this IList<T> list, int index)
⋮----
/// Safely checks if a collection has any elements.
⋮----
public static bool SafeAny<T>(this IEnumerable<T> enumerable)
⋮----
return enumerable != null && enumerable.Any();
⋮----
/// Safely checks if a collection has any elements matching predicate.
⋮----
public static bool SafeAny<T>(this IEnumerable<T> enumerable, Func<T, bool> predicate)
⋮----
return enumerable != null && predicate != null && enumerable.Any(predicate);
⋮----
// Execution helpers
⋮----
/// Safely executes an action with exception handling and logging.
⋮----
public static void SafeExecute(Action action, string context = "SafeExecute")
⋮----
/// Safely executes a function with exception handling and logging, returning default on error.
⋮----
public static T SafeExecute<T>(Func<T> func, T defaultValue = default(T), string context = "SafeExecute")
⋮----
// Def / Pawn / Thing helpers
⋮----
/// Safely gets a ThingDef by name, with fallback and logging if not found.
⋮----
public static ThingDef SafeGetThingDef(string defName, ThingDef fallback = null)
⋮----
if (string.IsNullOrEmpty(defName)) return fallback;
var def = DefDatabase<ThingDef>.GetNamed(defName, errorOnFail: false);
⋮----
/// Validates that a pawn is not null, not dead, and not destroyed.
⋮----
public static bool IsValidPawn(Pawn pawn)
⋮----
/// Validates that a thing is not null and not destroyed.
⋮----
public static bool IsValidThing(Thing thing)
⋮----
// Mod extension helpers
⋮----
/// Safely gets a mod extension from a def, with null checking.
⋮----
public static T SafeGetModExtension<T>(this Def def) where T : DefModExtension
⋮----
/// Safely tries to get a mod extension, returning whether it was found.
⋮----
public static bool TrySafeGetModExtension<T>(this Def def, out T extension) where T : DefModExtension
</file>
<file path="Source/Helpers/StatFilters.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/StatFilters.cs
⋮----
/// <summary>
/// Helper methods for filtering, analyzing, and categorizing StatDefs.
/// Centralized from SurvivalToolUtility and various stat-related logic.
///
/// Future ideas:
/// - Allow players to tweak which stats are optional/required via mod settings.
/// - Replace hardcoded priority scores with a DefModExtension or settings map.
/// - Add category split for "TreeFelling" vs "Mining" so they're displayed separately.
/// </summary>
public static class StatFilters
⋮----
/// Check if a stat is considered "optional" and shouldn't block jobs in hardcore mode.
/// Optional stats provide bonuses but aren't strictly required.
⋮----
/// Note: ButcheryFleshEfficiency is optional, but ButcheryFleshSpeed is NOT.
⋮----
public static bool IsOptionalStat(StatDef stat)
⋮----
/// Check if a stat should block jobs when missing tools in hardcore mode.
⋮----
public static bool ShouldBlockJobForMissingStat(StatDef stat)
⋮----
/// Get stats that are relevant for tool-based work and have available tools in the game.
⋮----
public static List<StatDef> GetAvailableToolStats()
⋮----
/// Filter a list of stats to only include those that have available tools in the current game.
⋮----
public static List<StatDef> FilterStatsWithAvailableTools(IEnumerable<StatDef> stats)
⋮----
foreach (var stat in stats.Where(s => s != null))
⋮----
availableStats.Add(stat);
⋮----
/// Check if there are any tools available in the game that improve the specified stat.
⋮----
public static bool HasAvailableToolsForStat(StatDef stat)
⋮----
// Real tools
foreach (var toolDef in DefDatabase<ThingDef>.AllDefs.Where(d => d.IsSurvivalTool()))
⋮----
// Tool-stuff (materials like Bioferrite, Obsidian, etc.)
foreach (var stuffDef in DefDatabase<ThingDef>.AllDefs.Where(d => d.IsToolStuff()))
⋮----
/// Group stats by their functional category (mining, farming, etc.).
⋮----
/// Future idea: break "Mining" and "TreeFelling" into separate groups for UI clarity.
⋮----
public static Dictionary<string, List<StatDef>> GroupStatsByCategory(IEnumerable<StatDef> stats)
⋮----
if (groups.ContainsKey(category))
groups[category].Add(stat);
⋮----
groups["Other"].Add(stat);
⋮----
/// Get a human-readable category name for a stat.
⋮----
public static string CategorizeStat(StatDef stat)
⋮----
public static bool IsValidSurvivalToolStat(StatDef stat)
⋮----
public static List<StatDef> GetAllSurvivalToolStats()
⋮----
.Where(IsValidSurvivalToolStat)
.ToList();
⋮----
public static bool ContainsSurvivalToolStats(IEnumerable<StatDef> stats)
⋮----
public static List<StatDef> FilterToSurvivalToolStats(IEnumerable<StatDef> stats)
⋮----
return stats?.Where(IsValidSurvivalToolStat).ToList() ?? new List<StatDef>();
⋮----
/// Get a priority score for a stat (higher = more important).
⋮----
/// Future idea: externalize these values into mod settings or DefModExtensions
/// so players/modders can rebalance priorities without code edits.
⋮----
public static int GetStatPriority(StatDef stat)
⋮----
public static List<StatDef> SortByPriority(IEnumerable<StatDef> stats)
⋮----
return stats?.OrderByDescending(GetStatPriority).ToList() ?? new List<StatDef>();
</file>
<file path="Source/Helpers/SurvivalToolDiscovery.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/SurvivalToolDiscovery.cs
//
// Central helper for discovering survival tools, valid replacements, and
// research-gated tool availability. Used by alerts and optimizers.
⋮----
public static class SurvivalToolDiscovery
⋮----
/// <summary>
/// Returns all unlocked (researched) tool ThingDefs that contribute to the given stat.
/// Includes modded tools that define SurvivalToolProperties with that stat.
/// </summary>
public static IEnumerable<ThingDef> GetToolsForStat(StatDef stat)
⋮----
var props = SurvivalToolProperties.For(def);
⋮----
if (props.baseWorkStatFactors.Any(m => m?.stat == stat))
⋮----
// Skip if locked behind research
⋮----
/// Given a pawn and a damaged tool, finds the best researched replacement available
/// (higher stat factor for at least one stat the tool provides).
/// Returns null if none found.
⋮----
public static ThingDef GetBestReplacement(Pawn pawn, SurvivalTool damagedTool)
⋮----
var stats = damagedTool.WorkStatFactors.Select(m => m.stat).Where(s => s != null).Distinct().ToList();
if (stats.NullOrEmpty()) return null;
// Evaluate score of the damaged tool
⋮----
// Scan all tools (real defs) that share at least one relevant stat
⋮----
.Where(d => SurvivalToolProperties.For(d).HasWorkStatFactors &&
SurvivalToolProperties.For(d).baseWorkStatFactors.Any(m => stats.Contains(m.stat)) &&
⋮----
.ToList();
ThingDef best = null;
⋮----
float score = props.baseWorkStatFactors.Where(m => stats.Contains(m.stat)).Sum(m => m.value);
⋮----
/// Returns true if the tool def is considered "researched/unlocked".
/// Tools without research requirements are always unlocked.
⋮----
public static bool IsUnlocked(ThingDef def)
⋮----
if (reqs.NullOrEmpty()) return true;
return reqs.All(r => r != null && r.IsFinished);
⋮----
/// Scores a tool (or virtual tool) based on its stat modifiers.
/// Simple sum of values for its WorkStatFactors.
⋮----
private static float ToolScore(SurvivalTool tool)
</file>
<file path="Source/Helpers/ToolClassification.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ToolClassification.cs
⋮----
/// <summary>
/// Helper methods for classifying and identifying tool types, purposes, and capabilities.
/// Centralized from ToolUtility, VirtualTool, and various detection logic.
/// </summary>
public static class ToolClassification
⋮----
/// Determine the tool kind based on the thing's properties, name, and stats.
⋮----
public static STToolKind ClassifyToolKind(Thing thing)
⋮----
// Direct tool classification via mod extension
if (thing.def.IsSurvivalTool())
⋮----
return ClassifyByStats(props.baseWorkStatFactors.Select(f => f.stat));
⋮----
// Tool-stuff classification
if (thing.def.IsToolStuff())
⋮----
return ClassifyByStats(stuffProps.baseWorkStatFactors.Select(f => f.stat));
⋮----
// Fallback to name-based detection
⋮----
/// Classify tool kind based on the stats it improves.
⋮----
public static STToolKind ClassifyByStats(IEnumerable<StatDef> stats)
⋮----
var statSet = new HashSet<StatDef>(stats.Where(s => s != null));
// Priority order matters - more specific matches first
if (statSet.Contains(ST_StatDefOf.DiggingSpeed)) return STToolKind.Pick;
if (statSet.Contains(ST_StatDefOf.TreeFellingSpeed)) return STToolKind.Axe;
if (statSet.Contains(ST_StatDefOf.PlantHarvestingSpeed)) return STToolKind.Sickle;
if (statSet.Contains(ST_StatDefOf.SowingSpeed)) return STToolKind.Hoe;
if (statSet.Contains(StatDefOf.ConstructionSpeed)) return STToolKind.Hammer;
if (statSet.Contains(ST_StatDefOf.MaintenanceSpeed) || statSet.Contains(ST_StatDefOf.DeconstructionSpeed)) return STToolKind.Wrench;
if (statSet.Contains(ST_StatDefOf.CleaningSpeed)) return STToolKind.Cleaning;
if (statSet.Contains(ST_StatDefOf.ResearchSpeed)) return STToolKind.Research;
if (statSet.Contains(ST_StatDefOf.MedicalOperationSpeed) || statSet.Contains(ST_StatDefOf.MedicalSurgerySuccessChance)) return STToolKind.Medical;
if (statSet.Contains(ST_StatDefOf.ButcheryFleshSpeed) || statSet.Contains(ST_StatDefOf.ButcheryFleshEfficiency)) return STToolKind.Knife;
⋮----
/// Classify tool kind based on defName and label patterns.
⋮----
public static STToolKind ClassifyByName(ThingDef def)
⋮----
var name = def.defName.ToLowerInvariant();
⋮----
// Pick/Mining tools
⋮----
// Axe/Tree felling
⋮----
// Sickle/Harvesting
⋮----
// Hoe/Farming
⋮----
// Hammer/Construction
⋮----
// Wrench/Maintenance
⋮----
// Medical tools
⋮----
// Cleaning tools
⋮----
// Knife/Butchery
⋮----
/// Check if a thing can function as a survival tool (real tool or tool-stuff).
⋮----
public static bool IsSurvivalTool(Thing thing)
⋮----
return thing.def.IsSurvivalTool() ||
thing.def.IsToolStuff() ||
⋮----
/// Check if a tool definition looks like tool-stuff based on name patterns.
⋮----
public static bool LooksLikeToolStuff(ThingDef def)
⋮----
// Common tool-stuff patterns
⋮----
/// Check if a tool is considered a "pacifist tool" (non-weapon).
⋮----
public static bool IsPacifistTool(ThingDef def)
⋮----
// These tool types are clearly non-violent
⋮----
/// Get the expected stats that a tool kind should improve.
⋮----
public static IEnumerable<StatDef> GetExpectedStatsForKind(STToolKind kind)
⋮----
/// Check if a string contains any of the specified substrings.
⋮----
private static bool ContainsAny(string text, params string[] substrings)
⋮----
if (string.IsNullOrEmpty(text) || substrings == null) return false;
return substrings.Any(s => !string.IsNullOrEmpty(s) && text.Contains(s));
</file>
<file path="Source/Helpers/WorkSpeedGlobalHelper.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/WorkSpeedGlobalHelper.cs
⋮----
/// <summary>
/// Helper methods for WorkSpeedGlobal job detection and management
/// </summary>
public static class WorkSpeedGlobalHelper
⋮----
/// Get all work givers that use the WorkSpeedGlobal stat
⋮----
public static IEnumerable<WorkGiverDef> GetWorkSpeedGlobalJobs()
⋮----
.Where(workGiver => UsesWorkSpeedGlobal(workGiver))
.OrderBy(workGiver => workGiver.workType?.label ?? "Unknown")
.ThenBy(workGiver => workGiver.label ?? workGiver.defName);
⋮----
/// Check if a work giver uses the WorkSpeedGlobal stat
⋮----
public static bool UsesWorkSpeedGlobal(WorkGiverDef workGiver)
⋮----
// Check if it's explicitly listed in vanilla job drivers that use WorkSpeedGlobal
⋮----
if (knownWorkSpeedJobs.Any(job =>
workGiver.defName.Contains(job) ||
(!string.IsNullOrEmpty(workGiver.label) && workGiver.label.ToLower().Contains(job.ToLower()))))
⋮----
// Check work type
⋮----
if (workTypesThatUseWorkSpeed.Any(type =>
workGiver.workType.defName.Contains(type) ||
(!string.IsNullOrEmpty(workGiver.workType.label) && workGiver.workType.label.ToLower().Contains(type.ToLower()))))
⋮----
// Check if it's a bill-based work giver (these typically use WorkSpeedGlobal)
if (workGiver.defName.Contains("DoBill") ||
(!string.IsNullOrEmpty(workGiver.label) && workGiver.label.ToLower().Contains("bill")))
⋮----
/// Check if a specific job should be gated by survival tools based on settings
⋮----
public static bool ShouldGateJob(WorkGiverDef workGiver, SurvivalToolsSettings settings)
⋮----
// If the job doesn't use WorkSpeedGlobal, don't gate it
⋮----
// Check the settings dictionary
return settings.workSpeedGlobalJobGating.GetValueOrDefault(workGiver.defName, true);
</file>
<file path="Source/ModCompatibilityCheck.cs">
// RimWorld 1.6 / C# 7.3
// Source/ModCompatibilityCheck.cs
⋮----
namespace SurvivalTools
⋮----
public static class ModCompatibilityCheck
⋮----
// Cache the active list once
private static readonly List<ModMetaData> Active = ModsConfig.ActiveModsInLoadOrder.ToList();
private static bool Has(string nameOrId)
⋮----
if (string.IsNullOrEmpty(nameOrId)) return false;
return Active.Any(m =>
string.Equals(m.PackageId, nameOrId, StringComparison.OrdinalIgnoreCase) ||
string.Equals(m.PackageIdNonUnique, nameOrId, StringComparison.OrdinalIgnoreCase) ||
string.Equals(m.Name, nameOrId, StringComparison.OrdinalIgnoreCase));
⋮----
private static bool HasAny(params string[] namesOrIds) =>
namesOrIds != null && namesOrIds.Any(Has);
// Known package IDs (best-effort; keep names as fallbacks)
⋮----
// Useful aggregate
</file>
<file path="Source/VirtualTool.cs">
// RimWorld 1.6 / C# 7.3
// Source/VirtualTool.cs
//
// VirtualTool
// - Wrapper so tool-stuff (cloth, hyperweave, etc.) or other qualifying Things behave like SurvivalTool at runtime.
// - Exposes work stat modifiers via SurvivalToolProperties / statBases through the SurvivalTool base caches.
// - Not saved separately; ephemeral adapter used in scoring/assignment paths.
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// A lightweight wrapper so tool-stuff or other resource Things can act like SurvivalTools transparently.
/// Wraps a physical Thing (stack) and exposes tool stat modifiers from its def (extension + statBases).
/// </summary>
public class VirtualTool : SurvivalTool
⋮----
/// <summary>Physical thing (stack) that this wrapper represents.</summary>
⋮----
/// <summary>Definition of the wrapped thing.</summary>
⋮----
/// <summary>Precomputed stat factors pulled from SurvivalToolProperties on the source def.</summary>
⋮----
/// Hide the base property since it's not virtual. For virtual tools this returns only
/// non-null, non-zero stat modifiers defined in SurvivalToolProperties.baseWorkStatFactors.
⋮----
.ToList()
⋮----
// Present as the same def for labeling/inspection consistency.
⋮----
/// Factory method that wraps a physical Thing (like cloth or hyperweave) into a VirtualSurvivalTool.
/// Returns null if the Thing's def does not declare SurvivalToolProperties.
⋮----
public static VirtualTool FromThing(Thing thing)
⋮----
return new VirtualTool(thing);
⋮----
public override string LabelCap => LabelNoCount.CapitalizeFirst();
⋮----
private static bool LooksLikeToolStuff(ThingDef def)
</file>
<file path="Source/WorldComponent_DelayedValidation.cs">
// RimWorld 1.6 / C# 7.3
// Source/WorldComponent_DelayedValidation.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// World component that handles delayed job validation after game load
/// </summary>
public class WorldComponent_DelayedValidation : WorldComponent
⋮----
public override void WorldComponentTick()
⋮----
ST_Logging.LogInfo("[SurvivalTools.JobValidation] Executing delayed job validation after tool stats have been properly initialized.");
SurvivalToolValidation.ValidateExistingJobs("delayed validation after game load");
⋮----
public void ScheduleValidation(int targetTick)
⋮----
ST_Logging.LogInfo($"[SurvivalTools.JobValidation] Scheduled validation for tick {targetTick} (current: {Find.TickManager.TicksGame})");
⋮----
public override void ExposeData()
⋮----
base.ExposeData();
// Don't save validation state - we want it to reset each time we load
</file>
<file path="1.6/Languages/English/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>axe</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>A fundamental forestry tool designed for efficient tree felling. Its weighted head delivers powerful cutting strikes, making it indispensable for colonists working with wood. The balance and leverage make it far superior to improvised cutting methods. Also serves as a reliable melee weapon when survival demands it.</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>pickaxe</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>An essential mining implement featuring a heavy, pointed head mounted on a sturdy handle. Specifically engineered to break through solid rock and extract valuable materials efficiently. The concentrated force and leverage it provides are crucial for productive mining operations. Can double as an improvised weapon when circumstances require it.</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>hammer</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>The cornerstone tool of any construction project. This versatile hammer provides the precision and force needed for driving fasteners, shaping materials, and assembling structures. Essential for colonists engaged in building and maintenance work. Its balanced design ensures effective strikes while minimizing fatigue during extended construction tasks.</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>sickle</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>A specialized agricultural tool featuring a curved cutting blade perfectly designed for harvesting crops and cutting plant matter. The ergonomic design allows for efficient, repetitive cutting motions while reducing strain on the user. Essential for productive farming operations and plant maintenance tasks.</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>hoe</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>A fundamental agricultural implement engineered for soil preparation and seed planting. The pointed design efficiently breaks through earth and creates optimal planting conditions. Indispensable for establishing productive farming operations and maintaining crop yields. Its sturdy construction ensures reliable performance season after season.</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>knife</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>A versatile cutting implement with a sharp blade essential for precise work. Perfect for butchery operations, medical procedures, and general cutting tasks. The balanced design allows for controlled, accurate cuts while the keen edge ensures clean work. An indispensable tool for any serious colonist.</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>hand saw</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>A traditional woodworking tool featuring a metal blade with precisely cut teeth designed for manual lumber processing. Essential for construction projects requiring custom-cut timber and detailed woodwork. The steady rhythm of hand-sawing may take longer than power tools, but provides excellent control and precision.</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>bone sickle</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>A primitive harvesting tool crafted from carved bone with a sharpened edge. While not as durable as metal variants, this traditional implement serves admirably for crop harvesting and plant cutting. The curved design follows ancient patterns proven effective across countless generations of agricultural work.</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>pry bar</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>A primitive but effective leverage tool crafted from durable materials. Essential for dismantling structures, prying apart materials, and performing basic mechanical operations. Represents the ingenuity of early civilizations in developing practical solutions for construction and deconstruction tasks without advanced technology.</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>abacus</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>An ancient calculating instrument featuring movable beads arranged on rods for performing arithmetic operations. Essential for organizing research data, managing complex calculations, and maintaining accurate records in societies without advanced computational devices. Represents the foundation of mathematical thinking and data organization.</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>steel knife</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>A precision-forged steel knife with superior edge retention and durability. The high-carbon steel blade maintains its sharpness through extensive use, making it ideal for demanding butchery and medical work. The ergonomic handle provides excellent control for delicate operations.</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>crosscut saw</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>A precision industrial saw designed for efficient lumber processing and construction work. The specially designed teeth and reinforced steel construction allow for clean, accurate cuts through various materials. Essential for large-scale construction projects and advanced woodworking operations.</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>wrench</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>A precision mechanical tool engineered for gripping, turning, and manipulating fasteners and mechanical components. Critical for maintenance operations, machinery repair, and construction projects requiring exact adjustments. The adjustable jaw design accommodates various sizes while providing optimal leverage and control.</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>microscope</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>A precision optical instrument that magnifies small objects and specimens for detailed examination. Essential for advanced research, biological studies, and scientific analysis.</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>carbide pickaxe</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>An advanced mining implement featuring carbide-tipped edges that maintain their sharpness through the most demanding excavation work. The precision-engineered head cuts through rock more efficiently than standard tools, while the reinforced construction ensures exceptional durability in harsh mining conditions.</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>precision scalpel</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>An ultra-sharp surgical instrument crafted from the finest steel alloys. The carefully balanced blade maintains its edge through repeated sterilization and use, while the ergonomic handle ensures precise control during delicate medical procedures. Standard equipment in advanced medical facilities.</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>power drill</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>A mechanized drilling tool powered by an internal motor, capable of boring through tough materials with precision and speed. The variable-speed motor and interchangeable bits make it invaluable for construction and mechanical work. Requires periodic maintenance to keep the motor running smoothly.</SurvivalTools_PowerDrill.description>
    <!-- Cleaning Tools -->
    <SurvivalTools_PileOfRags.label>pile of rags</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>A collection of cloth pieces bundled together for cleaning purposes. These simple rags are effective for basic cleaning tasks, though they wear out more quickly than proper cleaning tools. Essential for maintaining colony hygiene and cleanliness.</SurvivalTools_PileOfRags.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>glitterworld multitool</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>A high-tech universal tool commonly used by domestic mechanoids in glitterworld societies. This advanced device can seamlessly adapt to any task - construction, mining, forestry, maintenance, and deconstruction - making it the ultimate all-in-one survival tool. Though designed for mechanoids, it's perfectly usable by humanoids due to physiological similarities.</SurvivalTools_Multitool.description>
    <!-- =================================================== -->
    <!-- MULTIPURPOSE GENERAL WORK TOOLS (WorkSpeedGlobal)   -->
    <!-- Newly added tool defs requiring DefInjected entries -->
    <!-- =================================================== -->
    <!-- Tribal / Primitive Tier -->
    <SurvivalTools_MultipurposeStoneTool.label>multipurpose stone tool</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>A rugged, versatile stone implement shaped to cover many general tasks. While primitive, it grants a modest improvement to overall work speed.</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>carved bone implements</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>A collection of carefully carved bone implements bundled together for multi-purpose use. Fragile, but shaped for efficiency, giving a noticeable boost to general work speed.</SurvivalTools_CarvedBoneImplements.description>
    <!-- Medieval Tier -->
    <SurvivalTools_ArtisansToolkit.label>artisan's toolkit</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>A curated collection of quality medieval-era implements for crafting, shaping, and assembly. Improves overall work throughput across many tasks.</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>woodworker's kit</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>A specialized assortment of saws, chisels, planes and gauges optimized for timber shaping and joinery. Its organization and quality grant a strong boost to general work speed.</SurvivalTools_WoodworkersKit.description>
    <!-- Industrial Tier -->
    <SurvivalTools_MechanicsToolkit.label>mechanic's toolkit</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>An organized industrial-era toolkit containing precision wrenches, gauges, torque implements and fast-retrieval storage. Greatly improves overall task flow and coordination in general work.</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>workshop hammer drill</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>A heavy-duty powered hammer drill with interchangeable percussion and rotary modules. Its integrated clamping and alignment system accelerates virtually any mechanical or construction task.</SurvivalTools_WorkshopHammerDrill.description>
    <!-- Spacer / Ultra Tech Tier -->
    <SurvivalTools_NanofabricatorInterface.label>nanofabricator interface</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>A sleek control and augmentation module that synchronizes the user's motions with adaptive nano-assembly routines. Dramatically improves general task execution efficiency.</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>omni-tool gauntlet</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>A cutting-edge modular gauntlet embedding field projectors, micro-fabricators and force-aligned manipulators. Provides an unparalleled increase to general work speed through predictive optimization.</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>
<file path="1.6/Languages/French/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>hache</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>Un outil forestier de base conçu pour un travail d'abattage efficace. Sa tête lourde offre une force de frappe puissante, en faisant un outil indispensable pour les colons engagés dans le travail du bois. Son équilibre et son effet de levier le rendent bien plus efficace que les méthodes de coupe improvisées. Sert également d'arme de mêlée fiable lorsque la survie l'exige.</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>pioche</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>Un outil minier essentiel doté d'une tête lourde et pointue fixée à un manche robuste. Spécialement conçu pour briser la roche dure et extraire efficacement les matériaux précieux. Sa force concentrée et son effet de levier sont essentiels pour des opérations minières productives. Peut également servir d'arme improvisée lorsque les circonstances l'exigent.</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>marteau</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>Un outil fondamental pour tout projet de construction. Ce marteau polyvalent fournit la précision et la force nécessaires pour enfoncer les attaches, façonner les matériaux et assembler les structures. Indispensable pour les colons engagés dans les travaux de construction et de maintenance. Sa conception équilibrée assure des coups efficaces avec une fatigue minimale pendant les travaux de construction prolongés.</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>faucille</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>Un outil agricole spécialisé doté d'une lame courbe parfaitement conçue pour récolter les cultures et couper le matériel végétal. Sa conception ergonomique permet des mouvements de coupe efficaces et répétitifs avec une contrainte minimale sur l'utilisateur. Indispensable pour les opérations agricoles productives et les travaux d'entretien des plantes.</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>houe</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>Un outil agricole de base conçu pour la préparation du sol et la plantation de graines. Sa conception pointue brise efficacement le sol, créant des conditions de plantation optimales. Indispensable pour établir des opérations agricoles productives et maintenir les rendements des cultures. Sa construction robuste assure des performances fiables à travers les saisons.</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>couteau</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>Un outil de coupe polyvalent avec une lame tranchante indispensable pour les travaux de précision. Idéal pour les travaux de boucherie, les procédures médicales et les tâches de coupe générales. Sa conception équilibrée permet des coupes contrôlées et précises, tandis que la lame tranchante assure un travail propre. Un outil indispensable pour tout colon sérieux.</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>scie à main</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>Un outil de menuiserie traditionnel doté d'une lame métallique avec des dents précisément coupées pour le travail du bois manuel. Indispensable pour les projets de construction nécessitant du bois coupé sur mesure et des travaux de menuiserie détaillés. Le rythme régulier d'une scie à main peut prendre plus de temps que les outils électriques, mais offre un excellent contrôle et une précision.</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>faucille en os</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>Un outil de récolte primitif fait d'os sculpté avec un bord aiguisé. Bien qu'il ne soit pas aussi durable que ses homologues métalliques, cet instrument traditionnel sert admirablement pour récolter les cultures et couper les plantes. Sa conception courbe suit des modèles anciens qui ont prouvé leur efficacité à travers d'innombrables générations de travail agricole.</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>levier</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>Un outil de levier primitif mais efficace fabriqué à partir de matériaux durables. Indispensable pour démonter les structures, séparer les matériaux et effectuer des opérations mécaniques de base. Représente l'ingéniosité des premières civilisations dans le développement de solutions pratiques pour les travaux de construction et de démolition sans technologie avancée.</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>boulier</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>Un instrument de calcul ancien avec des perles mobiles disposées sur des tiges pour effectuer des opérations arithmétiques. Indispensable pour organiser les données de recherche, gérer les calculs complexes et maintenir des registres précis dans les sociétés sans dispositifs de calcul avancés. Représente la fondation de la pensée mathématique et de l'organisation des données.</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>couteau en acier</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>Un couteau en acier forgé avec précision avec une rétention de tranchant et une durabilité supérieures. La lame en acier carbone maintient son tranchant à travers une utilisation extensive, le rendant idéal pour les travaux de boucherie et médicaux exigeants. Le manche ergonomique offre un excellent contrôle pour les travaux fins.</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>scie à tronçonner</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>Une scie industrielle de précision conçue pour un travail du bois et de construction efficace. Ses dents spécialement conçues et sa construction en acier renforcé permettent des coupes nettes et précises à travers divers matériaux. Indispensable pour les grands projets de construction et les travaux de menuiserie avancés.</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>clé</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>Un outil mécanique de précision conçu pour saisir, tourner et manipuler les attaches et les composants mécaniques. Crucial pour les travaux de maintenance, les réparations de machines et les projets de construction nécessitant des ajustements précis. Le système de mâchoires ajustables s'adapte à diverses tailles tout en offrant un effet de levier et un contrôle optimaux.</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>microscope</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>Un instrument optique de précision qui grossit les petits objets et échantillons pour un examen détaillé. Indispensable pour la recherche avancée, les études biologiques et l'analyse scientifique.</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>pioche au carbure</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>Un outil minier avancé doté d'une pointe au carbure qui maintient son tranchant à travers les travaux d'excavation les plus exigeants. La tête conçue avec précision coupe la roche plus efficacement que les outils standard, tandis que sa construction renforcée assure une durabilité exceptionnelle dans des conditions minières difficiles.</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>scalpel de précision</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>Un instrument chirurgical ultra-tranchant fabriqué à partir d'alliages d'acier de qualité supérieure. La lame soigneusement équilibrée maintient son tranchant à travers une stérilisation et une utilisation répétées, tandis que le manche ergonomique assure un contrôle précis pendant les procédures médicales fines. Équipement standard pour les installations médicales avancées.</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>perceuse électrique</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>Un outil de perçage mécanisé alimenté par un moteur intégré capable de percer des matériaux durs avec précision et vitesse. Le moteur à vitesse variable et les mèches interchangeables le rendent extrêmement précieux pour les travaux de construction et mécaniques. Nécessite un entretien régulier pour maintenir le moteur en bon état de fonctionnement.</SurvivalTools_PowerDrill.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>multi-outil glittermonde</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>Un outil universel haute technologie couramment utilisé par les mécanoides domestiques dans les sociétés glittermonde. Cet appareil avancé s'adapte sans effort à toute tâche - construction, minage, foresterie, maintenance, démolition - en faisant l'outil de survie tout-en-un ultime. Bien que conçu pour les mécanoides, il est parfaitement utilisable par les humanoïdes en raison de similitudes physiologiques.</SurvivalTools_Multitool.description>
    <SurvivalTools_PileOfRags.label>tas de chiffons</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>Un simple outil de nettoyage fait de chiffons et de morceaux de tissu. Utile pour les tâches de nettoyage de base mais s'use rapidement.</SurvivalTools_PileOfRags.description>
    <!-- =================================================== -->
    <!-- OUTILS GÉNÉRAUX MULTI-USAGES (WorkSpeedGlobal)       -->
    <!-- Nouvelles définitions nécessitant des entrées        -->
    <!-- =================================================== -->
    <!-- Palier tribal / primitif -->
    <SurvivalTools_MultipurposeStoneTool.label>outil en pierre polyvalent</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>Un instrument en pierre robuste et polyvalent, façonné pour couvrir de nombreuses tâches générales. Bien que primitif, il confère une légère amélioration de la vitesse de travail globale.</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>implements en os sculptés</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>Un ensemble d'outils en os soigneusement sculptés et groupés pour un usage multi‑fonction. Fragiles mais bien profilés, ils procurent un gain notable à la vitesse générale de travail.</SurvivalTools_CarvedBoneImplements.description>
    <!-- Palier médiéval -->
    <SurvivalTools_ArtisansToolkit.label>trousse de l'artisan</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>Une collection sélectionnée d'outils de qualité d'époque médiévale pour l'artisanat, le façonnage et l'assemblage. Améliore le débit global à travers de nombreuses tâches.</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>kit du menuisier</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>Un assortiment spécialisé de scies, ciseaux, rabots et jauges optimisés pour le façonnage et l'assemblage du bois. Son organisation et sa qualité accordent un fort bonus à la vitesse de travail générale.</SurvivalTools_WoodworkersKit.description>
    <!-- Palier industriel -->
    <SurvivalTools_MechanicsToolkit.label>trousse du mécanicien</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>Une trousse industrielle organisée contenant clés de précision, jauges, outils de couple et rangement à accès rapide. Améliore grandement le flux et la coordination des tâches générales.</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>marteau-perforateur d'atelier</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>Un marteau-perforateur robuste avec modules percussifs et rotatifs interchangeables. Son système intégré de serrage et d'alignement accélère presque toute tâche mécanique ou de construction.</SurvivalTools_WorkshopHammerDrill.description>
    <!-- Palier ultra‑tech / spatial -->
    <SurvivalTools_NanofabricatorInterface.label>interface de nanofabrication</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>Un module élégant de contrôle et d'augmentation qui synchronise les mouvements de l'utilisateur avec des routines adaptatives nano‑assemblées. Améliore profondément l'efficacité d'exécution des tâches générales.</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>gantelet omni‑outil</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>Un gantelet modulaire de pointe incorporant projecteurs de champ, micro‑fabricateurs et manipulateurs à alignement de force. Fournit un accroissement inégalé de la vitesse générale de travail via une optimisation prédictive.</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>
<file path="1.6/Languages/French/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <NoTool>Aucun outil</NoTool>
    <ToolInUse>(en cours d'utilisation)</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>Outils de Survie</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>Paramètres de base</Settings_BasicSection>
    <Settings_DebugSection>Paramètres de débogage</Settings_DebugSection>
    <Settings_HardcoreMode>Mode hardcore</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>Augmente considérablement la difficulté en rendant les outils essentiels à la survie. Sans outils appropriés, les colons deviennent incapables d'exécuter efficacement la plupart des tâches de travail. Les outils s'usent aussi 50% plus rapidement, nécessitant un remplacement plus fréquent et une meilleure gestion des outils. Transforme le jeu en une véritable expérience de survie dépendante des outils.</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>Mode hardcore extrême</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>DIFFICULTÉ MAXIMALE : Le défi de survie ultime. Lorsqu'il est combiné avec le mode hardcore, les colons deviennent complètement impuissants sans les bons outils. Les tâches qui n'étaient que simplement inefficaces (comme le nettoyage à la main ou les soins médicaux improvisés) deviennent impossibles à tenter. Les outils se dégradent 87,5% plus rapidement que la normale, créant une pression constante pour la production et la maintenance d'outils. Utilisez les cases à cocher ci-dessous pour contrôler exactement quels types de travail deviennent dépendants des outils. ATTENTION : Le début de jeu devient extrêmement difficile - l'acquisition d'outils devient critique pour la survie de la colonie !</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>Outils de nettoyage requis</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>Force les colons à utiliser des outils de nettoyage appropriés (comme des balais ou des serpillières) pour toutes les tâches de nettoyage. Sans les bons outils, ils ne peuvent pas nettoyer les sols, enlever la saleté ou déblayer la neige. Essentiel pour maintenir l'hygiène de la colonie dans les modes de difficulté extrême.</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>Outils de boucherie requis</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>Exige des outils de coupe appropriés (comme des couteaux ou des hachoirs) pour toutes les opérations de boucherie et d'abattage. Les colons ne peuvent pas traiter la viande ou abattre des animaux sans lames appropriées. Critique pour les chaînes de production alimentaire dans les scénarios hardcore.</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>Outils médicaux requis</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>Impose l'utilisation d'instruments médicaux spécialisés pour les procédures chirurgicales et les soins médicaux avancés. Les opérations deviennent impossibles sans outils chirurgicaux appropriés, rendant l'acquisition d'équipement médical vitale pour la santé et la survie de la colonie.</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>Outils dans les bâtiments en ruine</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>Génère des outils de survie de base dans les ruines antiques et les structures écrasées pendant la génération de carte. Ces outils altérés fournissent des ressources importantes en début de jeu mais sont typiquement de faible qualité. Inestimables pour commencer des colonies dans des modes de difficulté difficiles où l'accès initial aux outils est critique.</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>Limite de transport d'outils</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>Restreint les colons à porter un maximum de 2-3 outils simultanément dans leur inventaire (excluant les voyages en caravane). Force la gestion stratégique des outils et la spécialisation parmi les colons. Les ceintures à outils et équipements similaires peuvent augmenter cette limite au-delà de la valeur de base. Ajoute des contraintes d'inventaire réalistes à l'utilisation des outils.</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>Taux de dégradation des outils</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>Optimisation automatique des outils</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>Active la gestion intelligente des outils où les colons sélectionnent et portent automatiquement les outils les plus efficaces pour leur travail assigné. Ils améliorent vers de meilleurs outils et abandonnent les inférieurs selon les besoins. Désactivez ceci si vous préférez le contrôle manuel des outils ou rencontrez des problèmes de performance avec des matériaux modifiés.</Settings_ToolOptimization_Tooltip>
    <Settings_PickupFromStorageOnly>Restreindre la collecte d'outils aux zones de stockage</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>Lorsqu'activé, les colons n'acquerront des outils que depuis les zones de stockage désignées, maintenant une meilleure organisation et les empêchant de saisir des outils depuis les zones de travail. Lorsque désactivé, ils peuvent ramasser n'importe quel outil accessible dans la zone Maison (excluant les objets interdits ou en feu), offrant plus de flexibilité mais moins de contrôle.</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_AllowPacifistEquip>Permettre aux pacifistes d'équiper des outils de survie</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>Permet aux colons pacifistes d'équiper des outils de survie classifiés comme armes (comme les haches, pics ou couteaux). Bien que ces outils aient des capacités de combat, ils sont essentiels pour les tâches de travail comme l'abattage d'arbres, l'extraction minière ou la préparation alimentaire. Lorsqu'activé, les pacifistes peuvent utiliser ces outils pour un travail productif tout en refusant de s'engager dans la violence.</Settings_AllowPacifistEquip_Tooltip>
    <Settings_DebugLogging>Activer la journalisation de débogage détaillée</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>Active la journalisation complète des décisions de sélection d'outils, du comportement de collecte automatique et de la logique de correspondance travail-outil. Essentiel pour dépanner les problèmes d'outils ou comprendre pourquoi les colons choisissent des outils spécifiques. Recommandé seulement pour le développement de mods ou lors de problèmes liés aux outils. Peut affecter les performances avec une sortie de journalisation extensive.</Settings_DebugLogging_Tooltip>
    <Settings_AutoTool>Collecte d'outils intelligente pré-travail</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>Révolutionne l'efficacité du flux de travail en faisant que les colons acquièrent automatiquement l'outil optimal avant de commencer tout travail. Ils échangent intelligemment les outils, améliorent vers de meilleures variantes et s'assurent d'avoir l'équipement approprié pour une productivité maximale. La fonctionnalité fondamentale pour un gameplay basé sur les outils sans faille.</Settings_AutoTool_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>Le colon manque d'outils essentiels</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>Les colons manquent d'outils essentiels</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>Ces colons ont besoin d'outils appropriés pour leur travail assigné, mais il leur manque l'équipement nécessaire. Leur productivité est sévèrement compromise.</ColonistNeedsSurvivalToolDesc>
    <SurvivalToolsNeedReplacing>Outils approchant de la défaillance</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>Ces colons utilisent des outils qui vont bientôt se briser. Remplacez-les immédiatement pour éviter l'interruption du travail.</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>Gérer les assignations d'outils</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>Assignation d'outil</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>Constructeur</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>Mineur</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>Travailleur des plantes</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>Chercheur</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>Nettoyeur</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>Médical</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>Boucher</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>Sélectionner l'assignation d'outil...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>Nouvelle assignation d'outil</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>Supprimer l'assignation d'outil...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>L'assignation d'outil est utilisée par {0}</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>Aucune assignation d'outil sélectionnée</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>Outils forcés</ForcedSurvivalTools>
    <!-- Settings -->
    <Settings_CompatLogging>Activer la journalisation de débogage de compatibilité</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Active la journalisation détaillée pour les systèmes de compatibilité de mods incluant l'intégration Research Reinvented, la détection de statistiques et le câblage WorkGiver. Affiche les processus étape par étape de configuration et d'intégration de compatibilité. Seulement affiché quand la journalisation de débogage générale est activée. Utile pour diagnostiquer les problèmes avec les interactions de mods.</Settings_CompatLogging_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Cliquez sur le bouton ci-dessous pour ouvrir la fenêtre de paramètres améliorée et redimensionnable avec toutes les options du mod.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Ouvrir les Paramètres Améliorés</Settings_OpenEnhancedButton>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>Types de Travaux</JobTable_JobTypes>
    <JobTable_JobType>Type de Travail</JobTable_JobType>
    <JobTable_NormalMode>Mode Normal</JobTable_NormalMode>
    <JobTable_HardcoreMode>Mode Hardcore</JobTable_HardcoreMode>
    <JobTable_ExtraHardcore>Hardcore Extrême</JobTable_ExtraHardcore>
    <JobTable_Enhanced>Amélioré</JobTable_Enhanced>
    <JobTable_Required>Requis</JobTable_Required>
    <JobTable_NoJobsFound>Aucun travail amélioré par des outils trouvé.</JobTable_NoJobsFound>
    <JobTable_SectionTitle>Exigences d'Outils par Mode</JobTable_SectionTitle>
    <JobTable_SectionTooltip>Ce tableau montre comment les différents types de travaux se comportent dans chaque mode de difficulté. 'Amélioré' signifie que les outils apportent des bonus mais ne sont pas obligatoires. 'Obligatoire' signifie que les outils sont nécessaires pour effectuer le travail. Utilisez ceci pour comprendre quels outils vos colons auront besoin selon vos paramètres actuels.</JobTable_SectionTooltip>
    <!-- Job Table Headers -->
    <JobTable_Normal>Normal</JobTable_Normal>
    <JobTable_Hardcore>Hardcore</JobTable_Hardcore>
    <JobTable_ExtraHardcore>Super Hardcore</JobTable_ExtraHardcore>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Cliquez sur le bouton ci-dessous pour ouvrir la fenêtre de paramètres améliorée et redimensionnable avec toutes les options du mod.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Ouvrir les Paramètres Améliorés</Settings_OpenEnhancedButton>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>Recherche Réinventée</Compat_ResearchReinvented>
    <Compat_FieldResearch>Recherche de Terrain</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>Recherche Réinventée</Compat_ReinventedResearchAlert>
    <!-- Configuration WorkSpeedGlobal (ajout) -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>Configuration des travaux vitesse générale</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>Sélectionnez quels travaux utilisant la statistique de vitesse de travail générale doivent être soumis aux outils de survie. Les travaux non soumis ignorent les pénalités d'outils lorsque les colons manquent d'équipement.</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>Type de travail</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>Soumis</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>Description</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>Aucun travail de vitesse générale trouvé.</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>Tout activer</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>Tout désactiver</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>Réinitialiser</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>Tracer WorkGivers</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>Nécessite des outils en modes hardcore</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>Aucune pénalité d'outil</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>Configurer les travaux vitesse générale</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (ajout) -->
    <JobTable_NoActiveMode>Aucun mode actif sélectionné.</JobTable_NoActiveMode>
    <JobTable_GatedFormat>Soumis ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>Soumis (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>Inconnu</JobTable_Status_Unknown>
    <JobTable_Blocked>Bloqué</JobTable_Blocked>
</LanguageData>
</file>
<file path="1.6/Languages/German/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>Axt</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>Ein grundlegendes Forstwerkzeug, das für effiziente Holzfällerarbeiten entwickelt wurde. Der gewichtige Kopf bietet kraftvolle Schlagkraft und macht es zu einem unverzichtbaren Werkzeug für Siedler, die in der Holzwirtschaft tätig sind. Seine Ausgewogenheit und sein Hebeleffekt machen es weitaus effektiver als improvisierte Schneidemethoden. Fungiert auch als zuverlässige Nahkampfwaffe, wenn das Überleben es erfordert.</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>Spitzhacke</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>Ein unverzichtbares Bergbauwerkzeug mit einem schweren, spitzen Kopf, der an einem robusten Griff befestigt ist. Speziell entwickelt, um harte Gesteine aufzubrechen und wertvolle Materialien effizient zu extrahieren. Seine konzentrierte Kraft und sein Hebeleffekt sind für produktive Bergbauoperationen unerlässlich. Kann auch als improvisierte Waffe verwendet werden, wenn es die Umstände erfordern.</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>Hammer</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>Ein grundlegendes Werkzeug für jedes Bauprojekt. Dieser vielseitige Hammer bietet die nötige Präzision und Kraft zum Einschlagen von Befestigungselementen, Formen von Materialien und Zusammenbauen von Strukturen. Unverzichtbar für Siedler, die in Bau- und Wartungsarbeiten tätig sind. Sein ausgewogenes Design gewährleistet effektive Schläge bei minimaler Ermüdung während längerer Bauarbeiten.</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>Sichel</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>Ein spezialisiertes landwirtschaftliches Werkzeug mit einer gekrümmten Schneide, die perfekt für das Ernten von Feldfrüchten und das Schneiden von Pflanzenmaterial entwickelt wurde. Das ergonomische Design ermöglicht effiziente, wiederholende Schneidebewegungen bei minimaler Belastung des Benutzers. Unverzichtbar für produktive landwirtschaftliche Betriebe und Pflanzenwartungsarbeiten.</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>Hacke</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>Ein grundlegendes landwirtschaftliches Werkzeug, das für die Bodenbearbeitung und das Pflanzen von Samen entwickelt wurde. Sein spitzes Design bricht den Boden effizient auf und schafft optimale Pflanzenbedingungen. Unverzichtbar für die Etablierung produktiver landwirtschaftlicher Betriebe und die Aufrechterhaltung der Ernteerträge. Seine robuste Konstruktion gewährleistet zuverlässige Leistung durch die Saisons.</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>Messer</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>Ein vielseitiges Schneidewerkzeug mit einer scharfen Klinge, die für Präzisionsarbeiten unverzichtbar ist. Ideal für Fleischzerlegungsarbeiten, medizinische Verfahren und allgemeine Schneidaufgaben. Sein ausgewogenes Design ermöglicht kontrollierte, präzise Schnitte, während die scharfe Klinge saubere Arbeit gewährleistet. Ein unverzichtbares Werkzeug für jeden ernsthaften Siedler.</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>Handsäge</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>Ein traditionelles Holzbearbeitungswerkzeug mit einer Metallklinge mit präzise geschnittenen Zähnen für die manuelle Holzbearbeitung. Unverzichtbar für Bauprojekte, die maßgeschnittenes Holz und detaillierte Holzarbeiten erfordern. Das gleichmäßige Tempo einer Handsäge mag länger dauern als Elektrowerkzeuge, bietet aber hervorragende Kontrolle und Präzision.</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>Knochensichel</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>Ein primitives Erntewerkzeug aus geschnitzten Knochen mit einer geschärften Kante. Obwohl nicht so langlebig wie ihre Metallgegenstücke, dient dieses traditionelle Werkzeug bewundernswert beim Ernten von Feldfrüchten und Schneiden von Pflanzen. Sein gekrümmtes Design folgt alten Mustern, die ihre Wirksamkeit durch unzählige Generationen landwirtschaftlicher Arbeit bewiesen haben.</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>Brecheisen</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>Ein primitives, aber effektives Hebelwerkzeug aus langlebigen Materialien. Unverzichtbar zum Auseinandernehmen von Strukturen, Trennen von Materialien und Durchführen grundlegender mechanischer Operationen. Repräsentiert den Einfallsreichtum früher Zivilisationen bei der Entwicklung praktischer Lösungen für Bau- und Abrissarbeiten ohne fortgeschrittene Technologie.</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>Abakus</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>Ein altes Rechenwerkzeug mit beweglichen Perlen, die auf Stäben angeordnet sind, um arithmetische Operationen durchzuführen. Unverzichtbar für die Organisation von Forschungsdaten, die Verwaltung komplexer Berechnungen und die Führung genauer Aufzeichnungen in Gesellschaften ohne fortgeschrittene Rechengeräte. Repräsentiert die Grundlage mathematischen Denkens und Datenorganisation.</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>Stahlmesser</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>Ein präzise geschmiedetes Stahlmesser mit überlegener Schärfehaltung und Haltbarkeit. Die Kohlenstoffstahlklinge behält ihre Schärfe durch extensive Nutzung bei und macht es ideal für anspruchsvolle Fleischzerlegungs- und medizinische Arbeiten. Der ergonomische Griff bietet hervorragende Kontrolle bei feinen Arbeiten.</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>Quersäge</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>Eine Präzisions-Industriesäge für effiziente Holzbearbeitung und Bauarbeiten. Ihre speziell entwickelten Zähne und verstärkte Stahlkonstruktion ermöglichen saubere, präzise Schnitte durch verschiedene Materialien. Unverzichtbar für große Bauprojekte und fortgeschrittene Holzarbeiten.</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>Schraubenschlüssel</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>Ein Präzisions-Maschinenwerkzeug zum Greifen, Drehen und Manipulieren von Befestigungselementen und mechanischen Komponenten. Entscheidend für Wartungsarbeiten, Maschinenreparaturen und Bauprojekte, die präzise Anpassungen erfordern. Das verstellbare Backensystem bietet optimalen Hebeleffekt und Kontrolle bei der Anpassung an verschiedene Größen.</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>Mikroskop</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>Ein präzises optisches Instrument, das kleine Objekte und Proben zur detaillierten Untersuchung vergrößert. Unverzichtbar für fortgeschrittene Forschung, biologische Studien und wissenschaftliche Analysen.</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>Hartmetall-Spitzhacke</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>Ein fortgeschrittenes Bergbauwerkzeug mit einer Hartmetall-Spitze, die ihre Schärfe durch die anspruchsvollsten Grabarbeiten behält. Der präzise entwickelte Kopf schneidet Gestein effizienter als Standardwerkzeuge, während seine verstärkte Konstruktion außergewöhnliche Haltbarkeit unter rauen Bergbaubedingungen gewährleistet.</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>Präzisionsskalpell</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>Ein ultrascherfer chirurgischer Instrument aus hochwertigen Stahllegierungen gefertigt. Die sorgfältig ausgewogene Klinge behält ihre Schärfe durch wiederholte Sterilisation und Verwendung bei, während der ergonomische Griff präzise Kontrolle während feiner medizinischer Verfahren gewährleistet. Standardausrüstung für fortgeschrittene medizinische Einrichtungen.</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>Elektrische Bohrmaschine</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>Ein mechanisiertes Bohrwerkzeug, das von einem eingebauten Motor angetrieben wird und harte Materialien mit Präzision und Geschwindigkeit durchbohren kann. Der variable Geschwindigkeitsmotor und austauschbare Bits machen es äußerst wertvoll für Bau- und Maschinenarbeiten. Erfordert regelmäßige Wartung, um den Motor reibungslos am Laufen zu halten.</SurvivalTools_PowerDrill.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>Glitterwelt-Multitool</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>Ein hochtechnologisches Universalwerkzeug, das häufig von Hausmechanoiden in Glitterwelt-Gesellschaften verwendet wird. Dieses fortgeschrittene Gerät passt sich nahtlos an jede Aufgabe an - Bau, Bergbau, Forstwirtschaft, Wartung, Abriss - und macht es zum ultimativen All-in-One-Überlebenswerkzeug. Obwohl für Mechanoiden entwickelt, ist es aufgrund physiologischer Ähnlichkeiten vollständig von Humanoiden verwendbar.</SurvivalTools_Multitool.description>
    <SurvivalTools_PileOfRags.label>Lumpenhaufen</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>Ein einfaches Reinigungswerkzeug aus Lumpen und Stoffresten. Nützlich für grundlegende Reinigungsarbeiten, aber nutzt sich schnell ab.</SurvivalTools_PileOfRags.description>
    <!-- =================================================== -->
    <!-- MEHRZWECK-ALLGEMEINWERKZEUGE (WorkSpeedGlobal)       -->
    <!-- Neue Tool-Defs benötigen Einträge                   -->
    <!-- =================================================== -->
    <!-- Tribal / Primitiv Stufe -->
    <SurvivalTools_MultipurposeStoneTool.label>mehrzweck-steinwerkzeug</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>Ein robustes, vielseitiges Steinwerkzeug, geformt um viele allgemeine Aufgaben abzudecken. Primitiv, aber verleiht einen kleinen Bonus auf die gesamte Arbeitsgeschwindigkeit.</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>geschnitzte knochenimplements</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>Ein Bündel sorgfältig geschnitzter Knochengeräte für Mehrzweckgebrauch. Zerbrechlich, aber effizient geformt und verleiht einen bemerkbaren Schub zur allgemeinen Arbeitsgeschwindigkeit.</SurvivalTools_CarvedBoneImplements.description>
    <!-- Mittelalter Stufe -->
    <SurvivalTools_ArtisansToolkit.label>werkzeugsatz des handwerkers</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>Eine kuratierte Sammlung mittelalterlicher Qualitätswerkzeuge zum Fertigen, Formen und Montieren. Verbessert den Gesamtdurchsatz vieler Aufgaben.</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>holzarbeiter-kit</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>Eine spezialisierte Auswahl aus Sägen, Meißeln, Hobeln und Lehren für Holzformung und Verbindungen. Organisation und Qualität gewähren einen starken Bonus auf die allgemeine Arbeitsgeschwindigkeit.</SurvivalTools_WoodworkersKit.description>
    <!-- Industrielle Stufe -->
    <SurvivalTools_MechanicsToolkit.label>werkzeugsatz des mechanikers</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>Ein gut organisierter Industriesatz mit Präzisionsschlüsseln, Lehren, Drehmomentwerkzeugen und Schnellzugriffsaufbewahrung. Verbessert den Ablauf und die Koordination allgemeiner Aufgaben stark.</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>werkstatt-schlagbohrer</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>Ein schwerer, angetriebener Schlagbohrer mit austauschbaren Schlag- und Rotationsmodulen. Das integrierte Spann- und Ausrichtungssystem beschleunigt nahezu jede mechanische oder bauliche Aufgabe.</SurvivalTools_WorkshopHammerDrill.description>
    <!-- Spacer / Ultra-Tech Stufe -->
    <SurvivalTools_NanofabricatorInterface.label>nanofabrikations-interface</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>Ein schlankes Steuer- und Verstärkungsmodul, das die Bewegungen des Benutzers mit adaptiven Nano-Assemblierungsroutinen synchronisiert. Steigert die Effizienz allgemeiner Aufgaben dramatisch.</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>omni-werkzeugstulpe</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>Eine hochmoderne modulare Stulpe mit Feldprojektoren, Mikro-Fabrikatoren und kraftausgerichteten Manipulatoren. Bietet durch prädiktive Optimierung einen unerreichten Anstieg der allgemeinen Arbeitsgeschwindigkeit.</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>
<file path="1.6/Languages/German/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <NoTool>Kein Werkzeug</NoTool>
    <ToolInUse>(im Gebrauch)</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>Überlebenswerkzeuge</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>Grundeinstellungen</Settings_BasicSection>
    <Settings_DebugSection>Debug-Einstellungen</Settings_DebugSection>
    <Settings_HardcoreMode>Hardcore-Modus</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>Erhöht die Schwierigkeit erheblich, indem Werkzeuge für das Überleben unverzichtbar werden. Ohne geeignete Werkzeuge können Kolonisten die meisten Arbeitsaufgaben nicht effektiv ausführen. Werkzeuge verschleißen auch 50% schneller und erfordern häufigeren Austausch und besseres Werkzeugmanagement. Verwandelt das Spiel in eine echte werkzeugabhängige Überlebenserfahrung.</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>Extrem-Hardcore-Modus</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>MAXIMALE SCHWIERIGKEIT: Die ultimative Überlebensherausforderung. In Kombination mit dem Hardcore-Modus werden Kolonisten ohne die richtigen Werkzeuge völlig hilflos. Aufgaben, die nur ineffizient waren (wie Reinigung von Hand oder improvisierte medizinische Versorgung), werden unmöglich zu versuchen. Werkzeuge verschleißen 87,5% schneller als normal und erzeugen ständigen Druck für Werkzeugproduktion und -wartung. Verwenden Sie die Kontrollkästchen unten, um genau zu steuern, welche Arbeitstypen werkzeugabhängig werden. WARNUNG: Das frühe Spiel wird extrem herausfordernd - Werkzeugbeschaffung wird kritisch für das Kolonieüberleben!</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>Reinigungswerkzeuge erforderlich</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>Zwingt Kolonisten, geeignete Reinigungswerkzeuge (wie Besen oder Wischmöpps) für alle Reinigungsaufgaben zu verwenden. Ohne die richtigen Werkzeuge können sie keine Böden reinigen, Schmutz entfernen oder Schnee räumen. Unverzichtbar für die Aufrechterhaltung der Koloniehygiene in extremen Schwierigkeitsmodi.</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>Schlachterwerkzeuge erforderlich</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>Verlangt geeignete Schneidwerkzeuge (wie Messer oder Hackmesser) für alle Schlachtungs- und Tötungsoperationen. Kolonisten können ohne geeignete Klingen kein Fleisch verarbeiten oder Tiere schlachten. Kritisch für Nahrungsproduktionsketten in Hardcore-Szenarien.</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>Medizinische Werkzeuge erforderlich</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>Erzwingt die Verwendung spezialisierter medizinischer Instrumente für chirurgische Eingriffe und fortgeschrittene medizinische Versorgung. Operationen werden ohne geeignete chirurgische Werkzeuge unmöglich, wodurch die Beschaffung medizinischer Ausrüstung für Koloniegesundheit und Überleben lebenswichtig wird.</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>Werkzeuge in verfallenen Gebäuden</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>Erzeugt grundlegende Überlebenswerkzeuge in antiken Ruinen und abgestürzten Strukturen während der Kartengenerierung. Diese verwitterten Werkzeuge bieten wichtige Ressourcen für das frühe Spiel, sind aber typischerweise von geringer Qualität. Unschätzbar wertvoll für startende Kolonien in harten Schwierigkeitsmodi, wo anfänglicher Werkzeugzugang kritisch ist.</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>Werkzeugtragelimit</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>Beschränkt Kolonisten darauf, maximal 2-3 Werkzeuge gleichzeitig in ihrem Inventar zu tragen (außer Karawanenreisen). Erzwingt strategisches Werkzeugmanagement und Spezialisierung unter Kolonisten. Werkzeuggürtel und ähnliche Ausrüstung können dieses Limit über den Grundwert hinaus erhöhen. Fügt realistische Inventarbeschränkungen zur Werkzeugnutzung hinzu.</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>Werkzeugverschleißrate</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>Automatische Werkzeugoptimierung</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>Ermöglicht intelligentes Werkzeugmanagement, bei dem Kolonisten automatisch die effektivsten Werkzeuge für ihre zugewiesene Arbeit auswählen und tragen. Sie upgraden zu besseren Werkzeugen und lassen schlechtere fallen, wie benötigt. Deaktivieren Sie dies, wenn Sie manuelle Werkzeugkontrolle bevorzugen oder Leistungsprobleme mit modierten Materialien erleben.</Settings_ToolOptimization_Tooltip>
    <Settings_PickupFromStorageOnly>Werkzeugaufnahme auf Lagerbereiche beschränken</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>Wenn aktiviert, erhalten Kolonisten nur Werkzeuge aus bestimmten Lagerzonen, wodurch bessere Organisation gewährleistet und verhindert wird, dass sie Werkzeuge aus Arbeitsbereichen greifen. Wenn deaktiviert, können sie jedes zugängliche Werkzeug im Heimbereich aufheben (außer verbotene oder brennende Gegenstände), was mehr Flexibilität bietet, aber weniger Kontrolle.</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_DebugLogging>Detaillierte Debug-Protokollierung aktivieren</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>Aktiviert umfassende Protokollierung von Werkzeugauswahlentscheidungen, automatischem Aufnahmeverhalten und Job-Werkzeug-Matching-Logik. Wesentlich für die Fehlerbehebung bei Werkzeugproblemen oder das Verstehen, warum Kolonisten bestimmte Werkzeuge wählen. Nur für Mod-Entwicklung oder bei werkzeugbezogenen Problemen empfohlen. Kann die Leistung mit umfangreicher Protokollausgabe beeinträchtigen.</Settings_DebugLogging_Tooltip>
    <Settings_AutoTool>Intelligente Werkzeugaufnahme vor der Arbeit</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>Revolutioniert die Workflow-Effizienz, indem Kolonisten automatisch das optimale Werkzeug erhalten, bevor sie mit einer Arbeit beginnen. Sie tauschen intelligent Werkzeuge aus, upgraden zu besseren Varianten und sorgen dafür, dass sie die richtige Ausrüstung für maximale Produktivität haben. Die Grundlagenfunktion für nahtloses werkzeugbasiertes Gameplay.</Settings_AutoTool_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>Kolonist benötigt unverzichtbare Werkzeuge</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>Kolonisten benötigen unverzichtbare Werkzeuge</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>Diese Kolonisten benötigen geeignete Werkzeuge für ihre zugewiesene Arbeit, aber ihnen fehlt die notwendige Ausrüstung. Ihre Produktivität ist schwer beeinträchtigt.</ColonistNeedsSurvivalToolDesc>
    <SurvivalToolsNeedReplacing>Werkzeuge nähern sich dem Versagen</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>Diese Kolonisten verwenden Werkzeuge, die bald brechen werden. Ersetzen Sie sie sofort, um Arbeitsunterbrechungen zu vermeiden.</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>Werkzeugzuweisungen verwalten</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>Werkzeugzuweisung</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>Bauarbeiter</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>Bergarbeiter</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>Pflanzenarbeiter</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>Forscher</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>Reiniger</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>Medizinisch</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>Schlachter</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>Werkzeugzuweisung auswählen...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>Neue Werkzeugzuweisung</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>Werkzeugzuweisung löschen...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>Werkzeugzuweisung wird von {0} verwendet</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>Keine Werkzeugzuweisung ausgewählt</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>Erzwungene Werkzeuge</ForcedSurvivalTools>
    <!-- Settings -->
    <Settings_CompatLogging>Kompatibilitäts-Debug-Protokollierung aktivieren</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Aktiviert detaillierte Protokollierung für Mod-Kompatibilitätssysteme einschließlich Research Reinvented Integration, Statistikerkennung und WorkGiver-Verkabelung. Zeigt schrittweise Kompatibilitäts-Setup und Integrationsprozesse. Wird nur angezeigt, wenn die allgemeine Debug-Protokollierung aktiviert ist. Nützlich zur Diagnose von Problemen mit Mod-Interaktionen.</Settings_CompatLogging_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Klicken Sie auf die Schaltfläche unten, um das erweiterte, größenveränderbare Einstellungsfenster mit allen Mod-Optionen zu öffnen.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Erweiterte Einstellungen Öffnen</Settings_OpenEnhancedButton>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>Arbeitstypen</JobTable_JobTypes>
    <JobTable_JobType>Arbeitstyp</JobTable_JobType>
    <JobTable_NormalMode>Normaler Modus</JobTable_NormalMode>
    <JobTable_HardcoreMode>Hardcore-Modus</JobTable_HardcoreMode>
    <JobTable_ExtraHardcore>Extrem-Hardcore</JobTable_ExtraHardcore>
    <JobTable_Enhanced>Verbessert</JobTable_Enhanced>
    <JobTable_Required>Erforderlich</JobTable_Required>
    <JobTable_NoJobsFound>Keine werkzeugverbesserten Arbeiten gefunden.</JobTable_NoJobsFound>
    <JobTable_SectionTitle>Werkzeuganforderungen nach Modus</JobTable_SectionTitle>
    <JobTable_SectionTooltip>Diese Tabelle zeigt, wie sich verschiedene Arbeitstypen in jedem Schwierigkeitsmodus verhalten. 'Verbessert' bedeutet, dass Werkzeuge Boni bieten, aber nicht erforderlich sind. 'Erforderlich' bedeutet, dass Werkzeuge zur Ausführung der Arbeit notwendig sind. Verwenden Sie dies, um zu verstehen, welche Werkzeuge Ihre Kolonisten basierend auf Ihren aktuellen Einstellungen benötigen.</JobTable_SectionTooltip>
    <!-- Job Table Headers -->
    <JobTable_Normal>Normal</JobTable_Normal>
    <JobTable_Hardcore>Hardcore</JobTable_Hardcore>
    <JobTable_ExtraHardcore>Extra Hardcore</JobTable_ExtraHardcore>
    <!-- Pacifist Tool Settings -->
    <Settings_AllowPacifistEquip>Pazifisten das Ausrüsten von Überlebenswerkzeugen erlauben</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>Erlaubt pazifistischen Kolonisten, Überlebenswerkzeuge auszurüsten, die als Waffen klassifiziert sind (wie Äxte, Spitzhacken oder Messer). Obwohl diese Werkzeuge Kampffähigkeiten haben, sind sie für Arbeitsaufgaben wie Baumfällung, Bergbau oder Nahrungszubereitung unverzichtbar. Wenn aktiviert, können Pazifisten diese Werkzeuge für produktive Arbeit verwenden, während sie sich weiterhin weigern, sich an Gewalt zu beteiligen.</Settings_AllowPacifistEquip_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Klicken Sie auf die Schaltfläche unten, um das erweiterte, in der Größe veränderbare Einstellungsfenster mit allen Mod-Optionen zu öffnen.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Erweiterte Einstellungen Öffnen</Settings_OpenEnhancedButton>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>Neu Erfundene Forschung</Compat_ResearchReinvented>
    <Compat_FieldResearch>Feldforschung</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>Neu Erfundene Forschung</Compat_ReinventedResearchAlert>
    <!-- WorkSpeedGlobal Konfiguration (hinzugefügt) -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>Konfiguration allgemeine Arbeitsgeschwindigkeit</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>Wählen Sie, welche Arbeiten, die die allgemeine Arbeitsgeschwindigkeits-Stat verwenden, durch Überlebenswerkzeuge begrenzt werden sollen. Nicht begrenzte Arbeiten ignorieren Werkzeugstrafen ohne passende Werkzeuge.</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>Arbeitstyp</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>Begrenzt</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>Beschreibung</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>Keine allgemeinen Arbeitsgeschwindigkeits-Jobs gefunden.</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>Alle aktivieren</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>Alle deaktivieren</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>Standard wiederherstellen</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>WorkGivers protokollieren</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>Benötigt Werkzeuge in Hardcore-Modi</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>Keine Werkzeugstrafen</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>Allgemeine Arbeitsgeschwindigkeits-Jobs konfigurieren</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (hinzugefügt) -->
    <JobTable_NoActiveMode>Kein aktiver Modus ausgewählt.</JobTable_NoActiveMode>
    <JobTable_GatedFormat>Begrenzt ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>Begrenzt (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>Unbekannt</JobTable_Status_Unknown>
    <JobTable_Blocked>Blockiert</JobTable_Blocked>
</LanguageData>
</file>
<file path="1.6/Languages/Japanese/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>斧</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>効率的な伐採作業のために設計された基本的な林業工具。重みのある刃頭が強力な切断力を発揮し、木材作業に従事する入植者にとって不可欠な道具です。バランスとレバレッジにより、即席の切断方法よりもはるかに優れた性能を発揮します。生存が求められる時には信頼できる近接武器としても機能します。</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>つるはし</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>頑丈な柄に取り付けられた重く尖った頭部を特徴とする必須の採掘道具。固い岩を破砕し、貴重な材料を効率的に抽出するために特別に設計されています。集中した力とレバレッジは生産的な採掘作業に不可欠です。状況が必要とする時には即席の武器としても使用できます。</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>ハンマー</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>あらゆる建設プロジェクトの基礎となる工具。この多目的ハンマーは、留め具の打ち込み、材料の成形、構造物の組み立てに必要な精度と力を提供します。建設・保守作業に従事する入植者にとって不可欠です。バランスの取れた設計により、長時間の建設作業中の疲労を最小限に抑えながら効果的な打撃を確保します。</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>鎌</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>作物の収穫と植物材料の切断のために完璧に設計された湾曲した切断刃を特徴とする専門的な農業工具。人間工学的設計により、ユーザーの負担を軽減しながら効率的で反復的な切断動作を可能にします。生産的な農業運営と植物保守作業に不可欠です。</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>鍬</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>土壌準備と種子植え付けのために設計された基本的な農業器具。尖った設計により土を効率的に破砕し、最適な植え付け条件を作り出します。生産的な農業運営の確立と作物収量の維持に不可欠です。頑丈な構造により、季節を通じて信頼できる性能を保証します。</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>ナイフ</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>精密作業に不可欠な鋭い刃を持つ多目的切断器具。食肉解体作業、医療処置、一般的な切断作業に最適です。バランスの取れた設計により制御された正確な切断を可能にし、鋭い刃がきれいな作業を保証します。真剣な入植者にとって不可欠な工具です。</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>手鋸</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>手動での木材加工のために設計された精密に切断された歯を持つ金属刃を特徴とする伝統的な木工工具。カスタムカットされた木材と詳細な木工を必要とする建設プロジェクトに不可欠です。手鋸の安定したリズムは電動工具よりも時間がかかるかもしれませんが、優れた制御と精度を提供します。</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>骨の鎌</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>研がれた縁を持つ彫刻された骨から作られた原始的な収穫工具。金属版ほど耐久性はありませんが、この伝統的な器具は作物の収穫と植物の切断に見事に役立ちます。湾曲した設計は、数え切れない世代の農業作業を通じて効果が証明された古代のパターンに従っています。</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>バール</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>耐久性のある材料から作られた原始的だが効果的なレバレッジ工具。構造物の解体、材料の分離、基本的な機械操作の実行に不可欠です。先進技術なしに建設・解体作業の実用的な解決策を開発する初期文明の創意工夫を表しています。</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>そろばん</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>算術演算を実行するためにロッドに配置された可動ビーズを特徴とする古代の計算器具。研究データの整理、複雑な計算の管理、先進的な計算装置のない社会での正確な記録の維持に不可欠です。数学的思考とデータ組織の基礎を表しています。</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>鋼鉄ナイフ</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>優れた刃保持力と耐久性を持つ精密鍛造された鋼鉄ナイフ。高炭素鋼の刃は広範囲な使用を通じてその鋭さを維持し、要求の厳しい食肉解体と医療作業に理想的です。人間工学的なハンドルは繊細な作業での優れた制御を提供します。</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>横挽き鋸</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>効率的な木材加工と建設作業のために設計された精密工業用鋸。特別に設計された歯と強化された鋼構造により、様々な材料を通じてきれいで正確な切断を可能にします。大規模建設プロジェクトと先進的な木工作業に不可欠です。</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>レンチ</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>留め具と機械部品の把持、回転、操作のために設計された精密機械工具。保守作業、機械修理、正確な調整を必要とする建設プロジェクトに重要です。調整可能なジョー設計により、最適なレバレッジと制御を提供しながら様々なサイズに対応します。</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>顕微鏡</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>小さな物体と標本を詳細に検査するために拡大する精密光学器具。先進的な研究、生物学的研究、科学的分析に不可欠です。</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>カーバイドつるはし</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>最も要求の厳しい掘削作業を通じてその鋭さを維持するカーバイド先端刃を特徴とする先進的な採掘器具。精密設計された頭部は標準工具よりも効率的に岩を切断し、強化された構造は過酷な採掘条件での例外的な耐久性を保証します。</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>精密メス</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>最高級の鋼合金から作られた超鋭利な外科器具。慎重にバランス調整された刃は繰り返しの殺菌と使用を通じてその刃を維持し、人間工学的なハンドルは繊細な医療処置中の精密な制御を保証します。先進的な医療施設の標準設備です。</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>電動ドリル</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>内蔵モーターによって駆動され、精度と速度で堅い材料を穿孔できる機械化された穿孔工具。可変速度モーターと交換可能なビットにより、建設と機械作業に非常に貴重です。モーターをスムーズに動作させ続けるために定期的なメンテナンスが必要です。</SurvivalTools_PowerDrill.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>グリッターワールドマルチツール</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>グリッターワールド社会で家庭用メカノイドによって一般的に使用される高技術汎用工具。この先進的な装置は、建設、採掘、林業、保守、解体など、あらゆる作業にシームレスに適応でき、究極のオールインワン生存工具となります。メカノイド用に設計されていますが、生理学的類似性により人間型にも完全に使用可能です。</SurvivalTools_Multitool.description>
    <SurvivalTools_PileOfRags.label>ぼろ布の山</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>ぼろ布と布切れで作られたシンプルな清掃道具。基本的な清掃作業には有用ですが、すぐに摩耗します。</SurvivalTools_PileOfRags.description>
    <!-- =================================================== -->
    <!-- 汎用多目的作業ツール (WorkSpeedGlobal)             -->
    <!-- 新規ツール定義のローカライズ                       -->
    <!-- =================================================== -->
    <!-- 部族 / 原始ティア -->
    <SurvivalTools_MultipurposeStoneTool.label>多目的石器</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>多くの一般作業をカバーする形状に整えられた頑丈で多用途な石製器具。原始的ではあるが、全体的な作業速度をわずかに高める。</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>彫刻骨製用具束</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>丁寧に彫刻された複数の骨製小道具を束ねた多目的セット。脆いが効率的な形状で、一般作業速度に目立つ向上を与える。</SurvivalTools_CarvedBoneImplements.description>
    <!-- 中世ティア -->
    <SurvivalTools_ArtisansToolkit.label>職人工具セット</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>製作・整形・組立のために厳選された中世期品質の工具コレクション。多数の作業全体の処理スループットを向上させる。</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>木工職人工具キット</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>木材成形と仕口作業に最適化された鋸・鑿・鉋・ゲージ類の専門アソート。整理と品質により一般作業速度へ強力なボーナスを付与。</SurvivalTools_WoodworkersKit.description>
    <!-- 産業ティア -->
    <SurvivalTools_MechanicsToolkit.label>整備技師ツールキット</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>精密レンチ、ゲージ、トルク用具と迅速アクセス収納を収めた産業期の整理済みキット。一般タスクの流れと連携を大幅に改善する。</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>工房用ヘビーデューティーハンマードリル</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>打撃と回転モジュールを交換可能な重作業用動力ハンマードリル。統合されたクランプとアライメント機構がほぼ全ての機械/建設タスクを加速する。</SurvivalTools_WorkshopHammerDrill.description>
    <!-- スペーサー / 超先進ティア -->
    <SurvivalTools_NanofabricatorInterface.label>ナノファブリケータ・インターフェース</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>ユーザーの動作を適応型ナノ組立ルーチンと同期させる流線型の制御・強化モジュール。一般タスク遂行効率を劇的に向上させる。</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>オムニツール・ガントレット</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>フィールドプロジェクタ、マイクロファブリケータ、力整列マニピュレータを内蔵した最先端モジュラーガントレット。予測的最適化により一般作業速度を比類なきほど引き上げる。</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>
<file path="1.6/Languages/Japanese/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <NoTool>ツールなし</NoTool>
    <ToolInUse>（使用中）</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>サバイバルツール</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>基本設定</Settings_BasicSection>
    <Settings_DebugSection>デバッグ設定</Settings_DebugSection>
    <Settings_HardcoreMode>ハードコアモード</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>ツールを生存に不可欠なものにして、難易度を大幅に向上させます。適切なツールがないと、入植者はほとんどの作業タスクを効果的に実行できなくなります。ツールの摩耗も50%速くなり、より頻繁な交換とより良いツール管理が必要になります。ゲームを真のツール依存のサバイバル体験に変えます。</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>エクストリームハードコアモード</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>最大難易度：究極のサバイバルチャレンジ。ハードコアモードと組み合わせると、入植者は適切なツールなしに完全に無力になります。単に非効率だったタスク（手作業での清掃や即席の医療ケア）が試行不可能になります。ツールは通常よりも87.5%速く劣化し、ツール製造と保守に継続的な圧力をかけます。下のチェックボックスでどの作業タイプがツール依存になるかを正確に制御してください。警告：初期ゲームが極めて困難になります - ツールの獲得がコロニーの生存に重要になります！</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>清掃ツールが必要</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>すべての清掃タスクで適切な清掃ツール（ほうきやモップなど）の使用を強制します。適切なツールがないと、床を清掃したり、汚れを除去したり、雪を片付けたりできません。極端な難易度モードでコロニーの衛生を維持するために不可欠です。</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>屠畜ツールが必要</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>すべての屠畜と殺処分作業で適切な切断ツール（ナイフや肉切り包丁など）を義務付けます。適切な刃物がないと、入植者は肉を処理したり動物を殺処分したりできません。ハードコアシナリオでの食料生産チェーンに重要です。</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>医療ツールが必要</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>外科手術と高度な医療ケアで専門の医療器具の使用を強制します。適切な手術ツールがないと手術が不可能になり、医療機器の獲得をコロニーの健康と生存に不可欠にします。</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>廃墟の建物にツール</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>マップ生成中に古代の廃墟や墜落した構造物に基本的なサバイバルツールを生成します。これらの風化したツールは重要な初期ゲームリソースを提供しますが、通常は低品質です。初期ツールアクセスが重要な厳しい難易度モードでコロニーを開始するのに非常に価値があります。</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>ツール携帯制限</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>入植者が同時にインベントリに運べるツールを最大2-3個に制限します（キャラバン旅行を除く）。入植者間での戦略的ツール管理と専門化を強制します。ツールベルトと類似の装備はこの制限を増加させることができます。ツール使用に現実的なインベントリ制約を追加します。</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>ツール劣化率</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>自動ツール最適化</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>入植者が割り当てられた作業のために最も効果的なツールを自動的に選択して運ぶインテリジェントツール管理を有効にします。必要に応じてより良いツールにアップグレードし、劣ったツールを落とします。手動ツール制御を好むか、モッド材料でパフォーマンスの問題を経験する場合はこれを無効にしてください。</Settings_ToolOptimization_Tooltip>
    <Settings_PickupFromStorageOnly>ストレージエリアからのツール取得制限</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>有効にすると、入植者は指定されたストレージゾーンからのみツールを取得し、より良い組織を維持し、作業エリアからツールを掴むのを防ぎます。無効にすると、ホームエリア内のアクセス可能なツール（禁止されたアイテムや燃えているアイテムを除く）を拾うことができ、より柔軟性を提供しますが制御は少なくなります。</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_DebugLogging>詳細デバッグログを有効</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>ツール選択決定、自動取得行動、ジョブ-ツールマッチングロジックの包括的なログ記録を有効にします。ツールの問題のトラブルシューティングや入植者が特定のツールを選ぶ理由を理解するために不可欠です。モッド開発やツール関連の問題を経験している場合のみ推奨します。広範なログ出力でパフォーマンスに影響する可能性があります。</Settings_DebugLogging_Tooltip>
    <Settings_AutoTool>スマート作業前ツール取得</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>入植者が任意の仕事を始める前に自動的に最適なツールを取得することで、ワークフロー効率を革命的に改善します。ツールをインテリジェントに交換し、より良いバリエーションにアップグレードし、最大生産性のために適切な機器を確保します。シームレスなツールベースのゲームプレイの基盤機能です。</Settings_AutoTool_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>入植者が必要なツールを欠いている</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>入植者が必要なツールを欠いている</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>これらの入植者は割り当てられた作業に適切なツールが必要ですが、必要な機器がありません。生産性が深刻に損なわれています。</ColonistNeedsSurvivalToolDesc>
    <SurvivalToolsNeedReplacing>ツールが故障近い</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>これらの入植者は間もなく壊れる危険な状態のツールを使用しています。作業中断を避けるため即座に交換してください。</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>ツール割り当て管理</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>ツール割り当て</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>建設者</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>採掘者</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>植物作業者</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>研究者</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>清掃者</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>医療</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>屠畜者</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>ツール割り当てを選択...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>新しいツール割り当て</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>ツール割り当てを削除...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>ツール割り当ては{0}によって使用されています</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>ツール割り当てが選択されていません</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>強制ツール</ForcedSurvivalTools>
    <!-- Settings -->
    <Settings_CompatLogging>互換性デバッグログを有効にする</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Research Reinvented統合、統計検出、WorkGiver配線を含むMOD互換性システムの詳細ログを有効にします。互換性設定と統合プロセスのステップバイステップを表示します。一般的なデバッグログが有効な場合にのみ表示されます。MODの相互作用の問題の診断に役立ちます。</Settings_CompatLogging_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>下のボタンをクリックして、すべてのモッドオプションを含む拡張されたリサイズ可能な設定ウィンドウを開いてください。</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>拡張設定を開く</Settings_OpenEnhancedButton>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>ジョブタイプ</JobTable_JobTypes>
    <JobTable_JobType>ジョブタイプ</JobTable_JobType>
    <JobTable_Normal>ノーマル</JobTable_Normal>
    <JobTable_Hardcore>ハードコア</JobTable_Hardcore>
    <JobTable_NormalMode>ノーマルモード</JobTable_NormalMode>
    <JobTable_HardcoreMode>ハードコアモード</JobTable_HardcoreMode>
    <JobTable_ExtraHardcore>エクストリームハードコア</JobTable_ExtraHardcore>
    <JobTable_Enhanced>強化</JobTable_Enhanced>
    <JobTable_Required>必須</JobTable_Required>
    <JobTable_NoJobsFound>ツール強化されたジョブが見つかりませんでした。</JobTable_NoJobsFound>
    <JobTable_SectionTitle>モード別ジョブツール要件</JobTable_SectionTitle>
    <JobTable_SectionTooltip>このテーブルは、各難易度モードで異なるジョブタイプがどのように動作するかを示します。「強化」はツールがボーナスを提供するが必須ではないことを意味します。「必須」はジョブを実行するためにツールが必要であることを意味します。現在の設定に基づいて入植者にどのツールが必要かを理解するためにこれを使用してください。</JobTable_SectionTooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>下のボタンをクリックして、すべてのMODオプションを含む拡張されたサイズ変更可能な設定ウィンドウを開きます。</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>拡張設定を開く</Settings_OpenEnhancedButton>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>研究再発明</Compat_ResearchReinvented>
    <Compat_FieldResearch>フィールド研究</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>研究再発明</Compat_ReinventedResearchAlert>
    <!-- Pacifist Tool Settings -->
    <Settings_AllowPacifistEquip>平和主義者がサバイバルツールを装備することを許可</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>武器として分類されているサバイバルツール（斧、つるはし、ナイフなど）を平和主義の入植者が装備することを許可します。これらのツールは戦闘能力を持っていますが、木の伐採、採掘、食料準備などの作業タスクに不可欠です。有効にすると、平和主義者は暴力に関与することを拒否しながら、生産的な作業にこれらのツールを使用できます。</Settings_AllowPacifistEquip_Tooltip>
    <!-- WorkSpeedGlobal 設定（追加） -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>一般作業速度ジョブ設定</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>「一般作業速度」ステータスを使用するジョブのうち、生存ツールによる制限（ゲート）対象にするものを選択します。制限されていないジョブは適切なツールがなくてもペナルティを受けません。</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>ジョブタイプ</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>制限</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>説明</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>一般作業速度ジョブが見つかりません。</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>全て有効</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>全て無効</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>デフォルトに戻す</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>WorkGiverをトレース</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>ハードコア系モードでツール必須</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>ツールペナルティなし</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>一般作業速度ジョブを設定</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (追加) -->
    <JobTable_NoActiveMode>有効なモードが選択されていません。</JobTable_NoActiveMode>
    <JobTable_GatedFormat>制限 ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>制限 (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>不明</JobTable_Status_Unknown>
    <JobTable_Blocked>ブロック</JobTable_Blocked>
</LanguageData>
</file>
<file path="1.6/Languages/Russian/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>топор</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>Базовый лесохозяйственный инструмент, предназначенный для эффективной рубки леса. Его тяжелая головка обеспечивает мощную силу удара, что делает его незаменимым инструментом для колонистов, занимающихся работой с древесиной. Его баланс и рычажный эффект делают его гораздо более эффективным, чем импровизированные методы резки. Также служит надежным оружием ближнего боя, когда выживание того требует.</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>кирка</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>Важный горнодобывающий инструмент с тяжелой острой головкой, прикрепленной к прочной рукоятке. Специально разработан для разбивания твердых пород и эффективного извлечения ценных материалов. Его концентрированная сила и рычажный эффект необходимы для продуктивных горнодобывающих операций. Также может служить импровизированным оружием, когда обстоятельства того требуют.</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>молоток</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>Основной инструмент для любого строительного проекта. Этот универсальный молоток обеспечивает точность и силу, необходимые для забивания креплений, формирования материалов и сборки конструкций. Незаменим для колонистов, занимающихся строительными и ремонтными работами. Его сбалансированная конструкция обеспечивает эффективные удары при минимальной усталости во время продолжительных строительных работ.</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>серп</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>Специализированный сельскохозяйственный инструмент с изогнутым лезвием, идеально подходящим для сбора урожая и резки растительного материала. Его эргономичная конструкция позволяет эффективные повторяющиеся режущие движения с минимальным напряжением для пользователя. Незаменим для продуктивных сельскохозяйственных операций и работ по уходу за растениями.</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>мотыга</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>Базовый сельскохозяйственный инструмент, предназначенный для подготовки почвы и посадки семян. Его заостренная конструкция эффективно разбивает почву, создавая оптимальные условия для посадки. Незаменим для создания продуктивных сельскохозяйственных операций и поддержания урожайности. Его прочная конструкция обеспечивает надежную работу в течение сезонов.</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>нож</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>Универсальный режущий инструмент с острым лезвием, незаменимый для точных работ. Идеален для мясницких работ, медицинских процедур и общих задач по резке. Его сбалансированная конструкция позволяет контролируемые точные разрезы, а острое лезвие обеспечивает чистую работу. Незаменимый инструмент для любого серьезного колониста.</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>ручная пила</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>Традиционный деревообрабатывающий инструмент с металлическим лезвием с точно нарезанными зубьями для ручной обработки дерева. Незаменим для строительных проектов, требующих пиломатериалов по индивидуальному заказу и детальной деревообработки. Равномерный темп ручной пилы может занять больше времени, чем электроинструменты, но обеспечивает отличный контроль и точность.</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>костяной серп</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>Примитивный инструмент для сбора урожая, изготовленный из резной кости с заточенным краем. Хотя он не такой прочный, как его металлические аналоги, этот традиционный инструмент превосходно служит для сбора урожая и резки растений. Его изогнутая конструкция следует древним образцам, которые доказали свою эффективность через бесчисленные поколения сельскохозяйственных работ.</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>лом</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>Примитивный, но эффективный рычажный инструмент, изготовленный из прочных материалов. Незаменим для разборки конструкций, разделения материалов и выполнения основных механических операций. Представляет изобретательность ранних цивилизаций в разработке практических решений для строительных и демонтажных работ без передовых технологий.</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>счёты</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>Древний вычислительный инструмент с подвижными бусинами, расположенными на стержнях для выполнения арифметических операций. Незаменим для организации исследовательских данных, управления сложными вычислениями и ведения точных записей в обществах без передовых вычислительных устройств. Представляет основу математического мышления и организации данных.</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>стальной нож</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>Точно кованый стальной нож с превосходным удержанием остроты и долговечностью. Лезвие из углеродистой стали сохраняет остроту при интенсивном использовании, что делает его идеальным для требовательных мясницких и медицинских работ. Эргономичная рукоятка обеспечивает отличный контроль при тонких работах.</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>поперечная пила</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>Точная промышленная пила, предназначенная для эффективной обработки дерева и строительных работ. Её специально разработанные зубья и усиленная стальная конструкция позволяют делать чистые точные разрезы через различные материалы. Незаменима для крупных строительных проектов и продвинутых деревообрабатывающих работ.</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>гаечный ключ</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>Точный механический инструмент, предназначенный для захвата, поворота и манипулирования крепежными элементами и механическими компонентами. Критически важен для ремонтных работ, ремонта машин и строительных проектов, требующих точной настройки. Система регулируемых губок приспосабливается к различным размерам, обеспечивая оптимальный рычажный эффект и контроль.</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>микроскоп</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>Точный оптический инструмент, который увеличивает мелкие объекты и образцы для детального изучения. Незаменим для передовых исследований, биологических исследований и научного анализа.</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>карбидная кирка</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>Передовой горнодобывающий инструмент с карбидным наконечником, который сохраняет остроту при самых требовательных раскопочных работах. Точно спроектированная головка режет породу более эффективно, чем стандартные инструменты, а его усиленная конструкция обеспечивает исключительную долговечность в суровых горнодобывающих условиях.</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>точный скальпель</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>Ультра-острый хирургический инструмент, изготовленный из высококачественных стальных сплавов. Тщательно сбалансированное лезвие сохраняет остроту при повторной стерилизации и использовании, а эргономичная рукоятка обеспечивает точный контроль во время тонких медицинских процедур. Стандартное оборудование для передовых медицинских учреждений.</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>электрическая дрель</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>Механизированный буровой инструмент, приводимый в действие встроенным двигателем, способный сверлить твердые материалы с точностью и скоростью. Двигатель с переменной скоростью и сменные биты делают его чрезвычайно ценным для строительных и механических работ. Требует регулярного обслуживания для поддержания двигателя в рабочем состоянии.</SurvivalTools_PowerDrill.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>мультитул глиттермира</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>Высокотехнологичный универсальный инструмент, обычно используемый домашними механоидами в обществах глиттермира. Это передовое устройство легко адаптируется к любой задаче - строительство, добыча полезных ископаемых, лесное хозяйство, техническое обслуживание, снос - что делает его идеальным универсальным инструментом выживания. Хотя он разработан для механоидов, он полностью пригоден для использования гуманоидами из-за физиологических сходств.</SurvivalTools_Multitool.description>
    <SurvivalTools_PileOfRags.label>груда тряпок</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>Простой инструмент для уборки, изготовленный из тряпок и кусков ткани. Полезен для основных задач по уборке, но быстро изнашивается.</SurvivalTools_PileOfRags.description>
    <!-- =================================================== -->
    <!-- МНОГОФУНКЦИОНАЛЬНЫЕ ОБЩИЕ ИНСТРУМЕНТЫ (WorkSpeedGlobal) -->
    <!-- Новые определения требуют локализации                 -->
    <!-- =================================================== -->
    <!-- Племенной / Примитивный уровень -->
    <SurvivalTools_MultipurposeStoneTool.label>многоцельной каменный инструмент</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>Прочный универсальный каменный инструмент, обтёсанный для покрытия множества общих задач. Примитивен, но слегка повышает общую скорость работы.</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>набор резных костяных принадлежностей</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>Набранный вместе комплект аккуратно вырезанных костяных приспособлений для многоцелевого применения. Хрупок, но эффективная форма даёт заметный прирост общей скорости работы.</SurvivalTools_CarvedBoneImplements.description>
    <!-- Средневековый уровень -->
    <SurvivalTools_ArtisansToolkit.label>набор инструментов ремесленника</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>Курированный набор качественных инструментов средневековой эпохи для изготовления, формования и сборки. Повышает общий пропуск множества задач.</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>набор столяра</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>Специализированный набор пил, стамесок, рубанков и шаблонов, оптимизированных под обработку древесины и соединения. Организация и качество дают сильный бонус к общей скорости.</SurvivalTools_WoodworkersKit.description>
    <!-- Индустриальный уровень -->
    <SurvivalTools_MechanicsToolkit.label>инструментальный набор механика</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>Организованный индустриальный комплект с точными ключами, измерительными приборами, моментными инструментами и быстрой системой хранения. Сильно улучшает поток и координацию общих задач.</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>мастерская ударная дрель</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>Тяжёлая приводная ударная дрель со сменными ударными и вращательными модулями. Интегрированная система зажима и выравнивания ускоряет почти любую механическую или строительную задачу.</SurvivalTools_WorkshopHammerDrill.description>
    <!-- Ультра-тех / Космический уровень -->
    <SurvivalTools_NanofabricatorInterface.label>интерфейс нано-фабрикатора</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>Обтекаемый модуль управления и усиления, синхронизирующий движения пользователя с адаптивными nano-сборочными процедурами. Радикально повышает эффективность выполнения общих задач.</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>перчатка омни-инструмент</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>Передовая модульная перчатка с полевыми проекторами, микро-фабрикаторами и силовыми манипуляторами. Обеспечивает непревзойдённый рост общей скорости работы через предиктивную оптимизацию.</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>
<file path="1.6/Languages/Russian/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <NoTool>Нет инструмента</NoTool>
    <ToolInUse>(используется)</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>Инструменты Выживания</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>Основные настройки</Settings_BasicSection>
    <Settings_DebugSection>Настройки отладки</Settings_DebugSection>
    <Settings_HardcoreMode>Хардкор режим</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>Значительно повышает сложность, делая инструменты жизненно важными для выживания. Без подходящих инструментов колонисты становятся неспособными эффективно выполнять большинство рабочих задач. Инструменты также изнашиваются на 50% быстрее, требуя более частой замены и лучшего управления инструментами. Превращает игру в настоящий зависимый от инструментов опыт выживания.</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>Экстремальный хардкор режим</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>МАКСИМАЛЬНАЯ СЛОЖНОСТЬ: Окончательный вызов выживания. В сочетании с хардкор режимом колонисты становятся полностью беспомощными без правильных инструментов. Задачи, которые были просто неэффективными (как уборка руками или импровизированная медицинская помощь), становятся невозможными для попытки. Инструменты деградируют на 87,5% быстрее обычного, создавая постоянное давление для производства и обслуживания инструментов. Используйте флажки ниже для точного контроля того, какие типы работ становятся зависимыми от инструментов. ПРЕДУПРЕЖДЕНИЕ: Ранняя игра становится чрезвычайно сложной - приобретение инструментов становится критическим для выживания колонии!</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>Требуются инструменты для уборки</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>Принуждает колонистов использовать подходящие инструменты для уборки (такие как метлы или швабры) для всех задач по уборке. Без правильных инструментов они не могут убирать полы, удалять грязь или расчищать снег. Необходимо для поддержания гигиены колонии в экстремальных режимах сложности.</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>Требуются инструменты для разделки</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>Требует подходящие режущие инструменты (такие как ножи или топорики) для всех операций разделки и забоя. Колонисты не могут обрабатывать мясо или забивать животных без подходящих лезвий. Критично для цепочек производства пищи в хардкор сценариях.</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>Требуются медицинские инструменты</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>Принуждает использовать специализированные медицинские инструменты для хирургических процедур и продвинутой медицинской помощи. Операции становятся невозможными без подходящих хирургических инструментов, делая приобретение медицинского оборудования жизненно важным для здоровья и выживания колонии.</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>Инструменты в разрушенных зданиях</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>Генерирует базовые инструменты выживания в древних руинах и разбившихся структурах во время генерации карты. Эти выветренные инструменты предоставляют важные ресурсы ранней игры, но обычно низкого качества. Бесценны для стартующих колоний в жестких режимах сложности, где начальный доступ к инструментам критичен.</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>Лимит переноса инструментов</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>Ограничивает колонистов переносить максимум 2-3 инструмента одновременно в их инвентаре (исключая путешествия каравана). Принуждает к стратегическому управлению инструментами и специализации среди колонистов. Пояса для инструментов и похожее снаряжение могут увеличить этот лимит сверх базового значения. Добавляет реалистичные ограничения инвентаря к использованию инструментов.</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>Скорость деградации инструментов</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>Автоматическая оптимизация инструментов</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>Включает интеллектуальное управление инструментами, где колонисты автоматически выбирают и носят наиболее эффективные инструменты для их назначенной работы. Они улучшают до лучших инструментов и бросают худшие по необходимости. Отключите это, если предпочитаете ручное управление инструментами или испытываете проблемы производительности с модифицированными материалами.</Settings_ToolOptimization_Tooltip>
    <Settings_PickupFromStorageOnly>Ограничить подбор инструментов зонами хранения</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>Когда включено, колонисты будут получать инструменты только из назначенных зон хранения, поддерживая лучшую организацию и предотвращая захват инструментов из рабочих зон. Когда отключено, они могут поднимать любой доступный инструмент в Домашней зоне (исключая запрещенные или горящие предметы), обеспечивая больше гибкости, но меньше контроля.</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_DebugLogging>Включить детальное отладочное логирование</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>Активирует комплексное логирование решений выбора инструментов, автоматического поведения подбора и логики сопоставления работа-инструмент. Необходимо для устранения проблем с инструментами или понимания того, почему колонисты выбирают конкретные инструменты. Рекомендуется только для разработки модов или при проблемах, связанных с инструментами. Может влиять на производительность с обширным выводом логов.</Settings_DebugLogging_Tooltip>
    <Settings_AutoTool>Умный подбор инструментов перед работой</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>Революционизирует эффективность рабочего процесса, заставляя колонистов автоматически получать оптимальный инструмент перед началом любой работы. Они интеллектуально меняют инструменты, улучшают до лучших вариантов и обеспечивают наличие подходящего оборудования для максимальной продуктивности. Основная функция для бесшовного геймплея, основанного на инструментах.</Settings_AutoTool_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>Колонисту не хватает необходимых инструментов</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>Колонистам не хватает необходимых инструментов</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>Этим колонистам нужны подходящие инструменты для назначенной работы, но им не хватает необходимого оборудования. Их продуктивность серьезно скомпрометирована.</ColonistNeedsSurvivalToolDesc>
    <SurvivalToolsNeedReplacing>Инструменты приближаются к поломке</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>Эти колонисты используют инструменты, которые скоро сломаются. Замените их немедленно, чтобы избежать прерывания работы.</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>Управление назначениями инструментов</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>Назначение инструмента</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>Строитель</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>Шахтер</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>Работник растений</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>Исследователь</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>Уборщик</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>Медицинский</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>Мясник</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>Выбрать назначение инструмента...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>Новое назначение инструмента</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>Удалить назначение инструмента...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>Назначение инструмента используется {0}</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>Назначение инструмента не выбрано</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>Принудительные инструменты</ForcedSurvivalTools>
    <!-- Settings -->
    <Settings_CompatLogging>Включить отладочное логирование совместимости</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Активирует подробное логирование для систем совместимости модов, включая интеграцию Research Reinvented, обнаружение статистики и проводку WorkGiver. Показывает пошаговые процессы настройки и интеграции совместимости. Отображается только при включенном общем отладочном логировании. Полезно для диагностики проблем с взаимодействием модов.</Settings_CompatLogging_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Нажмите кнопку ниже, чтобы открыть улучшенное изменяемое окно настроек со всеми опциями мода.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Открыть Улучшенные Настройки</Settings_OpenEnhancedButton>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>Типы работ</JobTable_JobTypes>
    <JobTable_JobType>Тип работы</JobTable_JobType>
    <JobTable_NormalMode>Обычный режим</JobTable_NormalMode>
    <JobTable_HardcoreMode>Хардкор режим</JobTable_HardcoreMode>
    <JobTable_ExtraHardcore>Экстремальный хардкор</JobTable_ExtraHardcore>
    <JobTable_Enhanced>Улучшенный</JobTable_Enhanced>
    <JobTable_Required>Требуется</JobTable_Required>
    <JobTable_NoJobsFound>Не найдено работ, улучшенных инструментами.</JobTable_NoJobsFound>
    <JobTable_SectionTitle>Требования к инструментам по режимам</JobTable_SectionTitle>
    <JobTable_SectionTooltip>Эта таблица показывает, как различные типы работ ведут себя в каждом режиме сложности. 'Улучшенный' означает, что инструменты дают бонусы, но не требуются. 'Требуется' означает, что инструменты необходимы для выполнения работы. Используйте это, чтобы понять, какие инструменты понадобятся вашим колонистам в зависимости от текущих настроек.</JobTable_SectionTooltip>
    <!-- Job Table Headers -->
    <JobTable_Normal>Обычный</JobTable_Normal>
    <JobTable_Hardcore>Хардкор</JobTable_Hardcore>
    <JobTable_ExtraHardcore>Экстра Хардкор</JobTable_ExtraHardcore>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Нажмите кнопку ниже, чтобы открыть расширенное окно настроек с изменяемым размером и всеми опциями мода.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Открыть Расширенные Настройки</Settings_OpenEnhancedButton>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>Исследования Переосмысленные</Compat_ResearchReinvented>
    <Compat_FieldResearch>Полевые Исследования</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>Исследования Переосмысленные</Compat_ReinventedResearchAlert>
    <!-- Pacifist Tool Settings -->
    <Settings_AllowPacifistEquip>Разрешить пацифистам экипировать инструменты выживания</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>Позволяет пацифистским колонистам экипировать инструменты выживания, классифицированные как оружие (такие как топоры, кирки или ножи). Хотя эти инструменты обладают боевыми возможностями, они необходимы для рабочих задач, таких как рубка деревьев, добыча полезных ископаемых или приготовление пищи. При включении пацифисты могут использовать эти инструменты для продуктивной работы, продолжая отказываться от участия в насилии.</Settings_AllowPacifistEquip_Tooltip>
    <!-- WorkSpeedGlobal Конфигурация (добавлено) -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>Конфигурация работ общей скорости</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>Выберите, какие работы, использующие стат общей скорости работы, должны ограничиваться инструментами выживания. Неограниченные работы игнорируют штрафы за отсутствие инструментов.</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>Тип работы</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>Ограничено</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>Описание</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>Работы общей скорости не найдены.</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>Включить все</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>Выключить все</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>Сбросить по умолчанию</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>Трассировать WorkGivers</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>Требует инструменты в хардкор режимах</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>Нет штрафов за инструменты</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>Настроить работы общей скорости</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (добавлено) -->
    <JobTable_NoActiveMode>Не выбран активный режим.</JobTable_NoActiveMode>
    <JobTable_GatedFormat>Ограничено ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>Ограничено (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>Неизвестно</JobTable_Status_Unknown>
    <JobTable_Blocked>Заблокировано</JobTable_Blocked>
</LanguageData>
</file>
<file path="1.6/Languages/Spanish/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>hacha</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>Una herramienta forestal básica diseñada para trabajo eficiente de tala. Su cabeza pesada proporciona fuerza de golpe poderosa, convirtiéndola en una herramienta indispensable para colonos comprometidos con el trabajo de madera. Su equilibrio y efecto de palanca la hacen mucho más efectiva que métodos de corte improvisados. También sirve como un arma cuerpo a cuerpo confiable cuando la supervivencia lo requiere.</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>pico</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>Una herramienta de minería esencial que presenta una cabeza pesada y puntiaguda unida a un mango robusto. Especialmente diseñada para romper roca dura y extraer materiales valiosos de manera eficiente. Su fuerza concentrada y efecto de palanca son esenciales para operaciones mineras productivas. También puede servir como arma improvisada cuando las circunstancias lo requieren.</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>martillo</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>Una herramienta fundamental para cualquier proyecto de construcción. Este martillo versátil proporciona la precisión y fuerza necesarias para clavar sujetadores, dar forma a materiales y ensamblar estructuras. Indispensable para colonos comprometidos con trabajos de construcción y mantenimiento. Su diseño equilibrado asegura golpes efectivos con fatiga mínima durante trabajos de construcción prolongados.</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>hoz</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>Una herramienta agrícola especializada que presenta una hoja curva perfectamente diseñada para cosechar cultivos y cortar material vegetal. Su diseño ergonómico permite movimientos de corte eficientes y repetitivos con tensión mínima en el usuario. Indispensable para operaciones agrícolas productivas y trabajos de mantenimiento de plantas.</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>azada</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>Una herramienta agrícola básica diseñada para preparación del suelo y plantación de semillas. Su diseño puntiagudo rompe el suelo eficientemente, creando condiciones óptimas de plantación. Indispensable para establecer operaciones agrícolas productivas y mantener rendimientos de cultivos. Su construcción resistente asegura rendimiento confiable a través de las estaciones.</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>cuchillo</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>Una herramienta de corte versátil con una hoja afilada indispensable para trabajos de precisión. Ideal para trabajos de carnicería, procedimientos médicos y tareas generales de corte. Su diseño equilibrado permite cortes controlados y precisos, mientras la hoja afilada asegura trabajo limpio. Una herramienta indispensable para cualquier colono serio.</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>sierra de mano</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>Una herramienta de carpintería tradicional que presenta una hoja de metal con dientes cortados precisamente para trabajo manual de madera. Indispensable para proyectos de construcción que requieren madera cortada a medida y trabajo detallado de carpintería. El ritmo constante de una sierra de mano puede tomar más tiempo que herramientas eléctricas, pero ofrece excelente control y precisión.</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>hoz de hueso</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>Una herramienta de cosecha primitiva hecha de hueso tallado con un borde afilado. Aunque no tan duradero como sus contrapartes metálicas, este instrumento tradicional sirve admirablemente para cosechar cultivos y cortar plantas. Su diseño curvo sigue patrones antiguos que han probado su efectividad a través de incontables generaciones de trabajo agrícola.</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>palanca</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>Una herramienta de palanca primitiva pero efectiva hecha de materiales duraderos. Indispensable para desarmar estructuras, separar materiales y realizar operaciones mecánicas básicas. Representa el ingenio de civilizaciones tempranas en desarrollar soluciones prácticas para trabajos de construcción y demolición sin tecnología avanzada.</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>ábaco</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>Un instrumento de cálculo antiguo con cuentas móviles dispuestas en varillas para realizar operaciones aritméticas. Indispensable para organizar datos de investigación, manejar cálculos complejos y mantener registros precisos en sociedades sin dispositivos de cálculo avanzados. Representa la fundación del pensamiento matemático y organización de datos.</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>cuchillo de acero</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>Un cuchillo de acero forjado con precisión con retención de filo superior y durabilidad. La hoja de acero al carbono mantiene su filo a través de uso extensivo, haciéndolo ideal para trabajos exigentes de carnicería y médicos. El mango ergonómico proporciona excelente control para trabajos finos.</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>sierra de tronzar</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>Una sierra industrial de precisión diseñada para trabajo eficiente de carpintería y construcción. Sus dientes especialmente diseñados y construcción de acero reforzado permiten cortes limpios y precisos a través de varios materiales. Indispensable para grandes proyectos de construcción y trabajos avanzados de carpintería.</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>llave inglesa</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>Una herramienta mecánica de precisión diseñada para agarrar, girar y manipular sujetadores y componentes mecánicos. Crucial para trabajos de mantenimiento, reparaciones de máquinas y proyectos de construcción que requieren ajustes precisos. El sistema de mordazas ajustables se adapta a varios tamaños mientras proporciona palanca y control óptimos.</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>microscopio</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>Un instrumento óptico de precisión que magnifica objetos pequeños y muestras para examen detallado. Indispensable para investigación avanzada, estudios biológicos y análisis científico.</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>pico de carburo</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>Una herramienta de minería avanzada que presenta una punta de carburo que mantiene su filo a través de los trabajos de excavación más exigentes. La cabeza diseñada con precisión corta roca más eficientemente que herramientas estándar, mientras su construcción reforzada asegura durabilidad excepcional bajo condiciones mineras duras.</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>bisturí de precisión</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>Un instrumento quirúrgico ultra-afilado fabricado de aleaciones de acero de grado superior. La hoja cuidadosamente equilibrada mantiene su filo a través de esterilización y uso repetidos, mientras el mango ergonómico asegura control preciso durante procedimientos médicos finos. Equipo estándar para instalaciones médicas avanzadas.</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>taladro eléctrico</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>Una herramienta de perforación mecanizada impulsada por un motor incorporado capaz de perforar materiales duros con precisión y velocidad. El motor de velocidad variable y brocas intercambiables la hacen extremadamente valiosa para trabajos de construcción y mecánicos. Requiere mantenimiento regular para mantener el motor funcionando suavemente.</SurvivalTools_PowerDrill.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>multiherramienta del glitterworld</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>Una herramienta universal de alta tecnología comúnmente utilizada por mecánicos domésticos en sociedades del glitterworld. Este dispositivo avanzado se adapta sin esfuerzo a cualquier tarea - construcción, minería, silvicultura, mantenimiento, demolición - convirtiéndola en la herramienta de supervivencia todo-en-uno definitiva. Aunque diseñada para mecánicos, es perfectamente utilizable por humanoides debido a similitudes fisiológicas.</SurvivalTools_Multitool.description>
    <SurvivalTools_PileOfRags.label>montón de trapos</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>Una herramienta de limpieza simple hecha de trapos y trozos de tela. Útil para tareas básicas de limpieza pero se desgasta rápidamente.</SurvivalTools_PileOfRags.description>
    <!-- =================================================== -->
    <!-- HERRAMIENTAS GENERALES MULTIUSO (WorkSpeedGlobal)     -->
    <!-- Nuevas definiciones que requieren entradas           -->
    <!-- =================================================== -->
    <!-- Nivel tribal / primitivo -->
    <SurvivalTools_MultipurposeStoneTool.label>herramienta de piedra multifunción</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>Un implemento de piedra resistente y versátil moldeado para abarcar muchas tareas generales. Aunque primitivo, otorga una leve mejora a la velocidad global de trabajo.</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>implementos de hueso tallados</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>Un conjunto de implementos de hueso cuidadosamente tallados y atados para uso multiuso. Frágiles, pero con formas eficientes que brindan un aumento notable a la velocidad general de trabajo.</SurvivalTools_CarvedBoneImplements.description>
    <!-- Nivel medieval -->
    <SurvivalTools_ArtisansToolkit.label>juego de herramientas de artesano</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>Una colección seleccionada de implementos de calidad de época medieval para fabricar, dar forma y ensamblar. Mejora el rendimiento global a través de muchas tareas.</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>kit de carpintero</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>Un surtido especializado de sierras, cinceles, cepillos y galgas optimizados para el moldeado y ensamble de madera. Su organización y calidad otorgan un fuerte impulso a la velocidad general de trabajo.</SurvivalTools_WoodworkersKit.description>
    <!-- Nivel industrial -->
    <SurvivalTools_MechanicsToolkit.label>juego de herramientas de mecánico</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>Un kit industrial bien organizado que contiene llaves de precisión, galgas, implementos de torque y almacenamiento de acceso rápido. Mejora en gran medida el flujo y coordinación de tareas generales.</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>taladro percutor de taller</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>Un pesado taladro percutor motorizado con módulos intercambiables de percusión y rotación. Su sistema integrado de sujeción y alineación acelera prácticamente cualquier tarea mecánica o de construcción.</SurvivalTools_WorkshopHammerDrill.description>
    <!-- Nivel espacial / ultra tecnológico -->
    <SurvivalTools_NanofabricatorInterface.label>interfaz de nanofabricador</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>Un módulo elegante de control y aumento que sincroniza los movimientos del usuario con rutinas adaptativas de nanoensamblaje. Mejora drásticamente la eficiencia de ejecución de tareas generales.</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>guantelete omni‑herramienta</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>Un guantelete modular de última generación con proyectores de campo, micro-fabricadores y manipuladores alineados por fuerza. Proporciona un aumento sin igual a la velocidad general de trabajo mediante optimización predictiva.</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>
<file path="1.6/Languages/Spanish/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <NoTool>Sin herramienta</NoTool>
    <ToolInUse>(en uso)</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>Herramientas de Supervivencia</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>Configuración básica</Settings_BasicSection>
    <Settings_DebugSection>Configuración de depuración</Settings_DebugSection>
    <Settings_HardcoreMode>Modo hardcore</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>Aumenta significativamente la dificultad haciendo que las herramientas sean esenciales para la supervivencia. Sin herramientas adecuadas, los colonos se vuelven incapaces de ejecutar efectivamente la mayoría de las tareas de trabajo. Las herramientas también se desgastan 50% más rápido, requiriendo reemplazo más frecuente y mejor gestión de herramientas. Transforma el juego en una verdadera experiencia de supervivencia dependiente de herramientas.</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>Modo hardcore extremo</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>DIFICULTAD MÁXIMA: El desafío de supervivencia definitivo. Cuando se combina con el modo hardcore, los colonos se vuelven completamente indefensos sin las herramientas correctas. Las tareas que eran meramente ineficientes (como limpiar a mano o cuidado médico improvisado) se vuelven imposibles de intentar. Las herramientas se degradan 87.5% más rápido de lo normal, creando presión constante para la producción y mantenimiento de herramientas. Use las casillas de verificación de abajo para controlar exactamente qué tipos de trabajo se vuelven dependientes de herramientas. ¡ADVERTENCIA: El juego temprano se vuelve extremadamente desafiante - la adquisición de herramientas se vuelve crítica para la supervivencia de la colonia!</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>Herramientas de limpieza requeridas</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>Fuerza a los colonos a usar herramientas de limpieza adecuadas (como escobas o trapeadores) para todas las tareas de limpieza. Sin las herramientas correctas, no pueden limpiar pisos, remover suciedad o limpiar nieve. Esencial para mantener la higiene de la colonia en modos de dificultad extrema.</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>Herramientas de carnicería requeridas</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>Obliga a usar herramientas de corte adecuadas (como cuchillos o machetas) para todas las operaciones de carnicería y sacrificio. Los colonos no pueden procesar carne o sacrificar animales sin hojas adecuadas. Crítico para las cadenas de producción de alimentos en escenarios hardcore.</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>Herramientas médicas requeridas</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>Impone el uso de instrumentos médicos especializados para procedimientos quirúrgicos y cuidado médico avanzado. Las operaciones se vuelven imposibles sin herramientas quirúrgicas adecuadas, haciendo que la adquisición de equipo médico sea vital para la salud y supervivencia de la colonia.</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>Herramientas en edificios en ruinas</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>Genera herramientas de supervivencia básicas en ruinas antiguas y estructuras estrelladas durante la generación del mapa. Estas herramientas erosionadas proporcionan recursos importantes del juego temprano pero son típicamente de baja calidad. Invaluables para colonias iniciantes en modos de dificultad duros donde el acceso inicial a herramientas es crítico.</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>Límite de carga de herramientas</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>Restringe a los colonos a cargar un máximo de 2-3 herramientas simultáneamente en su inventario (excluyendo viajes de caravana). Fuerza la gestión estratégica de herramientas y especialización entre colonos. Los cinturones de herramientas y equipo similar pueden aumentar este límite más allá del valor base. Añade restricciones de inventario realistas al uso de herramientas.</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>Tasa de degradación de herramientas</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>Optimización automática de herramientas</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>Habilita la gestión inteligente de herramientas donde los colonos automáticamente seleccionan y cargan las herramientas más efectivas para su trabajo asignado. Mejoran a mejores herramientas y descartan las inferiores según sea necesario. Deshabilite esto si prefiere control manual de herramientas o experimenta problemas de rendimiento con materiales modificados.</Settings_ToolOptimization_Tooltip>
    <Settings_PickupFromStorageOnly>Restringir recogida de herramientas a áreas de almacenamiento</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>Cuando está habilitado, los colonos solo adquirirán herramientas de zonas de almacenamiento designadas, manteniendo mejor organización y evitando que tomen herramientas de áreas de trabajo. Cuando está deshabilitado, pueden recoger cualquier herramienta accesible en el área del Hogar (excluyendo objetos prohibidos o en llamas), proporcionando más flexibilidad pero menos control.</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_DebugLogging>Habilitar registro de depuración detallado</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>Activa el registro comprensivo de decisiones de selección de herramientas, comportamiento de recogida automática y lógica de emparejamiento trabajo-herramienta. Esencial para solucionar problemas de herramientas o entender por qué los colonos eligen herramientas específicas. Recomendado solo para desarrollo de mods o cuando se experimentan problemas relacionados con herramientas. Puede afectar el rendimiento con salida de registro extensiva.</Settings_DebugLogging_Tooltip>
    <Settings_AutoTool>Recogida inteligente de herramientas pre-trabajo</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>Revoluciona la eficiencia del flujo de trabajo haciendo que los colonos automáticamente adquieran la herramienta óptima antes de comenzar cualquier trabajo. Intercambian herramientas inteligentemente, mejoran a mejores variantes y aseguran tener el equipo correcto para máxima productividad. La función fundamental para gameplay basado en herramientas sin costuras.</Settings_AutoTool_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>El colono necesita herramientas esenciales</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>Los colonos necesitan herramientas esenciales</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>Estos colonos necesitan herramientas adecuadas para su trabajo asignado, pero carecen del equipo necesario. Su productividad está severamente comprometida.</ColonistNeedsSurvivalToolDesc>
    <SurvivalToolsNeedReplacing>Herramientas acercándose al fallo</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>Estos colonos están usando herramientas que pronto se romperán. Reemplácelas inmediatamente para evitar interrupciones del trabajo.</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>Gestionar asignaciones de herramientas</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>Asignación de herramienta</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>Constructor</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>Minero</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>Trabajador de plantas</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>Investigador</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>Limpiador</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>Médico</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>Carnicero</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>Seleccionar asignación de herramienta...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>Nueva asignación de herramienta</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>Eliminar asignación de herramienta...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>La asignación de herramienta está siendo usada por {0}</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>No hay asignación de herramienta seleccionada</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>Herramientas forzadas</ForcedSurvivalTools>
    <!-- Settings -->
    <Settings_CompatLogging>Habilitar registro de depuración de compatibilidad</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Activa el registro detallado para sistemas de compatibilidad de mods incluyendo integración de Research Reinvented, detección de estadísticas y cableado de WorkGiver. Muestra procesos paso a paso de configuración e integración de compatibilidad. Solo se muestra cuando el registro de depuración general está habilitado. Útil para diagnosticar problemas con interacciones de mods.</Settings_CompatLogging_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Haga clic en el botón de abajo para abrir la ventana de configuración mejorada y redimensionable con todas las opciones del mod.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Abrir Configuración Mejorada</Settings_OpenEnhancedButton>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>Tipos de Trabajo</JobTable_JobTypes>
    <JobTable_JobType>Tipo de Trabajo</JobTable_JobType>
    <JobTable_Normal>Normal</JobTable_Normal>
    <JobTable_Hardcore>Hardcore</JobTable_Hardcore>
    <JobTable_NormalMode>Modo Normal</JobTable_NormalMode>
    <JobTable_HardcoreMode>Modo Hardcore</JobTable_HardcoreMode>
    <JobTable_ExtraHardcore>Hardcore Extremo</JobTable_ExtraHardcore>
    <JobTable_Enhanced>Mejorado</JobTable_Enhanced>
    <JobTable_Required>Requerido</JobTable_Required>
    <JobTable_NoJobsFound>No se encontraron trabajos mejorados por herramientas.</JobTable_NoJobsFound>
    <JobTable_SectionTitle>Requisitos de Herramientas por Modo</JobTable_SectionTitle>
    <JobTable_SectionTooltip>Esta tabla muestra cómo se comportan diferentes tipos de trabajo en cada modo de dificultad. 'Mejorado' significa que las herramientas proporcionan bonificaciones pero no son requeridas. 'Requerido' significa que las herramientas son necesarias para realizar el trabajo. Use esto para entender qué herramientas necesitarán sus colonos basándose en su configuración actual.</JobTable_SectionTooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Haz clic en el botón de abajo para abrir la ventana de configuración mejorada y redimensionable con todas las opciones del mod.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Abrir Configuración Mejorada</Settings_OpenEnhancedButton>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>Investigación Reinventada</Compat_ResearchReinvented>
    <Compat_FieldResearch>Investigación de Campo</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>Investigación Reinventada</Compat_ReinventedResearchAlert>
    <!-- Pacifist Tool Settings -->
    <Settings_AllowPacifistEquip>Permitir a pacifistas equipar herramientas de supervivencia</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>Permite a los colonos pacifistas equipar herramientas de supervivencia clasificadas como armas (como hachas, picos o cuchillos). Aunque estas herramientas tienen capacidades de combate, son esenciales para tareas laborales como tala de árboles, minería o preparación de alimentos. Cuando está habilitado, los pacifistas pueden usar estas herramientas para trabajo productivo mientras siguen rehusando participar en violencia.</Settings_AllowPacifistEquip_Tooltip>
    <!-- Configuración WorkSpeedGlobal (añadido) -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>Configuración de trabajos velocidad general</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>Seleccione qué trabajos que usan la estadística de velocidad de trabajo general deben estar restringidos por herramientas de supervivencia. Los trabajos no restringidos ignoran penalizaciones por falta de herramientas.</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>Tipo de trabajo</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>Restringido</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>Descripción</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>No se encontraron trabajos de velocidad general.</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>Habilitar todo</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>Deshabilitar todo</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>Restablecer</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>Rastrear WorkGivers</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>Requiere herramientas en modos hardcore</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>Sin penalización de herramientas</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>Configurar trabajos de velocidad general</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (añadido) -->
    <JobTable_NoActiveMode>No hay modo activo seleccionado.</JobTable_NoActiveMode>
    <JobTable_GatedFormat>Restringido ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>Restringido (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>Desconocido</JobTable_Status_Unknown>
    <JobTable_Blocked>Bloqueado</JobTable_Blocked>
</LanguageData>
</file>
<file path="1.6/Patches/Core/Stats/Stats_Pawns_WorkGeneral.xml">
<Patch>
    <!-- Plant Work Speed -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="PlantWorkSpeed"]/label</xpath>
        <value>
            <label>plant sowing speed</label>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="PlantWorkSpeed"]/description</xpath>
        <value>
            <description>The speed at which this person sows plants.</description>
        </value>
    </Operation>
    <!-- Construction Speed -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="ConstructionSpeed"]/minValue</xpath>
        <value>
            <minValue>0</minValue>
        </value>
    </Operation>
    <!-- Ensure <parts/> exists -->
    <Operation Class="PatchOperationSequence">
        <success>Always</success>
        <operations>
            <li Class="PatchOperationTest">
                <xpath>Defs/StatDef[defName="ConstructionSpeed"]/parts</xpath>
                <success>Invert</success>
            </li>
            <li Class="PatchOperationAdd">
                <xpath>Defs/StatDef[defName="ConstructionSpeed"]</xpath>
                <value>
                    <parts />
                </value>
            </li>
        </operations>
    </Operation>
    <!-- Add StatPart_SurvivalTool only if it isn't already present -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/StatDef[defName="ConstructionSpeed"]/parts/li[@Class="SurvivalTools.StatPart_SurvivalTool"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/StatDef[defName="ConstructionSpeed"]/parts</xpath>
            <value>
                <li Class="SurvivalTools.StatPart_SurvivalTool">
                    <noToolStatFactor>0.4</noToolStatFactor>
                </li>
            </value>
        </nomatch>
    </Operation>
    <!-- Mining Speed -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="MiningSpeed"]/description</xpath>
        <value>
            <description>The speed at which this person drills for deep resources or performs mining tasks other than digging at walls.</description>
        </value>
    </Operation>
    <!-- Mining Yield -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="MiningYield"]/label</xpath>
        <value>
            <label>mining yield (other)</label>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="MiningYield"]/description</xpath>
        <value>
            <description>The percentage of mined resources a miner will produce. This applies to deep drill mining. This doesn't affect the production rate of rock chunks.</description>
        </value>
    </Operation>
</Patch>
</file>
<file path="1.6/Patches/DarkAgesMedievalTools/DAMT_Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Dark Ages : Medieval Tools</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Building Hammer - Construction -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Hammer"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Hammer"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Pickaxe - Mining -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Pickaxe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <DiggingSpeed>1.15</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Miner</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Pickaxe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Scythe - Plant Cutting & Harvesting -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Scythe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <PlantHarvestingSpeed>1.2</PlantHarvestingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Scythe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Meat Cleaver - Butchery -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Cleaver"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ButcheryFleshSpeed>1.2</ButcheryFleshSpeed>
                <ButcheryFleshEfficiency>1.15</ButcheryFleshEfficiency>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Cook</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Cleaver"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Bonesaw - Medical Operations -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Hacksaw"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <MedicalOperationSpeed>1.2</MedicalOperationSpeed>
                <MedicalSurgerySuccessChance>0.9</MedicalSurgerySuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Doctor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Hacksaw"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Broom - Cleaning -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Broom"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <CleaningSpeed>1.35</CleaningSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Cleaner</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Broom"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/PrimitiveTools/PT_Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Primitive Tools</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_BoneShovel"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <DiggingSpeed>0.75</DiggingSpeed>
                <MiningYieldDigging>0.75</MiningYieldDigging>
                <PlantHarvestingSpeed>0.75</PlantHarvestingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Miner</li>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_BoneShovel"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_FlintAxe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_FlintAxe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_FlintHandAxe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>0.5</TreeFellingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_FlintHandAxe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_BoneSaw"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.0</TreeFellingSpeed>
                <MedicalOperationSpeed>0.8</MedicalOperationSpeed>
                <MedicalSurgerySuccessChance>0.7</MedicalSurgerySuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
                <li>Doctor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_BoneSaw"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_FlintSickle"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <PlantHarvestingSpeed>1.0</PlantHarvestingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_FlintSickle"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_HammerStone"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>0.85</ConstructionSpeed>
                <ConstructSuccessChance>1.0</ConstructSuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_HammerStone"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_StoneHammer"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>0.85</ConstructionSpeed>
                <ConstructSuccessChance>1.0</ConstructSuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_StoneHammer"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_StoneMallet"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>1.1</ConstructionSpeed>
                <ConstructSuccessChance>0.75</ConstructSuccessChance>
                <!-- Lower chance because big and wieldly -->
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_StoneMallet"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/RightToolForTheJob/RTFTJ_Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Right Tool For The Job (Continued)</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Pickaxe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <DiggingSpeed>1.0</DiggingSpeed>
                <MiningYieldDigging>1.0</MiningYieldDigging>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Miner</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_Pickaxe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Hammer"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>1.0</ConstructionSpeed>
                <ConstructSuccessChance>1.0</ConstructSuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_Hammer"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Autohammer"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>1.1</ConstructionSpeed>
                <ConstructSuccessChance>0.9</ConstructSuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_Autohammer"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_HandAxe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.0</TreeFellingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_HandAxe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Chainsaw"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_Chainsaw"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Drill"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <DiggingSpeed>1.1</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Miner</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_Drill"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Toolbelt"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.0</TreeFellingSpeed>
                <DiggingSpeed>1.0</DiggingSpeed>
                <MiningYieldDigging>1.0</MiningYieldDigging>
                <ConstructionSpeed>1.0</ConstructionSpeed>
                <ConstructSuccessChance>1.0</ConstructSuccessChance>
                <PlantHarvestingSpeed>1.0</PlantHarvestingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
                <li>Miner</li>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>Defs/ThingDef[defName="RTFTJ_Toolbelt"]/thingClass</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Should these toolbelts count as a survival tools? 
It adds a lot of stats but toolbelts are not real tools, just storage for tools 
Maybe they need to add carrying capacity and tool slots, more for the advanced one of course -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_ToolbeltAdv"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
                <DiggingSpeed>1.1</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
                <ConstructionSpeed>1.1</ConstructionSpeed>
                <ConstructSuccessChance>1.1</ConstructSuccessChance>
                <PlantHarvestingSpeed>1.1</PlantHarvestingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
                <li>Miner</li>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>Defs/ThingDef[defName="RTFTJ_ToolbeltAdv"]/thingClass</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>
<file path="1.6/Patches/VWEUTools/VWEUT_Patch.xml">
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>VWE Useful Tools</li>
        </mods>
        <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Hammer"]</xpath>
                    <value>
                        <li Class="SurvivalTools.SurvivalToolProperties">
                            <baseWorkStatFactors>
                                <ConstructionSpeed>1.0</ConstructionSpeed>
                                <ConstructSuccessChance>1.0</ConstructSuccessChance>
                            </baseWorkStatFactors>
                            <defaultSurvivalToolAssignmentTags>
                                <li>Constructor</li>
                            </defaultSurvivalToolAssignmentTags>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Hammer"]</xpath>
                    <value>
                        <thingClass>SurvivalTools.SurvivalTool</thingClass>
                    </value>
                </li>
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Pickaxe"]</xpath>
                    <value>
                        <li Class="SurvivalTools.SurvivalToolProperties">
                            <baseWorkStatFactors>
                                <DiggingSpeed>1.1</DiggingSpeed>
                                <MiningYieldDigging>1.1</MiningYieldDigging>
                            </baseWorkStatFactors>
                            <defaultSurvivalToolAssignmentTags>
                                <li>Miner</li>
                            </defaultSurvivalToolAssignmentTags>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Pickaxe"]</xpath>
                    <value>
                        <thingClass>SurvivalTools.SurvivalTool</thingClass>
                    </value>
                </li>
                <!-- hatchets are wood cutters (tree felling) -->
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Hatchet"]</xpath>
                    <value>
                        <li Class="SurvivalTools.SurvivalToolProperties">
                            <baseWorkStatFactors>
                                <TreeFellingSpeed>1.1</TreeFellingSpeed>
                            </baseWorkStatFactors>
                            <defaultSurvivalToolAssignmentTags>
                                <li>PlantWorker</li>
                            </defaultSurvivalToolAssignmentTags>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Hatchet"]</xpath>
                    <value>
                        <thingClass>SurvivalTools.SurvivalTool</thingClass>
                    </value>
                </li>
                <!-- shovels can dig and be used for basic plant work -->
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Shovel"]</xpath>
                    <value>
                        <li Class="SurvivalTools.SurvivalToolProperties">
                            <baseWorkStatFactors>
                                <DiggingSpeed>1.1</DiggingSpeed>
                                <MiningYieldDigging>1.1</MiningYieldDigging>
                                <SowingSpeed>0.8</SowingSpeed>
                            </baseWorkStatFactors>
                            <defaultSurvivalToolAssignmentTags>
                                <li>Miner</li>
                                <li>PlantWorker</li>
                            </defaultSurvivalToolAssignmentTags>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Shovel"]</xpath>
                    <value>
                        <thingClass>SurvivalTools.SurvivalTool</thingClass>
                    </value>
                </li>
                <!-- wrenches for maintenance and repair -->
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Wrench"]</xpath>
                    <value>
                        <li Class="SurvivalTools.SurvivalToolProperties">
                            <baseWorkStatFactors>
                                <ConstructionSpeed>1.1</ConstructionSpeed>
                                <MaintenanceSpeed>1.2</MaintenanceSpeed>
                                <DeconstructionSpeed>1.1</DeconstructionSpeed>
                            </baseWorkStatFactors>
                            <defaultSurvivalToolAssignmentTags>
                                <li>Constructor</li>
                            </defaultSurvivalToolAssignmentTags>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Wrench"]</xpath>
                    <value>
                        <thingClass>SurvivalTools.SurvivalTool</thingClass>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>
<file path="1.6/Textures/Things/Item/Equipment/Tool/README_Textures.txt">
=================================================================
COMMISSIONED ARTWORK SHOPPING LIST
=================================================================
=== PRIMITIVE TIER TOOLS ===
1. Knife.png - Basic Utility Knife
   • Resolution: 128x128
   • Style: Primitive/rustic
   • Description: Simple blade with wooden or stone handle
   • Use: Butchery, basic medical work
2. HandSaw.png - Primitive Hand Saw
   • Resolution: 128x128
   • Style: Simple, functional
   • Description: Toothed blade with wooden handle
   • Use: Basic woodworking, construction
3. BoneSickle.png - Bone Sickle
   • Resolution: 128x128
   • Style: Bone/fossil aesthetic
   • Description: Curved blade shaped like carved bone
   • Use: Harvesting crops/plants
4. Hoe.png - Farming Hoe
   • Resolution: 128x128
   • Style: Agricultural
   • Description: Wooden handle, metal or stone blade
   • Use: Soil preparation, farming
5. PryBar.png - Primitive Lever Tool
   • Resolution: 128x128
   • Style: Primitive
   • Description: Wood or stone pry tool
   • Use: Demolition, leverage
6. Abacus.png - Counting Frame
   • Resolution: 128x128
   • Style: Neolithic research aid
   • Description: Wooden frame with beads
   • Use: Research, intellectual work
7. PileOfRags.png - Cleaning Rags
   • Resolution: 128x128
   • Style: Practical
   • Description: Bundle of cloth rags
   • Use: Cleaning, maintenance
8. MultipurposeStoneTool.png - Crude Stone Tool
   • Resolution: 128x128
   • Style: Tribal/neolithic
   • Description: Chipped stone lashed to wood grip with twine
   • Use: WorkSpeedGlobal (primitive tier)
9. CarvedBoneImplements.png - Bundle of Bone Tools
   • Resolution: 128x128
   • Style: Tribal/organic
   • Description: Carved animal bones (scrapers, chisels, awl) tied with sinew
   • Use: WorkSpeedGlobal (primitive tier)
-----------------------------------------------------------------
=== MEDIEVAL / ARTISAN TIER TOOLS ===
10. Artisan’sToolkit.png - Leather Tool Wrap
    • Resolution: 128x128
    • Style: Medieval craftsman
    • Description: Leather roll with hammer, chisel, awl, hand drill
    • Use: WorkSpeedGlobal (medieval)
11. Woodworker’sKit.png - Fine Carpentry Set
    • Resolution: 128x128
    • Style: Late medieval
    • Description: Polished oak box with saws, rasps, knives, brass fittings
    • Use: WorkSpeedGlobal (medieval)
-----------------------------------------------------------------
=== INDUSTRIAL TIER TOOLS ===
12. SteelKnife.png - Professional Knife
    • Resolution: 128x128
    • Style: Industrial
    • Description: High-quality steel blade with ergonomic grip
    • Use: Butchery, medical
13. CrosscutSaw.png - Industrial Saw
    • Resolution: 128x128
    • Style: Heavy-duty
    • Description: Large toothed blade for lumber
    • Use: Advanced construction, woodworking
14. Wrench.png - Adjustable Wrench
    • Resolution: 128x128
    • Style: Industrial
    • Description: Steel adjustable jaw wrench
    • Use: Construction, repairs
15. Mechanic’sToolkit.png - Industrial Toolbox
    • Resolution: 128x128
    • Style: Utilitarian
    • Description: Red metal box with wrenches/pliers, grease smudges
    • Use: WorkSpeedGlobal (industrial)
16. WorkshopHammerDrill.png - Early Power Drill
    • Resolution: 128x128
    • Style: Industrial, rugged
    • Description: Bulky handheld hammer drill with steel bit
    • Use: WorkSpeedGlobal (industrial)
-----------------------------------------------------------------
=== PRECISION / SPACER PREP TOOLS ===
17. CarbidePick.png - Carbide Pickaxe
    • Resolution: 128x128
    • Style: Precision engineered
    • Description: Pickaxe with carbide-tipped metallic head
    • Use: Enhanced mining
18. PrecisionScalpel.png - Surgical Scalpel
    • Resolution: 128x128
    • Style: Medical/sterile
    • Description: Ultra-sharp surgical blade
    • Use: Advanced medical procedures
19. PowerDrill.png - Motorized Drill
    • Resolution: 128x128
    • Style: Industrial/modern
    • Description: Electric drill with motor housing
    • Use: Construction, fabrication
20. Microscope.png - Research Microscope
    • Resolution: 128x128
    • Style: Scientific
    • Description: Optical instrument for research
    • Use: Research boost
-----------------------------------------------------------------
=== SPACER / GLITTERWORLD TOOLS ===
21. NanofabricatorInterface.png - Holo Tablet
    • Resolution: 128x128
    • Style: Sleek spacer tech
    • Description: White/silver handheld slab with cyan holographic projection
    • Use: WorkSpeedGlobal (spacer)
22. OmniToolGauntlet.png - Wrist Gauntlet
    • Resolution: 128x128
    • Style: Glitterworld elegance
    • Description: Wrist-mounted gauntlet with glowing conduits + nano-arms
    • Use: WorkSpeedGlobal (glitterworld)
23. GlitterworldMultitool.png - Ultimate Multitool
    • Resolution: 128x128
    • Style: Sleek, futuristic
    • Description: High-tech universal tool with glow accents
    • Use: All-purpose survival tool
-----------------------------------------------------------------
=== EXISTING TOOL TEXTURES (TO BE REDONE AT 128×128) ===
24. Axe.png - Forestry Axe
    • Resolution: 128x128
    • Style: Functional, primitive-to-industrial variants
    • Use: Tree felling, wood chopping
25. Pickaxe.png - Mining Pickaxe
    • Resolution: 128x128
    • Style: Sturdy, material-adaptive (stone/iron/steel)
    • Use: Mining, digging
26. Hammer.png - Construction Hammer
    • Resolution: 128x128
    • Style: Simple head + wooden/metal shaft
    • Use: Building, construction
27. Sickle.png - Harvesting Sickle
    • Resolution: 128x128
    • Style: Curved blade with wood/metal handle
    • Use: Crop/plant harvesting  
-----------------------------------------------------------------
=== ARTWORK SPECIFICATIONS ===
• Resolution: All textures 128x128  
• Format: PNG with transparency  
• Lighting: RimWorld top-down, NW soft light, SE shadow  
• Style: Match RimWorld vanilla aesthetic  
• Silhouette: Must be distinct/readable at 25% scale  
• Material Adaptability: Wood/stone/metal where applicable  
• Tech Progression: Primitive → Medieval → Industrial → Precision → Spacer → Glitterworld  
-----------------------------------------------------------------
=== COMMISSION DELIVERY GUIDELINES ===
• Provide layered source files (PSD or equivalent) + PNG exports  
• Keep holograms/glow elements on separate layers for flexibility  
• Test readability at 50% and 25% scales  
• Avoid over-detailing fine lines (<1px)  
• Ensure silhouettes remain clear against RimWorld floors  
-----------------------------------------------------------------
TOTAL NEW TEXTURES: 23  
- Primitive/Medieval: 11  
- Industrial: 5  
- Precision: 4  
- Spacer/Glitterworld: 3  
=================================================================
</file>
<file path="About/PublishedFileId.txt">
3554664966
</file>
<file path="Source/AI/JobDriver_FellTree_Designated.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/JobDriver_FellTree_Designated.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Uses the standard CutPlant designation for designated tree felling.
/// Subclass of JobDriver_FellTree that requires the CutPlant designation to operate.
/// </summary>
public class JobDriver_FellTree_Designated : JobDriver_FellTree
⋮----
// Defensive: return the vanilla CutPlant designation if present.
// This is extremely unlikely to be null, but the guard avoids a possible NRE in exotic contexts.
</file>
<file path="Source/AI/JobDriver_HarvestTree_Designated.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/JobDriver_HarvestTree_Designated.cs
⋮----
namespace SurvivalTools
⋮----
// Uses the standard HarvestPlant designation for designated tree harvesting.
public class JobDriver_HarvestTree_Designated : JobDriver_HarvestTree
</file>
<file path="Source/DebugTools/PrimitiveToolsPatchLogger.cs">
// RimWorld 1.6 / C# 7.3
// Source/DebugTools/PrimitiveToolsPatchLogger.cs
//
// Debug utility for Primitive Tools compatibility diagnostics.
// Now runs only when triggered manually via the Debug Actions menu,
// and only shows if Primitive Tools is active.
⋮----
public static class PrimitiveToolsPatchLogger
⋮----
public static void DumpPrimitiveTools_DebugAction()
⋮----
// Gate: only show when Primitive Tools is active
if (!PrimitiveToolsHelpers.IsPrimitiveToolsActive())
⋮----
Messages.Message("Primitive Tools not detected — debug action unavailable.", MessageTypeDefOf.RejectInput, false);
⋮----
// 1) Try to find known PT assemblies and types
⋮----
var ptAssembly = AppDomain.CurrentDomain.GetAssemblies()
.FirstOrDefault(a => a.GetName().Name?.IndexOf(ptAssemblyName, StringComparison.OrdinalIgnoreCase) >= 0);
⋮----
// 2) Also check for PT ThingDefs that might conflict with our tools
⋮----
public static void DumpPatchesByHeuristics()
⋮----
var methods = Harmony.GetAllPatchedMethods()?.ToList();
if (methods.NullOrEmpty())
⋮----
var substrings = new[] { "primitive", "tools", "vby" }; // case-insensitive
⋮----
var info = Harmony.GetPatchInfo(tgt);
⋮----
if (PatchLooksLikePT(p, substrings)) matches.Add((p, "PREFIX"));
⋮----
if (PatchLooksLikePT(p, substrings)) matches.Add((p, "POSTFIX"));
⋮----
if (PatchLooksLikePT(p, substrings)) matches.Add((p, "TRANSPILER"));
⋮----
LogInfo($"[SurvivalTools] DumpPTHeur: target -> {tgt.FullDescriptionSafe()}");
⋮----
string pmDesc = p?.PatchMethod != null ? p.PatchMethod.FullDescriptionSafe() : "(unknown)";
⋮----
// helper
⋮----
if (subs.Any(s => owner.IndexOf(s, StringComparison.OrdinalIgnoreCase) >= 0)) return true;
⋮----
if (subs.Any(s => asm.IndexOf(s, StringComparison.OrdinalIgnoreCase) >= 0)) return true;
if (subs.Any(s => typeFull.IndexOf(s, StringComparison.OrdinalIgnoreCase) >= 0)) return true;
⋮----
private static void TryDumpPrimitiveToolsTypes(Assembly ptAssembly)
⋮----
var types = ptAssembly.GetTypes();
⋮----
foreach (var type in types.Take(20)) // Limit output
⋮----
var methods = type.GetMethods(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Static | BindingFlags.Instance);
foreach (var method in methods.Take(5)) // Limit to first few methods
⋮----
var patches = Harmony.GetPatchInfo(method);
if (patches != null && (patches.Prefixes.Any() || patches.Postfixes.Any() || patches.Transpilers.Any()))
⋮----
private static void DumpPrimitiveToolsThingDefs()
⋮----
.Where(d => d.defName != null && (
d.defName.IndexOf("primitive", StringComparison.OrdinalIgnoreCase) >= 0 ||
d.defName.IndexOf("stone", StringComparison.OrdinalIgnoreCase) >= 0 ||
d.defName.IndexOf("wood", StringComparison.OrdinalIgnoreCase) >= 0 ||
⋮----
.Where(d => d.IsWeapon || d.GetModExtension<SurvivalToolProperties>() != null || d.thingCategories?.Any(tc =>
tc.defName.IndexOf("tool", StringComparison.OrdinalIgnoreCase) >= 0 ||
tc.defName.IndexOf("weapon", StringComparison.OrdinalIgnoreCase) >= 0) == true)
.ToList();
⋮----
foreach (var def in primitiveToolDefs.Take(10))
⋮----
var categories = def.thingCategories?.Select(tc => tc.defName).ToList() ?? new List<string>();
LogInfo($"  {def.defName} (mod: {modName}, categories: {string.Join(", ", categories)})");
⋮----
private static void DumpAllLikelyPTPatches()
⋮----
var patchedMethods = Harmony.GetAllPatchedMethods()?.ToList();
⋮----
var info = Harmony.GetPatchInfo(method);
⋮----
if (IsLikelyPTPatch(p)) ptPatches.Add((p, "PREFIX"));
⋮----
if (IsLikelyPTPatch(p)) ptPatches.Add((p, "POSTFIX"));
⋮----
if (IsLikelyPTPatch(p)) ptPatches.Add((p, "TRANSPILER"));
⋮----
LogInfo($"[SurvivalTools] PrimitiveToolsPatchLogger: PT-style patches on target -> {method.FullDescriptionSafe()}");
⋮----
private static bool IsLikelyPTPatch(Patch p)
⋮----
if (!string.IsNullOrEmpty(p.owner) &&
(p.owner.IndexOf("primitivetools", StringComparison.OrdinalIgnoreCase) >= 0 ||
p.owner.IndexOf("primitive", StringComparison.OrdinalIgnoreCase) >= 0 ||
p.owner.IndexOf("vby", StringComparison.OrdinalIgnoreCase) >= 0))
⋮----
if (!string.IsNullOrEmpty(asmName) &&
asmName.IndexOf("primitivetools", StringComparison.OrdinalIgnoreCase) >= 0)
⋮----
if (!string.IsNullOrEmpty(typeFullName) &&
(typeFullName.IndexOf("PrimitiveTools", StringComparison.OrdinalIgnoreCase) >= 0 ||
typeFullName.IndexOf("Primitive", StringComparison.OrdinalIgnoreCase) >= 0))
⋮----
// ignore reflection failures
⋮----
private static string FullDescriptionSafe(this MethodBase mb)
⋮----
var paramDesc = string.Join(", ", mi.GetParameters().Select(p => p.ParameterType.Name + " " + p.Name));
⋮----
var parms = string.Join(", ", mb.GetParameters().Select(p => p.ParameterType.Name));
⋮----
return mb.ToString();
</file>
<file path="Source/DefOfs/ST_StatDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_StatDefOf.cs
⋮----
namespace SurvivalTools
⋮----
public static class ST_StatDefOf
⋮----
// -------------------------------
// Pawn-related stats
⋮----
// Custom (SurvivalTools)
public static StatDef SurvivalToolCarryCapacity;
public static StatDef DiggingSpeed;
public static StatDef MiningYieldDigging;
public static StatDef PlantHarvestingSpeed;
public static StatDef SowingSpeed;
public static StatDef TreeFellingSpeed;
public static StatDef MaintenanceSpeed;
public static StatDef DeconstructionSpeed;
// Vanilla (fallback for compat)
public static StatDef ResearchSpeed;
public static StatDef CleaningSpeed;
public static StatDef MedicalOperationSpeed;           // vanilla
public static StatDef MedicalSurgerySuccessChance;     // vanilla
public static StatDef ButcheryFleshSpeed;              // vanilla
public static StatDef ButcheryFleshEfficiency;         // vanilla
public static StatDef WorkSpeedGlobal;                 // vanilla
⋮----
// Thing-related stats
⋮----
public static StatDef ToolEstimatedLifespan;
public static StatDef ToolEffectivenessFactor;
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_StatDefOf));
</file>
<file path="Source/Harmony/Patch_ToolInvalidation.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_ToolInvalidation.cs
⋮----
public static class Patch_ToolInvalidation
⋮----
var harmony = new Harmony("com.jellypowered.survivaltools.invalidation");
// Patch Thing.TakeDamage(DamageInfo)
var takeDamage = AccessTools.Method(typeof(Thing), "TakeDamage", new Type[] { typeof(DamageInfo) });
⋮----
harmony.Patch(takeDamage, postfix: new HarmonyMethod(typeof(Patch_ToolInvalidation).GetMethod(nameof(Postfix_Thing_TakeDamage), System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static)));
// Patch Thing.Destroy(DestroyMode)
var destroy = AccessTools.Method(typeof(Thing), "Destroy", new Type[] { typeof(DestroyMode) });
⋮----
harmony.Patch(destroy, postfix: new HarmonyMethod(typeof(Patch_ToolInvalidation).GetMethod(nameof(Postfix_Thing_Destroy), System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static)));
// Patch ThingMaker.MakeThing(ThingDef, ThingDef)
var makeThing = AccessTools.Method(typeof(ThingMaker), "MakeThing", new Type[] { typeof(ThingDef), typeof(ThingDef) });
⋮----
harmony.Patch(makeThing, postfix: new HarmonyMethod(typeof(Patch_ToolInvalidation).GetMethod(nameof(Postfix_ThingMaker_MakeThing), System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static)));
// Patch Pawn_EquipmentTracker add/remove methods if present
var eqType = AccessTools.TypeByName("Pawn_EquipmentTracker");
⋮----
var add = AccessTools.Method(eqType, "AddEquipment");
⋮----
harmony.Patch(add, postfix: new HarmonyMethod(typeof(Patch_ToolInvalidation).GetMethod(nameof(Postfix_Equipment_Changed), System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static)));
var remove = AccessTools.Method(eqType, "RemoveEquipment");
⋮----
harmony.Patch(remove, postfix: new HarmonyMethod(typeof(Patch_ToolInvalidation).GetMethod(nameof(Postfix_Equipment_Changed), System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static)));
⋮----
// best-effort
⋮----
// Postfix for Thing.TakeDamage
private static void Postfix_Thing_TakeDamage(Thing __instance, DamageInfo dinfo)
⋮----
// Only log if this thing is a SurvivalTool or a tool-stuff (has SurvivalToolProperties)
⋮----
var mapName = __instance.Map != null ? __instance.Map.ToString() : "(none)";
⋮----
// If the thing was destroyed or fell to 0 HP, invalidate related cache entries
⋮----
SurvivalToolUtility.ToolFactorCache.InvalidateForThing(__instance);
try { SurvivalToolUtility.ClearCountersForThing(__instance); } catch { }
⋮----
// Postfix for Thing.Destroy
private static void Postfix_Thing_Destroy(Thing __instance, DestroyMode mode)
⋮----
// If the thing was held by a pawn (equipment or inventory), include holder info
⋮----
Pawn holderPawn = null;
⋮----
// If a pawn holder exists and the pawn is allowed to use survival tools
// (i.e., not blacklisted), append holder info. Otherwise fallback to standard log.
⋮----
if (PawnToolValidator.CanUseSurvivalTools(holderPawn))
⋮----
catch { /* best-effort: if validator throws, don't include holder info */ }
⋮----
// Postfix for ThingMaker.MakeThing
private static void Postfix_ThingMaker_MakeThing(Thing __result)
⋮----
// If a new tool or tool-stuff was created by crafting, invalidate its key so
// any cached entries will be recomputed on first use (safe and conservative).
if (__result.def != null && (__result.def.IsSurvivalTool() || __result.def.IsToolStuff()))
⋮----
SurvivalToolUtility.ToolFactorCache.InvalidateForThing(__result);
try { SurvivalToolUtility.ClearCountersForThing(__result); } catch { }
⋮----
// Generic postfix used for equipment add/remove patches
private static void Postfix_Equipment_Changed(ThingWithComps equipment)
⋮----
// Debug log to help verify that the reflection-based equipment patches are attached and firing.
⋮----
// Only log equipment changes for survival tools / tool-stuffs
⋮----
LogDecision($"Equipment_Changed_{equipment.GetHashCode()}", $"[SurvivalTools.Debug] Equipment changed: {equipment.def?.defName ?? "null"} on pawn {pawnLabel}");
⋮----
SurvivalToolUtility.ToolFactorCache.InvalidateForThing(equipment);
try { SurvivalToolUtility.ClearCountersForThing(equipment); } catch { }
</file>
<file path="Source/Helpers/CollectionExtensions.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/CollectionExtensions.cs
//
// Centralized extension methods for collections and common data patterns.
// These reduce boilerplate across SurvivalTools and keep code maintainable.
// Includes helpers for StatModifier lookups, List/HashSet/Dictionary utilities,
// and string/sequence filters.
⋮----
public static class CollectionExtensions
⋮----
// Deduplication guard for stat lookup debug logs
⋮----
/// <summary>
/// Get the stat factor from a list of StatModifiers, returning 1.0 if not found.
/// Includes optional cooldowned debug logging to help trace mismatches.
/// </summary>
public static float GetStatFactorFromList(this IEnumerable<StatModifier> modifiers, StatDef stat)
⋮----
/// <summary>Check if modifiers contain an entry for a specific stat.</summary>
public static bool HasModifierFor(this IEnumerable<StatModifier> modifiers, StatDef stat)
⋮----
/// <summary>Get all unique StatDefs that are modified by this collection.</summary>
public static IEnumerable<StatDef> GetModifiedStats(this IEnumerable<StatModifier> modifiers)
⋮----
return modifiers?.Where(m => m.stat != null).Select(m => m.stat).Distinct() ?? Enumerable.Empty<StatDef>();
⋮----
/// Filter modifiers to only include improvements (factor above no-tool baseline).
/// Penalties and neutral factors are excluded.
⋮----
public static IEnumerable<StatModifier> OnlyImprovements(this IEnumerable<StatModifier> modifiers)
⋮----
/// Baseline factor for a stat when no tools are equipped.
/// Reads from StatPart_SurvivalTool if present.
⋮----
private static float GetNoToolBaseline(StatDef stat) => SurvivalToolUtility.GetNoToolBaseline(stat);
⋮----
/// <summary>Check if a HashSet overlaps with another collection.</summary>
public static bool Overlaps<T>(this HashSet<T> set, IEnumerable<T> other)
⋮----
return other != null && other.Any(set.Contains);
⋮----
/// <summary>Add multiple items to a HashSet at once.</summary>
public static void AddRange<T>(this HashSet<T> set, IEnumerable<T> items)
⋮----
foreach (var item in items) set.Add(item);
⋮----
/// <summary>Get a random element from a list, or default if empty.</summary>
public static T GetRandomOrDefault<T>(this IList<T> list)
⋮----
return list[Rand.Range(0, list.Count)];
⋮----
/// <summary>Remove all null entries from a list in place.</summary>
public static void RemoveNulls<T>(this IList<T> list) where T : class
⋮----
if (list[i] == null) list.RemoveAt(i);
⋮----
/// <summary>Check if a collection is null or empty.</summary>
public static bool IsNullOrEmpty<T>(this ICollection<T> collection)
⋮----
/// Get the maximum element by selector, or default if empty.
/// Safe for nullable selector results.
⋮----
public static T MaxByOrDefault<T, TKey>(this IEnumerable<T> source, Func<T, TKey> selector)
where TKey : IComparable<TKey>
⋮----
if (!hasValue || (key != null && key.CompareTo(maxKey) > 0))
⋮----
/// Get a value from dictionary or add+return a generated default.
⋮----
public static TValue GetOrAdd<TKey, TValue>(this Dictionary<TKey, TValue> dict, TKey key, Func<TValue> valueFactory)
⋮----
if (!dict.TryGetValue(key, out var value))
⋮----
/// <summary>Increment a counter in a dictionary, creating it if absent.</summary>
public static void IncrementCount<TKey>(this Dictionary<TKey, int> dict, TKey key, int increment = 1)
⋮----
if (dict.TryGetValue(key, out var count)) dict[key] = count + increment;
⋮----
/// <summary>Join non-null, non-empty strings with a separator.</summary>
public static string JoinNonEmpty(this IEnumerable<string> strings, string separator = ", ")
⋮----
return string.Join(separator, strings.Where(s => !string.IsNullOrEmpty(s)));
⋮----
/// <summary>Truncate a string with ellipsis if it exceeds maxLength.</summary>
public static string TruncateWithEllipsis(this string str, int maxLength)
⋮----
if (string.IsNullOrEmpty(str) || maxLength <= 0) return string.Empty;
⋮----
if (maxLength <= ellipsis.Length) return ellipsis.Substring(0, maxLength);
return str.Substring(0, maxLength - ellipsis.Length) + ellipsis;
⋮----
/// <summary>Filter sequence to only items of T (non-null).</summary>
public static IEnumerable<T> OfTypeNotNull<T>(this IEnumerable<object> source) where T : class
⋮----
return source?.OfType<T>().Where(item => item != null) ?? Enumerable.Empty<T>();
⋮----
/// <summary>Apply a filter predicate only if condition is true.</summary>
public static IEnumerable<T> WhereIf<T>(this IEnumerable<T> source, bool condition, Func<T, bool> predicate)
⋮----
/// Take items while predicate holds, but include the first failing item.
/// Useful for inclusive ranges.
⋮----
public static IEnumerable<T> TakeWhileInclusive<T>(this IEnumerable<T> source, Func<T, bool> predicate)
</file>
<file path="Source/Helpers/ST_Logging.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ST_Logging.cs
⋮----
namespace SurvivalTools
⋮----
internal static class ST_Logging
⋮----
internal static bool IsCompatLogging()
⋮----
internal static void InvalidateDebugLoggingCache() => _debugLoggingCache = null;
// Enable dedup only in DevMode and when at least one toggle is active
⋮----
// Compact key: "pawnId|jobDef|statDef"
⋮----
private const int TOOLGATE_SUPPRESS_TICKS = 250; // suppress identical entries within this window
private const int TOOLGATE_REPORT_TICKS = 2500; // periodic flush threshold for reporting
/// <summary>
/// Log a ToolGate event with deduplication. Emits the first event immediately (unless debug off), then
/// suppresses repeated identical events for TOOLGATE_SUPPRESS_TICKS. When suppressed events exist and the
/// cooldown expires, emits a summary line indicating how many events were suppressed.
/// If DebugMode is enabled in settings, suppression is bypassed and all events are logged.
/// </summary>
internal static void LogToolGateEvent(Pawn pawn, JobDef jobDef, StatDef statDef, string reason)
⋮----
// jobDef may be null (we'll include a placeholder in messages). pawn and statDef are required.
⋮----
// If debug logging is globally disabled, don't do any heavy work
⋮----
// Still allow a minimal non-debug message in release runs (rare)
⋮----
// Developer override: if debug logging flag is true, bypass suppression
⋮----
try { Log.Message($"[SurvivalTools.ToolGate] {pawn.LabelShort} denied {jobDef.defName} ({statDef.defName}) - {reason}"); } catch { }
⋮----
LogBucket bucket;
if (!_toolGateBuckets.TryGetValue(key, out bucket))
⋮----
// First occurrence: log immediately and record tick
try { Log.Message($"[SurvivalTools.ToolGate] {pawn.LabelShort} denied {jobName} ({statDef.defName}) - {reason}"); } catch { }
⋮----
// If within suppression window, increment counter and return
⋮----
// Suppression window expired: if we suppressed events, emit a summary, then log the current event
⋮----
Log.Message($"[SurvivalTools.ToolGate] {pawn.LabelShort} denied {jobName} ({statDef.defName}) — suppressed {bucket.suppressedCount} similar events.");
⋮----
// Log the current event and update lastTick
⋮----
/// Called periodically (e.g., in ST_LogRunner.GameComponentUpdate) to flush stale buckets
/// and emit summary messages for suppressed counts that haven't been reported yet.
⋮----
internal static void TickToolGateBuckets()
⋮----
toReport.Add(k);
⋮----
// Stale bucket: purge
⋮----
if (!_toolGateBuckets.TryGetValue(k, out var b)) continue;
⋮----
// Key format: pawnId|jobDef|statDef
var parts = k.Split('|');
⋮----
try { Log.Message($"[SurvivalTools.ToolGate] {pawnId} denied {job} ({stat}) — suppressed {b.suppressedCount} similar events."); } catch { }
⋮----
_toolGateBuckets.Remove(k);
⋮----
public static void LogStatPartSummary(Pawn pawn, StatDef stat, JobDef job, string toolLabel, float factor, string context = null)
⋮----
public static void DumpStatDiag(Pawn pawn, StatDef stat, string jobContext = null, bool includeBestTool = true)
⋮----
float raw = pawn.GetStatValue(stat, applyPostProcess: false);
float post = pawn.GetStatValue(stat, applyPostProcess: true);
⋮----
sb.AppendLine($"[SurvivalTools.StatDiag] pawn={pawn.LabelShort} job={jobLabel} stat={statName}");
sb.AppendLine($"  base={stat.defaultBaseValue:F3}, raw={raw:F3}, post={post:F3}");
⋮----
sb.AppendLine($"  parts ({stat.parts.Count}):");
⋮----
sb.AppendLine($"   [{i}] {stat.parts[i].GetType().FullName}");
⋮----
var bestTool = pawn.GetBestSurvivalTool(stat);
⋮----
sb.AppendLine($"  bestTool={bestTool.LabelCapNoCount} factor={factor}");
⋮----
sb.AppendLine("  bestTool=(none)");
⋮----
LogDebug(sb.ToString(), key, respectCooldown: true);
⋮----
internal static bool ShouldLog(string logKey, bool respectCooldown = true)
⋮----
if (!respectCooldown || string.IsNullOrEmpty(logKey)) return true;
⋮----
if (_lastLoggedTick.TryGetValue(logKey, out last) && now - last < LOG_COOLDOWN_TICKS)
⋮----
internal static bool ShouldLogWithCooldown(string logKey) => ShouldLog(logKey, true);
⋮----
internal static bool ShouldLogJobForPawn(Pawn pawn, JobDef jobDef)
⋮----
if (!_loggedJobsPerPawn.TryGetValue(pawn, out set))
⋮----
if (set.Contains(jobDef)) return false;
set.Add(jobDef);
⋮----
private static void CleanupJobLoggingCache(Pawn pawn)
⋮----
if (_loggedJobsPerPawn.TryGetValue(pawn, out set) && !set.Contains(pawn.CurJob.def))
set.Clear();
⋮----
private sealed class BufferedEntry
⋮----
public LogLevel level;
⋮----
private static void EnqueueBuffered(string formatted, LogLevel level)
⋮----
if (string.IsNullOrEmpty(formatted))
⋮----
BufferedEntry entry;
if (_buffer.TryGetValue(formatted, out entry))
⋮----
_buffer[formatted] = new BufferedEntry
⋮----
private static void FlushOldest_NoLock()
⋮----
_buffer.Remove(oldestKey);
⋮----
internal static void TickBuffered()
⋮----
ready.Add(kv.Key);
⋮----
_buffer.Remove(key);
⋮----
private static void Emit(string text, LogLevel level)
⋮----
case LogLevel.Warning: Log.Warning(text); break;
case LogLevel.Error: Log.Error(text); break;
default: Log.Message(text); break;
⋮----
internal static void LogDebug(string message, string logKey = null, bool respectCooldown = true)
⋮----
internal static void LogCompat(string message, string logKey = null, bool respectCooldown = true)
⋮----
internal static void LogCompatMessage(string message, string logKey = null, bool respectCooldown = true)
⋮----
internal static void LogInfo(string message) => Emit(message, LogLevel.Message);
internal static void LogWarning(string message) => Emit(message, LogLevel.Warning);
internal static void LogError(string message) => Emit(message, LogLevel.Error);
⋮----
/// Raw debug logger for special-case systems (ToolResolver). Bypasses buffering,
/// deduplication and cooldown but remains gated behind the debug-settings flag.
/// Use only where callers must always see unthrottled debug output when DevMode+debug
/// logging is enabled (e.g. automatic tool resolution at startup).
⋮----
internal static void LogRawDebug(string message)
⋮----
/// Decision-level logging: deduped and cooldown-aware. Intended for scoring/validation
/// and patch decision explanations.
⋮----
internal static void LogDecision(string key, string message)
⋮----
if (string.IsNullOrEmpty(key))
⋮----
/// Summarized debug message for AI flows (single-line summary per pawn/job).
/// Respects cooldown keyed by pawn+job to avoid per-tool spam.
⋮----
internal static void LogDebugSummary(Pawn pawn, JobDef job, Thing chosenTool)
⋮----
/// Summarized stat debug for evaluation chains. Emits one line per pawn+stat key.
⋮----
internal static void LogStatDebug(Pawn pawn, StatDef stat, float factor)
⋮----
/// Emits an info-level message but only once per supplied key (cooldown semantics).
/// Useful for alerts and UI change logs that should not spam every tick.
⋮----
internal static void LogInfoOnce(string message, string key)
⋮----
internal static void LogCompatWarning(string message) =>
⋮----
internal static void LogCompatError(string message) =>
⋮----
internal static void ExtensionLogger()
⋮----
Emit($"    - {m.stat.defName}: {m.value.ToStringPercent()}", LogLevel.Message);
⋮----
var tags = string.Join(", ", ext.defaultSurvivalToolAssignmentTags);
⋮----
public sealed class ST_LogRunner : GameComponent
⋮----
public override void GameComponentUpdate()
⋮----
ST_Logging.TickBuffered();
ST_Logging.TickToolGateBuckets();
</file>
<file path="Source/ModExtensions/StuffPropsTool.cs">
// RimWorld 1.6 / C# 7.3
// Source/ModExtensions/StuffPropsTool.cs
⋮----
namespace SurvivalTools
⋮----
public class StuffPropsTool : DefModExtension
⋮----
public static readonly StuffPropsTool defaultValues = new StuffPropsTool();
// Factors applied to survival tool stats when this stuff is used.
// Initialize to avoid null refs in consumers.
⋮----
// Multiplier for tool wear when made from this stuff (1 = normal).
⋮----
/// <summary>
/// Convenience: get the extension for a stuff def, or defaultValues if absent.
/// </summary>
public static StuffPropsTool For(ThingDef stuffDef)
⋮----
/// Check if this stuff has any tool stat factors defined.
⋮----
/// Get the modifier for a specific stat, or null if not found.
⋮----
public StatModifier GetStatModifier(StatDef stat)
⋮----
/// Get the factor value for a specific stat (1.0 if not found).
⋮----
public float GetStatFactor(StatDef stat)
</file>
<file path="Source/SpecialThingFilterWorker_NonSmeltableTools.cs">
// RimWorld 1.6 / C# 7.3
// Source/SpecialThingFilterWorker_NonSmeltableTools.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Stockpile filter that matches SurvivalTools which cannot be smelted.
/// </summary>
public class SpecialThingFilterWorker_NonSmeltableTools : SpecialThingFilterWorker
⋮----
public override bool Matches(Thing t)
⋮----
public override bool CanEverMatch(ThingDef def)
⋮----
if (!def.IsSurvivalTool()) return false;
⋮----
public override bool AlwaysMatches(ThingDef def)
⋮----
private static bool IsInSurvivalToolCategory(ThingDef def)
⋮----
if (def?.thingCategories.NullOrEmpty() != false) return false;
⋮----
// Walk up the category hierarchy to check if it's under SurvivalTools
ThingCategoryDef cat = thingCat;
</file>
<file path="Source/WorkSpeedGlobalConfigWindow.cs">
// RimWorld 1.6 / C# 7.3
// Source/WorkSpeedGlobalConfigWindow.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Window for configuring which WorkSpeedGlobal jobs should be gated by survival tools
/// </summary>
public class WorkSpeedGlobalConfigWindow : Window
⋮----
private SurvivalToolsSettings settings;
private Vector2 scrollPosition;
⋮----
// Code-side exclusion list (never shown in the UI)
⋮----
// Example: add defNames here that should never show in the list
// "CookMealFine",
// "CookMealLavish",
⋮----
public override Vector2 InitialSize => new Vector2(700f, 550f); // Increased width for better text fit
⋮----
private void InitializeWorkSpeedJobs()
⋮----
// Get all work givers that use WorkSpeedGlobal, filter excluded and non-gate-eligible
workSpeedJobs = WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs()
.Where(j => !excludedJobs.Contains(j.defName) && SurvivalToolUtility.ShouldGateByDefault(j))
.ToList();
// Initialize any missing job configurations to true (gated by default)
⋮----
if (!settings.workSpeedGlobalJobGating.ContainsKey(job.defName))
⋮----
settings.workSpeedGlobalJobGating[job.defName] = true; // Default to gated
⋮----
public override void DoWindowContents(Rect inRect)
⋮----
// Title
⋮----
var titleRect = new Rect(inRect.x, inRect.y, inRect.width, 30f);
Widgets.Label(titleRect, "WorkSpeedGlobal_Title".Translate());
⋮----
// Description
var descRect = new Rect(inRect.x, titleRect.yMax + 5f, inRect.width, 50f);
Widgets.Label(descRect, "WorkSpeedGlobal_Description".Translate());
// Reserve space for bottom buttons (plus padding and close button)
⋮----
const float bottomPadding = 50f; // Extra space for RimWorld's close button
⋮----
// Pinned Header area
⋮----
var headerRect = new Rect(inRect.x, descRect.yMax + 10f, inRect.width, headerHeight);
// Draw pinned header background
GUI.color = new Color(0.1f, 0.1f, 0.1f, 0.9f);
Widgets.DrawBoxSolid(headerRect, GUI.color);
GUI.color = new Color(0.6f, 0.6f, 0.6f, 1f);
Widgets.DrawBox(headerRect, 1);
// Header content with proper column alignment
⋮----
// Calculate dynamic column widths based on content
⋮----
// Calculate max job name width
float maxJobNameWidth = Text.CalcSize("WorkSpeedGlobal_JobTypeHeader".Translate()).x + 20f; // Header text plus padding
⋮----
var jobName = !string.IsNullOrEmpty(workSpeedJobs[i].label) ? workSpeedJobs[i].label.CapitalizeFirst() : workSpeedJobs[i].defName;
float w = Text.CalcSize(jobName).x + 10f;
⋮----
// Calculate Gated column width (centered checkbox)
float gatedColumnWidth = Mathf.Max(Text.CalcSize("WorkSpeedGlobal_GatedHeader".Translate()).x + 10f, 60f); // Minimum 60f for checkbox space
⋮----
// Job Type header
var jobHeaderRect = new Rect(headerRect.x + 5f, headerRect.y, maxJobNameWidth, headerRect.height);
⋮----
Widgets.Label(jobHeaderRect, "WorkSpeedGlobal_JobTypeHeader".Translate());
// Gated header - centered
var gatedHeaderRect = new Rect(jobHeaderRect.xMax + 10f, headerRect.y, gatedColumnWidth, headerRect.height);
Widgets.Label(gatedHeaderRect, "WorkSpeedGlobal_GatedHeader".Translate());
// Description header
var descHeaderRect = new Rect(gatedHeaderRect.xMax + 10f, headerRect.y, headerRect.width - gatedHeaderRect.xMax - 15f, headerRect.height);
Widgets.Label(descHeaderRect, "WorkSpeedGlobal_DescriptionHeader".Translate());
⋮----
// Draw vertical separators in header
⋮----
GUI.color = new Color(0.6f, 0.6f, 0.6f, 0.8f);
GUI.DrawTexture(new Rect(headerSep1X - 0.5f, headerRect.y, 1f, headerRect.height), BaseContent.WhiteTex);
GUI.DrawTexture(new Rect(headerSep2X - 0.5f, headerRect.y, 1f, headerRect.height), BaseContent.WhiteTex);
⋮----
// Content area for scrollable job list (below pinned header, above buttons)
var contentRect = new Rect(inRect.x, headerRect.yMax, inRect.width, inRect.height - headerRect.yMax - totalBottomSpace);
⋮----
Widgets.Label(contentRect, "WorkSpeedGlobal_NoJobsFound".Translate());
⋮----
// Calculate content height for scrolling
float contentHeight = workSpeedJobs.Count * 30f + 20f; // Extra padding
// Ensure the inner view rect height is at least the visible content area to prevent clipping the bottom buttons
var viewRect = new Rect(0, 0, contentRect.width - 20f, Mathf.Max(contentRect.height, contentHeight));
Widgets.BeginScrollView(contentRect, ref scrollPosition, viewRect);
⋮----
// Job entries (no header here since it's pinned above)
⋮----
var rowRect = new Rect(0, curY, viewRect.width, 25f);
// Alternate row colors
⋮----
GUI.color = new Color(0.1f, 0.1f, 0.1f, 0.3f);
Widgets.DrawBoxSolid(rowRect, GUI.color);
⋮----
// Job name
var nameRect = new Rect(rowRect.x + 5f, rowRect.y, maxJobNameWidth, rowRect.height);
var jobName = !string.IsNullOrEmpty(job.label) ? job.label.CapitalizeFirst() : job.defName;
Widgets.Label(nameRect, jobName);
// Gated checkbox - centered in column
var checkColumnRect = new Rect(nameRect.xMax + 10f, rowRect.y, gatedColumnWidth, rowRect.height);
var checkRect = new Rect(checkColumnRect.x + (checkColumnRect.width - 20f) / 2f, rowRect.y + (rowRect.height - 20f) / 2f, 20f, 20f);
bool isGated = settings.workSpeedGlobalJobGating.GetValueOrDefault(job.defName, true);
⋮----
Widgets.Checkbox(checkRect.position, ref newGated);
⋮----
// Immediately persist changes so other windows can see the update
settings.Write();
⋮----
var descriptionRect = new Rect(checkColumnRect.xMax + 10f, rowRect.y, rowRect.width - checkColumnRect.xMax - 15f, rowRect.height);
⋮----
Widgets.Label(descriptionRect, description);
⋮----
// Draw vertical separators
float sep1X = nameRect.xMax + 5f; // After job name
float sep2X = checkColumnRect.xMax + 5f; // After checkbox column
GUI.color = new Color(0.6f, 0.6f, 0.6f, 0.4f);
GUI.DrawTexture(new Rect(sep1X - 0.5f, rowRect.y, 1f, rowRect.height), BaseContent.WhiteTex);
GUI.DrawTexture(new Rect(sep2X - 0.5f, rowRect.y, 1f, rowRect.height), BaseContent.WhiteTex);
⋮----
Widgets.EndScrollView();
// Bottom buttons positioned relative to content area end
⋮----
var buttonRect = new Rect(inRect.x, buttonY, 120f, 30f);
if (Widgets.ButtonText(buttonRect, "WorkSpeedGlobal_EnableAll".Translate()))
⋮----
if (Widgets.ButtonText(buttonRect, "WorkSpeedGlobal_DisableAll".Translate()))
⋮----
if (Widgets.ButtonText(buttonRect, "WorkSpeedGlobal_ResetDefaults".Translate()))
⋮----
// Debug-only trace button
if (Prefs.DevMode && Widgets.ButtonText(buttonRect, "WorkSpeedGlobal_TraceWorkGivers".Translate()))
⋮----
private string GetJobDescription(WorkGiverDef job, bool isGated)
⋮----
if (isGated) return "WorkSpeedGlobal_JobStatus_Gated".Translate();
return "WorkSpeedGlobal_JobStatus_Ungated".Translate();
⋮----
private bool GetDefaultGatingForJob(WorkGiverDef job)
⋮----
// Default gating logic - gate production jobs, don't gate basic jobs
string name = job.defName.ToLower();
string label = !string.IsNullOrEmpty(job.label) ? job.label.ToLower() : "";
// Don't gate basic survival activities including manipulation
⋮----
// Manipulation and medical jobs that should never be gated
⋮----
if (name.Contains(k) || label.Contains(k)) return false;
⋮----
// Gate production activities
⋮----
if (name.Contains(k) || label.Contains(k)) return true;
⋮----
// Default to gated for ambiguous cases
⋮----
// -------- Trace helpers --------
private static IEnumerable<StatDef> ResolveRequiredStatsFor(WorkGiverDef job)
⋮----
// We will try to ask WorkSpeedGlobalHelper for the stats it found when it
// discovered these jobs. Different implementations may expose different method names.
// We attempt a few common/likely signatures to keep this window decoupled.
// If nothing is available, we fall back to WorkSpeedGlobal.
Type helperType = typeof(WorkSpeedGlobalHelper);
// Candidate method names returning IEnumerable<StatDef> for either WorkGiverDef or Type
⋮----
// one-parameter (WorkGiverDef) candidates
⋮----
// one-parameter (Type) candidates
⋮----
// 1) try WorkGiverDef parameter
⋮----
MethodInfo m = helperType.GetMethod(
⋮----
object r = m.Invoke(null, new object[] { job });
⋮----
// 2) try Type (giverClass) parameter
⋮----
object r = m.Invoke(null, new object[] { job.giverClass });
⋮----
// Fallback: the entire list was computed off WorkSpeedGlobal usage,
// so at minimum we can report that stat explicitly.
⋮----
private static string StatNames(IEnumerable<StatDef> stats)
⋮----
if (s != null) names.Add(s.defName);
⋮----
return string.Join(", ", names.ToArray());
⋮----
private void DumpWorkSpeedGlobalInfo()
⋮----
string desktop = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);
string filePath = Path.Combine(desktop, "WorkSpeedGlobalJobsTrace.txt");
using (var writer = new StreamWriter(filePath, false))
⋮----
writer.WriteLine("WorkSpeedGlobal Jobs Trace");
writer.WriteLine("==========================");
writer.WriteLine();
⋮----
writer.WriteLine("Excluded Jobs (never shown):");
foreach (var ex in excludedJobs) writer.WriteLine("  - " + ex);
⋮----
bool gated = settings.workSpeedGlobalJobGating.GetValueOrDefault(job.defName, true);
writer.WriteLine("DefName: " + job.defName);
writer.WriteLine("Label: " + (job.label ?? "(no label)"));
writer.WriteLine("WorkType: " + (job.workType != null ? job.workType.defName : "(none)"));
writer.WriteLine("GiverClass: " + (job.giverClass != null ? job.giverClass.FullName : "(null)"));
writer.WriteLine("Currently Gated: " + gated);
// Optional: list recipe stats/skills for DoBill givers
if (typeof(WorkGiver_DoBill).IsAssignableFrom(job.giverClass))
⋮----
.Where(r => r.workSpeedStat != null) // only those affected by speed
.Select(r => $"{r.defName} (Stat={r.workSpeedStat.defName}, Skill={(r.workSkill != null ? r.workSkill.defName : "none")})")
⋮----
writer.WriteLine("Recipes (with workSpeedStat/workSkill):");
⋮----
writer.WriteLine("  - " + rec);
⋮----
writer.WriteLine(new string('-', 40));
⋮----
Messages.Message("WorkSpeedGlobal job trace written to desktop.", MessageTypeDefOf.TaskCompletion, false);
</file>
<file path="1.6/Languages/ChineseSimplified/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- Basic/Primitive Tools -->
  <SurvivalTools_Axe.label>斧头</SurvivalTools_Axe.label>
  <SurvivalTools_Axe.description>为高效伐木工作而设计的基础林业工具。其重量级头部提供强大的冲击力，使其成为从事木材工作的殖民者不可或缺的工具。其平衡性和杠杆效应使其比临时切割方法更加有效。当生存需要时，也可作为可靠的近战武器。</SurvivalTools_Axe.description>
  <SurvivalTools_Axe.tools.0.label>手柄</SurvivalTools_Axe.tools.0.label>
  <SurvivalTools_Axe.tools.1.label>前端</SurvivalTools_Axe.tools.1.label>
  <SurvivalTools_Pickaxe.label>镐</SurvivalTools_Pickaxe.label>
  <SurvivalTools_Pickaxe.description>一种重要的采矿工具，具有固定在坚固手柄上的重型尖头。专门设计用于破碎硬岩石并高效提取有价值的材料。其集中力量和杠杆效应对于高产采矿作业至关重要。当情况需要时，也可作为临时武器使用。</SurvivalTools_Pickaxe.description>
  <SurvivalTools_Pickaxe.tools.0.label>手柄</SurvivalTools_Pickaxe.tools.0.label>
  <SurvivalTools_Pickaxe.tools.1.label>前端</SurvivalTools_Pickaxe.tools.1.label>
  <SurvivalTools_Hammer.label>锤子</SurvivalTools_Hammer.label>
  <SurvivalTools_Hammer.description>任何建筑项目的基础工具。这把多功能锤子提供了钉入紧固件、塑造材料和组装结构所需的精度和力量。对于从事建筑和维护工作的殖民者来说是不可或缺的。其平衡设计确保在长时间建筑工作期间以最小疲劳度提供有效打击。</SurvivalTools_Hammer.description>
  <SurvivalTools_Hammer.tools.0.label>手柄</SurvivalTools_Hammer.tools.0.label>
  <SurvivalTools_Hammer.tools.1.label>前端</SurvivalTools_Hammer.tools.1.label>
  <SurvivalTools_Sickle.label>镰刀</SurvivalTools_Sickle.label>
  <SurvivalTools_Sickle.description>一种专用农业工具，具有完美设计的弯曲刀片，用于收割作物和切割植物材料。其人体工程学设计允许高效、重复的切割动作，对用户造成最小的压力。对于高产农业经营和植物维护工作不可或缺。</SurvivalTools_Sickle.description>
  <SurvivalTools_Sickle.tools.0.label>手柄</SurvivalTools_Sickle.tools.0.label>
  <SurvivalTools_Sickle.tools.1.label>前端</SurvivalTools_Sickle.tools.1.label>
  <SurvivalTools_Hoe.label>锄头</SurvivalTools_Hoe.label>
  <SurvivalTools_Hoe.description>为土壤准备和种子种植而设计的基础农业工具。其尖锐设计有效地破碎土壤，创造最佳种植条件。对于建立高产农业经营和维持作物产量不可或缺。其坚固结构确保季节间的可靠性能。</SurvivalTools_Hoe.description>
  <SurvivalTools_Knife.label>刀</SurvivalTools_Knife.label>
  <SurvivalTools_Knife.description>一种多功能切割工具，具有对精密工作不可或缺的锋利刀刃。非常适合屠宰工作、医疗程序和一般切割任务。其平衡设计允许受控、精确的切割，而锋利的刀刃确保干净的工作。任何认真的殖民者的必备工具。</SurvivalTools_Knife.description>
  <SurvivalTools_HandSaw.label>手锯</SurvivalTools_HandSaw.label>
  <SurvivalTools_HandSaw.description>一种传统木工工具，具有精确切割齿的金属刀片，用于手动木材加工。对于需要定制切割木材和详细木工的建筑项目不可或缺。手锯的稳定节奏可能比电动工具需要更长时间，但提供出色的控制和精度。</SurvivalTools_HandSaw.description>
  <SurvivalTools_BoneSickle.label>骨镰刀</SurvivalTools_BoneSickle.label>
  <SurvivalTools_BoneSickle.description>一种由雕刻骨头制成的原始收割工具，具有磨锐的边缘。虽然不如其金属对应物耐用，但这种传统工具在收割作物和切割植物方面表现出色。其弯曲设计遵循已通过无数代农业工作证明其有效性的古老模式。</SurvivalTools_BoneSickle.description>
  <SurvivalTools_PrimitiveLever.label>撬棍</SurvivalTools_PrimitiveLever.label>
  <SurvivalTools_PrimitiveLever.description>一种由耐用材料制成的原始但有效的杠杆工具。对于拆卸结构、分离材料和执行基本机械操作不可或缺。代表了早期文明在没有先进技术的情况下为建筑和拆除工作开发实用解决方案的聪明才智。</SurvivalTools_PrimitiveLever.description>
  <SurvivalTools_Abacus.label>算盘</SurvivalTools_Abacus.label>
  <SurvivalTools_Abacus.description>一种古老的计算工具，在杆上排列可移动珠子以执行算术运算。对于组织研究数据、管理复杂计算和在没有先进计算设备的社会中保持准确记录不可或缺。代表数学思维和数据组织的基础。</SurvivalTools_Abacus.description>
  <!-- Industrial Tools -->
  <SurvivalTools_SteelKnife.label>钢刀</SurvivalTools_SteelKnife.label>
  <SurvivalTools_SteelKnife.description>一把精密锻造的钢刀，具有卓越的保锐性和耐用性。碳钢刀片通过广泛使用保持其锋利度，使其成为要求苛刻的屠宰和医疗工作的理想选择。人体工程学手柄为精细工作提供出色控制。</SurvivalTools_SteelKnife.description>
  <SurvivalTools_CrosscutSaw.label>横锯</SurvivalTools_CrosscutSaw.label>
  <SurvivalTools_CrosscutSaw.description>为高效木工和建筑工作设计的精密工业锯。其专门设计的齿和强化钢结构允许通过各种材料进行干净、精确的切割。对于大型建筑项目和先进木工工作不可或缺。</SurvivalTools_CrosscutSaw.description>
  <SurvivalTools_Wrench.label>扳手</SurvivalTools_Wrench.label>
  <SurvivalTools_Wrench.description>设计用于抓取、转动和操纵紧固件和机械部件的精密机械工具。对于维护工作、机器修理和需要精确调整的建筑项目至关重要。可调夹爪系统适应各种尺寸，同时提供最佳杠杆和控制。</SurvivalTools_Wrench.description>
  <SurvivalTools_Microscope.label>显微镜</SurvivalTools_Microscope.label>
  <SurvivalTools_Microscope.description>一种精密光学仪器，放大小物体和样本以进行详细检查。对于先进研究、生物学研究和科学分析不可或缺。</SurvivalTools_Microscope.description>
  <!-- Precision Tools -->
  <SurvivalTools_CarbidePick.label>硬质合金镐</SurvivalTools_CarbidePick.label>
  <SurvivalTools_CarbidePick.description>一种先进的采矿工具，具有碳化物尖端，在最苛刻的挖掘工作中保持其锋利度。精确设计的头部比标准工具更有效地切割岩石，而其强化结构确保在恶劣的采矿条件下具有卓越的耐用性。</SurvivalTools_CarbidePick.description>
  <SurvivalTools_PrecisionScalpel.label>精密手术刀</SurvivalTools_PrecisionScalpel.label>
  <SurvivalTools_PrecisionScalpel.description>一种由优质钢合金制成的超锋利外科器械。精心平衡的刀片通过反复消毒和使用保持其锋利度，而人体工程学手柄确保在精细医疗程序中的精确控制。先进医疗设施的标准设备。</SurvivalTools_PrecisionScalpel.description>
  <SurvivalTools_PowerDrill.label>电钻</SurvivalTools_PowerDrill.label>
  <SurvivalTools_PowerDrill.description>一种由内置电机驱动的机械化钻孔工具，能够精确快速地钻透坚硬材料。可变速电机和可互换钻头使其对建筑和机械工作极其有价值。需要定期维护以保持电机平稳运行。</SurvivalTools_PowerDrill.description>
  <!-- Spacer Tools -->
  <SurvivalTools_Multitool.label>闪耀世界多用工具</SurvivalTools_Multitool.label>
  <SurvivalTools_Multitool.description>一种在闪耀世界社会中家用机械体常用的高科技通用工具。这种先进设备能够无缝适应任何任务——建筑、采矿、林业、维护、拆除——使其成为终极的一体化生存工具。虽然为机械体设计，但由于生理相似性，人形生物完全可以使用。</SurvivalTools_Multitool.description>
  <SurvivalTools_Multitool.tools.0.label>手柄</SurvivalTools_Multitool.tools.0.label>
  <SurvivalTools_Multitool.tools.1.label>前端</SurvivalTools_Multitool.tools.1.label>
  <SurvivalTools_PileOfRags.label>一堆破布</SurvivalTools_PileOfRags.label>
  <SurvivalTools_PileOfRags.description>简单的清洁工具，由破布和织物碎片制成。对于基本的清洁工作很有用，但磨损很快。</SurvivalTools_PileOfRags.description>
  <!-- =================================================== -->
  <!-- 多用途通用工作工具 (WorkSpeedGlobal)                -->
  <!-- 新增工具定义需要本地化条目                         -->
  <!-- =================================================== -->
  <!-- 部落 / 原始阶层 -->
  <SurvivalTools_MultipurposeStoneTool.label>多用途石制工具</SurvivalTools_MultipurposeStoneTool.label>
  <SurvivalTools_MultipurposeStoneTool.description>一种粗糙但多功能的石制器具，打磨成可覆盖多种通用任务的形状。虽属原始，却能略微提升整体工作速度。</SurvivalTools_MultipurposeStoneTool.description>
  <SurvivalTools_CarvedBoneImplements.label>雕刻骨制多件工具</SurvivalTools_CarvedBoneImplements.label>
  <SurvivalTools_CarvedBoneImplements.description>一组精心雕刻并捆绑在一起的骨制小工具，供多用途使用。较脆弱，但造型高效，可带来显著的通用工作速度提升。</SurvivalTools_CarvedBoneImplements.description>
  <!-- 中世纪阶层 -->
  <SurvivalTools_ArtisansToolkit.label>工匠工具套件</SurvivalTools_ArtisansToolkit.label>
  <SurvivalTools_ArtisansToolkit.description>一套精心挑选的中世纪时期优质工具，用于制作、整形与装配。可提升多类任务的整体处理效率。</SurvivalTools_ArtisansToolkit.description>
  <SurvivalTools_WoodworkersKit.label>木工工具包</SurvivalTools_WoodworkersKit.label>
  <SurvivalTools_WoodworkersKit.description>一组专用锯、凿、刨与量具，优化于木材成形与榫卯作业。良好的组织与品质赋予显著的通用工作速度增益。</SurvivalTools_WoodworkersKit.description>
  <!-- 工业阶层 -->
  <SurvivalTools_MechanicsToolkit.label>机械技师工具箱</SurvivalTools_MechanicsToolkit.label>
  <SurvivalTools_MechanicsToolkit.description>一个整理良好的工业时代工具箱，内含精密扳手、量规、扭矩工具与快速取放的收纳。大幅改善通用任务流程与协调。</SurvivalTools_MechanicsToolkit.description>
  <SurvivalTools_WorkshopHammerDrill.label>重型车间锤击钻</SurvivalTools_WorkshopHammerDrill.label>
  <SurvivalTools_WorkshopHammerDrill.description>一台可更换冲击与旋转模块的重型动力锤击钻。其集成夹持与对准系统几乎加速所有机械或建造相关任务。</SurvivalTools_WorkshopHammerDrill.description>
  <!-- 超科技 / 闪耀阶层 -->
  <SurvivalTools_NanofabricatorInterface.label>纳米制造接口</SurvivalTools_NanofabricatorInterface.label>
  <SurvivalTools_NanofabricatorInterface.description>一个流线型的控制与增强模块，将用户动作与自适应纳米组装流程同步。显著提升通用任务执行效率。</SurvivalTools_NanofabricatorInterface.description>
  <SurvivalTools_OmniToolGauntlet.label>全域多能工具护臂</SurvivalTools_OmniToolGauntlet.label>
  <SurvivalTools_OmniToolGauntlet.description>一只前沿的模块化护臂，内嵌力场投射器、微型制造器与力对齐操作器。通过预测式优化提供无与伦比的通用工作速度提升。</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>
<file path="1.6/Languages/ChineseSimplified/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <NoTool>没有工具</NoTool>
  <ToolInUse>（使用中）</ToolInUse>
  <!-- Settings -->
  <SurvivalToolsSettingsCategory>基础工具</SurvivalToolsSettingsCategory>
  <Settings_BasicSection>基本设置</Settings_BasicSection>
  <Settings_DebugSection>调试设置</Settings_DebugSection>
  <Settings_HardcoreMode>极限模式</Settings_HardcoreMode>
  <Settings_HardcoreMode_Tooltip>大幅提升游戏难度，使工具成为生存必需品。没有合适的工具，殖民者将无法有效执行大多数工作任务。工具磨损速度也会增加50%，需要更频繁的更换和更好的工具管理。将游戏转变为真正依赖工具的生存体验。</Settings_HardcoreMode_Tooltip>
  <Settings_ExtraHardcoreMode>超极限模式</Settings_ExtraHardcoreMode>
  <Settings_ExtraHardcoreMode_Tooltip>终极难度：最极端的生存挑战。与极限模式结合时，殖民者在没有合适工具的情况下将变得完全无助。原本只是效率较低的任务（如徒手清洁或临时医疗护理）变得完全无法尝试。工具磨损速度比正常情况快87.5%，对工具生产和维护造成持续压力。使用下方复选框精确控制哪些工作类型需要工具依赖。警告：早期游戏变得极其困难——工具获取成为殖民地生存的关键！</Settings_ExtraHardcoreMode_Tooltip>
  <Settings_RequireCleaningTools>需要清洁工具</Settings_RequireCleaningTools>
  <Settings_RequireCleaningTools_Tooltip>强制殖民者在所有清洁任务中使用适当的清洁工具（如扫帚或拖把）。没有合适的工具，他们无法清洁地板、清除污垢或清理积雪。在极端难度模式下维持殖民地卫生的必要条件。</Settings_RequireCleaningTools_Tooltip>
  <Settings_RequireButcheryTools>需要屠宰工具</Settings_RequireButcheryTools>
  <Settings_RequireButcheryTools_Tooltip>要求在所有屠宰和宰杀作业中使用适当的切割工具（如刀具或切肉刀）。殖民者没有合适的刀具就无法处理肉类或宰杀动物。在硬核场景中对食物生产链至关重要。</Settings_RequireButcheryTools_Tooltip>
  <Settings_RequireMedicalTools>需要医疗工具</Settings_RequireMedicalTools>
  <Settings_RequireMedicalTools_Tooltip>强制在外科手术和高级医疗护理中使用专业医疗器械。没有适当的手术工具就无法进行手术，使医疗设备获取对殖民地健康和生存至关重要。</Settings_RequireMedicalTools_Tooltip>
  <Settings_ToolMapGen>废墟建筑中的工具</Settings_ToolMapGen>
  <Settings_ToolMapGen_Tooltip>在地图生成期间在古代废墟和坠毁结构中生成基本生存工具。这些风化的工具提供重要的早期游戏资源，但通常质量较低。在严酷难度模式下对于初期工具获取至关重要的殖民地来说是无价的。</Settings_ToolMapGen_Tooltip>
  <Settings_ToolLimit>工具携带限制</Settings_ToolLimit>
  <Settings_ToolLimit_Tooltip>限制殖民者同时在库存中最多携带2-3个工具（商队旅行除外）。强制殖民者之间进行战略工具管理和专业化。工具带和类似装备可以增加此限制。为工具使用添加现实的库存约束。</Settings_ToolLimit_Tooltip>
  <Settings_ToolDegradation>工具老化</Settings_ToolDegradation>
  <Settings_ToolDegradation_Tooltip>无论工具是否被使用都会老化。</Settings_ToolDegradation_Tooltip>
  <Settings_ToolDegradationRate>工具老化速度</Settings_ToolDegradationRate>
  <Settings_ToolOptimization>自动工具优化</Settings_ToolOptimization>
  <Settings_ToolOptimization_Tooltip>启用智能工具管理，殖民者会自动选择并携带最有效的工具来完成分配的工作。他们会根据需要升级到更好的工具并丢弃劣质的工具。如果您更喜欢手动工具控制或遇到模组材料的性能问题，请禁用此功能。</Settings_ToolOptimization_Tooltip>
  <Settings_PickupFromStorageOnly>限制从储存区域获取工具</Settings_PickupFromStorageOnly>
  <Settings_PickupFromStorageOnly_Tooltip>启用时，殖民者只能从指定的储存区域获取工具，保持更好的组织性并防止他们从工作区域抓取工具。禁用时，他们可以拾取家园区域中任何可访问的工具（排除被禁止或燃烧的物品），提供更多灵活性但控制性较少。</Settings_PickupFromStorageOnly_Tooltip>
  <Settings_AllowPacifistEquip>允许和平主义者装备生存工具</Settings_AllowPacifistEquip>
  <Settings_AllowPacifistEquip_Tooltip>允许和平主义殖民者装备被归类为武器的生存工具（如斧头、镐或刀具）。虽然这些工具具有战斗能力，但它们对于诸如砍伐树木、采矿或食物准备等工作任务至关重要。启用时，和平主义者可以使用这些工具进行生产性工作，同时仍然拒绝参与暴力。</Settings_AllowPacifistEquip_Tooltip>
  <Settings_DebugLogging>启用详细调试日志</Settings_DebugLogging>
  <Settings_DebugLogging_Tooltip>激活工具选择决策、自动拾取行为和工作-工具匹配逻辑的全面日志记录。对于故障排除工具问题或了解殖民者为什么选择特定工具至关重要。仅建议用于模组开发或遇到工具相关问题时使用。大量日志输出可能影响性能。</Settings_DebugLogging_Tooltip>
  <Settings_AutoTool>智能工作前工具拾取</Settings_AutoTool>
  <Settings_AutoTool_Tooltip>通过让殖民者在开始任何工作前自动获取最优工具来革命性地提高工作流程效率。他们会智能地交换工具、升级到更好的变体，并确保拥有合适的设备以实现最大生产力。基于工具的无缝游戏体验的核心功能。</Settings_AutoTool_Tooltip>
  <!-- Alerts -->
  <ColonistNeedsSurvivalTool>殖民者缺乏必要工具</ColonistNeedsSurvivalTool>
  <ColonistsNeedSurvivalTool>殖民者们缺乏必要工具</ColonistsNeedSurvivalTool>
  <ColonistNeedsSurvivalToolDesc>这些殖民者需要适当的工具来完成分配的工作，但缺乏必要的设备。他们的生产力严重受损。</ColonistNeedsSurvivalToolDesc>
  <SurvivalToolsNeedReplacing>工具即将损坏</SurvivalToolsNeedReplacing>
  <SurvivalToolNeedsReplacingDesc>这些殖民者正在使用即将损坏的工具。立即更换以避免工作中断。</SurvivalToolNeedsReplacingDesc>
  <!-- Tool assignment management -->
  <ManageSurvivalToolAssignments>管理工具配置</ManageSurvivalToolAssignments>
  <SurvivalToolAssignment>工具分配</SurvivalToolAssignment>
  <SurvivalToolAssignmentConstructor>建造</SurvivalToolAssignmentConstructor>
  <SurvivalToolAssignmentMiner>采矿</SurvivalToolAssignmentMiner>
  <SurvivalToolAssignmentPlantWorker>种植</SurvivalToolAssignmentPlantWorker>
  <SurvivalToolAssignmentResearcher>研究</SurvivalToolAssignmentResearcher>
  <SurvivalToolAssignmentCleaner>清洁</SurvivalToolAssignmentCleaner>
  <SurvivalToolAssignmentMedical>医疗</SurvivalToolAssignmentMedical>
  <SurvivalToolAssignmentButcher>屠宰</SurvivalToolAssignmentButcher>
  <SelectSurvivalToolAssignment>选择工具配置…</SelectSurvivalToolAssignment>
  <NewSurvivalToolAssignment>新工具配置</NewSurvivalToolAssignment>
  <DeleteSurvivalToolAssignment>删除工具配置…</DeleteSurvivalToolAssignment>
  <SurvivalToolAssignmentInUse>{0}正在使用工具配置</SurvivalToolAssignmentInUse>
  <NoSurvivalToolAssignmentSelected>没有选择工具配置</NoSurvivalToolAssignmentSelected>
  <ForcedSurvivalTools>强制工具</ForcedSurvivalTools>
  <!-- Settings -->
  <Settings_CompatLogging>启用兼容性调试日志</Settings_CompatLogging>
  <Settings_CompatLogging_Tooltip>激活模组兼容性系统的详细日志记录，包括Research Reinvented集成、统计检测和WorkGiver连线。显示兼容性设置和集成过程的逐步信息。仅在启用常规调试日志记录时显示。对诊断模组交互问题很有用。</Settings_CompatLogging_Tooltip>
  <!-- Resizable Settings Window -->
  <Settings_EnhancedWindowDescription>点击下方按钮打开增强的可调整大小设置窗口，包含所有模组选项。</Settings_EnhancedWindowDescription>
  <Settings_OpenEnhancedButton>打开增强设置</Settings_OpenEnhancedButton>
  <!-- Job Requirements Table -->
  <JobTable_JobTypes>工作类型</JobTable_JobTypes>
  <JobTable_JobType>工作类型</JobTable_JobType>
  <JobTable_NormalMode>普通模式</JobTable_NormalMode>
  <JobTable_HardcoreMode>极限模式</JobTable_HardcoreMode>
  <JobTable_ExtraHardcore>超极限</JobTable_ExtraHardcore>
  <JobTable_Enhanced>增强</JobTable_Enhanced>
  <JobTable_Required>必需</JobTable_Required>
  <JobTable_NoJobsFound>未找到工具增强的工作。</JobTable_NoJobsFound>
  <JobTable_SectionTitle>各模式下的工作工具需求</JobTable_SectionTitle>
  <JobTable_SectionTooltip>此表显示不同工作类型在各种难度模式下的行为。'增强'意味着工具提供奖励但不是必需的。'必需'意味着工具是执行工作所必需的。使用此表了解根据当前设置您的殖民者需要哪些工具。</JobTable_SectionTooltip>
  <!-- Job Table Headers -->
  <JobTable_Normal>普通</JobTable_Normal>
  <JobTable_Hardcore>硬核</JobTable_Hardcore>
  <JobTable_ExtraHardcore>极限硬核</JobTable_ExtraHardcore>
  <!-- Resizable Settings Window -->
  <Settings_EnhancedWindowDescription>点击下面的按钮打开带有所有模组选项的增强可调整大小设置窗口。</Settings_EnhancedWindowDescription>
  <Settings_OpenEnhancedButton>打开增强设置</Settings_OpenEnhancedButton>
  <!-- Mod Compatibility -->
  <Compat_ResearchReinvented>重新发明的研究</Compat_ResearchReinvented>
  <Compat_FieldResearch>实地研究</Compat_FieldResearch>
  <Compat_ReinventedResearchAlert>重新发明的研究</Compat_ReinventedResearchAlert>
  <!-- WorkSpeedGlobal 配置（新增） -->
  <!-- Added WorkSpeedGlobal translation keys -->
  <WorkSpeedGlobal_Title>通用工作速度任务配置</WorkSpeedGlobal_Title>
  <WorkSpeedGlobal_Description>选择哪些使用“通用工作速度”属性的工作需要生存工具进行限制。未限制的工作在缺少工具时不受惩罚。</WorkSpeedGlobal_Description>
  <WorkSpeedGlobal_JobTypeHeader>工作类型</WorkSpeedGlobal_JobTypeHeader>
  <WorkSpeedGlobal_GatedHeader>限制</WorkSpeedGlobal_GatedHeader>
  <WorkSpeedGlobal_DescriptionHeader>描述</WorkSpeedGlobal_DescriptionHeader>
  <WorkSpeedGlobal_NoJobsFound>未找到通用工作速度任务。</WorkSpeedGlobal_NoJobsFound>
  <WorkSpeedGlobal_EnableAll>全部启用</WorkSpeedGlobal_EnableAll>
  <WorkSpeedGlobal_DisableAll>全部禁用</WorkSpeedGlobal_DisableAll>
  <WorkSpeedGlobal_ResetDefaults>恢复默认</WorkSpeedGlobal_ResetDefaults>
  <WorkSpeedGlobal_TraceWorkGivers>跟踪工作提供者</WorkSpeedGlobal_TraceWorkGivers>
  <WorkSpeedGlobal_JobStatus_Gated>在硬核模式中需要工具</WorkSpeedGlobal_JobStatus_Gated>
  <WorkSpeedGlobal_JobStatus_Ungated>不适用工具惩罚</WorkSpeedGlobal_JobStatus_Ungated>
  <WorkSpeedGlobal_OpenConfigButton>配置通用工作速度任务</WorkSpeedGlobal_OpenConfigButton>
  <!-- Job Table Additional (新增) -->
  <JobTable_NoActiveMode>未选择任何模式。</JobTable_NoActiveMode>
  <JobTable_GatedFormat>限制 ({0}/{1})</JobTable_GatedFormat>
  <JobTable_GatedExample>限制 (99/99)</JobTable_GatedExample>
  <JobTable_Status_Unknown>未知</JobTable_Status_Unknown>
  <JobTable_Blocked>阻止</JobTable_Blocked>
</LanguageData>
</file>
<file path="1.6/Patches/Core/ThingDefs_Items/Items_Resource_Stuff.xml">
<Patch>
    <!-- Steel -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Steel"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>1.1</TreeFellingSpeed>
                    <ConstructionSpeed>1.1</ConstructionSpeed>
                    <DeconstructionSpeed>1.1</DeconstructionSpeed>
                    <DiggingSpeed>1.1</DiggingSpeed>
                    <MiningYieldDigging>1.1</MiningYieldDigging>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Silver -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Silver"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.7</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Gold -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Gold"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.6</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                    <DiggingSpeed>1.1</DiggingSpeed>
                    <MiningYieldDigging>1.1</MiningYieldDigging>
                    <ConstructionSpeed>1.1</ConstructionSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Plasteel -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Plasteel"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>1.3</TreeFellingSpeed>
                    <PlantHarvestingSpeed>1.3</PlantHarvestingSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Wood -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="WoodLog"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.6</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                    <DiggingSpeed>0.6</DiggingSpeed>
                    <MiningYieldDigging>0.8</MiningYieldDigging>
                    <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Uranium -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Uranium"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <DiggingSpeed>1.3</DiggingSpeed>
                    <MiningYieldDigging>1.1</MiningYieldDigging>
                    <ConstructionSpeed>1.3</ConstructionSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Jade -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Jade"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.9</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.9</PlantHarvestingSpeed>
                    <MiningYieldDigging>0.9</MiningYieldDigging>
                    <DiggingSpeed>1.1</DiggingSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
</Patch>
</file>
<file path="Source/AI/JobDriver_HarvestTree.cs">
//Rimworld 1.6 / C# 7.3
// Source/AI/JobDriver_HarvestTree.cs
⋮----
namespace SurvivalTools
⋮----
// Harvests tree yield, then clears the HarvestPlant designation.
public class JobDriver_HarvestTree : JobDriver_PlantWork
⋮----
protected override void Init()
⋮----
base.Init();
⋮----
protected override Toil PlantWorkDoneToil()
⋮----
var t = new Toil();
⋮----
var plant = Plant; // use base property which is null-safe
⋮----
// Call PlantCollected in a guarded way — signature mismatches on some RW variants caused crashes previously.
// We catch exceptions and only log when debug logging is enabled to avoid noisy spam.
⋮----
plant.PlantCollected(actor, PlantDestructionMode.Cut);
⋮----
Log.ErrorOnce($"[SurvivalTools] PlantCollected threw in JobDriver_HarvestTree for {plant} : {innerEx}", 9832174); // leave error unchanged
// Fallback: don't crash; we can't reliably emulate PlantCollected across versions here.
⋮----
Log.ErrorOnce($"[SurvivalTools] Unexpected exception in HarvestTree PlantWorkDoneToil.initAction: {ex}", 9832175); // leave error unchanged
</file>
<file path="Source/AI/JobDriver_PlantWork.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/JobDriver_PlantWork.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Base driver for plant work (felling/harvesting trees).
/// Adds defensive null checks, unified stat gating, and diagnostic logging.
/// </summary>
public abstract class JobDriver_PlantWork : JobDriver
⋮----
protected const TargetIndex PlantInd = TargetIndex.A;
public override bool TryMakePreToilReservations(bool errorOnFailed)
⋮----
if (target.IsValid && !pawn.Reserve(target, job, 1, -1, null, errorOnFailed))
⋮----
pawn.ReserveAsManyAsPossible(job?.GetTargetQueue(TargetIndex.A), job, 1, -1, null);
⋮----
protected override IEnumerable<Toil> MakeNewToils()
⋮----
yield return Toils_JobTransforms.MoveCurrentTargetIntoQueue(TargetIndex.A);
var initExtractTargetFromQueue = Toils_JobTransforms.ClearDespawnedNullOrForbiddenQueuedTargets(
⋮----
Map.designationManager.DesignationOn(t, RequiredDesignation) != null)
⋮----
yield return Toils_JobTransforms.SucceedOnNoTargetInQueue(TargetIndex.A);
yield return Toils_JobTransforms.ExtractNextTargetFromQueue(TargetIndex.A);
var gotoThing = Toils_Goto.GotoThing(TargetIndex.A, PathEndMode.Touch)
.JumpIfDespawnedOrNullOrForbidden(TargetIndex.A, initExtractTargetFromQueue);
⋮----
gotoThing.FailOnThingMissingDesignation(TargetIndex.A, RequiredDesignation);
gotoThing.FailOn(() => Plant == null);
⋮----
var cut = new Toil
⋮----
if (actor == null || actor.DestroyedOrNull() || plant == null || plant.Destroyed)
⋮----
// ✅ Unified stat gating
⋮----
StatGatingHelper.ShouldBlockJobForStat(ST_StatDefOf.TreeFellingSpeed, settings, actor))
⋮----
// Degrade tools and grant XP
SurvivalToolUtility.TryDegradeTool(actor, ST_StatDefOf.TreeFellingSpeed);
⋮----
float statValue = actor.GetStatValue(ST_StatDefOf.TreeFellingSpeed, true);
// Unified diagnostics
⋮----
// Trace best tool factor
var bestTool = actor.GetBestSurvivalTool(ST_StatDefOf.TreeFellingSpeed);
⋮----
if (!float.IsFinite(statValue) || statValue < 0f)
⋮----
float growth = Mathf.Clamp01(plant.Growth);
float workThisTick = statValue * Mathf.Lerp(3.3f, 1f, growth); // Mature plants need less extra effort
if (!float.IsFinite(workThisTick)) workThisTick = 0f;
workDone = Mathf.Clamp(workDone + workThisTick, 0f, float.MaxValue / 4f);
⋮----
if (!float.IsFinite(harvestWork) || harvestWork <= 0f) harvestWork = 1f;
⋮----
// Yield (safe)
⋮----
&& Rand.Value > actor.GetStatValue(StatDefOf.PlantHarvestYield, true))
⋮----
MoteMaker.ThrowText((actor.DrawPos + plant.DrawPos) * 0.5f, Map, "TextMote_HarvestFailed".Translate(), 3.65f);
⋮----
int yieldCount = plant.YieldNow();
⋮----
var product = ThingMaker.MakeThing(harvestedDef);
product.stackCount = Mathf.Max(1, yieldCount);
⋮----
product.SetForbidden(true, true);
GenPlace.TryPlaceThing(product, actor.Position, Map, ThingPlaceMode.Near);
⋮----
cut.FailOnDespawnedNullOrForbidden(TargetIndex.A);
⋮----
cut.FailOnThingMissingDesignation(TargetIndex.A, RequiredDesignation);
cut.FailOnCannotTouch(TargetIndex.A, PathEndMode.Touch);
cut.WithProgressBar(TargetIndex.A, () =>
⋮----
if (!float.IsFinite(total) || total <= 0f) total = 1f;
return Mathf.Clamp01(workDone / total);
⋮----
cut.PlaySustainerOrSound(() => Plant?.def?.plant?.soundHarvesting);
⋮----
yield return Toils_Jump.Jump(initExtractTargetFromQueue);
⋮----
public override void ExposeData()
⋮----
base.ExposeData();
Scribe_Values.Look(ref workDone, "workDone", 0f);
⋮----
protected virtual void Init() { }
⋮----
/// Subclasses should finalize the operation (destroy plant, call PlantCollected, etc.).
⋮----
protected virtual Toil PlantWorkDoneToil() => null;
</file>
<file path="Source/Compatibility/CompatAPI.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/CompatAPI.cs
//
// SurvivalTools Generic Compatibility API + Registry (single file)
⋮----
// - Public, mod-agnostic CompatAPI surface
// - Internal registry with pluggable modules (RR, Primitive Tools, Separate Tree Chopping)
// - Lightweight caching, null-safety, debug-only logging chatter
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// ---------- Module Interface ----------
public interface ICompatibilityModule
⋮----
void Initialize();
List<StatDef> GetCompatibilityStats();
Dictionary<string, string> GetDebugInfo();
⋮----
// ---------- Primitive Tools ----------
internal sealed class PrimitiveToolsCompatibilityModule : ICompatibilityModule
⋮----
public bool IsModActive => PrimitiveToolsHelpers.IsPrimitiveToolsActive();
public void Initialize()
⋮----
Log.Message($"[SurvivalTools Compat] Primitive Tools detected ({PrimitiveToolsHelpers.GetPrimitiveToolDefs().Count} defs).");
⋮----
public List<StatDef> GetCompatibilityStats() => new List<StatDef>(); // none added by PT
public Dictionary<string, string> GetDebugInfo()
⋮----
["Active"] = IsModActive.ToString(),
["Tool Count"] = PrimitiveToolsHelpers.GetPrimitiveToolDefs().Count.ToString(),
["Optimize?"] = PrimitiveToolsHelpers.ShouldOptimizeForPrimitiveTools().ToString()
⋮----
var conflicts = PrimitiveToolsHelpers.CheckForConflicts();
info["Conflicts"] = conflicts.Count > 0 ? string.Join("; ", conflicts) : "None";
⋮----
// ---------- Separate Tree Chopping ----------
internal sealed class SeparateTreeChoppingCompatibilityModule : ICompatibilityModule
⋮----
public bool IsModActive => SeparateTreeChoppingHelpers.IsSeparateTreeChoppingActive();
⋮----
// If both are handling tree felling, auto-prefer STC (safer UX).
if (SeparateTreeChoppingHelpers.ShouldAutoDisableSTTreeFelling())
⋮----
Log.Message("[SurvivalTools Compat] Auto-resolving tree felling overlap for Separate Tree Chopping...");
⋮----
if (!SeparateTreeChoppingHelpers.ApplyRecommendedResolution())
Log.Warning("[SurvivalTools Compat] Failed to auto-resolve tree felling conflict.");
⋮----
public List<StatDef> GetCompatibilityStats() => new List<StatDef>(); // none added by STC
⋮----
var map = new Dictionary<string, string> { ["Active"] = IsModActive.ToString() };
⋮----
map["Has Tree Conflict"] = SeparateTreeChoppingHelpers.HasTreeFellingConflict().ToString();
map["Recommended Resolution"] = SeparateTreeChoppingHelpers.GetRecommendedResolution().ToString();
var conflicts = SeparateTreeChoppingHelpers.CheckForConflicts();
map["Conflicts"] = conflicts.Count > 0 ? string.Join("; ", conflicts) : "None";
⋮----
// ---------- Research Reinvented ----------
internal sealed class ResearchReinventedCompatibilityModule : ICompatibilityModule
⋮----
public void Initialize() => RRHelpers.Initialize();
public List<StatDef> GetCompatibilityStats() => CompatAPI.GetAllResearchStats();
public Dictionary<string, string> GetDebugInfo() => RRHelpers.GetReflectionStatus();
⋮----
// ---------- Registry ----------
⋮----
internal static class CompatibilityRegistry
⋮----
public static void Initialize()
⋮----
Log.Message("[SurvivalTools Compat] Initializing module registry…");
⋮----
RegisterModule(new ResearchReinventedCompatibilityModule());
RegisterModule(new PrimitiveToolsCompatibilityModule());
RegisterModule(new SeparateTreeChoppingCompatibilityModule());
// New compat modules
// Register new compatibility modules explicitly so they are discoverable and type-checked at compile time.
try { RegisterModule(new CommonSenseCompatibilityModule()); } catch { }
try { RegisterModule(new SmarterConstructionCompatibilityModule()); } catch { }
try { RegisterModule(new SmarterDeconstructionCompatibilityModule()); } catch { }
try { RegisterModule(new TDEnhancementPackCompatibilityModule()); } catch { }
foreach (var m in Modules.Where(m => m.IsModActive))
⋮----
Log.Message($"[SurvivalTools Compat] Init {m.ModName}…");
⋮----
m.Initialize();
⋮----
Log.Error($"[SurvivalTools Compat] Failed to init {m.ModName}: {e}");
⋮----
Log.Error($"[SurvivalTools Compat] Registry init failed: {e}");
⋮----
public static void RegisterModule(ICompatibilityModule module)
⋮----
if (Modules.Any(m => string.Equals(m.ModName, module.ModName, StringComparison.OrdinalIgnoreCase)))
⋮----
Log.Message($"[SurvivalTools Compat] {module.ModName} already registered, skipping.");
⋮----
Modules.Add(module);
⋮----
public static IEnumerable<ICompatibilityModule> GetActiveModules() =>
Modules.Where(m => m.IsModActive);
public static ICompatibilityModule GetModule(string modName) =>
Modules.FirstOrDefault(m => m.ModName.Equals(modName, StringComparison.OrdinalIgnoreCase));
public static List<StatDef> GetAllCompatibilityStats()
⋮----
try { all.AddRange(m.GetCompatibilityStats()); }
catch (Exception e) { Log.Warning($"[SurvivalTools Compat] Stats from {m.ModName} failed: {e.Message}"); }
⋮----
return all.Where(s => s != null).Distinct().ToList();
⋮----
public static void DumpCompatibilityStatus()
⋮----
Log.Message("[SurvivalTools Compat] === Compatibility Modules Status ===");
⋮----
Log.Message($"[SurvivalTools Compat] Module: {m.ModName}");
Log.Message($"[SurvivalTools Compat]   Active: {m.IsModActive}");
⋮----
var info = m.GetDebugInfo();
foreach (var kv in info) Log.Message($"[SurvivalTools Compat]   {kv.Key}: {kv.Value}");
var stats = m.GetCompatibilityStats();
var statNames = (stats ?? new List<StatDef>()).Select(s => s != null ? s.defName : "null").ToArray();
Log.Message($"[SurvivalTools Compat]   Stats: {string.Join(", ", statNames)}");
⋮----
catch (Exception e) { Log.Message($"[SurvivalTools Compat]   Error: {e.Message}"); }
⋮----
Log.Message(string.Empty);
⋮----
Log.Message("[SurvivalTools Compat] === End Compatibility Status ===");
⋮----
// ---------- Public API ----------
public static class CompatAPI
⋮----
// — Research Reinvented (kept for backward compatibility with your call sites) —
⋮----
// Cached stat defs to avoid recursion/expensive lookups
private static StatDef _cachedResearchSpeed;
private static StatDef _cachedFieldResearchSpeed;
public static StatDef GetResearchSpeedStat()
⋮----
?? DefDatabase<StatDef>.GetNamedSilentFail("ResearchSpeed"));
⋮----
public static StatDef GetFieldResearchSpeedStat()
⋮----
?? (_cachedFieldResearchSpeed = DefDatabase<StatDef>.GetNamedSilentFail("FieldResearchSpeedMultiplier")
?? DefDatabase<StatDef>.GetNamedSilentFail("RR_FieldResearchSpeed")
?? DefDatabase<StatDef>.GetNamedSilentFail("FieldResearchSpeed"));
⋮----
/// <summary>
/// True if pawn has a survival tool (real or virtual) that provides research speed.
/// Works for both vanilla Research and RR’s Field Research.
/// </summary>
public static bool PawnHasResearchTools(Pawn pawn)
⋮----
if (researchStat != null && pawn.HasSurvivalToolFor(researchStat))
⋮----
if (fieldStat != null && pawn.HasSurvivalToolFor(fieldStat))
⋮----
public static bool IsRRWorkGiver(WorkGiverDef wg) => RRHelpers.IsRRWorkGiver(wg);
public static bool IsFieldResearchWorkGiver(WorkGiverDef wg) => RRHelpers.IsFieldResearchWorkGiver(wg);
// — Primitive Tools —
public static bool IsPrimitiveToolsActive => PrimitiveToolsHelpers.IsPrimitiveToolsActive();
public static bool PawnHasPrimitiveTools(Pawn pawn) => PrimitiveToolsHelpers.PawnHasPrimitiveTools(pawn);
public static List<Thing> GetPawnPrimitiveTools(Pawn pawn) => PrimitiveToolsHelpers.GetPawnPrimitiveTools(pawn);
public static bool ShouldOptimizeForPrimitiveTools() => PrimitiveToolsHelpers.ShouldOptimizeForPrimitiveTools();
// — Separate Tree Chopping —
public static bool IsSeparateTreeChoppingActive => SeparateTreeChoppingHelpers.IsSeparateTreeChoppingActive();
public static bool HasTreeFellingConflict() => SeparateTreeChoppingHelpers.HasTreeFellingConflict();
public static bool ApplyTreeFellingConflictResolution() => SeparateTreeChoppingHelpers.ApplyRecommendedResolution();
public static List<string> GetSeparateTreeChoppingRecommendations() => SeparateTreeChoppingHelpers.GetUserRecommendations();
// — Generic —
public static List<StatDef> GetAllCompatibilityStats() => CompatibilityRegistry.GetAllCompatibilityStats();
public static List<StatDef> GetAllResearchStats()
⋮----
if (r != null) list.Add(r);
if (f != null && !list.Contains(f)) list.Add(f);
⋮----
public static void DumpCompatibilityStatus() => CompatibilityRegistry.DumpCompatibilityStatus();
// Hot reload helper if you ever need to re-init on game load changes.
public static void ReinitializeRegistryForDebug()
⋮----
Log.Message("[SurvivalTools Compat] ReinitializeRegistryForDebug() called (dev only).");
⋮----
// -------------------------------------------------------------------------
// TEMPLATE for new compatibility modules
// Copy, rename, and fill in details when adding new mod integrations.
⋮----
/*
public class SomeOtherModCompatibilityModule : ICompatibilityModule
{
    public string ModName => "Some Other Mod";
    public bool IsModActive
    {
        get
        {
            // Example detection (by packageId or def presence)
            return ModsConfig.ActiveModsInLoadOrder.Any(m =>
                m.PackageId.Contains("author.somemod") ||
                m.Name.Contains("Some Other Mod"));
        }
    }
    public void Initialize()
    {
        if (IsModActive)
        {
            if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.IsCompatLogging())
                ST_Logging.LogInfo("[SurvivalTools Compat] SomeOtherMod detected and initialized.");
            // Perform setup or conflict resolution here
        }
    }
    public List<StatDef> GetCompatibilityStats()
    {
        // Return any StatDefs this mod introduces or uses
        return new List<StatDef>
        {
            // Example: DefDatabase<StatDef>.GetNamedSilentFail("SomeStat")
        };
    }
    public Dictionary<string, string> GetDebugInfo()
    {
        var info = new Dictionary<string, string>
        {
            ["Active"] = IsModActive.ToString(),
            ["Notes"] = "Fill in useful debug information here"
        };
        return info;
    }
}
*/
</file>
<file path="Source/DebugTools/ResearchReinventedPatchLogger.cs">
// RimWorld 1.6 / C# 7.3
// Source/DebugTools/ResearchReinventedPatchLogger.cs
//
// Debug utility for Research Reinvented compatibility diagnostics.
// Now runs only when triggered manually via the Debug Actions menu,
// and only shows if Research Reinvented is active.
⋮----
public static class ResearchReinventedPatchLogger
⋮----
public static void DumpRRDiagnostics()
⋮----
// Gate: only show when Research Reinvented is active
⋮----
Messages.Message("Research Reinvented not detected — debug action unavailable.", MessageTypeDefOf.RejectInput, false);
⋮----
var rrType = Type.GetType(rrTypeName);
⋮----
public static void DumpPatchesByHeuristics()
⋮----
var methods = Harmony.GetAllPatchedMethods()?.ToList();
if (methods.NullOrEmpty())
⋮----
var info = Harmony.GetPatchInfo(tgt);
⋮----
if (PatchLooksLikeRR(p, substrings)) matches.Add((p, "PREFIX"));
⋮----
if (PatchLooksLikeRR(p, substrings)) matches.Add((p, "POSTFIX"));
⋮----
if (PatchLooksLikeRR(p, substrings)) matches.Add((p, "TRANSPILER"));
⋮----
LogInfo($"[SurvivalTools] DumpRRHeur: target -> {tgt.FullDescriptionSafe()}");
⋮----
string pmDesc = p?.PatchMethod != null ? p.PatchMethod.FullDescriptionSafe() : "(unknown)";
⋮----
if (subs.Any(s => owner.IndexOf(s, StringComparison.OrdinalIgnoreCase) >= 0)) return true;
⋮----
if (subs.Any(s => asm.IndexOf(s, StringComparison.OrdinalIgnoreCase) >= 0)) return true;
if (subs.Any(s => typeFull.IndexOf(s, StringComparison.OrdinalIgnoreCase) >= 0)) return true;
⋮----
private static void TryDumpMethodPatches(Type type, string methodName)
⋮----
if (type == null || string.IsNullOrEmpty(methodName)) return;
⋮----
var method = type.GetMethod(methodName, BindingFlags.Public | BindingFlags.Static);
⋮----
var patches = Harmony.GetPatchInfo(method);
⋮----
LogInfo($"  PREFIX: {patch.PatchMethod.FullDescriptionSafe()} (Owner={patch.owner}, Priority={patch.priority}, Index={patch.index})");
⋮----
LogInfo($"  POSTFIX: {patch.PatchMethod.FullDescriptionSafe()} (Owner={patch.owner}, Priority={patch.priority}, Index={patch.index})");
⋮----
LogInfo($"  TRANSPILER: {patch.PatchMethod.FullDescriptionSafe()} (Owner={patch.owner}, Priority={patch.priority}, Index={patch.index})");
⋮----
private static void DumpAllLikelyRRPatches()
⋮----
var patchedMethods = Harmony.GetAllPatchedMethods()?.ToList();
⋮----
var info = Harmony.GetPatchInfo(method);
⋮----
if (IsLikelyRRPatch(p)) rrPatches.Add((p, "PREFIX"));
⋮----
if (IsLikelyRRPatch(p)) rrPatches.Add((p, "POSTFIX"));
⋮----
if (IsLikelyRRPatch(p)) rrPatches.Add((p, "TRANSPILER"));
⋮----
LogInfo($"[SurvivalTools] ResearchReinventedPatchLogger: RR-style patches on target -> {method.FullDescriptionSafe()}");
⋮----
private static bool IsLikelyRRPatch(Patch p)
⋮----
if (!string.IsNullOrEmpty(p.owner) &&
(p.owner.IndexOf("researchreinvented", StringComparison.OrdinalIgnoreCase) >= 0 ||
p.owner.IndexOf("petetimesix", StringComparison.OrdinalIgnoreCase) >= 0))
⋮----
if (!string.IsNullOrEmpty(asmName) &&
asmName.IndexOf("researchreinvented", StringComparison.OrdinalIgnoreCase) >= 0)
⋮----
if (!string.IsNullOrEmpty(typeFullName) &&
typeFullName.IndexOf("ResearchReinvented", StringComparison.OrdinalIgnoreCase) >= 0)
⋮----
// ignore reflection failures
⋮----
private static string FullDescriptionSafe(this MethodBase mb)
⋮----
var paramDesc = string.Join(", ", mi.GetParameters().Select(p => p.ParameterType.Name + " " + p.Name));
⋮----
var parms = string.Join(", ", mb.GetParameters().Select(p => p.ParameterType.Name));
⋮----
return mb.ToString();
</file>
<file path="Source/GameComponent_SurvivalToolsValidation.cs">
// RimWorld 1.6 / C# 7.3
// Source/GameComponent_SurvivalToolsValidation.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Game component that triggers job validation when a save is loaded
/// </summary>
public class GameComponent_SurvivalToolsValidation : GameComponent
⋮----
public override void FinalizeInit()
⋮----
// Trigger validation after game initialization with proper timing
⋮----
// Ensure any leftover deterministic counters from previous sessions/maps are cleared.
try { SurvivalToolUtility.ClearAllCounters(); } catch { }
// Immediate stat refresh - don't queue it, do it now before anything else
⋮----
// Then queue delayed validation to ensure jobs are checked after everything is settled
LongEventHandler.QueueLongEvent(() =>
⋮----
// Schedule validation for 3 seconds after load to ensure everything is settled
var ticksToWait = 180; // 3 seconds at 60 TPS
⋮----
// Schedule the ToolFactorCache activation at the same time so computed
// factors are cached only after the world is stable. This prevents
// early caching during PostLoadInit which has caused CTDs in the past.
SurvivalToolUtility.ToolFactorCache.ScheduleActivation(scheduledValidationTick);
⋮----
public override void GameComponentTick()
⋮----
// Execute delayed validation when the time comes
// Allow the ToolFactorCache to flip into Initialized when the scheduled tick arrives
SurvivalToolUtility.ToolFactorCache.CheckActivation();
⋮----
SurvivalToolValidation.ValidateExistingJobs("delayed validation after game load");
⋮----
public override void ExposeData()
⋮----
// Don't save hasValidatedThisSession - we want it to reset each time we load
base.ExposeData();
⋮----
/// Refresh stat factors for all existing survival tools on the map.
/// This fixes tools that were created with old stat calculation logic.
⋮----
private void RefreshAllToolStats()
⋮----
foreach (var thing in map.listerThings.ThingsInGroup(ThingRequestGroup.HaulableEver))
⋮----
// Force immediate stat factor initialization by accessing WorkStatFactors
// This triggers the lazy initialization we just added
var _ = tool.WorkStatFactors.ToList(); // Force evaluation
⋮----
// If this tool is held by a pawn, mark them for stat cache refresh
⋮----
refreshedPawns.Add(inventory.pawn);
⋮----
refreshedPawns.Add(equipment.pawn);
⋮----
// Force stat cache refresh for all pawns with refreshed tools
⋮----
pawn.workSettings.Notify_UseWorkPrioritiesChanged();
⋮----
// Force full stat recalculation
pawn.Notify_DisabledWorkTypesChanged();
</file>
<file path="Source/Harmony/Patch_EquipmentUtility_CanEquip_PacifistTools.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Part 1: Let pacifists equip Survival Tools that happen to be IsWeapon.
/// We do NOT change IsWeapon or other vanilla blocks (forbidden, biocode, etc.).
/// </summary>
⋮----
public static class Patch_EquipmentUtility_CanEquip_PacifistTools
⋮----
// Patch all overloads named CanEquip that look like: bool CanEquip(Thing, Pawn, out string, bool, ...)
static IEnumerable<MethodBase> TargetMethods()
⋮----
return AccessTools.GetDeclaredMethods(typeof(EquipmentUtility))
.Where(m => m.Name == "CanEquip" && m.ReturnType == typeof(bool))
.Where(m =>
⋮----
var p = m.GetParameters();
⋮----
&& typeof(Thing).IsAssignableFrom(p[0].ParameterType)
⋮----
&& p[2].ParameterType == typeof(string).MakeByRefType()
⋮----
// Postfix uses generic object parameters because we patch multiple overloads.
static void Postfix(ref bool __result, object __0, object __1)
⋮----
// Fast exits
⋮----
// Only care for things that vanilla considers weapons
⋮----
// Only affect pacifists (WorkTags.Violent disabled)
⋮----
if (!pawn.WorkTagIsDisabled(WorkTags.Violent)) return;
⋮----
// Unexpected pawn state â€” be conservative
⋮----
// Only our survival tools (via mod extension)
var ext = SurvivalToolProperties.For(def);
⋮----
// Respect normal vanilla restrictions
if (thing.IsForbidden(pawn)) return;
⋮----
// Passed all checks â€” allow equip for pacifist
⋮----
// Royalty-safe biocode check.
private static bool IsBiocodedForDifferentPawn(Thing t, Pawn pawn)
⋮----
// If something odd happens with a modded comp, be conservative
⋮----
// --------------------------------------------------------------------
// Part 2: Float menu providers (1.6 pipeline) for UNDRAFTED and DRAFTED
⋮----
/// <summary>Shared logic for both providers.</summary>
public abstract class FloatMenuOptionProvider_PacifistEquipToolsBase : FloatMenuOptionProvider
⋮----
// In 1.6 these are abstract and PROTECTED on the base class.
⋮----
protected override bool Multiselect => true; // allow multi-select contexts
⋮----
public override bool Applies(FloatMenuContext context)
⋮----
// At least one humanlike pacifist in this drafted state
return context.ValidSelectedPawns.Any(p =>
⋮----
p.WorkTagIsDisabled(WorkTags.Violent) &&
⋮----
public override bool TargetThingValid(Thing t, FloatMenuContext context)
⋮----
public override IEnumerable<FloatMenuOption> GetOptionsFor(Thing t, FloatMenuContext context)
⋮----
Pawn pawn = context.ValidSelectedPawns.FirstOrDefault(p =>
⋮----
p.CanReach(t, PathEndMode.ClosestTouch, Danger.Deadly) &&
p.CanReserve(t) &&
!t.IsForbidden(p));
⋮----
// --- Equip option ---
⋮----
string label = "Equip".Translate(t.LabelShort);
Action act = () =>
⋮----
if (pawn.DestroyedOrNull() || t.DestroyedOrNull()) return;
var job = JobMaker.MakeJob(JobDefOf.Equip, t);
⋮----
pawn.jobs.TryTakeOrderedJob(job, JobTag.Misc);
⋮----
yield return FloatMenuUtility.DecoratePrioritizedTask(
new FloatMenuOption(label, act, MenuOptionPriority.High, null, t),
⋮----
// --- Take to inventory option (let pacifists carry without equipping) ---
⋮----
// Prefer existing translation key if present; fallback to a simple composite string
⋮----
invLabel = "TakeToInventory".Translate(t.LabelShort);
⋮----
invLabel = "Take to inventory".TranslateSimple() + ": " + t.LabelShort;
⋮----
Action actInv = () =>
⋮----
var job = JobMaker.MakeJob(JobDefOf.TakeInventory, t);
⋮----
new FloatMenuOption(invLabel, actInv, MenuOptionPriority.Default, null, t),
⋮----
/// <summary>Provider shown while pawns are UNDRAFTED.</summary>
public sealed class FloatMenuOptionProvider_PacifistEquipTools_Undrafted
: FloatMenuOptionProvider_PacifistEquipToolsBase
⋮----
/// <summary>Provider shown while pawns are DRAFTED.</summary>
public sealed class FloatMenuOptionProvider_PacifistEquipTools_Drafted
</file>
<file path="Source/Helpers/ConditionalRegistration.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ConditionalRegistration.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Handles conditional registration/deregistration of SurvivalTools features
/// (currently only tree felling) based on settings and compat checks.
///
/// ðŸ”® Future: This can be expanded into a general-purpose feature toggle system.
///    Example: gating medical tool usage, research tool requirements, etc.,
///    with helpers to both disable and re-enable features at runtime instead of
///    only removing WorkGivers.
/// </summary>
public static class ConditionalRegistration
⋮----
public static void ApplyTreeFellingConditionals()
⋮----
ST_Logging.LogInfo($"[SurvivalTools] Applying tree felling conditionals: enabled={enabled}");
⋮----
private static void DisableTreeFellingFeatures()
⋮----
SafetyUtils.SafeExecute(() =>
⋮----
var fellTreesWG = DefDatabase<WorkGiverDef>.GetNamed("ST_FellTrees", errorOnFail: false);
⋮----
ST_Logging.LogInfo("[SurvivalTools] Disabled ST_FellTrees WorkGiver due to setting.");
⋮----
public static void ResetConditionals()
⋮----
public static bool IsTreeFellingEnabled()
⋮----
if (SeparateTreeChoppingHelpers.IsSeparateTreeChoppingActive() &&
SeparateTreeChoppingHelpers.HasTreeFellingConflict())
</file>
<file path="Source/Helpers/JobDefToWorkGiverDefHelper.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/JobDefToWorkGiverDefHelper.cs
⋮----
/// <summary>
/// Helper to map a JobDef to its associated WorkGiverDef.
/// Used in tool gating / stat checks when we need to trace
/// from the active job back to the workgiver logic that created it.
/// </summary>
public static class JobDefToWorkGiverDefHelper
⋮----
/// Explicit mappings (JobDef â†’ WorkGiverDef) for jobs where the link
/// is not obvious or where defName patterns are unreliable.
///
/// ðŸ”® Future: could be externalized to XML defs or settings for easier patching
/// by other mods (instead of hardcoding here).
⋮----
// Tree / plant harvesting
⋮----
// Mining
⋮----
// Construction (explicit)
{ "BuildRoof", "BuildRoofs" },   // vanilla 1.6
{ "RoofJob", "BuildRoofs" },     // legacy / some mods
// Hauling
⋮----
// Cleaning
⋮----
// Butchery
⋮----
// Research
⋮----
{ "FieldResearch", "Research" } // RR: extra job type
⋮----
/// Finds the WorkGiverDef that produces the given JobDef, if any.
⋮----
/// Order of resolution:
///  1. Check explicit hardcoded mapping table.
///  2. Special-case fallbacks (construction, RR jobs, plants, etc).
///  3. Heuristic: match job defName against WorkGiver defName or label.
⋮----
/// Returns null if nothing reasonable can be found.
⋮----
public static WorkGiverDef GetWorkGiverDefForJob(JobDef jobDef)
⋮----
// Step 1: explicit mapping
if (ExplicitJobToWorkGiverMap.TryGetValue(jobDef.defName, out string wgDefName))
⋮----
// Emit one cooldown-protected log when roofing mapping is used so we can verify resolution
⋮----
return DefDatabase<WorkGiverDef>.GetNamedSilentFail(wgDefName);
⋮----
// Step 2: special-case fallbacks
var defName = jobDef.defName.ToLower();
// ðŸ”¨ Construction (catch-all: build, construct, roof, floor, blueprints, frames)
if (defName.Contains("construct") || defName.Contains("build") ||
defName.Contains("roof") || defName.Contains("floor") ||
defName.Contains("blueprint") || defName.Contains("frame"))
⋮----
return DefDatabase<WorkGiverDef>.GetNamedSilentFail("ConstructGeneral")
?? DefDatabase<WorkGiverDef>.GetNamedSilentFail("BuildRoofs")
?? DefDatabase<WorkGiverDef>.GetNamedSilentFail("ConstructDeliverResources");
⋮----
// ðŸ“– Research Reinvented â€“ fieldwork jobs
if (defName.Contains("fieldresearch") || defName.Contains("survey"))
return DefDatabase<WorkGiverDef>.GetNamedSilentFail("Research");
// ðŸŒ± Plant work (catch-all: sow, harvest, cut)
if (defName.Contains("sow"))
return DefDatabase<WorkGiverDef>.GetNamedSilentFail("GrowerSow");
if (defName.Contains("harvest"))
return DefDatabase<WorkGiverDef>.GetNamedSilentFail("GrowerHarvest");
if (defName.Contains("cutplant"))
return DefDatabase<WorkGiverDef>.GetNamedSilentFail("PlantsCut");
// Step 3: heuristic fallback (best effort)
⋮----
.FirstOrDefault(wg =>
⋮----
(wg.defName.ToLower().Contains(defName) ||
(!string.IsNullOrEmpty(wg.label) && wg.label.ToLower().Contains(defName))));
</file>
<file path="Source/Helpers/StatGatingHelper.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/StatGatingHelper.cs
⋮----
/// <summary>
/// Centralized logic for stat gating and WorkGiver → stat mapping.
/// Replaces scattered versions in SurvivalToolUtility, Validation, and Scanner patches.
/// </summary>
public static class StatGatingHelper
⋮----
/// Determines whether a stat should block a job for the given pawn under current settings.
/// Integrates with Research Reinvented (RR) so research jobs behave like before.
⋮----
// Unified gating rules (vanilla + RR intent)
public static bool ShouldBlockJobForStat(StatDef stat, SurvivalToolsSettings settings, Pawn pawn = null)
⋮----
// Never hard-block CleaningSpeed or WorkSpeedGlobal here - these are handled
// by StatPart_SurvivalTool as a penalty-based fallback and should not abort jobs.
⋮----
// Core work stats (mining, construction, etc.) always gate in hardcore.
if (StatFilters.ShouldBlockJobForMissingStat(stat))
⋮----
bool result = pawn == null || !pawn.HasSurvivalToolFor(stat);
// Debug logging for deconstruction decisions
⋮----
ST_Logging.LogDebug(msg, $"StatGate_Deconstruct_{pawnId}");
⋮----
// Optional families — only hard-gate if explicitly enabled or in extra-hardcore.
⋮----
return (xhc || settings.requireCleaningTools) && (pawn == null || !pawn.HasSurvivalToolFor(stat));
⋮----
return (xhc || settings.requireButcheryTools) && (pawn == null || !pawn.HasSurvivalToolFor(stat));
⋮----
return (xhc || settings.requireMedicalTools) && (pawn == null || !pawn.HasSurvivalToolFor(stat));
// Research is **not** hard-blocked in normal hardcore — job may run but progress=~0 via StatPart.
⋮----
return xhc && (pawn == null || !pawn.HasSurvivalToolFor(stat));
// Extra-hardcore custom rules (RR or future packs)
if (xhc && settings.IsStatRequiredInExtraHardcore(stat))
⋮----
ST_Logging.LogDebug(msg, $"StatGate_Deconstruct_XHC_{pawnId}");
⋮----
/// Detect required stats for a WorkGiver by extension or defName patterns.
/// Covers vanilla WorkGivers that lack WorkGiverExtension.
⋮----
public static List<StatDef> GetStatsForWorkGiver(WorkGiverDef wgDef)
⋮----
// 1) Explicit extension wins
⋮----
if (fromExtension != null && fromExtension.Any())
return fromExtension.Where(s => s != null && s.RequiresSurvivalTool()).ToList();
// 2) Heuristics by defName
⋮----
// Research
if (name.Contains("research"))
stats.Add(ST_StatDefOf.ResearchSpeed);
// Cleaning
if (name.Contains("clean"))
stats.Add(ST_StatDefOf.CleaningSpeed);
// Roofing is construction
// (RimWorld vanilla def is "BuildRoofs"; other mods may include "roof" in name)
if (name == "buildroofs" || name.Contains("roof"))
stats.Add(StatDefOf.ConstructionSpeed);
// Construction vs maintenance vs deconstruction
// Build / construct / frames / blueprints => ConstructionSpeed
if (name.Contains("construct") || name.Contains("build") || name.Contains("frame") || name.Contains("blueprint"))
⋮----
// Repair / maintain => MaintenanceSpeed
if (name.Contains("repair") || name.Contains("maintain") || name.Contains("maintenance"))
stats.Add(ST_StatDefOf.MaintenanceSpeed);
// Deconstruct / remove / uninstall => DeconstructionSpeed
if (name.Contains("deconstruct") || name.Contains("remove") || name.Contains("uninstall"))
stats.Add(ST_StatDefOf.DeconstructionSpeed);
// Trees & plants
if (name.Contains("felltree") || name.Contains("chopwood") || name.Contains("cutwood"))
stats.Add(ST_StatDefOf.TreeFellingSpeed);
if (name.Contains("harvest") || name.Contains("plantscut"))
stats.Add(ST_StatDefOf.PlantHarvestingSpeed);
if (name.Contains("grow") || name.Contains("sow") || name.Contains("plant"))
stats.Add(ST_StatDefOf.SowingSpeed);
// Mining
if (name.Contains("mine") || name.Contains("drill"))
⋮----
stats.Add(ST_StatDefOf.DiggingSpeed);
stats.Add(ST_StatDefOf.MiningYieldDigging);
⋮----
// Butchery
if (name.Contains("butcher") || name.Contains("slaughter"))
⋮----
stats.Add(ST_StatDefOf.ButcheryFleshSpeed);
stats.Add(ST_StatDefOf.ButcheryFleshEfficiency);
⋮----
// Keep only real survival-tool stats, unique
return stats.Where(s => s != null && s.RequiresSurvivalTool()).Distinct().ToList();
⋮----
/// Centralized BuildRoof gating helper.
/// Returns true if the pawn should be blocked from BuildRoof jobs under current settings.
/// Produces a small logKey suitable for ShouldLogWithCooldown when needed.
⋮----
public static bool ShouldBlockBuildRoof(Pawn pawn, out string logKey, IntVec3? cell = null)
⋮----
if (settings == null || settings.extraHardcoreMode != true) return false; // only hard-block in extra-hardcore
// Respect general pawn/tool capability (mechs, prisoners, etc.)
if (!PawnToolValidator.CanUseSurvivalTools(pawn)) return false;
// ConstructionSpeed is the canonical stat for roofing
⋮----
// Build a compact log key: include pawn id and optional cell coordinates
⋮----
/*
    📌 NOTE FOR FUTURE ME:
    Mining yield (ST_StatDefOf.MiningYieldDigging) should generally be treated as *optional*.
    Pawns without tools should still be able to mine, they’ll just be less efficient.
    If you want to enforce this cleanly, update StatFilters.cs like so:
        public static bool IsOptionalStat(StatDef stat)
        {
            if (stat == null) return true;
            // Research, cleaning, medical, and mining yield are optional
            return stat == ST_StatDefOf.ResearchSpeed ||
                   stat == ST_StatDefOf.CleaningSpeed ||
                   stat == ST_StatDefOf.MedicalOperationSpeed ||
                   stat == ST_StatDefOf.MedicalSurgerySuccessChance ||
                   stat == ST_StatDefOf.ButcheryFleshEfficiency ||
                   stat == ST_StatDefOf.MiningYieldDigging; // 👈 new optional stat
        }
    That way mining *speed* stays mandatory (hardcore tool gating), but *yield* just becomes a bonus.
*/
</file>
<file path="Source/Helpers/SurvivalToolValidation.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/SurvivalToolValidation.cs
⋮----
/// <summary>
/// Utility class for validating existing jobs when settings change
/// </summary>
public static class SurvivalToolValidation
⋮----
/// Manual test method to trigger job validation for debugging
⋮----
public static void TestValidation()
⋮----
/*
    FUTURE ME NOTE:
    Pawns sometimes start loading with an `Ingest` job that still tries to use CleaningSpeed 
    (e.g., eating while also flagged for cleaning). Job validation normally ignores Ingest 
    since it has no WorkGiverDef, so these slip through.
    This helper can be called in JobValidation.ValidateExistingJobs() after the normal loop.
    It cancels Ingest jobs that wrongly require CleaningSpeed but the pawn has no tool 
    (or when hardcore gating is enabled).
*/
/*private static void CancelBadIngestJobs(Map map)
        {
            if (map == null) return;
            foreach (var pawn in map.mapPawns.FreeColonistsSpawned)
            {
                var job = pawn.CurJob;
                if (job != null && job.def == JobDefOf.Ingest)
                {
                    // Check if gating is active AND pawn lacks cleaning tools
                    var s = SurvivalTools.Settings;
                    bool enforce = SurvivalToolUtility.IsHardcoreModeEnabled || (s != null && s.extraHardcoreMode);
                    if (enforce && StatGatingHelper.ShouldBlockJobForStat(ST_StatDefOf.CleaningSpeed, s, pawn))
                    {
                        pawn.jobs.EndCurrentJob(JobCondition.InterruptForced, true);
                        if (ST_Logging.IsDebugLoggingEnabled)
                            LogDebug($"[SurvivalTools.JobValidation] Cancelled bad Ingest job for {pawn.LabelShort} (required CleaningSpeed, no tool).", $"JobValidation_Cancel_{pawn.ThingID}");
                    }
                }
            }
        }*/
⋮----
/// Last-ditch safety net: cancels obviously invalid jobs that sometimes slip through
/// normal validation (e.g., Ingest with CleaningSpeed requirement).
/// Called once after game load, or manually if needed.
⋮----
private static void CancelBadJobs(Map map)
⋮----
// Snapshot pawns to avoid "collection modified" exceptions when ending jobs
var pawns = map.mapPawns.FreeColonistsSpawned.ToList();
⋮----
// Special case: Ingest job that wrongly uses CleaningSpeed
⋮----
StatGatingHelper.ShouldBlockJobForStat(ST_StatDefOf.CleaningSpeed, s, pawn))
⋮----
// End the job and also set the JobTracker's per-pawn abort guard so we don't thrash
pawn.jobs.EndCurrentJob(JobCondition.InterruptForced, true);
// Try to set the lastAbortTickByPawn guard used in Patch_Pawn_JobTracker_ExtraHardcore
⋮----
// Try to find the patch type by full name or short name
var patchType = Type.GetType("SurvivalTools.Harmony.Patch_Pawn_JobTracker_ExtraHardcore")
?? Type.GetType("Patch_Pawn_JobTracker_ExtraHardcore")
?? AccessTools.TypeByName("SurvivalTools.Harmony.Patch_Pawn_JobTracker_ExtraHardcore")
?? AccessTools.TypeByName("Patch_Pawn_JobTracker_ExtraHardcore");
⋮----
var dictField = patchType.GetField("lastAbortTickByPawn", BindingFlags.NonPublic | BindingFlags.Static | BindingFlags.Public);
⋮----
var dictObj = dictField.GetValue(null);
⋮----
var dictType = dictObj.GetType();
// Use indexer property to set value by key
var indexer = dictType.GetProperty("Item");
⋮----
// key used in Patch_Pawn_JobTracker_ExtraHardcore is pawn.thingIDNumber
⋮----
indexer.SetValue(dictObj, tick, new object[] { key });
⋮----
catch { /* best-effort, swallow errors */ }
// Use centralized debug logging with cooldown to avoid per-pawn spam
⋮----
// 📝 Future me: add other edge-case checks here if new jobs show up.
⋮----
/// Validates all existing jobs across all pawns when settings change.
/// Cancels jobs that require tools the pawns don't have in hardcore mode.
⋮----
public static void ValidateExistingJobs(string reason)
⋮----
.Where(p => p.CanUseSurvivalTools()).ToList();
⋮----
// Map JobDef to WorkGiverDef for gating logic
var workGiverDef = JobDefToWorkGiverDefHelper.GetWorkGiverDefForJob(currentJob.def);
⋮----
// Only gate jobs that are eligible and enabled in settings
if (!SurvivalToolUtility.ShouldGateByDefault(workGiverDef))
⋮----
// Respect settings toggle for WorkSpeedGlobal jobs
if (settings.workSpeedGlobalJobGating != null && settings.workSpeedGlobalJobGating.TryGetValue(workGiverDef.defName, out bool gated) && !gated)
⋮----
var requiredStats = SurvivalToolUtility.RelevantStatsFor(null, currentJob.def);
if (requiredStats.NullOrEmpty())
⋮----
LogDebug($"[SurvivalTools.JobValidation] Required stats for {currentJob.def.defName}: {string.Join(", ", requiredStats.Select(s => s.defName))}", $"JobValidation_Stats_{currentJob.def.defName}");
⋮----
// ✅ Unified gating logic via StatGatingHelper
bool shouldBlock = StatGatingHelper.ShouldBlockJobForStat(stat, settings, pawn);
LogDebug($"[SurvivalTools.JobValidation] Stat {stat.defName}: shouldBlock={shouldBlock}, hasTool={pawn.HasSurvivalToolFor(stat)}", $"JobValidation_Stat_{pawn.ThingID}_{currentJob.def.defName}_{stat.defName}");
⋮----
pawn.jobs.EndCurrentJob(JobCondition.Incompletable, startNewJob: true, canReturnToPool: true);
⋮----
Messages.Message(
⋮----
//CancelBadIngestJobs(map);
CancelBadJobs(map); // Catch all bad jobs blocker on load *FUTURE ME*
</file>
<file path="Source/ModExtensions/SurvivalToolProperties.cs">
//Rimworld 1.6 / C# 7.3
// Source/ModExtensions/SurvivalToolProperties.cs
⋮----
namespace SurvivalTools
⋮----
public class SurvivalToolProperties : DefModExtension
⋮----
public static readonly SurvivalToolProperties defaultValues = new SurvivalToolProperties();
// Base stat factors a tool contributes (e.g., TreeFellingSpeed, DiggingSpeed)
// Initialize to avoid null checks everywhere.
⋮----
// Power multipliers applied to base stats based on material power factor
// Used to make better materials (devilstrand, hyperweave) more effective
⋮----
// Tags used by default survival tool assignments (untranslated keys/ids)
⋮----
// Multiplier for wear rate (1 = normal)
⋮----
/// <summary>
/// Convenience: get SurvivalToolProperties from a ThingDef (or defaultValues if none).
/// </summary>
public static SurvivalToolProperties For(ThingDef def)
⋮----
/// Check if this tool has any work stat factors defined.
⋮----
/// Check if this tool has any assignment tags defined.
⋮----
/// Get the modifier for a specific stat, or null if not found.
⋮----
public StatModifier GetStatModifier(StatDef stat)
⋮----
/// Get the factor value for a specific stat (1.0 if not found).
⋮----
public float GetStatFactor(StatDef stat)
⋮----
/// Check if this tool has a specific assignment tag.
⋮----
public bool HasAssignmentTag(string tag)
⋮----
return !string.IsNullOrEmpty(tag) && defaultSurvivalToolAssignmentTags?.Contains(tag) == true;
</file>
<file path="Source/ModExtensions/WorkGiverExtension.cs">
//RimWorld 1.6 / C# 7.3
// Source/ModExtensions/WorkGiverExtension.cs
⋮----
namespace SurvivalTools
⋮----
public class WorkGiverExtension : DefModExtension
⋮----
public static readonly WorkGiverExtension defaultValues = new WorkGiverExtension();
// Stats a pawn must meet to perform this WorkGiver. Keep non-null for easy consumption.
⋮----
/// <summary>
/// Convenience: get the extension for a WorkGiver def, or defaultValues if absent.
/// </summary>
public static WorkGiverExtension For(WorkGiverDef def)
⋮----
/// Check if this work giver has any required stats defined.
⋮----
/// Check if a specific stat is required by this work giver.
⋮----
public bool RequiresStat(StatDef stat)
⋮----
/// Get all required stats as a read-only enumerable.
⋮----
public IEnumerable<StatDef> GetRequiredStats()
</file>
<file path="Source/Stats/StatWorker_EstimatedLifespan.cs">
//RimWorld 1.6 / C# 7.3
// Source/Stats/StatWorker_EstimatedLifespan.cs
⋮----
namespace SurvivalTools
⋮----
public class StatWorker_EstimatedLifespan : StatWorker
⋮----
// Once per hour of continuous work, or ~40 mins with hardcore enabled.
⋮----
Mathf.RoundToInt(GenDate.TicksPerHour * (SurvivalToolUtility.IsHardcoreModeEnabled ? 0.67f : 1f));
⋮----
public override bool ShouldShowFor(StatRequest req)
⋮----
// Only show for buildables that are survival tools, and when degradation is on.
⋮----
if (bdef == null || !bdef.IsSurvivalTool()) return false;
⋮----
public override float GetValueUnfinalized(StatRequest req, bool applyPostProcess = true)
⋮----
public override string GetExplanationUnfinalized(StatRequest req, ToStringNumberSense numberSense)
⋮----
return $"{"StatsReport_BaseValue".Translate()}: {GetBaseEstimatedLifespan(tool, bdef).ToString("F1")}";
⋮----
private float GetBaseEstimatedLifespan(SurvivalTool tool, BuildableDef def)
⋮----
// For def (no specific instance)
⋮----
var props = SurvivalToolProperties.For(thingDef);
var maxHP = def.GetStatValueAbstract(StatDefOf.MaxHitPoints);
⋮----
return GenDate.TicksToDays(Mathf.RoundToInt((BaseWearInterval * maxHP) / wear));
⋮----
// For specific instance (stuff + HP)
var stuffProps = StuffPropsTool.For(tool.Stuff);
var tProps = SurvivalToolProperties.For(tool.def);
⋮----
return GenDate.TicksToDays(Mathf.RoundToInt((BaseWearInterval * tool.MaxHitPoints) / wearFactor));
⋮----
public override void FinalizeValue(StatRequest req, ref float val, bool applyPostProcess)
⋮----
base.FinalizeValue(req, ref val, applyPostProcess);
⋮----
public override string GetExplanationFinalizePart(StatRequest req, ToStringNumberSense numberSense, float finalVal)
⋮----
var sb = new StringBuilder();
sb.AppendLine($"{"Settings_ToolDegradationRate".Translate()}: {(1f / factor).ToStringByStyle(ToStringStyle.FloatTwo, ToStringNumberSense.Factor)}");
sb.AppendLine();
sb.AppendLine(base.GetExplanationFinalizePart(req, numberSense, finalVal));
return sb.ToString();
</file>
<file path="Source/SurvivalToolForcedHandler.cs">
// RimWorld 1.6 / C# 7.3
// Source/SurvivalToolForcedHandler.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Tracks tools the player has explicitly "forced" a pawn to keep.
/// </summary>
public class SurvivalToolForcedHandler : IExposable
⋮----
// We deliberately store Thing references; RimWorld's cross-ref resolver will rebind them on load.
⋮----
public void ExposeData()
⋮----
Scribe_Collections.Look(ref forcedTools, "forcedTools", LookMode.Reference);
⋮----
// Prune stale entries (null/destroyed) that can appear in old saves or when items were removed.
⋮----
forcedTools.RemoveAt(i);
⋮----
public bool IsForced(Thing tool)
⋮----
// If a destroyed thing remains, quietly remove it and treat as not forced.
⋮----
return forcedTools != null && forcedTools.Contains(tool);
⋮----
public bool AllowedToAutomaticallyDrop(Thing tool) => !IsForced(tool);
⋮----
public void SetForced(Thing tool, bool forced)
⋮----
if (!tool.Destroyed && !forcedTools.Contains(tool))
forcedTools.Add(tool);
⋮----
forcedTools.Remove(tool);
⋮----
public void Reset() => forcedTools?.Clear();
⋮----
// Expose the backing list for existing code that expects a mutable list.
</file>
<file path="Source/ToolAssignments/Dialog_ManageSurvivalToolAssignments.cs">
//RimWorld 1.6 / C# 7.3
// Source/ToolAssignments/Dialog_ManageSurvivalToolAssignments.cs
⋮----
namespace SurvivalTools
⋮----
public class Dialog_ManageSurvivalToolAssignments : Window
⋮----
private static ThingFilter survivalToolGlobalFilter;
private SurvivalToolAssignment selSurvivalToolAssignmentInt;
⋮----
survivalToolGlobalFilter = new ThingFilter();
survivalToolGlobalFilter.SetAllow(ST_ThingCategoryDefOf.SurvivalTools, true);
⋮----
private void EnsureSelectedHasName()
⋮----
if (selSurvivalToolAssignmentInt != null && selSurvivalToolAssignmentInt.label.NullOrEmpty())
⋮----
// Make sure we assign a string (TaggedString.ToString() -> string) so the conditional operator
// elsewhere also has a string result and we don't mix TaggedString/string types.
selSurvivalToolAssignmentInt.label = "Unnamed".Translate().ToString();
⋮----
public override Vector2 InitialSize => new Vector2(700f, 700f);
public override void DoWindowContents(Rect inRect)
⋮----
var rectSelect = new Rect(x, 0f, TopButtonWidth, TopButtonHeight);
⋮----
if (Widgets.ButtonText(rectSelect, "SelectSurvivalToolAssignment".Translate()))
⋮----
Messages.Message("NoSurvivalToolDatabase".Translate(), MessageTypeDefOf.RejectInput);
⋮----
opts.Add(new FloatMenuOption(local.label, () => SelectedSurvivalToolAssignment = local));
⋮----
Find.WindowStack.Add(new FloatMenu(opts));
⋮----
var rectNew = new Rect(x, 0f, TopButtonWidth, TopButtonHeight);
⋮----
if (Widgets.ButtonText(rectNew, "NewSurvivalToolAssignment".Translate(), active: true, doMouseoverSound: false, drawBackground: true))
⋮----
var created = db.MakeNewSurvivalToolAssignment();
⋮----
var rectDelete = new Rect(x, 0f, TopButtonWidth, TopButtonHeight);
if (Widgets.ButtonText(rectDelete, "DeleteSurvivalToolAssignment".Translate(), active: true, doMouseoverSound: false, drawBackground: true))
⋮----
opts.Add(new FloatMenuOption(local.label, () =>
⋮----
var rep = db.TryDelete(local);
⋮----
Messages.Message(rep.Reason, MessageTypeDefOf.RejectInput, historical: false);
⋮----
var mainRect = new Rect(0f, TopAreaHeight, inRect.width, inRect.height - TopAreaHeight - CloseButSize.y).ContractedBy(10f);
⋮----
Widgets.Label(mainRect, "NoSurvivalToolAssignmentSelected".Translate());
⋮----
GUI.BeginGroup(mainRect);
// Name field
var nameRect = new Rect(0f, 0f, 300f, 30f);
Widgets.Label(new Rect(nameRect.x, nameRect.y, 70f, nameRect.height), "Name".Translate() + ":");
var nameEditRect = new Rect(nameRect.x + 75f, nameRect.y, nameRect.width - 75f, nameRect.height);
// Only update the label if the text actually changed to avoid constant writes.
var newName = Widgets.TextField(nameEditRect, nameBuffer ?? string.Empty, 64);
⋮----
// Ensure both branches of the ?: are the same type (string) to avoid C# 7.3 conditional typing issues.
SelectedSurvivalToolAssignment.label = nameBuffer.NullOrEmpty()
? "Unnamed".Translate().ToString()
⋮----
// Filter config
var filterRect = new Rect(0f, TopAreaHeight, 300f, mainRect.height - 45f - 10f);
⋮----
// Use UIState rather than Vector2
ThingFilterUI.DoThingFilterConfigWindow(filterRect, filterUiState, filter, parentFilter, openMask);
GUI.EndGroup();
⋮----
public override void PreClose()
⋮----
base.PreClose();
</file>
<file path="Source/ToolAssignments/PawnColumnWorker_SurvivalToolAssignment.cs">
// Rimworld 1.6 / C# 7.3
// Source/ToolAssignments/PawnColumnWorker_SurvivalToolAssignment.cs
⋮----
namespace SurvivalTools
⋮----
public sealed class PawnColumnWorker_SurvivalToolAssignment : PawnColumnWorker
⋮----
public override void DoHeader(Rect rect, PawnTable table)
⋮----
base.DoHeader(rect, table);
var manageRect = new Rect(rect.x, rect.y + (rect.height - 65f), Mathf.Min(rect.width, 360f), 32f);
if (Widgets.ButtonText(manageRect, "ManageSurvivalToolAssignments".Translate()))
⋮----
Find.WindowStack.Add(new Dialog_ManageSurvivalToolAssignments(null));
⋮----
public override void DoCell(Rect rect, Pawn pawn, PawnTable table)
⋮----
int leftWidth = Mathf.FloorToInt((rect.width - 4f) * 0.71428573f);
int rightWidth = Mathf.FloorToInt((rect.width - 4f) * 0.2857143f);
⋮----
// Selection dropdown
var ddRect = new Rect(curX, rect.y + 2f, leftWidth, rect.height - 4f);
⋮----
var buttonLabel = (tracker.CurrentSurvivalToolAssignment?.label ?? "Unnamed").Truncate(ddRect.width);
Widgets.Dropdown(
⋮----
// Clear forced tools button (if any)
⋮----
var clearRect = new Rect(curX, rect.y + 2f, rightWidth, rect.height - 4f);
if (Widgets.ButtonText(clearRect, "ClearForcedApparel".Translate()))
⋮----
tracker.forcedHandler.Reset();
⋮----
TooltipHandler.TipRegion(clearRect, new TipSignal(() =>
⋮----
var text = "ForcedSurvivalTools".Translate() + ":\n";
⋮----
}, pawn.GetHashCode() * 128));
⋮----
// Edit current assignment
var editRect = new Rect(curX, rect.y + 2f, rightWidth, rect.height - 4f);
if (Widgets.ButtonText(editRect, "AssignTabEdit".Translate()))
⋮----
Find.WindowStack.Add(new Dialog_ManageSurvivalToolAssignments(tracker.CurrentSurvivalToolAssignment));
⋮----
private IEnumerable<Widgets.DropdownMenuElement<SurvivalToolAssignment>> Button_GenerateMenu(Pawn pawn)
⋮----
option = new FloatMenuOption(local.label, () =>
⋮----
public override int GetMinWidth(PawnTable table) =>
Mathf.Max(base.GetMinWidth(table), Mathf.CeilToInt(194f));
public override int GetOptimalWidth(PawnTable table) =>
Mathf.Clamp(Mathf.CeilToInt(251f), GetMinWidth(table), GetMaxWidth(table));
public override int GetMinHeaderHeight(PawnTable table) =>
Mathf.Max(base.GetMinHeaderHeight(table), PawnColumnWorker_Outfit.TopAreaHeight);
public override int Compare(Pawn a, Pawn b) =>
GetValueToCompare(a).CompareTo(GetValueToCompare(b));
private int GetValueToCompare(Pawn pawn)
</file>
<file path="Source/ToolAssignments/SurvivalToolAssignment.cs">
// Rimworld 1.6 / C# 7.3
// Source/ToolAssignments/SurvivalToolAssignment.cs
⋮----
namespace SurvivalTools
⋮----
public class SurvivalToolAssignment : IExposable, ILoadReferenceable
⋮----
public ThingFilter filter = new ThingFilter();
⋮----
this.label = string.IsNullOrEmpty(label) ? "Unnamed" : label;
if (filter == null) filter = new ThingFilter();
⋮----
public void ExposeData()
⋮----
Scribe_Values.Look(ref uniqueId, "uniqueId", 0);
Scribe_Values.Look(ref label, "label", "Unnamed");
Scribe_Deep.Look(ref filter, "filter");
⋮----
if (string.IsNullOrEmpty(label)) label = "Unnamed";
⋮----
// ILoadReferenceable: keep a stable reference key independent of label changes
public string GetUniqueLoadID() => $"SurvivalToolAssignment_{uniqueId}";
public override string ToString() => $"{label} (ID: {uniqueId})";
// QoL helpers (non-breaking)
public string LabelCap => (label ?? "Unnamed").CapitalizeFirst();
public bool Allows(Thing t) => filter != null && t != null && filter.Allows(t);
public void Rename(string newLabel) => label = string.IsNullOrEmpty(newLabel) ? "Unnamed" : newLabel.Trim();
</file>
<file path="Source/ToolUtility.cs">
// RimWorld 1.6 / C# 7.3
// Source/ToolUtility.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Defines the types of survival tools available.
/// </summary>
⋮----
/// Utility methods for survival tool identification, selection, and job-to-tool mapping.
⋮----
public static class ToolUtility
⋮----
private static readonly StatDef[] Stats_Saw = { ST_StatDefOf.DeconstructionSpeed }; // optional alias for deconstruction
private static IEnumerable<StatDef> StatsForKind(STToolKind kind)
⋮----
private static STToolKind KindForStats(IEnumerable<StatDef> stats)
⋮----
var set = new HashSet<StatDef>(stats.Where(s => s != null));
if (set.Overlaps(Stats_Pick)) return STToolKind.Pick;
if (set.Overlaps(Stats_Axe)) return STToolKind.Axe;
if (set.Overlaps(Stats_Sickle)) return STToolKind.Sickle;
if (set.Overlaps(Stats_Hoe)) return STToolKind.Hoe;
if (set.Overlaps(Stats_Hammer)) return STToolKind.Hammer;
if (set.Overlaps(Stats_Wrench)) return STToolKind.Wrench;
if (set.Overlaps(Stats_Cleaning)) return STToolKind.Cleaning;
if (set.Overlaps(Stats_Medical)) return STToolKind.Medical;
if (set.Overlaps(Stats_Research)) return STToolKind.Research;
if (set.Overlaps(Stats_Knife)) return STToolKind.Knife;
if (set.Overlaps(Stats_Saw)) return STToolKind.Saw;
⋮----
/// Public wrapper to determine the STToolKind implied by a set of StatDefs.
/// Used by other modules that only have stat lists available.
⋮----
public static STToolKind ToolKindForStats(IEnumerable<StatDef> stats)
⋮----
private static bool Overlaps(this HashSet<StatDef> a, IEnumerable<StatDef> b) =>
b != null && b.Any(a.Contains);
⋮----
/// Determines whether a Thing should be treated as a virtual survival tool.
/// Virtual tools are non-SurvivalTool Things (usually stuff/material stacks) that
/// provide survival tool work stats via SurvivalToolProperties or statBases.
/// Unlike real SurvivalTool instances they are transient wrappers at runtime.
⋮----
public static bool IsVirtualTool(Thing t)
⋮----
// Already an actual SurvivalTool instance (includes VirtualSurvivalTool subclass) => not virtual by this predicate.
if (t is SurvivalTool) return t is VirtualTool; // Only treat the dedicated wrapper subclass as virtual.
⋮----
// Must NOT be minified buildings, corpses, pawns, plants, filth, chunks, apparel, weapons, ingestibles etc.
// Fast negative filters to avoid misclassification in hauling / reservation systems.
// Fast negatives; avoid reflection or expensive checks. Exclude ingestibles (raw food, meals), apparel, weapons, corpses, plants, filth.
⋮----
// If def is explicitly a SurvivalTool (thingClass assignable) it's not a virtual tool.
if (typeof(SurvivalTool).IsAssignableFrom(def.thingClass)) return false;
// Require mod extension or statBases with survival tool stats.
⋮----
bool hasExtFactors = ext?.baseWorkStatFactors != null && ext.baseWorkStatFactors.Any(m => m?.stat != null && m.value != 0f);
// Also consider statBases providing survival tool stats directly (e.g., WorkSpeedGlobal tool-stuff patches)
⋮----
// Heuristic: if stat requires a survival tool or is one of known survival tool stats.
if (sb.stat.defName.StartsWith("ST_")) { hasRelevantStatBase = true; break; }
⋮----
// Material / stuff items: prefer IsToolStuff extension when available to narrow.
if (def.IsToolStuff()) return true;
// Fallback: ensure it's a small haulable resource (category Item) to avoid buildings.
⋮----
/// Attempt to wrap a qualifying Thing as a VirtualTool; returns null if not virtual.
/// Centralized to avoid scattered FromThing calls and repeated predicate logic.
⋮----
public static VirtualTool TryWrapVirtual(Thing thing)
⋮----
return VirtualTool.FromThing(thing);
⋮----
/// Determine tool kind by defName/label and, for tool-stuff, by its SurvivalToolProperties stats.
⋮----
public static STToolKind ToolKindOf(Thing t)
⋮----
// Tool-stuff: infer kind from provided stats
if (t.def.IsToolStuff())
⋮----
var stats = props.baseWorkStatFactors.Where(m => m?.stat != null).Select(m => m.stat).ToList();
⋮----
// Specifics before generics (avoid "pickaxe" -> axe)
if (s.Contains("pickaxe") || s.Contains("pick")) return STToolKind.Pick;
if (s.Contains("sickle")) return STToolKind.Sickle;
if (s.Contains("hammer") || s.Contains("mallet")) return STToolKind.Hammer;
if (s.Contains("wrench") || s.Contains("prybar") || s.Contains("primitivelever")) return STToolKind.Wrench;
if (s.Contains("hatchet")) return STToolKind.Axe;
if (s.Contains("axe")) return STToolKind.Axe;
if (s.Contains("hoe")) return STToolKind.Hoe;
if (s.Contains("saw")) return STToolKind.Saw;
if (s.Contains("knife")) return STToolKind.Knife;
// Research
if (s.Contains("microscope") || s.Contains("telescope") || s.Contains("sextant") ||
s.Contains("calculator") || s.Contains("computer") || s.Contains("analyzer") ||
s.Contains("scanner") || s.Contains("spectrometer") || s.Contains("datapad") ||
s.Contains("tablet") || s.Contains("laptop")) return STToolKind.Research;
// Medical
if (s.Contains("scalpel") || s.Contains("forceps") || s.Contains("stethoscope") ||
s.Contains("syringe") || s.Contains("surgical") || s.Contains("medkit")) return STToolKind.Medical;
// Cleaning via properties on any ThingWithComps
⋮----
bool hasClean = props2.baseWorkStatFactors.Any(m => m?.stat == ST_StatDefOf.CleaningSpeed);
bool hasMed = props2.baseWorkStatFactors.Any(m => m?.stat == ST_StatDefOf.MedicalOperationSpeed || m?.stat == ST_StatDefOf.MedicalSurgerySuccessChance);
if (hasMed) return STToolKind.Medical;  // fix: medical should not fall through to cleaning
⋮----
// Traditional cleaning names
if (s.Contains("broom") || s.Contains("mop") || s.Contains("rags") ||
s.Contains("sponge") || s.Contains("towel")) return STToolKind.Cleaning;
// Known fabrics we patch as tool-stuff for cleaning/research/medical
⋮----
/// True if this Thing is a survival tool (real tool, tool-stuff, or recognized by name).
⋮----
public static bool IsSurvivalTool(Thing t)
⋮----
// Prefer comp detection (keeps compatibility without hard deps on the actual comp type)
if (t is ThingWithComps twc && twc.AllComps.Any(c => c.GetType().Name.Contains("CompSurvivalTool")))
⋮----
/// Expected tool kind for a job. Prefers stat-based mapping, falls back to name heuristics.
⋮----
public static STToolKind ExpectedToolFor(Pawn pawn, Job job)
⋮----
// 1) Stat-based mapping (more reliable & mod-friendly)
var stats = SurvivalToolUtility.StatsForJob(job.def, pawn);
⋮----
// 2) Heuristic fallback (names/driver)
⋮----
string s = (jn + "|" + driver + "|" + curDrv).ToLowerInvariant();
if (s.Contains("mine") || s.Contains("drill")) return STToolKind.Pick;
if (s.Contains("construct") || s.Contains("frame") || s.Contains("smooth") ||
s.Contains("buildroof") || s.Contains("removeroof") || s.Contains("build") ||
s.Contains("deliver") || s.Contains("install")) return STToolKind.Hammer;
if (s.Contains("repair") || s.Contains("maintain") || s.Contains("maintenance") ||
s.Contains("fixbroken") || s.Contains("tendmachine") || s.Contains("fix")) return STToolKind.Wrench;
if (s.Contains("uninstall") || s.Contains("deconstruct") || s.Contains("teardown")) return STToolKind.Wrench;
if (s.Contains("plantcut") || s.Contains("cutplant") || s.Contains("chop") || s.Contains("prune")) return STToolKind.Sickle;
if (s.Contains("sow") || s.Contains("plantsow") || s.Contains("plantgrow")) return STToolKind.Hoe;
if (s.Contains("harvest")) return STToolKind.Sickle;
if (s.Contains("clean") || s.Contains("sweep") || s.Contains("mop")) return STToolKind.Cleaning;
if (s.Contains("medical") || s.Contains("surgery") || s.Contains("operate") ||
s.Contains("tend") || s.Contains("doctor")) return STToolKind.Medical;
if (s.Contains("research") || s.Contains("study") || s.Contains("analyze")) return STToolKind.Research;
⋮----
/// Select the most appropriate inventory item for the pawn's current job.
/// Prefers items (tools or tool-stuff) that actually provide the expected stat(s).
⋮----
public static Thing TryGetActiveTool(Pawn pawn)
⋮----
var wantedStats = StatsForKind(expectedKind).ToList();
// Pass A: tool-stuff (materials) with matching stats
⋮----
if (!item.def.IsToolStuff()) continue;
⋮----
if (props.baseWorkStatFactors.Any(m => m?.stat != null && wantedStats.Contains(m.stat)))
⋮----
// Pass B: real tools that have the required stats
⋮----
if (st.WorkStatFactors.Any(m => m?.stat != null && wantedStats.Contains(m.stat)))
⋮----
// Pass C: exact kind name heuristic
⋮----
// Pass D: soft fallbacks between related kinds (respect hardcore limits)
</file>
<file path="1.6/Defs/Stats/Stats_Pawn_WorkGeneral.xml">
<Defs>
    <!-- Tool Carrying Capacity -->
    <StatDef>
        <defName>SurvivalToolCarryCapacity</defName>
        <label>tool carrying capacity</label>
        <description>Determines the maximum number of tools this colonist can effectively carry and manage in their personal inventory. Higher capacity allows for greater versatility and preparedness, enabling colonists to handle multiple types of work without constantly returning to storage. Tool belts and similar equipment can increase this limit beyond the base value.</description>
        <category>PawnWork</category>
        <displayPriorityInCategory>100</displayPriorityInCategory>
        <defaultBaseValue>2</defaultBaseValue>
        <minValue>0</minValue>
        <showOnAnimals>false</showOnAnimals>
        <showOnMechanoids>false</showOnMechanoids>
    </StatDef>
    <!-- Mining-related -->
    <StatDef>
        <defName>DiggingSpeed</defName>
        <label>digging speed</label>
        <description>Measures how quickly this colonist can excavate walls, break through rock formations, and extract materials from solid stone. Critical for mining operations, tunnel construction, and accessing buried resources. Without proper tools (pickaxes), this task becomes extremely difficult or impossible in hardcore modes.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Mining</skill>
                <baseValue>0.04</baseValue>
                <bonusPerLevel>0.12</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.5</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <scenarioRandomizable>true</scenarioRandomizable>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
        <postProcessCurve>
            <points>
                <li>(0, 0)</li>
                <li>(0.00001, 0.10)</li>
                <li>(0.04, 0.10)</li>
                <li>(0.10, 0.10)</li>
                <li>(99999, 99999)</li>
            </points>
        </postProcessCurve>
    </StatDef>
    <StatDef>
        <defName>MiningYieldDigging</defName>
        <label>mining yield (digging)</label>
        <description>Determines what percentage of available mineral resources this colonist successfully extracts when mining walls and rock formations. Higher yields mean less waste and more efficient resource gathering. Quality mining tools significantly improve extraction efficiency. This stat only affects wall mining operations and doesn't influence rock chunk production from other sources.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <maxValue>1</maxValue>
        <toStringStyle>PercentZero</toStringStyle>
        <skillNeedFactors>
            <li Class="SkillNeed_Direct">
                <skill>Mining</skill>
                <valuesPerLevel>
                    <li>0.6</li>
                    <li>0.7</li>
                    <li>0.8</li>
                    <li>0.85</li>
                    <li>0.9</li>
                    <li>0.925</li>
                    <li>0.95</li>
                    <li>0.975</li>
                    <li>1</li>
                    <li>1.01</li>
                    <li>1.02</li>
                    <li>1.03</li>
                    <li>1.04</li>
                    <li>1.05</li>
                    <li>1.06</li>
                    <li>1.07</li>
                    <li>1.08</li>
                    <li>1.09</li>
                    <li>1.10</li>
                    <li>1.12</li>
                    <li>1.13</li>
                </valuesPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.2</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <!-- Plant-related -->
    <StatDef>
        <defName>PlantHarvestingSpeed</defName>
        <label>plant harvesting speed</label>
        <description>Determines how efficiently this colonist can gather crops, berries, and other harvestable plant materials. Proper harvesting tools like sickles dramatically improve both speed and yield, ensuring maximum food production from available plants. Essential for maintaining sustainable food supplies and managing large agricultural operations.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <neverDisabled>true</neverDisabled>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Plants</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <StatDef>
        <defName>SowingSpeed</defName>
        <label>sowing speed</label>
        <description>Measures the efficiency with which this colonist can plant seeds and establish new crops. Specialized planting tools like hoes ensure proper soil preparation and optimal seed placement, leading to better germination rates and crop establishment. Critical for expanding agricultural operations and food security.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <neverDisabled>true</neverDisabled>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Plants</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <StatDef>
        <defName>TreeFellingSpeed</defName>
        <label>tree felling speed</label>
        <description>Determines how quickly this colonist can cut down trees and process large woody vegetation. Axes and similar cutting tools are absolutely essential for efficient forestry operations. Without proper tools, tree felling becomes extremely slow or impossible in hardcore modes, making this stat critical for wood production and land clearing.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <neverDisabled>true</neverDisabled>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Plants</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <!-- Maintenance and repair-related -->
    <StatDef>
        <defName>MaintenanceSpeed</defName>
        <label>maintenance speed</label>
        <description>Measures how efficiently this colonist can repair, maintain, and service buildings, equipment, and mechanical devices. Proper maintenance tools like wrenches and repair kits are essential for keeping colony infrastructure in optimal condition. Regular maintenance prevents costly breakdowns and extends equipment lifespan significantly.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Construction</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.5</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <StatDef>
        <defName>DeconstructionSpeed</defName>
        <label>deconstruction speed</label>
        <description>Determines how rapidly this colonist can safely dismantle structures, equipment, and buildings to recover valuable materials. Proper deconstruction tools ensure maximum material recovery while minimizing waste and preventing accidental damage. Essential for resource management and colony reorganization efforts.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Construction</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <!-- Research-related -->
    <StatDef>
        <defName>ResearchSpeed</defName>
        <label>research speed</label>
        <description>The speed at which this person conducts research and experiments.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Intellectual</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>0.8</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>1</weight>
                <max>1</max>
            </li>
            <li>
                <capacity>Consciousness</capacity>
                <weight>1</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <!-- Cleaning-related -->
    <StatDef>
        <defName>CleaningSpeed</defName>
        <label>cleaning speed</label>
        <description>The speed at which this person cleans filth and debris. Anyone can clean, but it's much faster with proper tools.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Moving</capacity>
                <weight>0.5</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <!-- Medical-related -->
    <StatDef>
        <defName>MedicalOperationSpeed</defName>
        <label>medical operation speed</label>
        <description>The speed at which this person performs medical operations and surgery.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Medicine</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.8</weight>
                <max>1</max>
            </li>
            <li>
                <capacity>Consciousness</capacity>
                <weight>0.5</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <StatDef>
        <defName>MedicalSurgerySuccessChance</defName>
        <label>medical surgery success chance</label>
        <description>The likelihood that this person's medical operations will succeed without complications.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <maxValue>2</maxValue>
        <toStringStyle>PercentZero</toStringStyle>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Medicine</skill>
                <baseValue>0.5</baseValue>
                <bonusPerLevel>0.075</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.8</weight>
                <max>1</max>
            </li>
            <li>
                <capacity>Consciousness</capacity>
                <weight>0.8</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <!-- Butchery-related -->
    <StatDef>
        <defName>ButcheryFleshSpeed</defName>
        <label>butchery speed</label>
        <description>The speed at which this person butchers animals and processes meat.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Cooking</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <StatDef>
        <defName>ButcheryFleshEfficiency</defName>
        <label>butchery efficiency</label>
        <description>The amount of meat and other products this person can extract from animal carcasses.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <maxValue>2</maxValue>
        <toStringStyle>PercentZero</toStringStyle>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Cooking</skill>
                <baseValue>0.5</baseValue>
                <bonusPerLevel>0.075</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>0.8</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.5</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
    <!-- General Work Speed (for crafting, etc.) -->
    <StatDef>
        <defName>WorkSpeedGlobal</defName>
        <label>general work speed</label>
        <description>The general speed at which this person works at crafting, cooking, and other production tasks. Proper tools can significantly improve efficiency for various types of work that don't have specialized speed stats.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <neverDisabled>true</neverDisabled>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Crafting</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.085</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
            <li>
                <capacity>Consciousness</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.StatPart_SurvivalTool">
                <noToolStatFactor>0.4</noToolStatFactor>
            </li>
        </parts>
    </StatDef>
</Defs>
</file>
<file path="1.6/Defs/ThingDefs/Tools.xml">
<Defs>
    <ThingDef Name="SurvivalToolBasic" ParentName="BaseSurvivalTool" Abstract="True">
        <techLevel>Neolithic</techLevel>
        <statBases>
            <WorkToMake>1800</WorkToMake>
        </statBases>
        <stuffCategories>
            <li>Woody</li>
            <li>Stony</li>
            <li>Metallic</li>
        </stuffCategories>
        <smeltable>true</smeltable>
        <recipeMaker>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <comps>
            <li>
                <compClass>CompQuality</compClass>
            </li>
        </comps>
    </ThingDef>
    <!-- =================================================== -->
    <!-- PRIMITIVE TIER TOOLS (Stonecutting Research)       -->
    <!-- Basic tools for early colony survival              -->
    <!-- =================================================== -->
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Axe</defName>
        <label>axe</label>
        <description>A fundamental forestry tool designed for efficient tree felling. Its weighted head delivers powerful cutting strikes, making it indispensable for colonists working with wood. The balance and leverage make it far superior to improvised cutting methods. Also serves as a reliable melee weapon when survival demands it.</description>
        <costStuffCount>40</costStuffCount>
        <statBases>
            <Mass>2.5</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Axe</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <TreeFellingSpeed>1.5</TreeFellingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>PlantWorker</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Poke</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <!-- 83% of the club's DPS with the main tool -->
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>15.1</power>
                <cooldownTime>2.6</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Pickaxe</defName>
        <label>pickaxe</label>
        <description>An essential mining implement featuring a heavy, pointed head mounted on a sturdy handle. Specifically engineered to break through solid rock and extract valuable materials efficiently. The concentrated force and leverage it provides are crucial for productive mining operations. Can double as an improvised weapon when circumstances require it.</description>
        <costStuffCount>40</costStuffCount>
        <statBases>
            <Mass>2.5</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Pickaxe</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <DiggingSpeed>1.5</DiggingSpeed>
                    <MiningYieldDigging>1.2</MiningYieldDigging>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Miner</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Poke</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                </capacities>
                <power>15.1</power>
                <cooldownTime>2.6</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Hammer</defName>
        <label>hammer</label>
        <description>The cornerstone tool of any construction project. This versatile hammer provides the precision and force needed for driving fasteners, shaping materials, and assembling structures. Essential for colonists engaged in building and maintenance work. Its balanced design ensures effective strikes while minimizing fatigue during extended construction tasks.</description>
        <costStuffCount>30</costStuffCount>
        <statBases>
            <Mass>0.5</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Hammer</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ConstructionSpeed>1.5</ConstructionSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>11.6</power>
                <cooldownTime>2</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Sickle</defName>
        <label>sickle</label>
        <description>A specialized agricultural tool featuring a curved cutting blade perfectly designed for harvesting crops and cutting plant matter. The ergonomic design allows for efficient, repetitive cutting motions while reducing strain on the user. Essential for productive farming operations and plant maintenance tasks.</description>
        <costStuffCount>30</costStuffCount>
        <statBases>
            <Mass>0.5</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Sickle</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <PlantHarvestingSpeed>1.5</PlantHarvestingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>PlantWorker</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>11.6</power>
                <cooldownTime>2</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Hoe</defName>
        <label>hoe</label>
        <description>A fundamental agricultural implement engineered for soil preparation and seed planting. The pointed design efficiently breaks through earth and creates optimal planting conditions. Indispensable for establishing productive farming operations and maintaining crop yields. Its sturdy construction ensures reliable performance season after season.</description>
        <costStuffCount>30</costStuffCount>
        <statBases>
            <Mass>1.0</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Hoe</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <SowingSpeed>1</SowingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>PlantWorker</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>8</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>10</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Wrench</defName>
        <label>wrench</label>
        <description>A precision mechanical tool engineered for gripping, turning, and manipulating fasteners and mechanical components. Critical for maintenance operations, machinery repair, and construction projects requiring exact adjustments. The adjustable jaw design accommodates various sizes while providing optimal leverage and control.</description>
        <costStuffCount>35</costStuffCount>
        <statBases>
            <Mass>1.2</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Wrench</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <MaintenanceSpeed>1</MaintenanceSpeed>
                    <DeconstructionSpeed>1</DeconstructionSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>12</power>
                <cooldownTime>2.2</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Machining</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>4</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_PrimitiveLever</defName>
        <label>pry bar</label>
        <description>A primitive but effective leverage tool crafted from durable materials. Essential for dismantling structures, prying apart materials, and performing basic mechanical operations. Represents the ingenuity of early civilizations in developing practical solutions for construction and deconstruction tasks without advanced technology.</description>
        <costStuffCount>25</costStuffCount>
        <statBases>
            <Mass>1.8</Mass>
        </statBases>
        <techLevel>Neolithic</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/PryBar</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <MaintenanceSpeed>0.6</MaintenanceSpeed>
                    <DeconstructionSpeed>0.8</DeconstructionSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>8</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>tip</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                </capacities>
                <power>10</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_Abacus</defName>
        <label>abacus</label>
        <description>An ancient calculating instrument featuring movable beads arranged on rods for performing arithmetic operations. Essential for organizing research data, managing complex calculations, and maintaining accurate records in societies without advanced computational devices. Represents the foundation of mathematical thinking and data organization.</description>
        <costStuffCount>20</costStuffCount>
        <stuffCategories>
            <li>Woody</li>
            <li>Stony</li>
        </stuffCategories>
        <statBases>
            <Mass>0.8</Mass>
            <WorkToMake>1800</WorkToMake>
        </statBases>
        <techLevel>Neolithic</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Abacus</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ResearchSpeed>0.7</ResearchSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Researcher</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>frame</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>6</power>
                <cooldownTime>2.5</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>2</Crafting>
            </skillRequirements>
        </recipeMaker>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <comps>
            <li>
                <compClass>CompQuality</compClass>
            </li>
        </comps>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Microscope</defName>
        <label>microscope</label>
        <description>A precision optical instrument that magnifies small objects and specimens for detailed examination. Essential for advanced research, biological studies, and scientific analysis.</description>
        <costStuffCount>50</costStuffCount>
        <statBases>
            <Mass>2.5</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Microscope</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ResearchSpeed>1.4</ResearchSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Researcher</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>base</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>8</power>
                <cooldownTime>3</cooldownTime>
            </li>
            <li>
                <label>lens assembly</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                </capacities>
                <power>6</power>
                <cooldownTime>2.8</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Machining</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>6</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <!-- Regular Steel Tools -->
    <!-- =================================================== -->
    <!-- INDUSTRIAL TIER TOOLS (Smithing Research)          -->
    <!-- Advanced steel tools for established colonies      -->
    <!-- =================================================== -->
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_SteelKnife</defName>
        <label>steel knife</label>
        <description>A precision-forged steel knife with superior edge retention and durability. The high-carbon steel blade maintains its sharpness through extensive use, making it ideal for demanding butchery and medical work. The ergonomic handle provides excellent control for delicate operations.</description>
        <costStuffCount>30</costStuffCount>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>0.4</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/SteelKnife</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ButcheryFleshSpeed>1.2</ButcheryFleshSpeed>
                    <ButcheryFleshEfficiency>1.1</ButcheryFleshEfficiency>
                    <MedicalOperationSpeed>1.1</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>1.05</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Butcher</li>
                    <li>Medical</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>8</power>
                <cooldownTime>1.7</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                    <li>Stab</li>
                </capacities>
                <power>14</power>
                <cooldownTime>1.5</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Smithing</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>3</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_CrosscutSaw</defName>
        <label>crosscut saw</label>
        <description>A precision industrial saw designed for efficient lumber processing and construction work. The specially designed teeth and reinforced steel construction allow for clean, accurate cuts through various materials. Essential for large-scale construction projects and advanced woodworking operations.</description>
        <costStuffCount>45</costStuffCount>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <costList>
            <ComponentIndustrial>1</ComponentIndustrial>
        </costList>
        <statBases>
            <Mass>1.5</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/CrosscutSaw</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ConstructionSpeed>1.2</ConstructionSpeed>
                    <DeconstructionSpeed>1.3</DeconstructionSpeed>
                    <TreeFellingSpeed>1.1</TreeFellingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                    <li>PlantWorker</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>10</power>
                <cooldownTime>2.5</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>13</power>
                <cooldownTime>2.8</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Smithing</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>4</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <!-- Advanced Industrial Tools -->
    <!-- =================================================== -->
    <!-- PRECISION TIER TOOLS (Machining Research)          -->
    <!-- High-tech precision tools for advanced operations  -->
    <!-- =================================================== -->
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_CarbidePick</defName>
        <label>carbide pickaxe</label>
        <description>An advanced mining implement featuring carbide-tipped edges that maintain their sharpness through the most demanding excavation work. The precision-engineered head cuts through rock more efficiently than standard tools, while the reinforced construction ensures exceptional durability in harsh mining conditions.</description>
        <costStuffCount>50</costStuffCount>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>3.0</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/CarbidePick</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <DiggingSpeed>1.3</DiggingSpeed>
                    <MiningYieldDigging>1.2</MiningYieldDigging>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Miner</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>0.7</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Poke</li>
                </capacities>
                <power>11</power>
                <cooldownTime>2.1</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                </capacities>
                <power>17</power>
                <cooldownTime>2.7</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Machining</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>6</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_PrecisionScalpel</defName>
        <label>precision scalpel</label>
        <description>An ultra-sharp surgical instrument crafted from the finest steel alloys. The carefully balanced blade maintains its edge through repeated sterilization and use, while the ergonomic handle ensures precise control during delicate medical procedures. Standard equipment in advanced medical facilities.</description>
        <costStuffCount>25</costStuffCount>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>0.2</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/PrecisionScalpel</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <MedicalOperationSpeed>1.4</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>1.15</MedicalSurgerySuccessChance>
                    <MedicalTendQuality>1.1</MedicalTendQuality>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Medical</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>0.8</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>6</power>
                <cooldownTime>1.2</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                    <li>Stab</li>
                </capacities>
                <power>12</power>
                <cooldownTime>1.0</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Machining</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>8</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_PowerDrill</defName>
        <label>power drill</label>
        <description>A mechanized drilling tool powered by an internal motor, capable of boring through tough materials with precision and speed. The variable-speed motor and interchangeable bits make it invaluable for construction and mechanical work. Requires periodic maintenance to keep the motor running smoothly.</description>
        <costStuffCount>75</costStuffCount>
        <costList>
            <ComponentIndustrial>2</ComponentIndustrial>
        </costList>
        <statBases>
            <Mass>2.5</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/PowerDrill</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ConstructionSpeed>1.3</ConstructionSpeed>
                    <MaintenanceSpeed>1.4</MaintenanceSpeed>
                    <DiggingSpeed>1.2</DiggingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                    <li>Miner</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>0.9</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>body</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>12</power>
                <cooldownTime>2.0</cooldownTime>
            </li>
            <li>
                <label>drill bit</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                </capacities>
                <power>15</power>
                <cooldownTime>1.8</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Machining</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Machining</soundWorking>
            <recipeUsers>
                <li>FabricationBench</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>7</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedComponent</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <!-- =================================================== -->
    <!-- SPACER TIER TOOLS (Advanced Fabrication Research)  -->
    <!-- Glitterworld technology for ultimate efficiency    -->
    <!-- =================================================== -->
    <!-- Glitterworld Multitool -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_Multitool</defName>
        <label>glitterworld multitool</label>
        <description>A high-tech universal tool commonly used by domestic mechanoids in glitterworld societies. This advanced device can seamlessly adapt to any task - construction, mining, forestry, maintenance, and deconstruction - making it the ultimate all-in-one survival tool. Though designed for mechanoids, it's perfectly usable by humanoids due to physiological similarities.</description>
        <statBases>
            <MarketValue>800</MarketValue>
            <Flammability>0.7</Flammability>
            <Mass>1.8</Mass>
            <!-- Equivalent to excellent quality -->
            <ToolEffectivenessFactor>1.2</ToolEffectivenessFactor>
        </statBases>
        <equippedAngleOffset>-20</equippedAngleOffset>
        <techLevel>Ultra</techLevel>
        <thingCategories>
            <li>SurvivalToolsSpacer</li>
        </thingCategories>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/GlitterworldMultitool</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <!-- Forestry & Plant Work -->
                    <TreeFellingSpeed>1.3</TreeFellingSpeed>
                    <PlantHarvestingSpeed>1.3</PlantHarvestingSpeed>
                    <SowingSpeed>1.3</SowingSpeed>
                    <!-- Mining & Excavation -->
                    <DiggingSpeed>1.3</DiggingSpeed>
                    <MiningYieldDigging>1.1</MiningYieldDigging>
                    <!-- Construction & Building -->
                    <ConstructionSpeed>1.3</ConstructionSpeed>
                    <!-- Maintenance & Repair -->
                    <MaintenanceSpeed>1.4</MaintenanceSpeed>
                    <DeconstructionSpeed>1.3</DeconstructionSpeed>
                    <!-- Research & Analysis -->
                    <ResearchSpeed>1.5</ResearchSpeed>
                    <!-- Extended stats (only if other mods provide tools for these) -->
                    <CleaningSpeed>1.4</CleaningSpeed>
                    <MedicalOperationSpeed>1.3</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>1.1</MedicalSurgerySuccessChance>
                    <ButcheryFleshSpeed>1.3</ButcheryFleshSpeed>
                    <ButcheryFleshEfficiency>1.1</ButcheryFleshEfficiency>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                    <li>Miner</li>
                    <li>PlantWorker</li>
                    <li>Researcher</li>
                    <!-- Extended tags (only if other mods provide tools for these) -->
                    <li>Cleaner</li>
                    <li>Medical</li>
                    <li>Butcher</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>0.15</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Poke</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                    <li>Cut</li>
                    <li>Blunt</li>
                </capacities>
                <power>14</power>
                <cooldownTime>2</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <!-- Missing Primitive Tools -->
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Knife</defName>
        <label>knife</label>
        <description>A versatile cutting implement with a sharp blade essential for precise work. Perfect for butchery operations, medical procedures, and general cutting tasks. The balanced design allows for controlled, accurate cuts while the keen edge ensures clean work. An indispensable tool for any serious colonist.</description>
        <costStuffCount>25</costStuffCount>
        <stuffCategories>
            <li>Stony</li>
        </stuffCategories>
        <statBases>
            <Mass>0.3</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Knife</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ButcheryFleshSpeed>1</ButcheryFleshSpeed>
                    <ButcheryFleshEfficiency>1</ButcheryFleshEfficiency>
                    <MedicalOperationSpeed>1</MedicalOperationSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Butcher</li>
                    <li>Medical</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>7</power>
                <cooldownTime>1.8</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                    <li>Stab</li>
                </capacities>
                <power>12</power>
                <cooldownTime>1.6</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>1</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_HandSaw</defName>
        <label>hand saw</label>
        <description>A traditional woodworking tool featuring a metal blade with precisely cut teeth designed for manual lumber processing. Essential for construction projects requiring custom-cut timber and detailed woodwork. The steady rhythm of hand-sawing may take longer than power tools, but provides excellent control and precision.</description>
        <costStuffCount>35</costStuffCount>
        <statBases>
            <Mass>1.0</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/HandSaw</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ConstructionSpeed>1</ConstructionSpeed>
                    <DeconstructionSpeed>1</DeconstructionSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>8</power>
                <cooldownTime>2.2</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>10</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_BoneSickle</defName>
        <label>bone sickle</label>
        <description>A primitive harvesting tool crafted from carved bone with a sharpened edge. While not as durable as metal variants, this traditional implement serves admirably for crop harvesting and plant cutting. The curved design follows ancient patterns proven effective across countless generations of agricultural work.</description>
        <costStuffCount>20</costStuffCount>
        <stuffCategories>
            <li>Stony</li>
            <li>Woody</li>
        </stuffCategories>
        <statBases>
            <Mass>0.4</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/BoneSickle</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>PlantWorker</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>1.3</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>6</power>
                <cooldownTime>2.1</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>8</power>
                <cooldownTime>2.3</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>1</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
    </ThingDef>
    <!-- =================================================== -->
    <!-- CLEANING TOOLS                                      -->
    <!-- Basic cleaning implements for colony maintenance    -->
    <!-- =================================================== -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_PileOfRags</defName>
        <label>pile of rags</label>
        <description>A collection of cloth pieces bundled together for cleaning purposes. These simple rags are effective for basic cleaning tasks, though they wear out more quickly than proper cleaning tools. Essential for maintaining colony hygiene and cleanliness.</description>
        <techLevel>Neolithic</techLevel>
        <costStuffCount>5</costStuffCount>
        <stuffCategories>
            <li>Fabric</li>
        </stuffCategories>
        <statBases>
            <WorkToMake>600</WorkToMake>
            <MaxHitPoints>50</MaxHitPoints>
            <Mass>0.5</Mass>
            <DeteriorationRate>4</DeteriorationRate>
            <Beauty>-3</Beauty>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/PileOfRags</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <recipeMaker>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Tailor</effectWorking>
            <soundWorking>Recipe_Tailor</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>HandTailoringBench</li>
                <li>ElectricTailoringBench</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>1</Crafting>
            </skillRequirements>
            <unfinishedThingDef>UnfinishedApparel</unfinishedThingDef>
        </recipeMaker>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.75</CleaningSpeed>
                </baseWorkStatFactors>
                <stuffPowerMultiplier>
                    <CleaningSpeed>1.0</CleaningSpeed>
                </stuffPowerMultiplier>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>1.5</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>bundle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>0.25</power>
                <cooldownTime>3.0</cooldownTime>
            </li>
        </tools>
        <comps>
            <li>
                <compClass>CompQuality</compClass>
            </li>
        </comps>
    </ThingDef>
    <!-- =================================================== -->
    <!-- MULTIPURPOSE GENERAL WORK TOOLS (WorkSpeedGlobal)   -->
    <!-- Re-added after revert                               -->
    <!-- =================================================== -->
    <!-- Tribal Tier -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_MultipurposeStoneTool</defName>
        <label>multipurpose stone tool</label>
        <description>A rugged, versatile stone implement shaped to cover many general tasks. While primitive, it grants a modest improvement to overall work speed.</description>
        <techLevel>Neolithic</techLevel>
        <costStuffCount>35</costStuffCount>
        <stuffCategories>
            <li>Stony</li>
            <li>Woody</li>
        </stuffCategories>
        <statBases>
            <Mass>1.2</Mass>
            <MaxHitPoints>120</MaxHitPoints>
            <WorkToMake>1400</WorkToMake>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/MultipurposeStoneTool</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.00</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>1.10</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>body</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>1</power>
                <cooldownTime>2.5</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>FueledSmithy</li>
                <li>ElectricSmithy</li>
            </recipeUsers>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <skillRequirements>
                <Crafting>1</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                    <li>Steel</li>
                    <li>Plasteel</li>
                    <li>Uranium</li>
                    <li MayRequire="Anomaly">Bioferrite</li>
                    <!-- Tune later, This should only be basic stone -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
    </ThingDef>
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_CarvedBoneImplements</defName>
        <label>carved bone implements</label>
        <description>A collection of carefully carved bone implements bundled together for multi-purpose use. Fragile, but shaped for efficiency, giving a noticeable boost to general work speed.</description>
        <techLevel>Neolithic</techLevel>
        <costStuffCount>30</costStuffCount>
        <stuffCategories>
            <li>Woody</li>
        </stuffCategories>
        <statBases>
            <Mass>0.9</Mass>
            <MaxHitPoints>90</MaxHitPoints>
            <WorkToMake>1500</WorkToMake>
            <Flammability>0.7</Flammability>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/CarvedBoneImplements</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.05</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>1.00</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>bundle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>1</power>
                <cooldownTime>2.5</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>FueledSmithy</li>
                <li>ElectricSmithy</li>
            </recipeUsers>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <skillRequirements>
                <Crafting>1</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                    <li>Steel</li>
                    <li>Plasteel</li>
                    <li>Uranium</li>
                    <li MayRequire="Anomaly">Bioferrite</li>
                    <!-- Tune later, This should only be basic stone -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
    </ThingDef>
    <!-- Medieval Tier -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_ArtisansToolkit</defName>
        <label>artisan's toolkit</label>
        <description>A curated collection of quality medieval-era implements for crafting, shaping, and assembly. Improves overall work throughput across many tasks.</description>
        <techLevel>Medieval</techLevel>
        <costStuffCount>45</costStuffCount>
        <stuffCategories>
            <li>Metallic</li>
            <li>Woody</li>
        </stuffCategories>
        <statBases>
            <Mass>2.0</Mass>
            <MaxHitPoints>160</MaxHitPoints>
            <WorkToMake>2200</WorkToMake>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/ArtisansToolkit</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.10</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.90</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>FueledSmithy</li>
                <li>ElectricSmithy</li>
            </recipeUsers>
            <researchPrerequisite>Smithing</researchPrerequisite>
            <skillRequirements>
                <Crafting>4</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                    <li>Plasteel</li>
                    <li MayRequire="Anomaly">Bioferrite</li>
                    <!-- Tune later -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
        <tools>
            <li>
                <label>implements</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>2</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_WoodworkersKit</defName>
        <label>woodworker's kit</label>
        <description>A specialized assortment of saws, chisels, planes and gauges optimized for timber shaping and joinery. Its organization and quality grant a strong boost to general work speed.</description>
        <techLevel>Medieval</techLevel>
        <costStuffCount>55</costStuffCount>
        <stuffCategories>
            <li>Woody</li>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>2.2</Mass>
            <MaxHitPoints>170</MaxHitPoints>
            <WorkToMake>2400</WorkToMake>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/WoodworkersKit</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.15</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.80</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>FueledSmithy</li>
                <li>ElectricSmithy</li>
            </recipeUsers>
            <researchPrerequisite>Smithing</researchPrerequisite>
            <skillRequirements>
                <Crafting>5</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Plasteel</li>
                    <li MayRequire="Anomaly">Bioferrite</li>
                    <!-- Tune later -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
        <tools>
            <li>
                <label>kit frame</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>2</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <!-- Industrial Tier -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_MechanicsToolkit</defName>
        <label>mechanic's toolkit</label>
        <description>An organized industrial-era toolkit containing precision wrenches, gauges, torque implements and fast-retrieval storage. Greatly improves overall task flow and coordination in general work.</description>
        <techLevel>Industrial</techLevel>
        <costStuffCount>60</costStuffCount>
        <costList>
            <ComponentIndustrial>2</ComponentIndustrial>
        </costList>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>2.4</Mass>
            <MaxHitPoints>200</MaxHitPoints>
            <WorkToMake>3000</WorkToMake>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/MechanicsToolkit</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.22</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.65</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Machining</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <researchPrerequisite>Machining</researchPrerequisite>
            <skillRequirements>
                <Crafting>6</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <!-- Tune later -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
        <tools>
            <li>
                <label>case</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>3</power>
                <cooldownTime>2.6</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_WorkshopHammerDrill</defName>
        <label>workshop hammer drill</label>
        <description>A heavy-duty powered hammer drill with interchangeable percussion and rotary modules. Its integrated clamping and alignment system accelerates virtually any mechanical or construction task.</description>
        <techLevel>Industrial</techLevel>
        <costStuffCount>70</costStuffCount>
        <costList>
            <ComponentIndustrial>2</ComponentIndustrial>
        </costList>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>3.2</Mass>
            <MaxHitPoints>220</MaxHitPoints>
            <WorkToMake>3600</WorkToMake>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/WorkshopHammerDrill</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.30</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.50</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <recipeMaker>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Machining</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FabricationBench</li>
            </recipeUsers>
            <researchPrerequisite>Machining</researchPrerequisite>
            <skillRequirements>
                <Crafting>7</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <!-- Tune later -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
        <tools>
            <li>
                <label>housing</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>4</power>
                <cooldownTime>2.6</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <!-- Spacer / Glitterworld Tier / EXPENSIVE TO MAKE if Makeable -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_NanofabricatorInterface</defName>
        <label>nanofabricator interface</label>
        <description>A sleek control and augmentation module that synchronizes the user's motions with adaptive nano-assembly routines. Dramatically improves general task execution efficiency.</description>
        <techLevel>Ultra</techLevel>
        <costList>
            <ComponentSpacer>1</ComponentSpacer>
            <Gold>1</Gold>
            <Plasteel>25</Plasteel>
            <Silver>50</Silver>
            <Uranium>1</Uranium>
            <Steel>10</Steel>
        </costList>
        <statBases>
            <Mass>1.0</Mass>
            <MaxHitPoints>240</MaxHitPoints>
            <WorkToMake>5000</WorkToMake>
            <MarketValue>900</MarketValue>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/NanofabricatorInterface</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories Inherit="false">
            <li>SurvivalToolsSpacer</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.45</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.30</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Machining</soundWorking>
            <recipeUsers>
                <li>FabricationBench</li>
            </recipeUsers>
            <researchPrerequisite>Fabrication</researchPrerequisite>
            <skillRequirements>
                <Crafting>15</Crafting>
            </skillRequirements>
        </recipeMaker>
        <tools>
            <li>
                <label>interface shell</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>5</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_OmniToolGauntlet</defName>
        <label>omni-tool gauntlet</label>
        <description>A cutting-edge modular gauntlet embedding field projectors, micro-fabricators and force-aligned manipulators. Provides an unparalleled increase to general work speed through predictive optimization.</description>
        <techLevel>Ultra</techLevel>
        <statBases>
            <MarketValue>1400</MarketValue>
            <Flammability>0.5</Flammability>
            <Mass>1.1</Mass>
            <MaxHitPoints>260</MaxHitPoints>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/OmniToolGauntlet</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories>
            <li>SurvivalToolsSpacer</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.60</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.10</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <!--<li>Generalist</li>-->
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>emitter housing</label>
                <capacities>
                    <li>Poke</li>
                </capacities>
                <power>8</power>
                <cooldownTime>2.2</cooldownTime>
            </li>
            <li>
                <label>manipulator array</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>11</power>
                <cooldownTime>2.0</cooldownTime>
            </li>
        </tools>
    </ThingDef>
</Defs>
</file>
<file path="Source/AI/JobDriver_FellTree.cs">
// Rimworld 1.6 / C# 7.3
// Source/AI/JobDriver_FellTree.cs
⋮----
namespace SurvivalTools
⋮----
public class JobDriver_FellTree : JobDriver_PlantWork
⋮----
protected override void Init()
⋮----
base.Init();
// Defensive read of Plant
⋮----
if (plant != null && plant.def?.plant?.harvestedThingDef != null && plant.CanYieldNow())
⋮----
protected override Toil PlantWorkDoneToil()
⋮----
// Simple, instant-done toil that destroys the targeted thing (plant)
private Toil DestroyThing(TargetIndex ind)
⋮----
var toil = new Toil();
⋮----
// Prefer the driver job (stable) rather than actor.CurJob which may change
⋮----
// Ensure it's still a plant (extra safety)
⋮----
thing.Destroy(DestroyMode.Vanish);
⋮----
// If it's not a Plant but still exists, be conservative and avoid destroying unexpected things.
⋮----
$"[SurvivalTools] FellTree toil expected a Plant but found {thing.GetType().Name}: {thing} — skipping destroy.",
⋮----
// Critical exception — keep semantics but route through centralized logger
</file>
<file path="Source/AI/WorkGiver_FellTrees.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/WorkGiver_FellTrees.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// WorkGiver for tree felling / harvesting when designated.
/// - Defensive null checks
/// - Avoids duplicate targets
/// - Chooses correct job (HarvestTreeDesignated / FellTreeDesignated)
/// </summary>
public class WorkGiver_FellTrees : WorkGiver_Scanner
⋮----
public override Danger MaxPathDanger(Pawn pawn) => Danger.Deadly;
⋮----
public override IEnumerable<Thing> PotentialWorkThingsGlobal(Pawn pawn)
⋮----
if (seen.Add(thing))
⋮----
public override Job JobOnThing(Pawn pawn, Thing t, bool forced = false)
⋮----
if (t.IsForbidden(pawn) || t.IsBurning()) return null;
if (!pawn.CanReserveAndReach(t, PathEndMode.Touch, pawn.NormalMaxDanger()))
⋮----
return new Job(ST_JobDefOf.HarvestTreeDesignated, t);
⋮----
return new Job(ST_JobDefOf.FellTreeDesignated, t);
</file>
<file path="Source/Harmony/Patch_ThingFilter_SetFromPreset.cs">
// Rimworld 1.6 / C# 7.3
// Source/Harmony/Patch_ThingFilter_SetFromPreset.cs
⋮----
/// <summary>
/// Ensures that SurvivalTools category is enabled by default
/// in the "Default stockpile" preset.
///
/// Does NOT affect player-edited stockpiles or other presets.
/// </summary>
⋮----
public static class Patch_ThingFilter_SetFromPreset
⋮----
public static void Postfix(ThingFilter __instance, StorageSettingsPreset preset)
⋮----
// Defensive guards
⋮----
// Enable SurvivalTools in Default stockpile preset
__instance.SetAllow(cat, true);
</file>
<file path="Source/StaticConstructorClass.cs">
// RimWorld 1.6 / C# 7.3
// Source/StaticConstructorClass.cs
⋮----
namespace SurvivalTools
⋮----
public static class StaticConstructorClass
⋮----
Log.Message("[SurvivalTools] Starting static constructor initialization...");
// 1) MapGen / content constraints
⋮----
// 2) Mod compat shims
⋮----
// 3) Data integrity / components
⋮----
// 4) Auto-detect and enhance tools
⋮----
// 5) Warm settings cache (optional/perf)
SurvivalTools.InitializeSettings();
// 6) Apply conditional feature registration
ConditionalRegistration.ApplyTreeFellingConditionals();
// 7) Schedule delayed job validation (after game fully loads)
LongEventHandler.QueueLongEvent(ValidateExistingJobsOnModLoad, "SurvivalTools: Validating existing jobs...", false, null);
⋮----
Log.Message("[SurvivalTools] Static constructor initialization completed successfully");
⋮----
Log.Error($"[SurvivalTools] Error during static constructor initialization: {ex}");
⋮----
private static void ConfigureAncientRuinsTools()
⋮----
// fixedParams is a struct; copy-modify-assign
⋮----
Log.Message("[SurvivalTools] Configured ancient ruins tools to neolithic category");
⋮----
private static void AddSurvivalToolTrackersToHumanlikes()
⋮----
foreach (var tDef in DefDatabase<ThingDef>.AllDefs.Where(t => t?.race?.Humanlike == true))
⋮----
// Avoid duplicates if another mod or reload path already injected it.
if (!tDef.comps.Any(c => c?.compClass == typeof(Pawn_SurvivalToolAssignmentTracker)))
⋮----
tDef.comps.Add(new CompProperties(typeof(Pawn_SurvivalToolAssignmentTracker)));
⋮----
Log.Message($"[SurvivalTools] Added SurvivalToolAssignmentTracker to {addedCount} humanlike defs");
⋮----
private static void ResolveMendAndRecycleRecipes()
⋮----
// Only recipes that look like ours and are not the vanilla worker
var relevant = DefDatabase<RecipeDef>.AllDefs.Where(r =>
⋮----
r.workerClass != typeof(RecipeWorker)).ToList();
⋮----
// Require at least one real SurvivalTool to be a valid ingredient
⋮----
.Any(td => td?.thingClass == typeof(SurvivalTool) && recipe.IsIngredient(td));
⋮----
Log.Message($"[SurvivalTools] Processed {processed} Mend&Recycle recipes, cleared {cleared} without valid ingredients");
⋮----
private static void ResolveSmeltingRecipeUsers()
⋮----
foreach (var benchDef in DefDatabase<ThingDef>.AllDefs.Where(t => t?.IsWorkTable == true))
⋮----
// Add our tool recipes when the weapon equivalents are present; avoid duplicates.
if (benchDef.recipes.Contains(ST_RecipeDefOf.SmeltWeapon) &&
!benchDef.recipes.Contains(ST_RecipeDefOf.SmeltSurvivalTool))
⋮----
benchDef.recipes.Add(ST_RecipeDefOf.SmeltSurvivalTool);
⋮----
if (benchDef.recipes.Contains(ST_RecipeDefOf.DestroyWeapon) &&
!benchDef.recipes.Contains(ST_RecipeDefOf.DestroySurvivalTool))
⋮----
benchDef.recipes.Add(ST_RecipeDefOf.DestroySurvivalTool);
⋮----
Log.Message($"[SurvivalTools] Processed {benchesProcessed} work benches: added {smeltAdded} smelt recipes, {destroyAdded} destroy recipes");
⋮----
private static void CheckStuffForStuffPropsTool()
⋮----
var sb = new StringBuilder();
sb.AppendLine("[SurvivalTools] Checking all stuff for StuffPropsTool modExtension...");
sb.AppendLine();
var hasProps = new StringBuilder("Has props:\n");
var noProps = new StringBuilder("Doesn't have props:\n");
⋮----
sb.AppendLine($"Summary: {hasPropsCount} stuff defs have StuffPropsTool, {noPropsCount} do not");
⋮----
sb.Append(hasProps);
⋮----
sb.Append(noProps);
⋮----
Log.Message(sb.ToString());
⋮----
private static HashSet<StuffCategoryDef> GetSurvivalToolStuffCategories()
⋮----
foreach (var tool in DefDatabase<ThingDef>.AllDefsListForReading.Where(t => t?.IsSurvivalTool() == true))
⋮----
if (cat != null) toolCats.Add(cat);
⋮----
private static (int hasPropsCount, int noPropsCount) AnalyzeStuffDefs(
⋮----
foreach (var stuff in DefDatabase<ThingDef>.AllDefsListForReading.Where(t => t?.IsStuff == true))
⋮----
// Consider only stuff used by any ST tool
bool relevant = categories.Any(cat => cat != null && toolCats.Contains(cat));
⋮----
hasProps.AppendLine(line);
⋮----
noProps.AppendLine(line);
⋮----
private static void ValidateExistingJobsOnModLoad()
⋮----
// Only validate if we're in hardcore mode and the game is actually running
⋮----
Helpers.SurvivalToolValidation.ValidateExistingJobs("mod loaded with existing save");
</file>
<file path="Source/Stats/StatPart_SurvivalTool.cs">
// RimWorld 1.6 / C# 7.3
// Source/Stats/StatPart_SurvivalTool.cs
⋮----
namespace SurvivalTools
⋮----
public class StatPart_SurvivalTool : StatPart
⋮----
// Track how many times we've emitted a full zero-value diagnostic for a given pawn+stat
// Key: "{pawnThingID}|{statDefName}" -> count
⋮----
// Track whether we've already written a simulation trace file for a given pawn+stat
// Key: "{pawnThingID}|{statDefName}" -> true
⋮----
// Track whether we've already written a detailed diagnostic trace for a given pawn+stat
⋮----
public override string ExplanationPart(StatRequest req)
⋮----
// Handle tool showing its own stats
⋮----
// Tools should show their own stat modifiers for all relevant stats
float factor = CollectionExtensions.GetStatFactorFromList(tool.WorkStatFactors.ToList(), parentStat);
⋮----
return $"{tool.LabelCapNoCount}: x{factor.ToStringPercent()}";
⋮----
// Handle tool-stuff showing its own stats
if (req.Thing?.def.IsToolStuff() == true)
⋮----
// First try SurvivalToolProperties (for things like cloth)
⋮----
float factor = CollectionExtensions.GetStatFactorFromList(props.baseWorkStatFactors, parentStat);
⋮----
return $"{req.Thing.LabelCapNoCount}: x{factor.ToStringPercent()}";
⋮----
// Then try StuffPropsTool (for things like Bioferrite/Obsidian)
⋮----
float factor = CollectionExtensions.GetStatFactorFromList(stuffProps.toolStatFactors, parentStat);
⋮----
if (req.Thing is Pawn pawn && PawnToolValidator.CanUseSurvivalTools(pawn))
⋮----
// First try: actual SurvivalTool instance (best tool)
var bestTool = pawn.GetBestSurvivalTool(parentStat);
⋮----
float factor = CollectionExtensions.GetStatFactorFromList(bestTool.WorkStatFactors.ToList(), parentStat);
return $"{bestTool.LabelCapNoCount}: x{factor.ToStringPercent()}";
⋮----
// Second try: tool-stuff (cloth/wool/etc.) residing on pawn (inventory/equipment)
var toolStuff = pawn.GetAllUsableSurvivalTools()
.FirstOrDefault(t => t.def.IsToolStuff() &&
⋮----
// get factor from the def's baseWorkStatFactors
⋮----
CollectionExtensions.GetStatFactorFromList(props.baseWorkStatFactors, parentStat) :
⋮----
return $"{toolStuff.LabelCapNoCount}: x{factor.ToStringPercent()}";
⋮----
return $"{"NoTool".Translate()}: x{NoToolStatFactor.ToStringPercent()}";
⋮----
// Static flag to prevent recursive stat calculation calls (thread-local to avoid cross-call leakage)
⋮----
public override void TransformValue(StatRequest req, ref float val)
⋮----
// If we're already calculating stats on this thread, bail out to avoid re-entrancy
// (other codepaths like GetBestSurvivalTool may call GetStatValue and re-enter here)
⋮----
// Do not apply survival-tool modifiers during recursive stat evaluation
⋮----
// Handle tool showing its own stats (duplicate check for other code paths)
⋮----
float factor = CollectionExtensions.GetStatFactorFromList(toolInst.WorkStatFactors.ToList(), parentStat);
⋮----
// If parent stat is CleaningSpeed or WorkSpeedGlobal and the job already
// requires some other gated work stat, do not apply the cleaning/global fallback.
⋮----
var jobStats = SurvivalToolUtility.StatsForJob(pawn.CurJob.def, pawn);
⋮----
if (s != null && s != parentStat && s.RequiresSurvivalTool())
⋮----
// Another gated stat is in effect for this job; do not apply cleaning/global penalty here.
⋮----
float penaltyFactor = this.GetNoToolPenaltyFactor();
⋮----
// Non-spammy logging: only log once per pawn/stat per cooldown
⋮----
if (ST_Logging.ShouldLogWithCooldown(logKey))
⋮----
// Spawn a mote once when a job begins that suffers a penalty for cleaning/global work
⋮----
// ...existing code...
⋮----
// Default factor when no tool is used (non-hardcore).
// Kept as a fallback for safety, but runtime value should come from settings.
⋮----
// Expose NoToolStatFactor as a public property; prefer the value from settings when available
⋮----
// Settings provide the user-tweakable 'noToolStatFactorNormal'
⋮----
// Expose penalty logic as a public method
public float GetNoToolPenaltyFactor()
⋮----
// Delegate computation + caching to the centralized ToolFactorCache
⋮----
// If parentStat is null fall back to the default
⋮----
return SurvivalToolUtility.ToolFactorCache.GetOrComputeNoToolPenalty(parentStat);
⋮----
// Track last job reference per pawn to ensure motes spawn only once per job start
⋮----
private static void TrySpawnPenaltyMote(Pawn pawn, StatDef stat, float penaltyFactor)
⋮----
// Only apply motes for CleaningSpeed or WorkSpeedGlobal
⋮----
// If the current job actually uses other gated stats, skip spawning for the cleaning/global fallback
⋮----
if (s.RequiresSurvivalTool())
⋮----
// Another gated stat is in use; do not show cleaning/global fallback mote
⋮----
Job current = pawn.CurJob;
if (_lastMoteJob.TryGetValue(pawn.thingIDNumber, out var recorded) && ReferenceEquals(recorded, current))
return; // already shown for this job
// Record the job so we don't spam motes
⋮----
string shortText = $"Slow ({statLabel} x{penaltyFactor.ToString("F2")})";
// Position above pawn
MoteMaker.ThrowText(pawn.DrawPos, pawn.Map, shortText, 3.5f);
// Non-spammy log once per pawn/stat per cooldown
⋮----
if (ST_Logging.ShouldLogWithCooldown(logk))
ST_Logging.LogDebug($"[SurvivalTools.StatPart] {pawn.LabelShort} missing {statLabel} tool — penalty applied ({penaltyFactor.ToString("F2")}x).", logk);
⋮----
catch { /* best-effort mote */ }
⋮----
/// <summary>
/// Determines if a stat is work-related and should have tool factors applied.
/// This excludes item construction stats like WorkToMake, MaxHitPoints, DeteriorationRate, etc.
/// </summary>
private bool IsWorkRelatedStat(StatDef stat)
⋮----
// These are the work stats that tools should affect
⋮----
// Core work stats
⋮----
return workStats.Contains(stat.defName);
</file>
<file path="Source/ToolResolver.cs">
// RimWorld 1.6 / C# 7.3
// Source/ToolResolver.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// A system for automatically adding relevant stats to tools that don't already have them.
/// This ensures compatibility with modded tools by intelligently detecting tool types
/// and applying appropriate stats based on their names and tech levels.
/// </summary>
public static class ToolResolver
⋮----
/// Defines tool type detection rules with name patterns and corresponding stats
⋮----
new ToolDetectionRule
⋮----
// Sickles also get reduced butchering capability (0.5x) since they're blades
⋮----
ExcludePatterns = new[] { "sledgehammer", "persona" }, // Sledgehammers might be mining tools
⋮----
/// Automatically resolves and enhances all tools in the game with appropriate stats.
/// This method should be called during static constructor initialization.
⋮----
public static void ResolveAllTools()
⋮----
// Always log via raw debug logger so messages appear unthrottled in DevMode when debug logging enabled.
⋮----
// Process all ThingDefs for tool enhancement (weapons and items)
foreach (ThingDef thingDef in DefDatabase<ThingDef>.AllDefs.Where(t => t != null &&
⋮----
enhancementLog.Add(logEntry);
⋮----
// Summary logging
⋮----
// Keep warning-level direct emit for noteworthy no-op completion
⋮----
/// Attempts to enhance a weapon ThingDef with appropriate tool stats
⋮----
private static bool TryEnhanceTool(ThingDef thingDef, out string logEntry)
⋮----
// Use original label; perform case-insensitive comparisons via IndexOf
⋮----
// Check each detection rule
⋮----
// Check if label matches any pattern
bool matches = rule.NamePatterns.Any(pattern =>
!string.IsNullOrEmpty(pattern) &&
label.IndexOf(pattern, StringComparison.OrdinalIgnoreCase) >= 0);
⋮----
// Check if it should be excluded
bool excluded = rule.ExcludePatterns.Any(pattern =>
⋮----
logEntry = $"Excluded {rule.Description.ToLower()}: {thingDef.defName} ({thingDef.label}) from {modSource}";
⋮----
// Check if it already has the required stats (in statBases or mod extensions)
bool needsEnhancement = rule.RequiredStats.Any(stat => !HasExistingStat(thingDef, stat));
⋮----
logEntry = $"Already enhanced {rule.Description.ToLower()}: {thingDef.defName} ({thingDef.label}) from {modSource}";
⋮----
// Skip if this is already a SurvivalTools item (don't modify our own tools)
⋮----
// Enhance the tool
⋮----
logEntry = $"Enhanced {rule.Description.ToLower()}: {thingDef.defName} ({thingDef.label}) from {modSource}";
⋮----
/// Enhances a ThingDef with tool stats based on the detection rule
⋮----
private static void EnhanceTool(ThingDef thingDef, ToolDetectionRule rule, STToolKind toolKind)
⋮----
// Initialize statBases if needed
⋮----
// Add primary stats
⋮----
// Only add if not already present
if (!thingDef.statBases.Any(sb => sb.stat == requiredStat))
⋮----
thingDef.statBases.Add(new StatModifier
⋮----
// Add secondary stats (like reduced butchering for sickles)
⋮----
if (!thingDef.statBases.Any(sb => sb.stat == kvp.Key))
⋮----
value = kvp.Value * multiplier // Apply tech level scaling to secondary stats too
⋮----
// Add SurvivalToolProperties mod extension if not present
⋮----
/// Ensures a ThingDef has the SurvivalToolProperties mod extension
⋮----
private static void EnsureSurvivalToolExtension(ThingDef thingDef, STToolKind toolKind)
⋮----
// Check if it already has the extension
⋮----
// Initialize modExtensions if needed
⋮----
// Add basic SurvivalToolProperties extension
var toolProps = new SurvivalToolProperties();
// Set tool assignment tags based on tool kind
⋮----
toolProps.defaultSurvivalToolAssignmentTags = new List<string> { toolKind.ToString().ToLower() };
⋮----
thingDef.modExtensions.Add(toolProps);
⋮----
/// Gets the stat multiplier based on tech level
⋮----
private static float GetStatMultiplierForTechLevel(TechLevel techLevel)
⋮----
return 0.85f; // Default for unrecognized tech levels
⋮----
/// Checks if a ThingDef already has a specific stat (either in statBases or mod extensions)
⋮----
private static bool HasExistingStat(ThingDef thingDef, StatDef stat)
⋮----
// Check statBases
⋮----
// Check SurvivalToolProperties mod extension
⋮----
/// Checks if a ThingDef is from SurvivalTools (our own items)
⋮----
private static bool IsSurvivalToolsItem(ThingDef thingDef)
⋮----
// Check if defName starts with SurvivalTools_
⋮----
// Check if it has SurvivalToolProperties extension (strong indicator it's ours)
⋮----
/// Logs verification of all mod stats to ensure they're accounted for in detection rules
⋮----
private static void LogModStatsVerification()
⋮----
//ST_StatDefOf.SurvivalToolCarryCapacity,
⋮----
//ST_StatDefOf.ToolEstimatedLifespan,
//ST_StatDefOf.ToolEffectivenessFactor
⋮----
// Get all stats used in detection rules
⋮----
usedStats.Add(stat);
⋮----
usedStats.Add(kvp.Key);
⋮----
// Check for stats that aren't used in any detection rule
var unusedStats = allModStats.Where(stat => stat != null && !usedStats.Contains(stat)).ToList();
LogRawDebug($"[SurvivalTools] Stat coverage verification: {usedStats.Count}/{allModStats.Where(s => s != null).Count()} stats covered in detection rules");
if (unusedStats.Any())
⋮----
/// Gets the mod source name for a ThingDef
⋮----
private static string GetModSource(ThingDef thingDef)
⋮----
// Try to get the mod content pack from the def
ModContentPack modContentPack = thingDef.modContentPack;
⋮----
// Return a clean mod name
⋮----
if (string.IsNullOrEmpty(modName))
⋮----
return string.IsNullOrEmpty(modName) ? "Unknown Mod" : modName;
⋮----
// Fallback - try to determine from package ID if available
⋮----
if (!string.IsNullOrEmpty(packageId))
⋮----
if (packageId.IndexOf("core", StringComparison.OrdinalIgnoreCase) >= 0 ||
packageId.Equals("ludeon.rimworld", StringComparison.OrdinalIgnoreCase))
⋮----
/// Defines detection rules for a specific tool type
⋮----
private class ToolDetectionRule
</file>
<file path="Source/AI/JobDriver_DropSurvivalTool.cs">
// Rimworld 1.6 / C# 7.3
// Source/AI/JobDriver_DropSurvivalTool.cs
⋮----
namespace SurvivalTools
⋮----
public class JobDriver_DropSurvivalTool : JobDriver
⋮----
public override bool TryMakePreToilReservations(bool errorOnFailed) => true;
protected override IEnumerable<Toil> MakeNewToils()
⋮----
this.FailOnDestroyedOrNull(TargetIndex.A);
yield return Toils_General.Wait(DurationTicks, TargetIndex.None);
yield return Toils_General.DoAtomic(() =>
⋮----
var backing = SurvivalToolUtility.BackingThing(toolAsSurvival, pawn) ?? ToolToDrop;
⋮----
// Prefer exact reference match, fallback to def match
Thing inventoryInstance = null;
⋮----
inventoryInstance = inv.FirstOrDefault(t => t == backing);
⋮----
inventoryInstance = inv.FirstOrDefault(t => t.def == backing.def && t.stackCount > 0);
⋮----
inventoryInstance = inv.FirstOrDefault(t => t == ToolToDrop || t.def == ToolToDrop.def);
⋮----
// If the found stack has more than 1, split off 1. Otherwise operate on the instance directly.
Thing toDrop = inventoryInstance.stackCount > 1
? inventoryInstance.SplitOff(1)
⋮----
// Try dropping via the ThingOwner API
Thing droppedTool = null;
⋮----
dropOk = inv.TryDrop(toDrop, pawn.Position, pawn.Map, ThingPlaceMode.Near, out droppedTool);
⋮----
// Fallback: attempt to place on the map directly
⋮----
placed = GenPlace.TryPlaceThing(toDrop, pawn.Position, pawn.Map, ThingPlaceMode.Near);
⋮----
// Attempt to restore split-off items safely
⋮----
var sameStack = inv.FirstOrDefault(t => t.def == toDrop.def && t.stackCount < t.def.stackLimit);
⋮----
int moveAmount = Math.Min(freeSpace, toDrop.stackCount);
⋮----
try { toDrop.Destroy(); } catch { }
⋮----
try { inv.TryAdd(toDrop); }
catch { try { toDrop.Destroy(); } catch { } }
⋮----
// Clear forced-handler references
⋮----
// Try to find storage cell and enqueue haul job if appropriate
⋮----
var haulJob = JobMaker.MakeJob(JobDefOf.HaulToCell, droppedTool, storageCell);
⋮----
pawn.jobs.jobQueue.EnqueueFirst(haulJob);
⋮----
private bool TryFindStorageForTool(Thing tool, out IntVec3 storageCell)
⋮----
if (StoreUtility.TryFindBestBetterStoreCellFor(tool, pawn, map, StoreUtility.CurrentStoragePriorityOf(tool), faction, out storageCell))
⋮----
if (StoreUtility.TryFindBestBetterStoreCellFor(tool, pawn, map, StoragePriority.Unstored, faction, out storageCell))
⋮----
if (!stockpile.settings.AllowedToAccept(tool)) continue;
var validCell = stockpile.cells.FirstOrDefault(cell =>
StoreUtility.IsValidStorageFor(cell, map, tool) &&
pawn.CanReserveAndReach(cell, PathEndMode.OnCell, Danger.Deadly));
</file>
<file path="Source/Harmony/Patch_MassUtility.cs">
//Rimworld 1.6 / C# 7.3
// Source/Harmony/Patch_MassUtility.cs
⋮----
public static class Patch_MassUtility
⋮----
public static class CountToPickUpUntilOverEncumbered_Postfix
⋮----
public static void Postfix(ref int __result, Pawn pawn, Thing thing)
⋮----
bool isSurvivalThing = thing is SurvivalTool || thing.def.IsToolStuff();
⋮----
// For tool-stuff stacks, treat the entire stack as a single "tool unit"
int additionalToolUnits = thing.def.IsToolStuff() ? 1 : 1; // picking up any survival tool normally counts as 1
// (if you wanted to count multiple individual items for stackable tools, change above accordingly)
// If picking up the additionalToolUnits would exceed carry limit, disallow picking up any
if (!pawn.CanCarryAnyMoreSurvivalTools(additionalToolUnits))
⋮----
public static class WillBeOverEncumberedAfterPickingUp_Postfix
⋮----
public static void Postfix(ref bool __result, Pawn pawn, Thing thing, int count)
⋮----
// For tool-stuff stacks, treat the pickup as one additional tool unit (stack counts as single virtual tool).
int additionalToolUnits = thing.def.IsToolStuff() ? 1 : count;
</file>
<file path="Source/Harmony/Patch_Mineable_Notify_TookMiningDamage.cs">
// Rimworld 1.6 / C# 7.3
// Source/Harmony/Patch_Mineable_Notify_TookMiningDamage.cs
⋮----
public static class Patch_Mineable_Notify_TookMiningDamage
⋮----
private static readonly FieldInfo FI_MiningYield =
AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.MiningYield));
private static readonly FieldInfo FI_DiggingYield =
AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.MiningYieldDigging));
public static IEnumerable<CodeInstruction> Transpiler(IEnumerable<CodeInstruction> instructions)
⋮----
// No IL to work with — nothing to emit
⋮----
// If fields can’t be resolved, pass through original IL unchanged
⋮----
var repl = new CodeInstruction(OpCodes.Ldsfld, FI_DiggingYield)
⋮----
private static bool IsSameField(object operand, FieldInfo target)
</file>
<file path="Source/Harmony/Patch_Pawn_JobTracker_ExtraHardcore.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_Pawn_JobTracker_ExtraHardcore.cs
⋮----
/// <summary>
/// Blocks jobs that bypass WorkGiver gating when tools are missing in Hardcore / Extra Hardcore.
/// </summary>
⋮----
public static class Patch_Pawn_JobTracker_ExtraHardcore
⋮----
private static readonly FieldInfo PawnField = AccessTools.Field(typeof(Pawn_JobTracker), "pawn");
// NEW: per-pawn guard so we don't end/restart >1 time per tick and cause thrash
// key = pawn.thingIDNumber, value = last game tick we aborted a job
⋮----
// Track suppressed logs so we can print counts later
⋮----
// Low-frequency reporting of suppressed log counts (debug only)
private const int SuppressedLogReportInterval = 600; // 10s
⋮----
// ------------------------------
// BuildRoof cooldown gate
// Prevents repeated abort/requeue spam when roofing jobs are blocked by hardcore gating
// Keying is by pawn ID -> textual target key (cell or job def) -> tick expiry.
// Using string keys avoids allocations of complex structs in a hot path and keeps lookups fast.
⋮----
// Cooldown window in ticks (5s at 60 TPS)
⋮----
/// Build a compact string key for a job target. Prefer target cell when available.
⋮----
private static string BuildRoofTargetKey(Job job)
⋮----
/// Returns true if the pawn+target is currently on cooldown. Cleans expired entries.
⋮----
private static bool IsBuildRoofOnCooldown(Pawn pawn, string key, int now)
⋮----
if (!_buildRoofCooldowns.TryGetValue(pid, out var inner)) return false;
if (inner == null) { _buildRoofCooldowns.Remove(pid); return false; }
if (inner.TryGetValue(key, out int expiry))
⋮----
// expired — remove
inner.Remove(key);
if (inner.Count == 0) _buildRoofCooldowns.Remove(pid);
⋮----
/// Set a cooldown for pawn+target until now + BuildRoofCooldownTicks.
⋮----
private static void SetBuildRoofCooldown(Pawn pawn, string key, int now)
⋮----
if (!_buildRoofCooldowns.TryGetValue(pid, out var inner))
⋮----
/// Clear any cooldown entry for pawn+target (called when job succeeds or is validated ok).
⋮----
private static void ClearBuildRoofCooldown(Pawn pawn, string key)
⋮----
if (_buildRoofCooldowns.TryGetValue(pid, out var inner) && inner != null)
⋮----
[HarmonyPriority(Priority.Last)] // run after other mods
public static bool Prefix_TryTakeOrderedJob(Pawn_JobTracker __instance, Job job, ref bool __result)
⋮----
/// Prefix for TryFindAndStartJob: intercept the thinker job selection so we can prevent
/// StartJob from being called when gating determines the job should be blocked.
/// Uses reflection to call the private DetermineNextJob(out ThinkTreeDef) method and
/// inspect the returned ThinkResult.
⋮----
public static bool Prefix_TryFindAndStartJob(Pawn_JobTracker __instance)
⋮----
// Resolve pawn and settings defensively
var pawn = (Pawn)PawnField.GetValue(__instance);
⋮----
if (!settings.hardcoreMode || !pawn.CanUseSurvivalTools()) return true;
//if (Prefs.DevMode) return true; // don't interfere in dev mode
⋮----
// Call private DetermineNextJob(out ThinkTreeDef thinkTree) via reflection
⋮----
var determineMethod = AccessTools.Method(jobTrackerType, "DetermineNextJob");
⋮----
var resultObj = determineMethod.Invoke(__instance, parameters);
⋮----
// resultObj is a ThinkResult
⋮----
// Use reflection to read properties IsValid and Job
var isValidProp = thinkResult.GetType().GetProperty("IsValid");
var jobProp = thinkResult.GetType().GetProperty("Job");
⋮----
bool isValid = (bool)isValidProp.GetValue(thinkResult);
⋮----
var nextJob = (Job)jobProp.GetValue(thinkResult);
⋮----
// Determine relevant stats for this job and ask StatGatingHelper if any should block
var requiredStats = SurvivalToolUtility.RelevantStatsFor(null, nextJob.def);
⋮----
if (StatGatingHelper.ShouldBlockJobForStat(stat, settings, pawn))
⋮----
try { ST_Logging.LogToolGateEvent(pawn, nextJob.def, stat, "missing required tool"); } catch { }
// Prevent TryFindAndStartJob from calling StartJob by returning false.
⋮----
// Defensive: if reflection fails, allow normal behavior
⋮----
return true; // allow original method if not blocked
⋮----
// NOTE: RimWorld 1.6 does not expose a Pawn_JobTracker.TryStartJob method to patch.
// Gating is handled via TryTakeOrderedJob (prefix) and StartJob (postfix) above.
⋮----
public static void Postfix_StartJob(Pawn_JobTracker __instance, Job newJob)
⋮----
// Defensive: resolve pawn and settings
var pawn = __instance != null ? (Pawn)PawnField.GetValue(__instance) : null;
⋮----
if (settings?.hardcoreMode != true || !pawn.CanUseSurvivalTools()) return;
// Avoid thrash: do not repeatedly abort within the same tick for this pawn
⋮----
if (lastAbortTickByPawn.TryGetValue(id, out int lastTick) && lastTick == tick)
return; // already handled this pawn this tick
// Optional: don't auto-cancel explicit player-forced jobs in the postfix
⋮----
// Report suppressed logs at low frequency (debug only)
⋮----
// Special-case: Ingest jobs sometimes include CleaningSpeed as a requirement.
// We intentionally do NOT hard-abort jobs for CleaningSpeed or WorkSpeedGlobal
// because those stats are penalty-based only (see StatPart_SurvivalTool).
// This check ensures we don't incorrectly abort Ingest or similar jobs.
⋮----
StatGatingHelper.ShouldBlockJobForStat(ST_StatDefOf.CleaningSpeed, settings, pawn))
⋮----
// Log via deduped tool-gate logger so repeated denials are suppressed
⋮----
// Do NOT abort the job here; StatPart will apply the penalty and the job may proceed.
⋮----
// Normal gating: check stats from WorkGiver/job defs
var requiredStats = SurvivalToolUtility.RelevantStatsFor(null, newJob.def);
if (requiredStats.NullOrEmpty()) return;
⋮----
// Use centralized gating helper which knows about optional stats and exceptions
⋮----
// Special handling for BuildRoof/RoofJob to avoid repeated abort/requeue spam
⋮----
bool isRoofJob = jobDefName == "BuildRoof" || jobDefName == "RoofJob" || (jobDefName != null && jobDefName.IndexOf("buildroof", StringComparison.OrdinalIgnoreCase) >= 0);
⋮----
// If we're on cooldown for this pawn+target, silently skip abort to avoid thrash
⋮----
try { ST_Logging.LogToolGateEvent(pawn, newJob.def, stat, "missing required tool"); } catch { }
⋮----
suppressedLogCounts[logKey] = suppressedLogCounts.TryGetValue(logKey, out int c) ? c + 1 : 1;
⋮----
// Record guard BEFORE ending job to prevent immediate same-tick loops
⋮----
// Set per-pawn+target cooldown for roofing jobs
⋮----
// CRITICAL CHANGE: do NOT request immediate requeue here.
// Let vanilla re-evaluate on the next normal opportunity.
⋮----
// End current job forcefully so work ticks won't continue
⋮----
__instance.EndCurrentJob(JobCondition.Incompletable, startNewJob: false, canReturnToPool: true);
⋮----
pawn.jobs.EndCurrentJob(JobCondition.Incompletable);
⋮----
/// When a job ends successfully, clear any BuildRoof cooldown for that pawn+target so
/// future valid attempts are allowed immediately.
/// This is a Prefix so we can inspect the current job before it's cleared by EndCurrentJob.
⋮----
public static void Prefix_EndCurrentJob(Pawn_JobTracker __instance, JobCondition condition)
⋮----
// Only care about successful completion
⋮----
bool isRoofJob = name == "BuildRoof" || name == "RoofJob" || (name.IndexOf("buildroof", StringComparison.OrdinalIgnoreCase) >= 0);
⋮----
// Defensive: do not let cleanup fail the game
⋮----
private static bool CheckJobAssignment(Pawn_JobTracker jobTracker, Job job, ref bool setOrderedResult)
⋮----
// Resolve pawn safely (cached FieldInfo)
var pawn = jobTracker != null ? (Pawn)PawnField.GetValue(jobTracker) : null;
⋮----
// Only gate in hardcore mode, with a valid pawn that can use tools, and a valid job def
// Also skip gating when developer/debug mode is enabled to avoid interfering with testing.
if (settings == null || settings.hardcoreMode != true || pawn == null || !pawn.CanUseSurvivalTools() || job?.def == null || Prefs.DevMode)
⋮----
// Which stats matter for this job?
var requiredStats = SurvivalToolUtility.RelevantStatsFor(null, job.def);
⋮----
// Block if any relevant stat requires a tool we don't have (per Hardcore/Extra Hardcore rules)
⋮----
// Cooldown the log to avoid spam
⋮----
try { ST_Logging.LogToolGateEvent(pawn, job.def, stat, "missing required tool"); } catch { }
⋮----
// Immediately cancel the job so it cannot continue working ticks.
⋮----
// If we have a jobTracker instance, end the current job as Incompletable to force-drop it.
⋮----
pawnObj.jobs.EndCurrentJob(JobCondition.Incompletable);
⋮----
// Tell TryTakeOrderedJob we handled it (fail) and skip original
⋮----
return true; // allow original method
⋮----
/// Emits a low-frequency debug summary of suppressed log counts, then clears them.
/// Keeps overhead minimal by only running when debug logging is enabled and at a low tick interval.
⋮----
private static void ReportSuppressedLogsIfDue(int now)
⋮----
// Build a compact summary
⋮----
sb.Append("[SurvivalTools.JobBlock] Suppressed abort counts:");
⋮----
sb.Append(' ').Append(kv.Key).Append(':').Append(kv.Value).Append(';');
⋮----
LogDecision("JobBlock_SuppressedSummary", sb.ToString());
// Clear counts after reporting
suppressedLogCounts.Clear();
⋮----
// swallow
⋮----
/// Check if a stat should block jobs based on user settings.
⋮----
private static bool ShouldBlockJobForMissingStat(StatDef stat, SurvivalToolsSettings settings)
⋮----
// Core work stats that always block jobs
if (StatFilters.ShouldBlockJobForMissingStat(stat))
⋮----
// Optional stats that have specific user configuration
⋮----
return false; // Research is currently always optional in normal hardcore mode
// In extra hardcore mode, check additional requirements
if (settings.extraHardcoreMode && settings.IsStatRequiredInExtraHardcore(stat))
⋮----
/// Optional stats (cleaning, butchery, medical, research).
⋮----
private static bool IsOptionalStat(StatDef stat)
⋮----
return StatFilters.IsOptionalStat(stat);
</file>
<file path="Source/Harmony/Patch_RoofUtility_CanHandleBlockingThing.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_RoofUtility_CanHandleBlockingThing.cs
//
// Purpose:
//   Prevents pawns from handling roof-blocking trees unless they meet tree-felling requirements.
//   Integrates SurvivalTools' gating so pawns without the right tools cannot bypass roofs.
⋮----
// Notes:
//   - Early-outs preserve vanilla logic (only intervene if vanilla allowed it).
//   - Debug logging throttled with ShouldLogWithCooldown to prevent spam.
//   - Safe null guards for worker/blocker to avoid rare NREs.
//   - Adds JobFailReason (hardcoded) so players get an in-game message instead of silent blocking.
⋮----
public static class Patch_RoofUtility_CanHandleBlockingThing
⋮----
public static void Postfix(ref bool __result, Thing blocker, Pawn worker)
⋮----
// --- Early exits ---
if (!__result) return;                          // vanilla already disallowed
if (worker == null) return;                     // no pawn available
if (blocker?.def?.plant?.IsTree != true) return; // only care about trees
// --- SurvivalTools gating ---
if (!worker.CanFellTrees())
⋮----
// Avoid spam: many roof cells may query the same blocker repeatedly
⋮----
// Add an in-game job fail reason (non-translated, clear to player)
JobFailReason.Is("Missing tree-felling tool");
__result = false; // deny if no tree-felling tools
</file>
<file path="Source/Harmony/Patch_SymbolResolver_AncientRuins_Resolve.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_SymbolResolver_AncientRuins_Resolve.cs
//
// Ensures Survival Tools can spawn inside ancient ruins.
// Fix: moved from Prefix → Postfix so tools are placed AFTER
// vanilla pushes the "emptyRoom" symbol, otherwise they get wiped.
⋮----
public static class Patch_SymbolResolver_AncientRuins_Resolve
⋮----
// Favor cheaper stuff somewhat, but never zero weight.
private static readonly SimpleCurve StuffMarketValueRemainderToCommonalityCurve = new SimpleCurve
⋮----
new CurvePoint(0f,   SurvivalToolUtility.MapGenToolMaxStuffMarketValue * 0.1f),
new CurvePoint(SurvivalToolUtility.MapGenToolMaxStuffMarketValue,
⋮----
// Cache reflection once; fallback if unavailable.
⋮----
AccessTools.Method(typeof(QualityUtility), "GenerateFromGaussian");
⋮----
public static void Postfix(ResolveParams rp)
⋮----
things = setMaker.Generate();
⋮----
// Non-fatal generation error — route through ST_Logging to respect dev gating
⋮----
if (ST_Logging.ShouldLogWithCooldown(key))
ST_Logging.LogWarning($"[SurvivalTools] AncientRuins tool set generation failed: {e}");
⋮----
// --- Quality ---
⋮----
QualityCategory qc;
⋮----
object res = MI_GenerateFromGaussian.Invoke(
⋮----
qc = res is QualityCategory q ? q : QualityUtility.GenerateQualityRandomEqualChance();
⋮----
qc = QualityUtility.GenerateQualityRandomEqualChance();
⋮----
qComp.SetQuality(qc, ArtGenerationContext.Outsider);
⋮----
// --- Stuff (if applicable and not already assigned) ---
⋮----
var allowedEnum = GenStuff.AllowedStuffsFor(thing.def);
var allowed = allowedEnum != null ? allowedEnum.ToList() : null;
⋮----
var valid = allowed.Where(t =>
⋮----
).ToList();
⋮----
var chosen = valid.RandomElementByWeight(tdef =>
⋮----
float remainder = Mathf.Max(0f, maxMV - tdef.BaseMarketValue);
float baseW = StuffMarketValueRemainderToCommonalityCurve.Evaluate(remainder);
float common = Mathf.Max(0.0001f, tdef.stuffProps?.commonality ?? 1f);
return Mathf.Max(0.0001f, baseW * common);
⋮----
thing.SetStuffDirect(chosen);
⋮----
// --- HitPoints ---
⋮----
int hp = Mathf.RoundToInt(thing.MaxHitPoints *
⋮----
thing.HitPoints = Mathf.Clamp(hp, 1, thing.MaxHitPoints);
⋮----
// --- Enqueue spawn AFTER emptyRoom ---
var rpForThing = rp; // struct copy
⋮----
BaseGen.symbolStack.Push("thing", rpForThing);
⋮----
// Individual spawn errors are noisy in bulk — gate via ST_Logging
⋮----
ST_Logging.LogWarning($"[SurvivalTools] Skipped ancient-ruins tool '{thing?.def?.defName ?? "null"}' due to error: {e}");
</file>
<file path="Source/Harmony/Patch_ThingDef_SpecialDisplayStats.cs">
// Rimworld 1.6 / C# 7.3
// Source/Harmony/Patch_ThingDef_SpecialDisplayStats.cs
⋮----
public static class Patch_ThingDef_SpecialDisplayStats
⋮----
public static void Postfix(ThingDef __instance, ref IEnumerable<StatDrawEntry> __result, StatRequest req)
⋮----
// always work against a real list we control
⋮----
// Build a quick de-dupe set (label + value) to avoid duplicate rows
⋮----
existing.Add((e.LabelCap?.ToString() ?? "") + "|" + (e.ValueString ?? ""));
⋮----
// Aggregated stat factors for the def (covers SurvivalTool defs, enhanced weapon defs, and tool-stuff defs)
⋮----
// Actual SurvivalTool / VirtualTool instance overrides (instance factors already include effectiveness, quality, stuff multipliers)
⋮----
var instFactors = actualTool.WorkStatFactors?.Where(m => m != null && m.stat != null).ToList();
⋮----
// Remove any previously added entries for the same stats to prevent duplicate display rows showing base+instance
var instStatDefs = new HashSet<StatDef>(instFactors.Select(m => m.stat));
list.RemoveAll(entry => entry.category == ST_StatCategoryDefOf.SurvivalTool &&
entry?.LabelCap != null && instStatDefs.Any(sd => entry.LabelCap.ToString().IndexOf(sd.label, System.StringComparison.OrdinalIgnoreCase) >= 0));
existing.RemoveWhere(key => instStatDefs.Any(sd => key.IndexOf(sd.label, System.StringComparison.OrdinalIgnoreCase) >= 0));
⋮----
/// <summary>
/// Collects all survival tool related stat factors declared on a ThingDef either through
/// SurvivalToolProperties.baseWorkStatFactors or statBases (which may have been injected by ToolResolver).
/// Dedupe by StatDef keeping the maximum value. Returns an empty list if none found.
/// </summary>
private static List<StatModifier> AggregateDefToolFactors(ThingDef def)
⋮----
// Extension factors (baseWorkStatFactors)
⋮----
result.Add(new StatModifier { stat = m.stat, value = m.value });
⋮----
// statBases (injected primary/secondary stats from ToolResolver or original defs)
⋮----
// Stuff-based definitions (tool-stuff) don't expose material multipliers here; those apply at instance level.
// If it's stuff and has StuffPropsTool multipliers only (no ext), we still surface base factors so players see potential.*
⋮----
// Show only positive (>1) multipliers as factors; treat them as base factors to inform players.
⋮----
// Dedupe by stat keep max
⋮----
if (!dedup.TryGetValue(m.stat, out var cur) || m.value > cur)
⋮----
result = dedup.Select(kv => new StatModifier { stat = kv.Key, value = kv.Value }).ToList();
⋮----
catch { /* swallow for safety */ }
⋮----
private static void AddStatDrawEntries(
⋮----
// Only show stats that provide meaningful bonuses (> 100%).
// Penalties (< 100%) are intentionally hidden to reduce clutter in info cards.
⋮----
var value = modifier.value.ToStringByStyle(ToStringStyle.PercentZero, ToStringNumberSense.Factor);
⋮----
if (existing.Contains(key))
⋮----
var report = $"When survival tools (or tool-stuff) apply, {modifier.stat.label.ToLower()} is multiplied by {modifier.value.ToStringPercent()}.";
list.Add(new StatDrawEntry(
⋮----
existing.Add(key);
</file>
<file path="Source/Harmony/Patch_Toils_Haul_TakeToInventory.cs">
//RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_Toils_Haul_TakeToInventory.cs
⋮----
public static class Patch_Toils_Haul_TakeToInventory
⋮----
public static void Postfix(Toil __result, TargetIndex ind)
⋮----
if (__result == null) return; // defensive
⋮----
// Run vanilla behavior first, but never trust it to be non-null
⋮----
// If vanilla throws, we don’t want our patch to swallow it silently.
⋮----
// Must be a valid pawn able to use tools
if (actor == null || !PawnToolValidator.CanUseSurvivalTools(actor)) return;
⋮----
// Only react to player-forced pickups
⋮----
// Resolve the actual target
LocalTargetInfo lti;
try { lti = job.GetTarget(ind); }
⋮----
// Index out of range or mutated job — play it safe.
⋮----
// Only SurvivalTool items or tool-stuffs count
bool isSurvivalTool = ToolClassification.IsSurvivalTool(thing);
bool isToolStuff = thing.def != null && thing.def.IsToolStuff();
⋮----
// Verify it ended up in inventory after vanilla’s operation
⋮----
// We only mark the exact Thing reference if it’s now in inventory.
// (Avoid guessing among similar stacks to prevent marking the wrong item.)
if (!inv.Contains(thing)) return;
⋮----
fh.SetForced(thing, true);
</file>
<file path="Source/Harmony/Patch_WorkGiver_GrowerSow_JobOnCell.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_WorkGiver_GrowerSow_JobOnCell.cs
⋮----
public static class Patch_WorkGiver_GrowerSow_JobOnCell
⋮----
public static void Postfix(ref Job __result, Pawn pawn)
⋮----
// Use centralized tree-felling gate
if (pawn != null && pawn.CanFellTrees())
⋮----
__result = new Job(ST_JobDefOf.FellTree, job.targetA);
⋮----
// Block vanilla cut if requirements aren't met
</file>
<file path="Source/Harmony/Patch_WorkGiver_PlantsCut_JobOnThing.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_WorkGiver_PlantsCut_JobOnThing.cs
⋮----
public static class Patch_WorkGiver_PlantsCut_JobOnThing
⋮----
public static void Postfix(ref Job __result, Thing t, Pawn pawn)
⋮----
// Defensive: bail fast if nothing to do or the call has already decided "no job".
⋮----
// Only interfere with the PlantsCut-produced CutPlant job, and only for trees.
// (Avoids touching other job types or non-plant targets.)
⋮----
// Block PlantsCut on trees; specialized felling logic will handle them instead.
⋮----
// Cooldowned debug log to avoid spam.
⋮----
// Keyed by pawn + thing def to keep noise down while still being informative.
</file>
<file path="Source/Harmony/Patch_WorkGiver_Scanner_ToolGate.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_WorkGiver_Scanner_ToolGate.cs
⋮----
//
// Purpose: Prevents pawns from taking jobs from WorkGiver_Scanners unless they
// meet tool/stat requirements under Hardcore / Extra Hardcore modes.
// This is an early-phase gate, BEFORE TryGiveJob, so pawns wonâ€™t even consider
// jobs they lack the tools for.
⋮----
// Future possibilities:
//  - Instead of silent blocking, we could feed into a visual system
//    (eg. tool icons over pawns, animated actions like swinging a hoe,
//    wrench-turning, microscope oscillation, etc.) to show WHY a pawn wonâ€™t work.
//  - Could also tie into tutorial concepts (teach players about tools).
⋮----
public static class Patch_WorkGiver_Scanner_ToolGate
⋮----
// Reusable buffer to avoid per-loop List allocations
⋮----
public static bool Prefix_HasJobOnThing(WorkGiver_Scanner __instance, Pawn pawn, Thing t, bool forced, ref bool __result)
⋮----
public static bool Prefix_HasJobOnCell(WorkGiver_Scanner __instance, Pawn pawn, IntVec3 c, bool forced, ref bool __result)
⋮----
private static bool CheckToolRequirements(WorkGiver_Scanner instance, Pawn pawn, ref bool result)
⋮----
if (settings?.hardcoreMode != true || !pawn.CanUseSurvivalTools())
⋮----
// Get required stats via centralized helper FIRST
var requiredStats = StatGatingHelper.GetStatsForWorkGiver(instance.def);
if (requiredStats.NullOrEmpty())
⋮----
// Only gate jobs that are eligible by default...
// ...but if ShouldGateByDefault misses a WG, still gate when we positively identified CORE blocking stats
bool coreStatsPresent = requiredStats.Any(StatFilters.ShouldBlockJobForMissingStat);
if (!SurvivalToolUtility.ShouldGateByDefault(instance.def) && !coreStatsPresent)
⋮----
// Respect per-WG toggle for WorkSpeedGlobal jobs (if present)
⋮----
settings.workSpeedGlobalJobGating.TryGetValue(instance.def.defName, out bool gated) &&
⋮----
if (StatGatingHelper.ShouldBlockJobForStat(stat, settings, pawn))
⋮----
ST_Logging.LogToolGateEvent(pawn, null, stat, "missing tool");
⋮----
// -----------------------------------------------------------------
// Runtime: focused BuildRoof gating to prevent roofing jobs being assigned
// to pawns that lack ConstructionSpeed tools in extra-hardcore mode.
// We patch concrete WorkGiver_BuildRoof methods at startup so checks run
// earlier than generic Scanner logic and avoid assigning doomed jobs.
⋮----
var t = AccessTools.TypeByName("WorkGiver_BuildRoof") ?? AccessTools.TypeByName("WorkGiver_BuildRoofs");
⋮----
var harmony = new Harmony("com.jellypowered.survivaltools.buildroofgate");
// Patch HasJobOnCell(Pawn, IntVec3, bool)
var hasCell = AccessTools.Method(t, "HasJobOnCell", new Type[] { typeof(Pawn), typeof(IntVec3), typeof(bool) });
⋮----
var prefix = new HarmonyMethod(typeof(Patch_WorkGiver_Scanner_ToolGate).GetMethod(nameof(Prefix_BuildRoof_HasJobOnCell), BindingFlags.NonPublic | BindingFlags.Static));
harmony.Patch(hasCell, prefix: prefix);
⋮----
// Patch JobOnCell(Pawn, IntVec3) if present to avoid creating a job at all
var jobOnCell = AccessTools.Method(t, "JobOnCell", new Type[] { typeof(Pawn), typeof(IntVec3) });
⋮----
var prefix2 = new HarmonyMethod(typeof(Patch_WorkGiver_Scanner_ToolGate).GetMethod(nameof(Prefix_BuildRoof_JobOnCell), BindingFlags.NonPublic | BindingFlags.Static));
harmony.Patch(jobOnCell, prefix: prefix2);
⋮----
catch { /* best-effort */ }
⋮----
// Prefix for concrete BuildRoof.HasJobOnCell to deny job assignment early in extra-hardcore.
private static bool Prefix_BuildRoof_HasJobOnCell(object __instance, Pawn pawn, IntVec3 c, bool forced, ref bool __result)
⋮----
if (pawn == null) return true; // let original handle null
⋮----
// Only enforce stricter gating in extra-hardcore mode
⋮----
// Respect mechanoid/quest/other blacklists
if (!PawnToolValidator.CanUseSurvivalTools(pawn)) return true;
// Centralized helper: ShouldBlockBuildRoof returns whether we should block and a logKey
⋮----
if (StatGatingHelper.ShouldBlockBuildRoof(pawn, out string lk, c))
⋮----
try { if (ShouldLogWithCooldown(lk)) ST_Logging.LogToolGateEvent(pawn, null, StatDefOf.ConstructionSpeed, "missing construction tool"); } catch { }
⋮----
return true; // allow original
⋮----
// Prefix for BuildRoof.JobOnCell to avoid creating the job when pawn lacks tool
private static bool Prefix_BuildRoof_JobOnCell(object __instance, Pawn pawn, IntVec3 c, ref Job __result)
⋮----
if (StatGatingHelper.ShouldBlockBuildRoof(pawn, out string lk2, c))
⋮----
try { if (ShouldLogWithCooldown(lk2)) ST_Logging.LogToolGateEvent(pawn, null, StatDefOf.ConstructionSpeed, "missing construction tool"); } catch { }
</file>
<file path="Source/HarmonyPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/HarmonyPatches.cs
⋮----
internal static class HarmonyPatches
⋮----
private static readonly Type patchType = typeof(HarmonyPatches);
// One Harmony instance for all manual patches
⋮----
// Stat/Method lookups used in several transpilers
private static readonly FieldInfo ConstructionSpeed =
AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.ConstructionSpeed));
private static readonly FieldInfo MaintenanceSpeedField =
AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.MaintenanceSpeed));
private static readonly FieldInfo DeconstructionSpeedField =
AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.DeconstructionSpeed));
private static readonly FieldInfo SowingSpeedField =
AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.SowingSpeed));
private static readonly FieldInfo ResearchSpeedField =
AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.ResearchSpeed));
private static readonly MethodInfo TryDegradeTool =
AccessTools.Method(typeof(SurvivalToolUtility), nameof(SurvivalToolUtility.TryDegradeTool),
⋮----
private static readonly FieldInfo PawnField = AccessTools.Field(typeof(JobDriver), nameof(JobDriver.pawn));
private static readonly FieldInfo MiningSpeedField = AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.MiningSpeed));
private static readonly FieldInfo DiggingSpeedField = AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.DiggingSpeed));
⋮----
private static void TryPatch(string label, MethodBase original,
⋮----
H.Patch(original, prefix, postfix, transpiler, finalizer);
⋮----
// Find the anonymous state machine method that implements MakeNewToils
private static MethodInfo FindMakeNewToils(Type type)
⋮----
.GetNestedTypes(BindingFlags.Public | BindingFlags.NonPublic)
.SelectMany(AccessTools.GetDeclaredMethods)
.FirstOrDefault(m => m.ReturnType == typeof(void)
&& m.GetParameters().Length == 0
&& m.Name.Contains("MakeNewToils"));
⋮----
// (kept around for potential future use)
public static void TryDegradeTool_FromToil(Toil toil, StatDef stat)
⋮----
if (p != null) SurvivalToolUtility.TryDegradeTool(p, stat);
⋮----
// helpers (C# 7.3-friendly)
private static bool IsStloc(OpCode op)
⋮----
private static CodeInstruction LdForSt(CodeInstruction st)
⋮----
if (op == OpCodes.Stloc_0) return new CodeInstruction(OpCodes.Ldloc_0);
if (op == OpCodes.Stloc_1) return new CodeInstruction(OpCodes.Ldloc_1);
if (op == OpCodes.Stloc_2) return new CodeInstruction(OpCodes.Ldloc_2);
if (op == OpCodes.Stloc_3) return new CodeInstruction(OpCodes.Ldloc_3);
// stloc.s or stloc (short/long) – reuse the same operand
return new CodeInstruction(op == OpCodes.Stloc_S ? OpCodes.Ldloc_S : OpCodes.Ldloc, st.operand);
⋮----
// Attribute patches (if any)
H.PatchAll(Assembly.GetExecutingAssembly());
// -------- Vanilla --------
// Mining: reset pick hit uses DiggingSpeed instead of MiningSpeed + degrade on entry
⋮----
AccessTools.DeclaredMethod(typeof(JobDriver_Mine), "ResetTicksToPickHit"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_Mine_ResetTicksToPickHit)));
// Plants that obstruct construction zones
var postfixHandleBlocking = new HarmonyMethod(patchType, nameof(Postfix_HandleBlockingThingJob));
⋮----
AccessTools.Method(typeof(GenConstruct), nameof(GenConstruct.HandleBlockingThingJob)),
⋮----
AccessTools.Method(typeof(RoofUtility), nameof(RoofUtility.HandleBlockingThingJob)),
⋮----
// PlantWork MakeNewToils
⋮----
AccessTools.DeclaredMethod(typeof(JobDriver_PlantWork), "MakeNewToils"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_PlantWork_MakeNewToils)));
// ConstructFinishFrame MakeNewToils
⋮----
AccessTools.DeclaredMethod(typeof(JobDriver_ConstructFinishFrame), "MakeNewToils"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_ConstructFinishFrame_MakeNewToils)));
// Repair MakeNewToils
⋮----
AccessTools.DeclaredMethod(typeof(JobDriver_Repair), "MakeNewToils"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_Repair_MakeNewToils)));
// Deconstruct (tick)
⋮----
AccessTools.Method(typeof(JobDriver_Deconstruct), "TickActionInterval"),
prefix: new HarmonyMethod(patchType, nameof(Prefix_JobDriver_Deconstruct_TickActionInterval)));
// Plant Sowing
⋮----
AccessTools.DeclaredMethod(typeof(JobDriver_PlantSow), "MakeNewToils"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_PlantSow_MakeNewToils)));
// Research
var researchDriverType = GenTypes.GetTypeInAnyAssembly("RimWorld.JobDriver_Research");
⋮----
AccessTools.DeclaredMethod(researchDriverType, "MakeNewToils"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_Research_MakeNewToils)));
⋮----
// AffectRoof tick (nested iterator method)
⋮----
foreach (var t in typeof(JobDriver_AffectRoof).GetNestedTypes(BindingFlags.Public | BindingFlags.NonPublic))
foreach (var m in t.GetMethods(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.Static))
⋮----
var ps = m.GetParameters();
⋮----
m.Name.Contains("MakeNewToils"))
⋮----
transpiler: new HarmonyMethod(patchType, nameof(Transpile_AffectRoof_Tick))
⋮----
// -------- Fluffy Breakdowns --------
⋮----
var maintenanceDriver = GenTypes.GetTypeInAnyAssembly("Fluffy_Breakdowns.JobDriver_Maintenance");
if (maintenanceDriver != null && typeof(JobDriver).IsAssignableFrom(maintenanceDriver))
⋮----
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_Maintenance_MakeNewToils)));
⋮----
// -------- Quarry --------
⋮----
var quarryDriver = GenTypes.GetTypeInAnyAssembly("Quarry.JobDriver_MineQuarry");
if (quarryDriver != null && typeof(JobDriver).IsAssignableFrom(quarryDriver))
⋮----
AccessTools.Method(quarryDriver, "Mine"),
postfix: new HarmonyMethod(patchType, nameof(Postfix_JobDriver_MineQuarry_Mine)));
⋮----
AccessTools.Method(quarryDriver, "ResetTicksToPickHit"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_MineQuarry_ResetTicksToPickHit)));
⋮----
// -------- Turret Extensions --------
⋮----
var upgradeDriver = GenTypes.GetTypeInAnyAssembly("TurretExtensions.JobDriver_UpgradeTurret");
if (upgradeDriver != null && typeof(JobDriver).IsAssignableFrom(upgradeDriver))
⋮----
AccessTools.Method(upgradeDriver, "Upgrade"),
postfix: new HarmonyMethod(patchType, nameof(Postfix_JobDriver_UpgradeTurret_Upgrade)));
⋮----
// -------- Combat Extended --------
⋮----
var holdTracker = GenTypes.GetTypeInAnyAssembly("CombatExtended.Utility_HoldTracker");
⋮----
AccessTools.Method(holdTracker, "GetExcessThing"),
postfix: new HarmonyMethod(patchType, nameof(Postfix_CombatExtended_Utility_HoldTracker_GetExcessThing)));
⋮----
var compInventory = GenTypes.GetTypeInAnyAssembly("CombatExtended.CompInventory");
⋮----
// two overloads in CE 1.6: (Thing, ref int) and (ThingDef, ref int)
var mThing = AccessTools.GetDeclaredMethods(compInventory)
.FirstOrDefault(x => x.Name == "CanFitInInventory" && x.GetParameters().Length >= 1 && x.GetParameters()[0].ParameterType == typeof(Thing));
var mThingDef = AccessTools.GetDeclaredMethods(compInventory)
.FirstOrDefault(x => x.Name == "CanFitInInventory" && x.GetParameters().Length >= 1 && x.GetParameters()[0].ParameterType == typeof(ThingDef));
⋮----
mThing, postfix: new HarmonyMethod(patchType, nameof(Postfix_CombatExtended_CompInventory_CanFitInInventoryThing)));
⋮----
mThingDef, postfix: new HarmonyMethod(patchType, nameof(Postfix_CombatExtended_CompInventory_CanFitInInventoryThingDef)));
⋮----
// -------- Prison Labor --------
⋮----
var mineTweak = GenTypes.GetTypeInAnyAssembly("PrisonLabor.JobDriver_Mine_Tweak");
⋮----
AccessTools.Method(mineTweak, "ResetTicksToPickHit"),
⋮----
// NOTE: In 1.6 there is no FloatMenuMakerMap.AddHumanlikeOrders — we intentionally do NOT patch it.
⋮----
// ---------------- Vanilla postfixes/transpilers ----------------
public static void Postfix_HandleBlockingThingJob(ref Job __result, Pawn worker)
⋮----
// Redirect tree clearing to our FellTree job if the plant is a tree and pawn is allowed
⋮----
if (worker.CanFellTrees())
__result = new Job(ST_JobDefOf.FellTree, __result.targetA);
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_PlantWork_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
var list = instructions.ToList();
var plantHarvestingSpeed = AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.PlantHarvestingSpeed));
var vanillaPlantWorkSpeed = AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.PlantWorkSpeed));
⋮----
yield return ins;                                           // keep store
yield return new CodeInstruction(OpCodes.Ldloc_0);           // actor
yield return new CodeInstruction(OpCodes.Ldsfld, plantHarvestingSpeed);
ins = new CodeInstruction(OpCodes.Call, TryDegradeTool);    // TryDegradeTool(actor, PlantHarvestingSpeed)
⋮----
ins.operand = plantHarvestingSpeed;                          // replace PlantWorkSpeed -> PlantHarvestingSpeed
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_Mine_ResetTicksToPickHit(IEnumerable<CodeInstruction> instructions)
⋮----
// Inject once at method entry:
⋮----
// TryDegradeTool(this.pawn, ST_StatDefOf.DiggingSpeed);
yield return new CodeInstruction(OpCodes.Ldarg_0);                   // this
yield return new CodeInstruction(OpCodes.Ldfld, PawnField);          // this.pawn
yield return new CodeInstruction(OpCodes.Ldsfld, DiggingSpeedField); // ST_StatDefOf.DiggingSpeed
yield return new CodeInstruction(OpCodes.Call, TryDegradeTool);      // call
⋮----
// Replace MiningSpeed with DiggingSpeed
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_ConstructFinishFrame_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
yield return new CodeInstruction(OpCodes.Ldloc_0);
yield return new CodeInstruction(OpCodes.Ldsfld, ConstructionSpeed);
ins = new CodeInstruction(OpCodes.Call, TryDegradeTool);
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_Repair_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
public static void Prefix_JobDriver_Deconstruct_TickActionInterval(JobDriver_Deconstruct __instance)
⋮----
SurvivalToolUtility.TryDegradeTool(__instance.pawn, ST_StatDefOf.DeconstructionSpeed);
⋮----
public static IEnumerable<CodeInstruction> Transpile_AffectRoof_Tick(
⋮----
var code = instructions.ToList();
// The display class that holds the captured locals for the lambda
⋮----
.GetFields(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic)
.FirstOrDefault(f => f.FieldType == typeof(Toil));
⋮----
var toilActorField = AccessTools.Field(typeof(Toil), nameof(Toil.actor)); // Pawn
var constructionSpeed = AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.ConstructionSpeed));
// Inject at method start: TryDegradeTool(this.<toil>.actor, StatDefOf.ConstructionSpeed);
⋮----
yield return new CodeInstruction(OpCodes.Ldarg_0);                   // this (display class)
yield return new CodeInstruction(OpCodes.Ldfld, displayToilField);   // this.<toil>
yield return new CodeInstruction(OpCodes.Ldfld, toilActorField);     // this.<toil>.actor
yield return new CodeInstruction(OpCodes.Ldsfld, constructionSpeed); // StatDefOf.ConstructionSpeed
yield return new CodeInstruction(OpCodes.Call, TryDegradeTool);      // call TryDegradeTool
⋮----
// ---------- Modded JobDrivers ----------
public static IEnumerable<CodeInstruction> Transpile_JobDriver_Maintenance_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
yield return new CodeInstruction(OpCodes.Ldsfld, MaintenanceSpeedField);
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_PlantSow_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
yield return new CodeInstruction(OpCodes.Ldsfld, SowingSpeedField);
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_Research_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
yield return new CodeInstruction(OpCodes.Ldsfld, ResearchSpeedField);
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_MineQuarry_ResetTicksToPickHit(IEnumerable<CodeInstruction> instructions)
⋮----
var miningSpeed = AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.MiningSpeed));
var diggingSpeed = AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.DiggingSpeed));
⋮----
public static void Postfix_JobDriver_MineQuarry_Mine(JobDriver __instance, Toil __result)
⋮----
SurvivalToolUtility.TryDegradeTool(pawn, ST_StatDefOf.DiggingSpeed);
⋮----
__result.defaultDuration = (int)Mathf.Clamp(3000f / pawn.GetStatValue(ST_StatDefOf.DiggingSpeed), 500f, 10000f);
⋮----
public static void Postfix_JobDriver_UpgradeTurret_Upgrade(JobDriver __instance, Toil __result)
⋮----
SurvivalToolUtility.TryDegradeTool(pawn, StatDefOf.ConstructionSpeed);
⋮----
// ---------- Combat Extended hooks ----------
public static void Postfix_CombatExtended_Utility_HoldTracker_GetExcessThing(ref bool __result, Thing dropThing)
⋮----
public static void Postfix_CombatExtended_CompInventory_CanFitInInventoryThing(ThingComp __instance, ref bool __result, Thing thing, ref int count)
⋮----
if (__result && thing is SurvivalTool && __instance?.parent is Pawn pawn && !pawn.CanCarryAnyMoreSurvivalTools())
⋮----
public static void Postfix_CombatExtended_CompInventory_CanFitInInventoryThingDef(ThingComp __instance, ref bool __result, ThingDef thingDef, ref int count)
⋮----
if (__result && thingDef != null && typeof(SurvivalTool).IsAssignableFrom(thingDef.thingClass) && __instance?.parent is Pawn pawn && !pawn.CanCarryAnyMoreSurvivalTools())
</file>
<file path="Source/ToolAssignments/Pawn_SurvivalToolAssignmentTracker.cs">
// Rimworld 1.6 / C# 7.3
// Source/ToolAssignments/Pawn_SurvivalToolAssignmentTracker.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Per-pawn component that stores the current survival tool assignment,
/// forced tool state, and optimization cooldown bookkeeping.
/// </summary>
public class Pawn_SurvivalToolAssignmentTracker : ThingComp
⋮----
private SurvivalToolAssignment _currentAssignment;
public SurvivalToolForcedHandler forcedHandler;
private int _lastOptimizedTick = -99999;   // last time we "optimized"
private int _customOptimizeInterval = -1;  // next-interval override (randomized window), -1 = use default
⋮----
/// Current survival tool assignment for this pawn.
/// Lazily falls back to the database default if unset or invalid.
⋮----
/// Whether the optimizer should run again now.
/// Uses a longer interval when AutoTool is enabled (we opportunistically pick up tools anyway),
/// and a shorter interval when AutoTool is disabled (we rely on periodic optimization more).
⋮----
// ~24 in-game hours with AutoTool, ~1 hour otherwise
⋮----
// Use subtraction to avoid wrap-related edge cases
⋮----
/// Marks optimization as completed and (optionally) schedules the next window.
⋮----
public void Optimized(int minTicks = -1, int maxTicks = -1)
⋮----
_customOptimizeInterval = Rand.Range(minTicks, maxTicks);
⋮----
_customOptimizeInterval = -1; // revert to default cadence
⋮----
public override void Initialize(CompProperties props)
⋮----
base.Initialize(props);
// Ensure forced handler always exists
⋮----
forcedHandler = new SurvivalToolForcedHandler();
⋮----
public override void PostExposeData()
⋮----
base.PostExposeData();
Scribe_References.Look(ref _currentAssignment, "currentAssignment");
Scribe_Deep.Look(ref forcedHandler, "forcedHandler");
Scribe_Values.Look(ref _lastOptimizedTick, "lastOptimizedTick", -99999);
Scribe_Values.Look(ref _customOptimizeInterval, "customOptimizeInterval", -1);
⋮----
// Defensive: never leave this null after load
⋮----
// Validate the saved assignment still exists in the db; if not, fall back to default on next access
⋮----
if (db == null || db.AllSurvivalToolAssignments == null || !db.AllSurvivalToolAssignments.Contains(_currentAssignment))
⋮----
_currentAssignment = null; // lazy default on next get
</file>
<file path="Source/ToolAssignments/SurvivalToolAssignmentDatabase.cs">
//Rimworld 1.6 / C# 7.3
// Source/ToolAssignments/SurvivalToolAssignmentDatabase.cs
⋮----
namespace SurvivalTools
⋮----
public class SurvivalToolAssignmentDatabase : GameComponent
⋮----
public override void FinalizeInit()
⋮----
public override void ExposeData()
⋮----
Scribe_Values.Look(ref initialized, "initialized", false);
Scribe_Collections.Look(ref survivalToolAssignments, "survivalToolAssignments", LookMode.Deep);
⋮----
// Defensive: ensure filters/labels exist on all entries
⋮----
if (assignment.filter == null) assignment.filter = new ThingFilter();
if (assignment.label.NullOrEmpty()) assignment.label = "Unnamed";
⋮----
public SurvivalToolAssignment DefaultSurvivalToolAssignment() =>
survivalToolAssignments.SafeCount() == 0 ? MakeNewSurvivalToolAssignment() : survivalToolAssignments.SafeElementAt(0) ?? MakeNewSurvivalToolAssignment();
public AcceptanceReport TryDelete(SurvivalToolAssignment toolAssignment)
⋮----
// Block deletion if ANY alive pawn (on maps, caravans, temp maps, transport pods) is using it
⋮----
if (!SafetyUtils.IsValidPawn(pawn)) continue;
⋮----
return new AcceptanceReport("SurvivalToolAssignmentInUse".Translate(pawn));
⋮----
// Clear references on all pawns (alive or dead) so saves don’t keep dangling refs
⋮----
survivalToolAssignments.Remove(toolAssignment);
⋮----
public SurvivalToolAssignment MakeNewSurvivalToolAssignment()
⋮----
int uniqueId = survivalToolAssignments.Any() ? survivalToolAssignments.Max(a => a.uniqueId) + 1 : 1;
var toolAssignment = new SurvivalToolAssignment(uniqueId, $"{"SurvivalToolAssignment".Translate()} {uniqueId}");
toolAssignment.filter.SetAllow(ST_ThingCategoryDefOf.SurvivalTools, true);
survivalToolAssignments.Add(toolAssignment);
⋮----
private void GenerateStartingSurvivalToolAssignments()
⋮----
// --- Default "General Worker" (first entry) ---
⋮----
staGeneral.filter.SetDisallowAll();
// Include EVERYTHING that has SurvivalToolProperties (real tools + tool-stuffs)
// Previously this only included defs with baseWorkStatFactors; also include defs
// that declare defaultSurvivalToolAssignmentTags so they appear in starting sets.
⋮----
bool hasAssignmentTags = props.defaultSurvivalToolAssignmentTags != null && props.defaultSurvivalToolAssignmentTags.Any();
⋮----
staGeneral.filter.SetAllow(tDef, true);
⋮----
// --- “Anything” ---
⋮----
staAnything.label = "OutfitAnything".Translate();
staAnything.filter.SetDisallowAll();
// Allow all survival-tool defs + tool-stuffs (anything with SurvivalToolProperties)
// Also include defs that only specify assignment tags.
⋮----
staAnything.filter.SetAllow(tDef, true);
⋮----
// --- Category assignments (only if tools exist for that tag) ---
⋮----
bool hasToolsForTag = DefDatabase<ThingDef>.AllDefs.Any(tDef =>
⋮----
assignment.label = labelKey.Translate();
assignment.filter.SetDisallowAll();
⋮----
// Assign tools to created tag sets
⋮----
if (createdAssignments.TryGetValue(tag, out var assignment))
assignment.filter.SetAllow(tDef, true);
⋮----
staNothing.label = "FoodRestrictionNothing".Translate();
staNothing.filter.SetDisallowAll();
</file>
<file path="Source/Alerts/Alert_ColonistNeedsSurvivalTool.cs">
// RimWorld 1.6 / C# 7.3
// Alert_ColonistNeedsSurvivalTool.cs
//
// Rewritten for clarity:
// - Grouped by stat (Construction, Medical, Plants, etc.)
// - Collapses medical stats into "Medical"
// - Shows pawns per stat with overflow ("…and (X) others")
// - Upgrade suggestions shown once per stat (if enabled)
// - Excludes Glitterworld Multitool from suggestions
// - Cached culprits, minimal LINQ, safe fallbacks
// - RR tag preserved
⋮----
using System.Linq; // retained for limited use; heavy hot-path LINQ replaced below
⋮----
namespace SurvivalTools
⋮----
public class Alert_ColonistNeedsSurvivalTool : Alert
⋮----
private static readonly StatDef Stat_WorkSpeedGlobal =
DefDatabase<StatDef>.GetNamedSilentFail("WorkSpeedGlobal") ??
DefDatabase<StatDef>.GetNamedSilentFail("GlobalWorkSpeed");
⋮----
if (!PawnToolValidator.CanUseSurvivalTools(p)) continue;
if (IsWorkingToolless(p)) list.Add(p);
⋮----
private static bool IsWorkingToolless(Pawn pawn)
⋮----
? pawn.AssignedToolRelevantWorkGiversStatDefsForAlerts()
: pawn.AssignedToolRelevantWorkGiversStatDefs();
⋮----
if (!settings.hardcoreMode && StatFilters.IsOptionalStat(stat)) continue;
if (!SurvivalToolUtility.ToolsExistForStat(stat)) continue;
⋮----
private static bool HasToolImprovingStat(Pawn pawn, StatDef stat)
⋮----
var enumerable = pawn.GetAllUsableSurvivalTools();
⋮----
// Materialize once to list for indexed loop (GetAllUsableSurvivalTools returns IEnumerable)
var tools = enumerable as IList<Thing> ?? enumerable.ToList();
// Reuse unified helper: wrap single stat in temp list to avoid alloc reuse across calls
// For perf, avoid constructing list each iteration; simple direct factor comparison instead.
float baseline = SurvivalToolUtility.GetNoToolBaseline(stat);
⋮----
SurvivalTool st = thing as SurvivalTool;
if (st == null && thing.def != null && thing.def.IsToolStuff()) st = VirtualTool.FromThing(thing);
⋮----
float factor = SurvivalToolUtility.GetToolProvidedFactor(st, stat);
⋮----
public override TaggedString GetExplanation()
⋮----
if (culprits.NullOrEmpty()) return TaggedString.Empty;
⋮----
var sb = new StringBuilder(256);
sb.AppendLine("ColonistNeedsSurvivalToolDesc".Translate());
// Group missing stats -> pawns
⋮----
var givers = pawn.AssignedToolRelevantWorkGivers();
⋮----
if (!statToPawns.TryGetValue(label, out var list))
⋮----
list.Add(pawn);
⋮----
var tools = SurvivalToolDiscovery.GetToolsForStat(stat)
.Where(t => t != null)
// Exclude Glitterworld Multitool by defName OR by label
.Where(t => !t.defName.Contains("Glitterworld", StringComparison.OrdinalIgnoreCase)
&& !t.label.ToLower().Contains("glitterworld"))
.Where(ResearchUnlocks.IsToolResearchUnlocked)
.Select(t => t.label)
.Distinct()
.Take(3)
.ToList();
if (tools.Any())
⋮----
// ALSO include the global work-speed stat if applicable — it isn't tied to a specific WorkGiver
⋮----
if (!statToPawns.TryGetValue(globalLabel, out var list))
⋮----
if (!list.Contains(pawn)) list.Add(pawn);
⋮----
var tools = SurvivalToolDiscovery.GetToolsForStat(Stat_WorkSpeedGlobal)
⋮----
// Exclude Glitterworld Multitool
⋮----
statToSuggestions[globalLabel] = statToSuggestions.ContainsKey(globalLabel)
? statToSuggestions[globalLabel].Union(tools).Distinct().Take(3).ToList()
⋮----
// Write grouped output
foreach (var kv in statToPawns.OrderBy(kv => kv.Key))
⋮----
var pawns = kv.Value.Distinct().ToList();
⋮----
sb.AppendLine();
sb.Append($"{statLabel}: ");
var pawnNames = pawns.Take(MaxPawnsToShow).Select(p => p.LabelShort).ToList();
sb.Append(string.Join(", ", pawnNames));
⋮----
sb.Append($" and ({pawns.Count - MaxPawnsToShow}) others");
if (settings.showUpgradeSuggestions && statToSuggestions.TryGetValue(statLabel, out var suggs))
⋮----
sb.Append("  (" + string.Join(", ", suggs) + ")");
⋮----
return sb.ToString().TrimEnd();
⋮----
public override string GetLabel()
⋮----
bool hasRRNeeds = culprits.Any(p =>
p.AssignedToolRelevantWorkGivers()?.Any(g =>
⋮----
? "ColonistNeedsSurvivalTool".Translate(count)
: "ColonistsNeedSurvivalTool".Translate(count))
+ " (" + "Compat_ReinventedResearchAlert".Translate() + ")";
⋮----
: "ColonistsNeedSurvivalTool".Translate(count));
⋮----
public override AlertReport GetReport()
⋮----
? AlertReport.CulpritsAre(culprits)
⋮----
private static bool ShouldShowAlertForStat(Pawn pawn, StatDef stat, SurvivalToolsSettings settings)
⋮----
if (StatFilters.IsOptionalStat(stat)) return false;
float baseEfficiency = Math.Max(1f, stat.defaultBaseValue);
float current = Math.Max(0f, pawn.GetStatValue(stat));
⋮----
float threshold = Math.Max(0.01f, settings.noToolStatFactorNormal);
⋮----
/// <summary>
/// Normalizes certain stats to shared labels (e.g. all medical stats -> "Medical")
/// </summary>
private static string NormalizeStatLabel(StatDef stat)
⋮----
return stat.label.CapitalizeFirst();
⋮----
internal static class ResearchUnlocks
⋮----
public static bool IsToolResearchUnlocked(ThingDef toolDef)
⋮----
if (rp.NullOrEmpty()) return true;
</file>
<file path="Source/Alerts/Alert_SurvivalToolNeedsReplacing.cs">
// RimWorld 1.6 / C# 7.3
// Source/Alerts/Alert_SurvivalToolNeedsReplacing.cs
//
// QoL: shows damaged tool % remaining and suggests researched replacements.
⋮----
using System.Linq; // retained for non-hot path grouping in explanation only
⋮----
namespace SurvivalTools
⋮----
public class Alert_SurvivalToolNeedsReplacing : Alert
⋮----
// Threshold expressed as remaining HP fraction (0..1). Tools at or below this
// HP fraction will trigger the replacing alert. Using HP% is clearer for players
// than the internal "lifespan" estimate which combined multiple factors.
⋮----
if (!PawnToolValidator.CanUseSurvivalTools(p)) continue;
⋮----
private static bool HasDamagedTools(Pawn pawn)
⋮----
var toolsEnum = pawn.GetAllUsableSurvivalTools();
⋮----
SurvivalTool st = t as SurvivalTool;
if (st == null && t?.def != null && t.def.IsToolStuff()) st = VirtualTool.FromThing(t);
⋮----
private static bool IsToolBelowThreshold(SurvivalTool tool)
⋮----
// Use direct HP fraction for thresholding. This is more intuitive and stable
// than combining lifespan estimates with HP.
⋮----
hpFrac = Math.Max(0f, Math.Min(1f, hpFrac));
⋮----
private static ThingWithComps ResolveThingWithComps(SurvivalTool tool)
⋮----
// Prefer an explicit SourceThing for virtual wrappers (most accurate for inventory stacks)
⋮----
var backingThing = SurvivalToolUtility.BackingThing(tool);
⋮----
private static string FormatToolLifespan(SurvivalTool tool)
⋮----
// Display the actual HP / MaxHP and a human-friendly percentage (HP%). This
// replaces the previous "lifespan" presentation so players see the concrete
// condition of the item.
⋮----
public override TaggedString GetExplanation()
⋮----
var culprits = WorkersDamagedTools.ToList();
⋮----
// Build concise grouped explanation like:
// (2) 30% - Hammer, Axe
var sb = new StringBuilder();
sb.AppendLine("SurvivalToolNeedsReplacingDesc".Translate());
// Map from tool summary -> list of pawns
⋮----
var failing = p.GetAllUsableSurvivalTools()
⋮----
.Where(IsToolBelowThreshold)
.ToList();
⋮----
if (!groups.ContainsKey(summary)) groups[summary] = new List<string>();
groups[summary].Add(p.LabelShort);
⋮----
// Render up to 3 lines ordered by number of affected pawns
foreach (var kv in groups.OrderByDescending(kv => kv.Value.Count).Take(3))
⋮----
var toolNames = kv.Key; // already contains percent info
var pawnList = kv.Value.Distinct().Take(3);
sb.AppendLine($"({kv.Value.Count}) {toolNames} - {string.Join(", ", pawnList)}");
⋮----
int remaining = groups.Values.Sum(list => list.Count) - groups.Values.Take(3).Sum(list => list.Count);
⋮----
sb.AppendLine("...and " + remaining + " more");
return sb.ToString();
⋮----
public override string GetLabel() => "SurvivalToolsNeedReplacing".Translate();
public override AlertReport GetReport()
⋮----
return culprits.Count == 0 ? AlertReport.Inactive : AlertReport.CulpritsAre(culprits);
</file>
<file path="Source/Harmony/Patch_WorkGiver_MissingRequiredCapacity.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_WorkGiver_MissingRequiredCapacity.cs
⋮----
public static class Patch_WorkGiver_MissingRequiredCapacity
⋮----
public static void Postfix(WorkGiver __instance, ref PawnCapacityDef __result, Pawn pawn)
⋮----
// If vanilla already blocked, or no pawn/def, leave it alone.
⋮----
// Only gate jobs that are eligible by default
if (!SurvivalToolUtility.ShouldGateByDefault(wgDef)) return;
// Nothing to gate on.
⋮----
// Use the overload with WorkGiverDef context (helps consistency + any logging).
if (!pawn.MeetsWorkGiverStatRequirements(required, wgDef))
⋮----
var missingStats = string.Join(", ",
required.Where(stat => stat != null)
.Where(stat => pawn.GetBestSurvivalTool(stat) == null)
.Select(stat => stat.defName));
</file>
<file path="Source/AI/JobGiver_OptimizeSurvivalTools.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/JobGiver_OptimizeSurvivalTools.cs
⋮----
//
// SurvivalTools — Optimizer
// - Drops unneeded/duplicate tools
// - Picks up better tools (incl. tool-stuff via VirtualTool)
// - Reduced frequency when AutoTool is enabled
// - Safe map/area checks to avoid OOB errors
⋮----
namespace SurvivalTools
⋮----
public class JobGiver_OptimizeSurvivalTools : ThinkNode_JobGiver
⋮----
// Base cadence
private const int OPTIMIZE_TICK_MIN = 3600;    // ~3h
private const int OPTIMIZE_TICK_MAX = 14400;   // ~6h
// Reduced cadence when AutoTool is doing the heavy lifting
private const int OPTIMIZE_TICK_MIN_AUTOTOOL = 60000;  // ~24h
private const int OPTIMIZE_TICK_MAX_AUTOTOOL = 72000;  // ~30h
⋮----
protected override Job TryGiveJob(Pawn pawn)
⋮----
if (!pawn.CanUseSurvivalTools() || assignmentTracker == null) return null;
// Skip if downed/asleep/in bed
if (pawn.Downed || !pawn.Awake() || pawn.InBed())
⋮----
var heldTools = pawn.GetHeldSurvivalTools().ToList();
// 1) Drop tools that are disallowed by assignment or no longer needed
⋮----
Thing backingForTool = tool is SurvivalTool st ? SurvivalToolUtility.BackingThing(st, pawn) ?? st : tool;
bool disallowedByFilter = curAssignment?.filter != null && !curAssignment.filter.Allows(backingForTool);
bool notNeeded = tool is SurvivalTool surv && !pawn.NeedsSurvivalTool(surv);
⋮----
SetNextOptimizeTick(pawn, 300, 600); // quick cool-down after drop
return pawn.DequipAndTryStoreSurvivalTool(tool);
⋮----
// 2. Drop duplicate tools (includes tool-stuff via virtual wrappers)
⋮----
return pawn.DequipAndTryStoreSurvivalTool(stDup);
⋮----
if (inv?.innerContainer != null && inv.innerContainer.Contains(duplicateThingToDrop))
⋮----
Thing outThing;
// (optional — see #2) drop exactly one from stacks
⋮----
toDrop = toDrop.SplitOff(1);
inv.innerContainer.TryDrop(
⋮----
return null; // drop completed immediately, no job needed
⋮----
// 3) Build relevant stat set
var workRelevantStats = pawn.AssignedToolRelevantWorkGiversStatDefs().Distinct().ToList();
if (workRelevantStats.NullOrEmpty())
⋮----
// 3b) Respect cool-down unless pawn lacks any relevant tool
bool hasAnyRelevantTool = heldTools.Any(t => t is SurvivalTool st && st.WorkStatFactors.Any(m => workRelevantStats.Contains(m.stat)));
⋮----
LogDebug($"[SurvivalTools.Optimizer] Running tool optimization for {pawn.LabelShort}. Relevant stats: {string.Join(", ", workRelevantStats.Select(s => s.defName))}", $"Optimizer_Running_{pawn.ThingID}");
// 4) Find a better tool to acquire
⋮----
// 5) Make space if needed, then queue pickup
Thing toolToDrop = GetToolToDrop(pawn, bestNewTool, workRelevantStats, heldTools);
⋮----
var dropBacking = toolToDrop is SurvivalTool stDrop ? SurvivalToolUtility.BackingThing(stDrop, pawn) ?? toolToDrop : toolToDrop;
⋮----
pawn.jobs.jobQueue.EnqueueFirst(pawn.DequipAndTryStoreSurvivalTool(toolToDrop, enqueueCurrent: false));
⋮----
if (pawn.CanCarryAnyMoreSurvivalTools(heldToolOffset))
⋮----
var pickupTarget = SurvivalToolUtility.BackingThing(bestNewTool, pawn) ?? (Thing)bestNewTool;
var pickupJob = JobMaker.MakeJob(JobDefOf.TakeInventory, pickupTarget);
⋮----
private void SetNextOptimizeTick(Pawn pawn, int min = -1, int max = -1)
⋮----
private SurvivalTool FindBestToolToAcquire(Pawn pawn, List<StatDef> workRelevantStats, SurvivalToolAssignment curAssignment, List<Thing> heldTools)
⋮----
SurvivalTool bestNewTool = null;
⋮----
// Baseline: best held tool
⋮----
if (tool is Thing t && t.def.IsToolStuff()) stTool = VirtualTool.FromThing(t);
⋮----
float score = SurvivalToolUtility.ScoreToolForStats(stTool, pawn, workRelevantStats);
⋮----
var candidates = pawn.Map.listerThings.ThingsInGroup(ThingRequestGroup.HaulableEver);
⋮----
// A) Real SurvivalTool
⋮----
if (!sTool.Spawned || sTool.IsForbidden(pawn) || sTool.IsBurning()) continue;
if (curAssignment?.filter != null && !curAssignment.filter.Allows(sTool)) continue;
⋮----
if (!pawn.CanReserveAndReach(sTool, PathEndMode.OnCell, pawn.NormalMaxDanger())) continue;
float sScore = SurvivalToolUtility.ScoreToolForStats(sTool, pawn, workRelevantStats);
if (sScore <= 0f) continue; // irrelevant tool
⋮----
float sameTypeScore = SurvivalToolUtility.ScoreToolForStats(sameTypeHeld, pawn, workRelevantStats);
⋮----
// B) Tool-stuff (cloth/wool/hyperweave) -> VirtualTool
if (candidate.def.IsToolStuff())
⋮----
if (!item.Spawned || item.IsForbidden(pawn) || item.IsBurning()) continue;
if (curAssignment?.filter != null && !curAssignment.filter.Allows(item)) continue;
if (!pawn.CanReserveAndReach(item, PathEndMode.OnCell, pawn.NormalMaxDanger())) continue;
var vtool = VirtualTool.FromThing(item);
⋮----
bool hasRelevant = vtool.WorkStatFactors.Any(m => workRelevantStats.Contains(m.stat));
⋮----
float vScore = SurvivalToolUtility.ScoreToolForStats(vtool, pawn, workRelevantStats);
// Distance tie-breaker
vScore -= 0.01f * item.Position.DistanceTo(pawn.Position);
⋮----
private Thing GetToolToDrop(Pawn pawn, SurvivalTool newTool, List<StatDef> workRelevantStats, List<Thing> heldTools)
⋮----
// Prefer replacing same-type with worse score
⋮----
var backing = sameTypeHeld is SurvivalTool st ? SurvivalToolUtility.BackingThing(st, pawn) ?? (Thing)sameTypeHeld : (Thing)sameTypeHeld;
⋮----
// If at capacity, drop the worst allowed tool
if (!pawn.CanCarryAnyMoreSurvivalTools())
⋮----
Thing worst = null;
⋮----
var backing = tool is SurvivalTool st ? SurvivalToolUtility.BackingThing(st, pawn) ?? tool : tool;
⋮----
SurvivalTool stScoreTool = tool as SurvivalTool;
if (stScoreTool == null && tool is Thing t && t.def.IsToolStuff()) stScoreTool = VirtualTool.FromThing(t);
⋮----
float score = SurvivalToolUtility.ScoreToolForStats(stScoreTool, pawn, workRelevantStats);
⋮----
private SurvivalTool FindSameTypeHeldTool(Pawn pawn, SurvivalTool targetTool, List<Thing> heldTools)
⋮----
.FirstOrDefault(held => AreSameToolType(held, targetTool));
⋮----
private static bool AreSameToolType(SurvivalTool a, SurvivalTool b) => SurvivalToolUtility.ToolImprovesAny(a, b?.WorkStatFactors?.Select(f => f.stat).Where(s => s != null).Distinct().ToList() ?? new List<StatDef>());
⋮----
private static float SurvivalToolScore(Thing toolThing, Pawn pawn, List<StatDef> workRelevantStats)
⋮----
if (tool == null && toolThing is Thing t && t.def.IsToolStuff()) tool = VirtualTool.FromThing(t);
⋮----
return SurvivalToolUtility.ScoreToolForStats(tool, pawn, workRelevantStats);
⋮----
private static readonly SimpleCurve LifespanDaysToOptimalityMultiplierCurve = new SimpleCurve
⋮----
new CurvePoint(0f,   0.04f),
new CurvePoint(0.5f, 0.20f),
new CurvePoint(1f,   0.50f),
new CurvePoint(2f,   1.00f),
new CurvePoint(4f,   1.00f),
new CurvePoint(999f, 10.00f) // kept as-is from your original
⋮----
/// <summary>
/// Safe wrapper for forcedHandler.AllowedToAutomaticallyDrop that handles nulls.
/// </summary>
private static bool AllowedToAutomaticallyDropSafe(Pawn_SurvivalToolAssignmentTracker tracker, Thing thing)
⋮----
return PawnToolValidator.AllowedToAutomaticallyDrop(pawn, thing);
⋮----
// Groups both real SurvivalTools and held tool-stuff (wrapped as VirtualTool) by their functional stat set.
// Returns the physical Thing to drop: either a SurvivalTool to dequip/store, or a tool-stuff Thing to drop from inventory.
private Thing FindDuplicateToolToDropIncludingVirtuals(Pawn pawn, List<Thing> heldThings)
⋮----
// Build a list of (physicalThing, toolLike) where toolLike exposes WorkStatFactors
⋮----
// Wrap held tool-stuff into a virtual tool for grouping/scoring
⋮----
var v = VirtualTool.FromThing(ht);
if (v != null && v.WorkStatFactors.Any())
⋮----
// Group by the set of stat defNames
⋮----
string.Join(",",
⋮----
.Select(f => f.stat?.defName)
.Where(n => !string.IsNullOrEmpty(n))
.OrderBy(n => n));
⋮----
.GroupBy(x => KeyFor(x.toolLike))
.Where(g => !string.IsNullOrEmpty(g.Key));
⋮----
var members = grp.ToList();
⋮----
// best to keep
var best = members.OrderByDescending(x => Score(x.toolLike)).First();
// choose a droppable non-best member
foreach (var m in members.OrderBy(x => Score(x.toolLike)))
⋮----
? SurvivalToolUtility.BackingThing(st, pawn) ?? m.thing
⋮----
return m.thing; // could be SurvivalTool OR tool-stuff Thing
⋮----
/// Storage/home-area policy with bounds & map checks to avoid Area.get_Item OOB.
⋮----
private static bool ToolIsAcquirableByPolicySafe(Pawn pawn, SurvivalTool tool)
⋮----
var backing = SurvivalToolUtility.BackingThing(tool, pawn) ?? (tool as Thing);
⋮----
// Storage always OK
if (backing.IsInAnyStorage()) return true;
// Respect "storage only"
⋮----
// Must be spawned on the pawn's map and in bounds
⋮----
if (!pos.IsValid || !pos.InBounds(map)) return false;
</file>
<file path="Source/Harmony/Patch_Pawn_InventoryTracker.cs">
// Rimworld 1.6 / C# 7.3
// Source/Harmony/Patch_Pawn_InventoryTracker.cs
⋮----
public static class Patch_Pawn_InventoryTracker
⋮----
// ------------------------------
// Prevent unloading an "in-use" tool (real or virtual)
⋮----
public static class FirstUnloadableThing_Postfix
⋮----
public static void Postfix(Pawn_InventoryTracker __instance, ref ThingCount __result)
⋮----
// If the first unloadable item is an in-use tool (real or virtual), try to pick another item.
⋮----
(thing is SurvivalTool st && SurvivalToolUtility.IsToolInUse(st)) ||
(thing.def.IsToolStuff() && VirtualInUse(thing));
⋮----
// Find the first alternative item that is *not* an in-use SurvivalTool.
Thing alt = null;
⋮----
// Skip in-use real tools
⋮----
// Plain items (including tool-stuff stacks) are fine to unload
⋮----
__result = (alt != null) ? new ThingCount(alt, alt.stackCount) : default(ThingCount);
⋮----
private static bool VirtualInUse(Thing toolStuff)
⋮----
// Tool-stuff can be virtually wrapped; if that wrapper is "in use", treat this as in-use.
var v = VirtualTool.FromThing(toolStuff);
return v != null && SurvivalToolUtility.IsToolInUse(v);
⋮----
// Idle auto-trim of excess tools (respecting forced + in-use)
⋮----
public static class InventoryTracker_Tick_Patch
⋮----
public static IEnumerable<MethodBase> TargetMethods()
⋮----
// Cover both names used across versions.
var tick = AccessTools.Method(typeof(Pawn_InventoryTracker), "InventoryTrackerTick");
var tickRare = AccessTools.Method(typeof(Pawn_InventoryTracker), "InventoryTrackerTickRare");
⋮----
public static void Postfix(Pawn_InventoryTracker __instance)
⋮----
// Every ~1s real-time @60 TPS; skip while busy.
if (!pawn.IsHashIntervalTick(60) || pawn.jobs?.curJob != null) return;
⋮----
if (!pawn.CanUseSurvivalTools() || !pawn.CanRemoveExcessSurvivalTools()) return;
int heldCount = pawn.HeldSurvivalToolCount();
float cap = pawn.GetStatValue(ST_StatDefOf.SurvivalToolCarryCapacity);
⋮----
// Prefer dropping a held (real/virtual) SurvivalTool that is not forced and not in-use.
Thing toolToDrop = FindDroppableHeldTool(pawn);
⋮----
// Fallback: a plain tool-stuff stack from inventory if all tools are "in use".
⋮----
if (t != null && t.def.IsToolStuff())
⋮----
// Respect forced handler on the physical thing.
⋮----
var dropJob = pawn.DequipAndTryStoreSurvivalTool(toolToDrop, enqueueCurrent: false);
⋮----
pawn.jobs.TryTakeOrderedJob(dropJob, JobTag.Misc);
⋮----
private static Thing FindDroppableHeldTool(Pawn pawn)
⋮----
// Scan the "held tools" projection (real tools + virtual tool-stuff).
var held = pawn.GetHeldSurvivalTools();
⋮----
var asTool = t as SurvivalTool; // includes VirtualTool
⋮----
if (!SurvivalToolUtility.IsToolInUse(asTool))
⋮----
// Shouldn't happen (projection returns tools or virtual tools),
// but if we ever get a plain thing here, allow it.
⋮----
private static bool IsForced(Pawn pawn, Thing physical)
⋮----
return tracker.forcedHandler.IsForced(physical);
⋮----
private static Thing PhysicalThingFor(Thing toolOrVirtual, Pawn pawn)
⋮----
return st != null ? SurvivalToolUtility.BackingThing(st, pawn) ?? toolOrVirtual : toolOrVirtual;
⋮----
// Clear forced flag when an item leaves inventory
⋮----
public static class Notify_ItemRemoved_Postfix
⋮----
public static void Postfix(Pawn_InventoryTracker __instance, Thing item)
⋮----
// Clear forced status for SurvivalTool or tool-stuff.
if (item is SurvivalTool || item.def.IsToolStuff())
⋮----
try { SurvivalToolUtility.ToolFactorCache.InvalidateForThing(item); } catch { }
try { SurvivalToolUtility.ClearCountersForThing(item); } catch { }
</file>
<file path="Source/SurvivalTool.cs">
// RimWorld 1.6 / C# 7.3
// Source/SurvivalTool.cs
//
// SurvivalTool
// - Caches work stat factors from: tool def (mod ext + statBases) and stuff def (mod ext)
// - Dedupe by stat (keep max value) for stable scoring
// - Hardcoded English inspect labels (intentional)
// - Null-safe and logging-friendly
⋮----
using System.Linq;           // Contains / Any / ToList
⋮----
namespace SurvivalTools
⋮----
public class SurvivalTool : ThingWithComps
⋮----
/// <summary>Persistent usage counter (used by degradation logic and other systems).</summary>
⋮----
/// <summary>Cached work stat factors sourced from def/stuff; rebuilt on spawn/load when needed.</summary>
⋮----
/// <summary>Exposes cached factors (with lazy initialization when cache is not built).</summary>
⋮----
public override void PostMake()
⋮----
base.PostMake();
⋮----
var list = WorkStatFactors.Select(m => $"{m.stat?.defName ?? "null"}={m.value:G}").ToArray();
LogDebug($"[SurvivalTools] {LabelCap} factors: {string.Join(", ", list)}", $"SurvivalTool_Factors_{this.GetHashCode()}");
⋮----
// swallow: debug-only
⋮----
// Prefer SpawnSetup(Map,bool) for 1.6 over PostSpawnSetup(bool)
public override void SpawnSetup(Map map, bool respawningAfterLoad)
⋮----
base.SpawnSetup(map, respawningAfterLoad);
⋮----
public override void ExposeData()
⋮----
base.ExposeData();
Scribe_Values.Look(ref workTicksDone, "workTicksDone", 0);
// Rebuild cache after load to avoid stale references
⋮----
/// <summary>
/// Force recalculation of work stat factors. Useful when mod settings change
/// or when existing tools need to be updated after mod updates.
/// </summary>
public void RefreshWorkStatFactors()
⋮----
// Next access to WorkStatFactors will trigger InitializeWorkStatFactors
⋮----
private void InitializeWorkStatFactors()
⋮----
// Use the centralized ToolFactorCache for fast, safe caching. The cache implements
// delayed activation so we avoid using it too early during PostLoad init which
// previously led to CTDs. Before activation the cache computes results on-the-fly
// without storing them. Once initialized, results are cached and re-used.
⋮----
// Request precomputed factors from the central cache. Pass this SurvivalTool
// so the cache can apply any instance-specific multipliers if necessary.
var computed = SurvivalToolUtility.ToolFactorCache.GetOrComputeToolFactors(def, Stuff, this);
⋮----
// Never throw during initialization; keep an empty list on failure.
⋮----
// Special-case: if this is a VirtualTool, its physical SourceThing
// may be in a pawn's inventory/equipment. Prefer that holder when present.
⋮----
// For virtual wrappers, the job will target the physical backing thing.
// Use a canonical comparison thing: the source physical thing for virtuals,
// otherwise the tool object itself.
Thing comparisonThing = (this is VirtualTool v && v.SourceThing != null) ? (Thing)v.SourceThing : (Thing)this;
⋮----
/// How many work-ticks of usage correspond to one HP of wear.
/// (estimated lifespan in days * ticks/day) / max HP
⋮----
float lifespanDays = this.GetStatValue(ST_StatDefOf.ToolEstimatedLifespan);
int hp = Math.Max(1, MaxHitPoints);
⋮----
return (int)Math.Floor(ticksPerHp);
⋮----
public override string GetInspectString()
⋮----
var sb = new StringBuilder();
// Held by
⋮----
sb.AppendLine($"Held by {holder.LabelShort}");
// In use
⋮----
sb.AppendLine("In use");
// Condition / lifespan
⋮----
sb.AppendLine($"Condition: {HitPoints}/{MaxHitPoints} ({(hpFrac * 100f):F0}%)");
sb.AppendLine($"Estimated lifespan: {lifespanDays:F1}d");
⋮----
// Append base inspect string (if any)
var baseStr = base.GetInspectString();
if (!baseStr.NullOrEmpty())
⋮----
if (sb.Length > 0) sb.AppendLine();
sb.Append(baseStr);
⋮----
return SanitizeInspectString(sb.ToString());
⋮----
private static string SanitizeInspectString(string s)
⋮----
if (string.IsNullOrEmpty(s)) return s;
s = s.Replace("\r\n", "\n").Replace('\r', '\n');
⋮----
.Split('\n')
.Select(line => line?.Trim())
.Where(line => !string.IsNullOrEmpty(line));
return string.Join("\n", lines).TrimEnd();
</file>
<file path="1.6/Languages/English/keyed/Keys.xml">
<LanguageData>
    <NoTool>No tool</NoTool>
    <ToolInUse>in use</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>Survival Tools Reborn</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>Basic Settings</Settings_BasicSection>
    <Settings_DebugSection>Debug Settings</Settings_DebugSection>
    <Settings_HardcoreMode>Hardcore mode</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>Significantly increases difficulty by making tools essential for survival. Without proper tools, colonists become unable to perform most work tasks effectively. Tools also wear out 50% faster, requiring more frequent replacement and better tool management. Transforms the game into a true tool-dependent survival experience.</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>Extra hardcore mode</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>MAXIMUM DIFFICULTY: The ultimate survival challenge. When combined with hardcore mode, colonists become completely helpless without the right tools. Tasks that were merely inefficient (like cleaning by hand or improvised medical care) become impossible to attempt. Tools degrade 87.5% faster than normal, creating constant pressure for tool production and maintenance. Use the checkboxes below to control exactly which work types become tool-dependent. WARNING: Early game becomes extremely challenging - tool acquisition becomes critical for colony survival!</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>Require cleaning tools</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>Forces colonists to use proper cleaning tools (like brooms or mops) for all cleaning tasks. Without the right tools, they cannot clean floors, remove filth, or clear snow. Essential for maintaining colony hygiene in extreme difficulty modes.</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>Require butchery tools</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>Mandates proper cutting tools (like knives or cleavers) for all butchery and slaughter operations. Colonists cannot process meat or slaughter animals without appropriate bladed implements. Critical for food production chains in hardcore scenarios.</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>Require medical tools</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>Enforces the use of specialized medical instruments for surgical procedures and advanced medical care. Operations become impossible without proper surgical tools, making medical equipment acquisition vital for colony health and survival.</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>Tools in ruined buildings</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>Generates basic survival tools in ancient ruins and crashed structures during map generation. These weathered tools provide essential early-game resources but are typically low-quality. Invaluable for starting colonies in harsh difficulty modes where initial tool access is critical.</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>Tool carrying limit</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>Restricts colonists to carrying a maximum of 2-3 tools in their inventory simultaneously (excluding caravan travel). Forces strategic tool management and specialization among colonists. Tool belts and similar gear can increase this limit. Adds realistic inventory constraints to tool usage.</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>Tool degradation rate</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>Automatic tool optimization</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>Enables intelligent tool management where colonists automatically select and carry the most effective tools for their assigned work. They'll upgrade to better tools and drop inferior ones as needed. Disable this if you prefer manual tool control or experience performance issues with modded materials.</Settings_ToolOptimization_Tooltip>
    <Settings_EnableTreeFelling>Enable Survival Tools tree felling system</Settings_EnableTreeFelling>
    <Settings_EnableTreeFelling_Tooltip>Controls whether Survival Tools manages tree cutting jobs with its specialized Fell Trees and Harvest Trees system. When enabled (default), colonists use ST's enhanced tree felling that requires appropriate tools and provides better efficiency. When disabled, trees are handled by the standard Plant Cut job or other mods like Separate Tree Chopping (Continued). Disable this if you prefer to use other tree-cutting mods without overlap.</Settings_EnableTreeFelling_Tooltip>
    <Settings_ShowUpgradeSuggestions>Show upgrade suggestions</Settings_ShowUpgradeSuggestions>
    <Settings_ShowUpgradeSuggestions_Tooltip>When enabled, the UI will show suggestions to upgrade currently equipped tools to better materials or higher-quality variants when available.</Settings_ShowUpgradeSuggestions_Tooltip>
    <Settings_PickupFromStorageOnly>Restrict tool pickup to storage areas</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>When enabled, colonists will only acquire tools from designated storage zones, maintaining better organization and preventing them from grabbing tools from work areas. When disabled, they can pick up any accessible tool in the Home area (excluding forbidden or burning items), providing more flexibility but less control.</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_AllowPacifistEquip>Allow pacifists to equip survival tools</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>Permits pacifist colonists to equip survival tools that are classified as weapons (like axes, picks, or knives). While these tools have combat capabilities, they're essential for work tasks like tree felling, mining, or food preparation. When enabled, pacifists can use these tools for productive work while still refusing to engage in violence.</Settings_AllowPacifistEquip_Tooltip>
    <Settings_DebugLogging>Enable detailed debug logging</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>Activates comprehensive logging of tool selection decisions, automatic pickup behavior, and job-tool matching logic. Essential for troubleshooting tool issues or understanding why colonists choose specific tools. Recommended only for mod development or when experiencing tool-related problems. May impact performance with extensive logging output.</Settings_DebugLogging_Tooltip>
    <Settings_CompatLogging>Enable compatibility debug logging</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Activates detailed logging for mod compatibility systems including Research Reinvented integration, stat detection, and WorkGiver wiring. Shows step-by-step compatibility setup and integration processes. Only shown when general debug logging is enabled. Useful for diagnosing issues with mod interactions.</Settings_CompatLogging_Tooltip>
    <Settings_AutoTool>Smart pre-work tool pickup</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>Revolutionizes workflow efficiency by having colonists automatically acquire the optimal tool before starting any job. They'll intelligently swap tools, upgrade to better variants, and ensure they have the right equipment for maximum productivity. The cornerstone feature for seamless tool-based gameplay.</Settings_AutoTool_Tooltip>
    <!-- Cleaning penalty (replaces hard blocking) -->
    <Settings_EnableCleaningPenalties>Enable cleaning penalties (no blocking)</Settings_EnableCleaningPenalties>
    <Settings_EnableCleaningPenalties_Tooltip>When enabled, pawns without appropriate cleaning tools (brooms / mops etc.) suffer a severe Cleaning Speed penalty instead of being blocked from cleaning entirely. Penalty severity scales with Hardcore / Extra Hardcore modes. Disable to revert to vanilla-like behavior (no penalty). Recommended for balanced challenge without soft-locking colony hygiene.</Settings_EnableCleaningPenalties_Tooltip>
    <!-- Alert verbosity toggle -->
    <SurvivalTools_ShowDetailedToolListInAlert>Show detailed tool list in alert</SurvivalTools_ShowDetailedToolListInAlert>
    <SurvivalTools_ShowDetailedToolListInAlert_Tooltip>When enabled, the 'Colonist lacks essential tools' alert expands each pawn entry to list every missing or underpowered work stat along with the best tool (if any) they currently have. When disabled, a concise one-line summary per pawn is shown. Helpful for diagnostics; disable for a cleaner alert panel.</SurvivalTools_ShowDetailedToolListInAlert_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>Colonist lacks essential tools</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>Colonists lack essential tools</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>These colonists need proper tools for their assigned work but lack the necessary equipment. Their productivity is severely compromised.</ColonistNeedsSurvivalToolDesc>
    <ST_MissingToolsShort>Missing</ST_MissingToolsShort>
    <ST_NoActionableItems>No actionable items</ST_NoActionableItems>
    <WorkSpeedGlobalShort>Global</WorkSpeedGlobalShort>
    <SurvivalToolsNeedReplacing>Tools approaching failure</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>These colonists are using tools in critical condition that will break soon. Replace them immediately to avoid work disruption.</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>Manage tool assignments</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>Tool assignment</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>Constructor</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>Miner</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>Plant worker</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>Researcher</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>Cleaner</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>Medical</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>Butcher</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>Select tool assignment...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>New tool assignment</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>Delete tool assignment...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>Tool assignment is in use by {0}</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>No tool assignment selected</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>Forced tools</ForcedSurvivalTools>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>Job Types</JobTable_JobTypes>
    <JobTable_JobType>Job Type</JobTable_JobType>
    <JobTable_NormalMode>Normal Mode</JobTable_NormalMode>
    <JobTable_HardcoreMode>Hardcore Mode</JobTable_HardcoreMode>
    <JobTable_Enhanced>Enhanced</JobTable_Enhanced>
    <JobTable_Required>Required</JobTable_Required>
    <JobTable_NoJobsFound>No tool-enhanced jobs found.</JobTable_NoJobsFound>
    <JobTable_SectionTitle>Job Tool Requirements by Mode</JobTable_SectionTitle>
    <JobTable_SectionTooltip>This table shows how different job types behave in each difficulty mode. 'Enhanced' means tools provide bonuses but aren't required. 'Required' means tools are necessary to perform the job. Use this to understand which tools your colonists will need based on your current settings.</JobTable_SectionTooltip>
    <!-- Job Table Headers -->
    <JobTable_Normal>Normal</JobTable_Normal>
    <JobTable_Hardcore>Hardcore</JobTable_Hardcore>
    <JobTable_ExtraHardcore>Extra Hardcore</JobTable_ExtraHardcore>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Click the button below to open the enhanced, resizable settings window with all mod options.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Open Enhanced Settings</Settings_OpenEnhancedButton>
    <!-- Normal Mode explanatory texts -->
    <Settings_NormalModeSection>Normal Mode Work Speed Settings</Settings_NormalModeSection>
    <Settings_NormalMode_Explanation>Normal Mode Behavior:\n• Core work (mining, construction, farming, crafting) gets penalties without tools\n• Optional work (cleaning, research, medical) is unaffected\n• Hardcore mode applies penalties to ALL work types</Settings_NormalMode_Explanation>
    <Settings_EnableNormalModePenalties>Enable Normal Mode Penalties</Settings_EnableNormalModePenalties>
    <Settings_EnableNormalModePenalties_Tooltip>When enabled, pawns work slower at core tasks without proper tools in normal mode. When disabled, only hardcore mode applies penalties.</Settings_EnableNormalModePenalties_Tooltip>
    <Settings_NormalModeToolPenalty>Normal Mode Tool Penalty</Settings_NormalModeToolPenalty>
    <Settings_NormalModePenalties_HelperText>(Applies only to core work: mining, construction, farming, crafting. Optional work like cleaning is unaffected.)</Settings_NormalModePenalties_HelperText>
    <Settings_NormalModePenalties_Disabled>Normal mode penalties disabled - pawns work at full speed without tools except in hardcore mode.</Settings_NormalModePenalties_Disabled>
    <Settings_QualityToolScaling>Use quality-based tool scaling</Settings_QualityToolScaling>
    <Settings_QualityToolScaling_Tooltip>Awful tools are less effective, Legendary tools are stronger. Balances difficulty by making tool choice and quality matter in addition to material.</Settings_QualityToolScaling_Tooltip>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>Reinvented Research</Compat_ResearchReinvented>
    <Compat_FieldResearch>Field Research</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>Reinvented Research</Compat_ReinventedResearchAlert>
    <!-- WorkSpeedGlobal Configuration (Added) -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>General Work Speed Job Configuration</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>Select which jobs that use the general work speed stat should be gated by survival tools. Ungated jobs ignore tool penalties when colonists lack proper tools.</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>Job Type</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>Gated</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>Description</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>No general work speed jobs found.</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>Enable All</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>Disable All</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>Reset to Defaults</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>Trace WorkGivers</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>Requires tools in hardcore modes</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>No tool penalties applied</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>Configure General Work Speed Jobs</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (Added) -->
    <JobTable_NoActiveMode>No active mode selected.</JobTable_NoActiveMode>
    <JobTable_GatedFormat>Gated ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>Gated (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>Unknown</JobTable_Status_Unknown>
    <JobTable_Blocked>Blocked</JobTable_Blocked>
    <!-- Denial / Slowdown Motes -->
    <SurvivalTools_Mote_Blocked>Blocked: Needs {0}</SurvivalTools_Mote_Blocked>
    <SurvivalTools_Mote_Slowed>Slowed (x{0})</SurvivalTools_Mote_Slowed>
    <SurvivalTools_Mote_NeedsAndSlowed>Needs {0}  Slowed (x{1})</SurvivalTools_Mote_NeedsAndSlowed>
    <!-- Denial Mote Setting -->
    <Settings_ShowDenialMotes>Show denial and slowdown motes</Settings_ShowDenialMotes>
    <Settings_ShowDenialMotes_Tooltip>When enabled, pawns will display floating text motes when a job is blocked for lacking required tools (Hardcore/Extra Hardcore) or when continuing at a severe slowdown (Normal mode penalties / fallback cases). Includes per-pawn+stat cooldown to prevent spam. Disable for a cleaner screen or if using another feedback mod.</Settings_ShowDenialMotes_Tooltip>
</LanguageData>
</file>
<file path="Source/AI/AutoToolPickup_UtilityIntegrated.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/AutoToolPickup_UtilityIntegrated.cs
⋮----
public static class Patch_JobGiver_Work_TryIssueJobPackage_AutoTool
⋮----
public static void Postfix(Pawn pawn, JobIssueParams jobParams, ref ThinkResult __result)
⋮----
// Already has a suitable tool?
⋮----
// Hardcore gating: if we can't acquire something, block the job
⋮----
if (StatGatingHelper.ShouldBlockJobForStat(stat, SurvivalTools.Settings, pawn) &&
⋮----
// Normal & Hardcore: attempt proactive pickup (Hardcore may have gated already).
Thing backing;
var bestTool = SurvivalToolUtility.FindBestToolCandidate(pawn, requiredStats, searchMap: true, out backing);
⋮----
// Optional expansion: if single stat has no improving tool, broaden to a paired stat set
⋮----
var rs = requiredStats[i]; if (rs == null) continue; if (beforeSb.Length > 0) beforeSb.Append(", "); beforeSb.Append(rs.defName);
⋮----
var rs = expanded[i]; if (rs == null) continue; if (afterSb.Length > 0) afterSb.Append(", "); afterSb.Append(rs.defName);
⋮----
bestTool = SurvivalToolUtility.FindBestToolCandidate(pawn, requiredStats, searchMap: true, out backing);
⋮----
for (int i = 0; i < requiredStats.Count; i++) { var rs = requiredStats[i]; if (rs == null) continue; if (statsSb.Length > 0) statsSb.Append(", "); statsSb.Append(rs.defName); }
⋮----
private static bool ShouldAttemptAutoTool(Job job, Pawn pawn, out List<StatDef> requiredStats)
⋮----
!pawn.CanUseSurvivalTools() || pawn.Drafted || pawn.InMentalState ||
⋮----
// Special-case tree felling
⋮----
requiredStats = SurvivalToolUtility.RelevantStatsFor(job.workGiverDef, job) ?? new List<StatDef>();
return !requiredStats.NullOrEmpty();
⋮----
private static bool PawnHasHelpfulTool(Pawn pawn, List<StatDef> requiredStats)
⋮----
var tools = pawn.GetAllUsableSurvivalTools();
⋮----
SurvivalTool st = thing as SurvivalTool;
if (st == null && thing.def != null && thing.def.IsToolStuff())
st = VirtualTool.FromThing(thing);
if (st != null && SurvivalToolUtility.ToolImprovesAny(st, requiredStats))
⋮----
float toolFactor = SurvivalToolUtility.GetToolProvidedFactor(st, rs);
float baseline = SurvivalToolUtility.GetNoToolBaseline(rs);
⋮----
if (names.Length > 0) names.Append(", ");
names.Append(rs.defName).Append("(baseline=").Append(baseline.ToString("F2")).Append(" -> ").Append(toolFactor.ToString("F2")).Append(")");
⋮----
// Broadens a narrow single-stat requirement to a paired set when no direct improvement tool exists.
// Helps Normal Mode pick up multi-purpose tools that indirectly aid related tasks.
private static List<StatDef> ExpandAcquisitionStats(List<StatDef> current)
⋮----
// Pair sow/harvest stats bidirectionally
⋮----
if (!list.Contains(ST_StatDefOf.PlantHarvestingSpeed)) list.Add(ST_StatDefOf.PlantHarvestingSpeed);
⋮----
if (!list.Contains(ST_StatDefOf.SowingSpeed)) list.Add(ST_StatDefOf.SowingSpeed);
⋮----
return current; // unchanged
⋮----
private static bool CanAcquireHelpfulToolNow(Pawn pawn, List<StatDef> requiredStats, bool isDebug)
⋮----
var best = SurvivalToolUtility.FindBestToolCandidate(pawn, requiredStats, searchMap: true, out backing);
⋮----
return pawn.CanReserveAndReach(backing, PathEndMode.OnCell, pawn.NormalMaxDanger());
⋮----
private static ThinkResult CreateToolPickupJobs(
⋮----
return new ThinkResult(originalJob, sourceNode, JobTag.Misc, false);
var spawnTarget = SurvivalToolUtility.BackingThing(toolToGet, pawn) ?? (Thing)toolToGet;
⋮----
spawnTarget.IsForbidden(pawn) ||
!pawn.CanReserveAndReach(spawnTarget, PathEndMode.OnCell, pawn.NormalMaxDanger()))
⋮----
var pickupJob = JobMaker.MakeJob(JobDefOf.TakeInventory, spawnTarget);
⋮----
// Simple: queue pickup, then resume original job
⋮----
// Avoid cloning DoBill jobs because other mods (e.g. CommonSense) patch internal bill state.
if (originalJob.def.defName != null && originalJob.def.defName.IndexOf("DoBill", StringComparison.OrdinalIgnoreCase) >= 0)
⋮----
pawn.jobs.jobQueue.EnqueueFirst(originalJob);
⋮----
pawn.jobs.jobQueue.EnqueueFirst(cloned ?? originalJob);
⋮----
return new ThinkResult(pickupJob, sourceNode, JobTag.Misc, false);
⋮----
private static Job CloneJobForQueue(Job j)
⋮----
// Make a new job with the same def/targets
var copy = JobMaker.MakeJob(j.def, j.targetA, j.targetB, j.targetC);
// Copy fields manually (Job fields are public, not properties in RW 1.6)
⋮----
// Extra commonly used fields in DoBill & hauling contexts (defensive null checks)
⋮----
// Copy queues safely
⋮----
// Legacy scanner & scoring removed: unified logic lives in SurvivalToolUtility.FindBestToolCandidate / ScoreToolForStats / ToolImprovesAny
</file>
<file path="Source/Harmony/Patch_PawnRenderer.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_PawnRenderer.cs
//
// Purpose:
//   Ensures pawns visibly "use" survival tools while working by drawing the tool
//   in the same pass that vanilla uses for equipment/apparel extras.
//   This improves immersion, showing tools in-hand only when relevant.
⋮----
// What this patch does:
//   - Draws an in-use SurvivalTool (real or virtual) while a pawn is performing a work job.
//   - Skips portrait / invisible renders and invalid pawn states.
//   - Skips drafted pawns unless they're actually performing a work job (i.e., relevant stats exist).
//   - Avoids double-drawing if the same physical item is already shown as Primary.
//   - Uses a small JobDef â†’ required-stats cache to reduce allocations.
⋮----
// Future ideas (comments only, not implemented):
//   - Animated tools (e.g., swinging pick/axe, wrench turning, microscope oscillation).
//   - Per-job offsets/orientations so a hammer sits differently than a wrench.
//   - Sync lightweight animations to pawn tick or job progress for smooth motion.
⋮----
[HarmonyPriority(Priority.Last)] // draw last so our overlay isn't hidden by other mods
[StaticConstructorOnStartup]     // ensure our type gets initialized at load
public static class ShowWhileWorking_Draw_Postfix
⋮----
// Cache: JobDef -> required stats to avoid repeat lookups/allocations.
⋮----
// Optional: static ctor (no reload hook in 1.6 â€” we just start empty)
⋮----
_jobStatCache.Clear();
// If you later add a reload hook, clear the cache there as well.
⋮----
public static void Postfix(Pawn pawn, Vector3 drawPos, Rot4 facing, PawnRenderFlags flags)
⋮----
// Skip non-play renders / invisible / invalid pawns
⋮----
// Drafted behavior:
//  - We generally skip drafted pawns (vanilla shows weapons),
//  - but if they're actually doing a "work job" (i.e., stats are relevant),
//    we'll draw the tool. We enforce this indirectly because we only draw
//    when RelevantStatsFor() returns a non-empty set.
//    (So no special hard block here â€” the stat check below is the gate.)
// Decide which tool is in use (real or virtual) and what stats are required.
⋮----
// Prevent double-draw if the same physical thing is already being rendered as Primary.
⋮----
// Compare by backing thing for virtual wrappers so we don't draw a virtual wrapper
// when the actual spawned thing is already drawn as primary.
Thing backing = SurvivalToolUtility.BackingThing(toolThing as SurvivalTool, pawn);
⋮----
// Vanilla equipment distance factor (children hold closer).
⋮----
// If pawn is "aiming" per vanilla rules, draw with aiming helper; otherwise draw as carried.
⋮----
&& !flags.HasFlag(PawnRenderFlags.NeverAimWeapon)
⋮----
// Tint virtual tools by work-type (green medical, red butchery, etc.)
Color virtualTint = GetTintForVirtualTool(toolThing, requiredStats);
⋮----
// --- Aiming-style draw (reuses vanilla orientation logic) ---
Vector3 target = stanceBusy.focusTarg.HasThing
⋮----
: stanceBusy.focusTarg.Cell.ToVector3Shifted();
⋮----
Vector3 delta = target - pawn.DrawPos;
⋮----
aimAngle = delta.AngleFlat();
⋮----
drawPos += new Vector3(0f, 0f, 0.4f + eqOffset).RotatedBy(aimAngle) * distFactor;
⋮----
DrawVirtualTool(toolThing, drawPos, Quaternion.AngleAxis(aimAngle, Vector3.up), virtualTint);
// Animation hook (future):
//  - For â€œswingingâ€ tools, vary a small extra rotation (e.g., +/- 10Â°) with a sin wave
//    tied to pawn tick: float wobble = Mathf.Sin(Time.time * 6f) * 10f;
//  - Apply to 'aimAngle' before building the Quaternion.
⋮----
PawnRenderUtility.DrawEquipmentAiming(twc, drawPos, aimAngle);
⋮----
// --- Carried-style draw (when not aiming) ---
⋮----
//  - Subtle bobbing while working: offset drawPos.y or Z by a small sin wave.
//  - Slight rotation oscillation to suggest use.
⋮----
PawnRenderUtility.DrawCarriedWeapon(twc, drawPos, facing, distFactor);
⋮----
//  - For hammers/saws, consider small periodic rotation around local Z.
//  - Could keyframe based on job progress if available.
⋮----
// Draw a virtual tool with a tint (stat-driven)
private static void DrawVirtualTool(Thing toolThing, Vector3 drawPos, Quaternion rot, Color tint)
⋮----
? MaterialPool.MatFrom(tex, ShaderDatabase.Transparent, tint)
⋮----
Graphics.DrawMesh(
⋮----
Matrix4x4.TRS(drawPos, rot, new Vector3(scale, 1f, scale)),
⋮----
// Pick a tint based on which stats the tool contributes to.
private static Color GetTintForVirtualTool(Thing tool, List<StatDef> requiredStats)
⋮----
var defaultTint = new Color(1f, 1f, 1f, 0.6f);
⋮----
// light-weight membership checks (no LINQ allocs in the hot path)
⋮----
return new Color(0.4f, 1f, 0.4f, 0.75f);   // green
⋮----
return new Color(0.4f, 0.7f, 1f, 0.75f);   // blue
⋮----
return new Color(0.7f, 0.5f, 1f, 0.75f);   // purple
⋮----
return new Color(1f, 0.4f, 0.4f, 0.75f);   // red
⋮----
/// <summary>
/// Gets the active survival tool (real or virtual) for the pawn's current job,
/// and the required stats for that job. Uses a small cache keyed by JobDef.
/// Drafted pawns still pass through here; if RelevantStatsFor() returns empty,
/// we naturally refrain from drawing anything (so drafted idle = no tool drawn).
/// </summary>
private static (Thing tool, List<StatDef> requiredStats) GetActiveToolForJob(Pawn pawn, Job job)
⋮----
if (pawn == null || job == null || !PawnToolValidator.CanUseSurvivalTools(pawn))
⋮----
// Cache lookup
if (!_jobStatCache.TryGetValue(job.def, out var requiredStats))
⋮----
requiredStats = SurvivalToolUtility.RelevantStatsFor(job.workGiverDef, job) ?? new List<StatDef>();
⋮----
// If no relevant stats, nothing to draw (also filters out most drafted non-work jobs).
⋮----
// Debug logging (throttled)
⋮----
// Summarized per-pawn/job drawing info to avoid per-tool spam in the renderer
var bestForLog = pawn.GetBestSurvivalTool(requiredStats);
⋮----
// 1) Normal path: best survival tool (real or virtual) selected by our core logic.
var best = pawn.GetBestSurvivalTool(requiredStats);
⋮----
// Held-only best tool edge case: if unified logic returns null but we have exactly one
// held/equipped candidate that improves any required stat, use it rather than falling
// all the way through to ad-hoc scoring / virtual wrapping. This can happen briefly
// during cache warm-up or when expectedKind filtering raced against delayed stat init.
⋮----
var held = pawn.GetAllUsableSurvivalTools();
SurvivalTool singleImprover = null;
⋮----
SurvivalTool st = h as SurvivalTool;
if (st == null && h?.def != null && h.def.IsToolStuff()) st = VirtualTool.FromThing(h);
⋮----
if (SurvivalToolUtility.ToolImprovesAny(st, requiredStats))
⋮----
if (improverCount > 1) break; // no longer a single improver case
⋮----
catch { /* ignore fallback errors */ }
// 1b) Defensive fallback: if core selection returned null (possibly due to delayed cache
// initialization or stale factors), compute a one-off best candidate using the same
// factor computation used by the runtime cache so the drawn tool matches the job's
// effective stat contributor. This avoids showing the wrong tool (e.g., hammer when
// the pawn is actually using an axe-like virtual tool for tree felling).
⋮----
Thing bestThing = null;
var candidates = pawn.GetAllUsableSurvivalTools();
⋮----
// Determine def + stuff for the candidate (virtual wrappers supply def)
ThingDef toolDef = cand.def;
ThingDef stuffDef = null;
SurvivalTool asTool = cand as SurvivalTool;
⋮----
// Get base factors (may compute ad-hoc if cache not ready)
var factors = SurvivalToolUtility.ToolFactorCache.GetOrComputeToolFactors(toolDef, stuffDef, asTool);
⋮----
// Sum relevant stat values
⋮----
// Apply HP penalty for damaged physical tools
var backing = SurvivalToolUtility.BackingThing(asTool, pawn);
⋮----
catch { /* fallback silently if anything goes wrong during draw-time selection */ }
// 2) Fallback: wrap any relevant tool-stuff stack into a VirtualTool for display.
⋮----
if (thing?.def == null || !thing.def.IsToolStuff()) continue;
⋮----
if (mod?.stat != null && requiredStats.Contains(mod.stat))
return (VirtualTool.FromThing(thing), requiredStats);
</file>
<file path="Source/Harmony/Patch_ITab_Pawn_Gear_DrawThingRow.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_ITab_Pawn_Gear_DrawThingRow.cs
⋮----
public static class Patch_ITab_Pawn_Gear_DrawThingRow
⋮----
private static readonly MethodInfo MI_Widgets_Label =
AccessTools.Method(typeof(Widgets), nameof(Widgets.Label), new[] { typeof(Rect), typeof(string) });
private static readonly MethodInfo MI_SelPawnForGear =
AccessTools.PropertyGetter(typeof(ITab_Pawn_Gear), "SelPawnForGear");
private static readonly MethodInfo MI_Adjust =
AccessTools.Method(typeof(Patch_ITab_Pawn_Gear_DrawThingRow), nameof(AdjustDisplayedLabel));
public static IEnumerable<CodeInstruction> Transpiler(IEnumerable<CodeInstruction> instructions)
⋮----
var list = instructions.ToList();
⋮----
if (!didPatch && ins.Calls(MI_Widgets_Label))
⋮----
yield return new CodeInstruction(OpCodes.Ldarg_3); // thing
yield return new CodeInstruction(OpCodes.Ldarg_0); // this (ITab_Pawn_Gear)
yield return new CodeInstruction(OpCodes.Call, MI_SelPawnForGear); // pawn
yield return new CodeInstruction(OpCodes.Call, MI_Adjust);
⋮----
public static string AdjustDisplayedLabel(string originalLabel, Thing thing, Pawn pawn)
⋮----
if (string.IsNullOrEmpty(originalLabel)) originalLabel = string.Empty;
⋮----
var tool = thing as SurvivalTool ?? (thing.def?.IsToolStuff() == true ? (SurvivalTool)VirtualTool.FromThing(thing) : null);
// Forced handler suffix
⋮----
Thing physicalForForced =
⋮----
originalLabel += $", {"ApparelForcedLower".Translate()}";
⋮----
if (tool != null && SurvivalToolUtility.IsToolInUse(tool)) inUse = true;
⋮----
originalLabel += $", {"ToolInUse".Translate()}";
</file>
<file path="Source/SurvivalToolUtility.cs">
// RimWorld 1.6 / C# 7.3
// Source/SurvivalToolUtility.cs
⋮----
namespace SurvivalTools
⋮----
public static class SurvivalToolUtility
⋮----
// These helpers unify previously duplicated logic spread across:
//  - (Removed) ToolScoring legacy class
//  - JobGiver_OptimizeSurvivalTools
//  - AutoToolPickup_UtilityIntegrated
//  - Alert classes & ad-hoc loops
// All new code should call these methods; legacy code will be migrated to them.
private const float ST_MultiStatBonusPerExtra = 0.10f; // 10% per extra matched stat
private const float ST_DistancePenaltyPerTile = 0.01f; // score penalty per tile (map searches)
⋮----
public static float GetNoToolBaseline(StatDef stat)
⋮----
try { return ToolFactorCache.GetOrComputeNoToolPenalty(stat); } catch { return 1f; }
⋮----
public static float GetToolProvidedFactor(SurvivalTool tool, StatDef stat)
⋮----
// IMPORTANT: Returning 1f here incorrectly implied an improvement over the baseline
// no-tool penalty (e.g. 0.4 normal mode) even when the tool does NOT cover this stat.
// That caused any unrelated tool to appear to "improve" every penalized stat, blocking
// normal-mode proactive pickup (PawnHasHelpfulTool/ToolImprovesAny early-exited true).
// We now return the baseline penalty so absent modifiers yield zero delta in
// ScoreToolForStats and ToolImprovesAny.
⋮----
public static bool ToolImprovesAny(SurvivalTool tool, List<StatDef> stats)
⋮----
public static float ScoreToolForStats(SurvivalTool tool, Pawn pawn, List<StatDef> stats)
⋮----
// Quality weighting if enabled
⋮----
if (comp != null) total *= ToolQualityCurve.Evaluate((int)comp.Quality);
⋮----
// Condition weighting 50%..100%
⋮----
Thing backing = BackingThing(tool, pawn) ?? (tool as Thing);
⋮----
public static SurvivalTool FindBestToolCandidate(Pawn pawn, List<StatDef> requiredStats, bool searchMap, out Thing backingThing)
⋮----
SurvivalTool best = null; float bestScore = 0f;
// Held/equipped first
foreach (var thing in pawn.GetAllUsableSurvivalTools())
⋮----
SurvivalTool cand = thing as SurvivalTool;
if (cand == null && thing.def.IsToolStuff()) cand = VirtualTool.FromThing(thing);
⋮----
var map = pawn.Map; var seen = new HashSet<int>(); if (backingThing != null) seen.Add(backingThing.thingIDNumber);
// Radial
foreach (var t in GenRadial.RadialDistinctThingsAround(pawn.Position, map, ST_RadialSearchRadius, true))
⋮----
if (t == null) continue; SurvivalTool cand = t as SurvivalTool;
if (cand == null && t.def.IsToolStuff()) cand = VirtualTool.FromThing(t);
⋮----
if (bt == null || seen.Contains(bt.thingIDNumber) || bt.IsForbidden(pawn) || !pawn.CanReserveAndReach(bt, PathEndMode.OnCell, pawn.NormalMaxDanger())) continue;
if (!ToolImprovesAny(cand, requiredStats)) continue; seen.Add(bt.thingIDNumber);
float sc = ScoreToolForStats(cand, pawn, requiredStats) - ST_DistancePenaltyPerTile * bt.Position.DistanceTo(pawn.Position);
⋮----
// Storage + haulables passes
var haulables = map.listerThings.ThingsInGroup(ThingRequestGroup.HaulableEver);
⋮----
float dist = t.Position.DistanceTo(pawn.Position);
if (pass == 0 && (!t.IsInAnyStorage() || dist > ST_StorageSearchRadius)) continue;
if (pass == 1 && (t.IsInAnyStorage() || dist > ST_StorageSearchRadius)) continue;
⋮----
SurvivalTool cand = t as SurvivalTool; if (cand == null && t.def.IsToolStuff()) cand = VirtualTool.FromThing(t);
⋮----
/// <summary>
/// Deterministic counters for virtual-source wear. Keyed by SourceThing.thingIDNumber.
/// We use this to implement tick-based deterministic degradation for virtual tools
/// instead of probabilistic per-call damage. This prevents variance across runs
/// and makes debugging easier.
/// </summary>
⋮----
/// Safely removes any deterministic counters associated with the provided thing.
/// Call this when a backing thing is destroyed, dropped, or otherwise replaced so
/// counters don't accumulate for stale Thing ids across maps/saves.
⋮----
public static void ClearCountersForThing(Thing t)
⋮----
if (_virtualToolDegradeCounters.ContainsKey(key))
_virtualToolDegradeCounters.Remove(key);
⋮----
/// Remove all deterministic counters. Useful on map unload / game load to avoid
/// retaining stale thing ids across sessions.
⋮----
public static void ClearAllCounters()
⋮----
try { _virtualToolDegradeCounters.Clear(); } catch { }
⋮----
// Deduplication for debug logs in RelevantStatsFor
⋮----
public static readonly FloatRange MapGenToolHitPointsRange = new FloatRange(0.3f, 0.7f);
⋮----
// Quality multiplier curve for tools. This maps QualityCategory (as int) to an effectiveness multiplier.
// Values chosen to make quality meaningfully impact work speed without dominating base tool factors.
// Awful=0, Poor=1, Normal=2, Good=3, Excellent=4, Masterwork=5, Legendary=6
public static readonly SimpleCurve ToolQualityCurve = new SimpleCurve()
⋮----
new CurvePoint(0f, 0.6f), // Awful
new CurvePoint(1f, 0.8f), // Poor
new CurvePoint(2f, 1.0f), // Normal
new CurvePoint(3f, 1.1f), // Good
new CurvePoint(4f, 1.25f), // Excellent
new CurvePoint(5f, 1.4f), // Masterwork
new CurvePoint(6f, 1.6f)  // Legendary
⋮----
/// Centralized cache for computed work stat factors per (toolDef, stuffDef) pair.
/// This cache supports delayed activation: during the first ~3 seconds after a save
/// loads we avoid populating the cache to prevent CTDs caused by other systems
/// not being fully initialized. While not activated callers receive computed results
/// on-the-fly but nothing is persisted in the cache until activation.
///
/// Keys are lightweight strings "toolDef|stuffDef" to minimize allocations in hot paths.
⋮----
internal static class ToolFactorCache
⋮----
// Cache for computed no-tool penalty multipliers per statDefName
⋮----
private const int LOG_ONCE_KEY_TTL = 1; // placeholder to use existing keyed logging
⋮----
/// Schedule cache activation at the specified game tick. Call this from
/// the validation GameComponent when scheduling delayed init (3s after load).
⋮----
internal static void ScheduleActivation(int activationTick)
⋮----
/// Called each tick by GameComponent_SurvivalToolsValidation.GameComponentTick to
/// flip the Initialized flag when the scheduled activation tick is reached.
⋮----
internal static void CheckActivation()
⋮----
// Optionally log once when cache becomes active
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.ShouldLogWithCooldown("ToolFactorCache_Activated"))
⋮----
ST_Logging.LogDebug("[SurvivalTools] ToolFactorCache initialized and ready.", "ToolFactorCache_Activated");
⋮----
catch { /* best-effort */ }
⋮----
/// Compute or retrieve cached factors for the given tool definition + stuff.
/// If the cache isn't initialized yet we compute on-the-fly and do not store.
/// This method is defensive and avoids LINQ in hot paths.
⋮----
internal static List<StatModifier> GetOrComputeToolFactors(ThingDef toolDef, ThingDef stuff, SurvivalTool instance = null)
⋮----
// If not initialized, compute on the fly and do not cache.
⋮----
// Log computation once per key to aid diagnostics
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.ShouldLogWithCooldown($"ToolFactorComputed_{key}"))
ST_Logging.LogDebug($"[SurvivalTools] Computed factors (adhoc) for {key}: {FormatFactors(adHoc)}", $"ToolFactorComputed_{key}");
⋮----
// Try cached fast-path
if (_cache.TryGetValue(key, out var cached) && cached != null)
⋮----
// Miss: compute and populate cache
⋮----
// Defensive: ensure we always store a non-null list
⋮----
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.ShouldLogWithCooldown($"ToolFactorCached_{key}"))
ST_Logging.LogDebug($"[SurvivalTools] Cached factors for {key}: {FormatFactors(_cache[key])}", $"ToolFactorCached_{key}");
⋮----
/// Remove cached entries related to the provided thing (tool instance or stuff def).
/// Call this when a tool is crafted, destroyed, dropped, or when its HP reaches 0.
⋮----
internal static void InvalidateForThing(Thing thing)
⋮----
// If it's a SurvivalTool, clear its specific key(s). If it's a stuff def we need to
// clear any key that references that stuff (scan keys). Scanning is rare (on events)
// so it's acceptable to iterate the keys.
⋮----
_cache.Remove(k);
⋮----
// Stuff-level invalidation: remove any key that ends with |stuffDefName
⋮----
if (!string.IsNullOrEmpty(sd))
⋮----
if (kk.EndsWith("|" + sd))
_cache.Remove(kk);
⋮----
// When a thing (tool or stuff) changes, the no-tool penalty for affected stats may change
⋮----
_noToolPenaltyCache.Clear();
⋮----
/// Removes everything from the cache (map reset/load).
⋮----
internal static void ClearAll()
⋮----
_cache.Clear();
⋮----
/// Compute or retrieve the cached no-tool penalty multiplier for the provided stat.
/// This implements the tiered penalty logic described in settings: normal, hardcore (+25%), extraHardcore (+25%) stacking multiplicatively.
/// Always returns a non-zero value (never blocks jobs here).
⋮----
internal static float GetOrComputeNoToolPenalty(StatDef stat)
⋮----
if (Initialized && _noToolPenaltyCache.TryGetValue(key, out var cached))
⋮----
// Compute
float baseNormal = SurvivalTools.Settings?.noToolStatFactorNormal ?? 0.4f; // default fallback
// If stat is optional in normal mode, treat as 1
⋮----
// Normal mode penalties globally disabled
⋮----
// For WorkSpeedGlobal: if no gating jobs enabled, don't penalize
⋮----
var jobDef = DefDatabase<WorkGiverDef>.GetNamedSilentFail(kvp.Key);
if (jobDef != null && SurvivalToolUtility.ShouldGateByDefault(jobDef) && kvp.Value)
⋮----
// Start with normal base
⋮----
// Stack additional penalties additively on the remaining deficit so they feel multiplicative
// Penalty stacking formula:
// penalty = normal;
// if hardcore: penalty += 0.4f * (1f - penalty);
// if extraHardcore: penalty += 0.3f * (1f - penalty);
// This ensures each mode increases the penalty towards 1 by the specified share of the remaining gap.
⋮----
// Ensure never zero
⋮----
// -----------------------
// Internal helpers
⋮----
private static string MakeKey(ThingDef tool, ThingDef stuff)
⋮----
private static List<StatModifier> ComputeFactors(ThingDef toolDef, ThingDef stuff, SurvivalTool instance)
⋮----
// 1) From tool def mod extension
⋮----
result.Add(new StatModifier { stat = m.stat, value = m.value });
⋮----
// 2) From tool def statBases
⋮----
// 3) From stuff extension
⋮----
// StuffPropsTool multipliers are applied later when the instance exists.
⋮----
// We don't apply multipliers to virtual-only cached factors here; the
// SurvivalTool instance accessor may apply instance-specific multipliers
// when it wraps the cached base.
⋮----
// Dedupe by stat keeping the max value
⋮----
if (!dedup.TryGetValue(mm.stat, out var cur) || mm.value > cur)
⋮----
final.Add(new StatModifier { stat = kv.Key, value = kv.Value });
// If we have an instance and it has effectiveness multipliers, apply them
⋮----
// Base effectiveness value (can come from instance wear/HP or other mechanics)
float effectiveness = instance.GetStatValue(ST_StatDefOf.ToolEffectivenessFactor);
// Determine quality factor: if enabled in settings, read CompQuality on the backing thing
⋮----
QualityCategory qc = comp != null ? comp.Quality : QualityCategory.Normal;
qualityFactor = ToolQualityCurve.Evaluate((int)qc);
⋮----
catch { /* best-effort quality scaling */ }
⋮----
final[i] = new StatModifier { stat = final[i].stat, value = final[i].value * combinedMult };
⋮----
// Apply StuffPropsTool multipliers if applicable (material multipliers)
⋮----
float mult = sprops.toolStatFactors.GetStatFactorFromList(stat);
final[i] = new StatModifier { stat = stat, value = final[i].value * mult };
⋮----
private static string FormatFactors(List<StatModifier> list)
⋮----
if (sb.Length > 0) sb.Append(", ");
sb.Append(m.stat.defName).Append("=").Append(m.value.ToString("F2"));
⋮----
return sb.ToString();
⋮----
/// Returns true if the given WorkGiverDef is eligible for survival tool gating by default.
/// Uses keyword lists to filter jobs (never gate vs gate-eligible).
⋮----
public static bool ShouldGateByDefault(WorkGiverDef wgDef)
⋮----
var name = wgDef.defName.ToLower();
var label = !string.IsNullOrEmpty(wgDef.label) ? wgDef.label.ToLower() : "";
// Never gate keywords
⋮----
/*"repair", "buildroofs", "deconstruct", */ "deliver", "haul", "clean", "rescue", "tend", "handling", "feed", "cookfillhopper", "paint", "remove", "train", "childcarer"
⋮----
if (neverGateKeywords.Any(keyword => name.Contains(keyword) || label.Contains(keyword)))
⋮----
// Targeted debug log for deconstruct decisions
if (ST_Logging.IsDebugLoggingEnabled && (name.Contains("deconstruct") || label.Contains("deconstruct")))
⋮----
ST_Logging.LogDebug($"[SurvivalTools.ShouldGateByDefault] WorkGiver '{wgDef.defName}' labeled '{wgDef.label}' matched never-gate keywords -> NOT gate-eligible.", $"ShouldGate_Deconstruct_{wgDef.defName}");
⋮----
// Gate-eligible keywords
⋮----
if (gateKeywords.Any(keyword => name.Contains(keyword) || label.Contains(keyword)))
⋮----
ST_Logging.LogDebug($"[SurvivalTools.ShouldGateByDefault] WorkGiver '{wgDef.defName}' labeled '{wgDef.label}' matched gate keywords -> gate-eligible.", $"ShouldGate_Deconstruct_{wgDef.defName}");
⋮----
// Default: not gate-eligible
⋮----
// In SurvivalToolUtility.cs
public static Thing FindBestToolForStats(Pawn pawn, List<StatDef> stats)
⋮----
if (pawn == null || stats.NullOrEmpty())
⋮----
Thing bestTool = null;
⋮----
IEnumerable<Thing> candidates = pawn.GetAllUsableSurvivalTools();
⋮----
/// Return the physical backing <see cref="Thing"/> for a <see cref="SurvivalTool"/> (real or virtual).
/// For virtuals, prefers SourceThing if available, then pawn inventory, then closest reachable on pawn.Map, then any spawned.
⋮----
public static Thing BackingThing(SurvivalTool tool, Pawn pawn = null)
⋮----
// Real tool: it's already a Thing (exclude virtual wrappers here)
⋮----
// Virtual wrapper (tool-stuff)
⋮----
// 0) Direct SourceThing if available
⋮----
// 1) Pawn inventory (try exact match first, then by def)
⋮----
var exact = pawn.inventory.innerContainer.FirstOrDefault(t => ReferenceEquals(t, vtool.SourceThing));
⋮----
catch { /* safe fail */ }
var invThing = pawn.inventory.innerContainer.FirstOrDefault(t => t.def == vtool.SourceDef);
⋮----
// 2) Closest reachable on pawn's map
⋮----
!t.IsForbidden(pawn) &&
pawn.CanReserveAndReach(t, PathEndMode.OnCell, pawn.NormalMaxDanger());
var found = GenClosest.ClosestThingReachable(
⋮----
ThingRequest.ForDef(vtool.SourceDef),
⋮----
TraverseParms.For(pawn, Danger.Deadly, TraverseMode.ByPawn, false),
⋮----
// 3) Any spawned instance (fallback)
⋮----
var any = map.listerThings.ThingsOfDef(vtool.SourceDef).FirstOrDefault(t => t.Spawned);
⋮----
if (IsDebugLoggingEnabled && ShouldLogWithCooldown($"BackingThing_None_{vtool.GetHashCode()}"))
LogDebug($"[BackingThing] No backing Thing found for {vtool.LabelNoCount}", $"BackingThing_None_{vtool.GetHashCode()}");
⋮----
// Unknown subclass
⋮----
public static bool HasBackingThing(SurvivalTool tool, Pawn pawn = null) => BackingThing(tool, pawn) != null;
public static bool IsToolStuff(this ThingDef def) =>
⋮----
DefDatabase<StatDef>.AllDefsListForReading.Where(s => s.RequiresSurvivalTool()).ToList();
⋮----
DefDatabase<WorkGiverDef>.AllDefsListForReading.Where(w => w.HasModExtension<WorkGiverExtension>()).ToList();
⋮----
public static List<StatDef> RelevantStatsFor(WorkGiverDef wg, Job job)
⋮----
// Prefer job-level detection first (some mods inject workgivers that reuse a different
// WorkGiverDef for a job — we must honor the JobDef's semantics). If job-based
// detection yields stats, return them. Otherwise fall back to WorkGiver mod-extensions
// or heuristics.
// 1) Job-level detection
// Handle explicit common null-workgiver jobs first (defensive)
⋮----
// 2) WorkGiver mod extension
⋮----
if (fromWg != null && fromWg.Any())
return fromWg.Where(s => s != null).Distinct().ToList();
// Pattern matching for job def name (fallback)
⋮----
if (defName.Contains("clean") || defName.Contains("sweep") || defName.Contains("mop"))
stats.Add(ST_StatDefOf.CleaningSpeed);
if (defName.Contains("butcher") || defName.Contains("slaughter"))
stats.Add(ST_StatDefOf.ButcheryFleshSpeed);
if (defName.Contains("medical") || defName.Contains("surgery") || defName.Contains("operate"))
stats.Add(ST_StatDefOf.MedicalOperationSpeed);
if (defName.Contains("harvest") && defName.Contains("plant"))
stats.Add(ST_StatDefOf.PlantHarvestingSpeed);
if (defName.Contains("fell") && defName.Contains("tree"))
stats.Add(ST_StatDefOf.TreeFellingSpeed);
// Additional context-based detection for injected jobs:
// If job target is filth, cleaning is required
⋮----
// If job target is a corpse or butcherable, butchery is required
⋮----
// If job target is a medical bed or pawn needing tending, medical is required
⋮----
// Only return distinct, non-null stats
stats = stats.Where(s => s != null).Distinct().ToList();
⋮----
// Fallback to StatsForJob for other cases
⋮----
public static List<StatDef> RelevantStatsFor(WorkGiverDef wg, JobDef jobDef)
⋮----
// Prefer job-def specific mapping first (covers cases where a workgiver is re-used
// for an injected job). Only fall back to WorkGiverDef mod-extensions if the
// job-def mapping yields no stats.
⋮----
// Explicit mapping for cleaning job when workGiver may be null
⋮----
// Quick pattern: crafting/bill-like jobs -> WorkSpeedGlobal
⋮----
if (jobNameLower.Contains("dobill") || jobNameLower.Contains("do_bill") || jobNameLower.Contains("bill") || jobNameLower.Contains("craft") || jobNameLower.Contains("fabricate") || jobNameLower.Contains("produce") || jobNameLower.Contains("manufacture") || jobNameLower.Contains("smith") || jobNameLower.Contains("tailor") || jobNameLower.Contains("sculpt"))
⋮----
if (!loggedJobDefStatKeys.Contains(key))
⋮----
loggedJobDefStatKeys.Add(key);
⋮----
// Use class-level loggedJobDefStatKeys
⋮----
LogDebug($"[SurvivalTools] Using job fallback stats for WGD='{wg?.defName ?? "null"}' Job='{jobDef?.defName ?? "null"}': {string.Join(", ", fallback.Select(s => s.defName))}", key);
⋮----
public static List<StatDef> StatsForJob(Job job) => StatsForJob(job?.def);
private static bool IsToolRelevantJob(JobDef jobDef)
⋮----
var s = jobDef.defName.ToLowerInvariant();
return s.Contains("construct") || s.Contains("build") || s.Contains("frame") ||
s.Contains("smooth") || s.Contains("install") || s.Contains("roof") ||
s.Contains("repair") || s.Contains("uninstall") || s.Contains("deconstruct") ||
s.Contains("fell") || s.Contains("tree") || s.Contains("harvest") ||
s.Contains("sow") || s.Contains("plant") || s.Contains("grow") ||
s.Contains("research") || s.Contains("study") ||
s.Contains("clean") || s.Contains("sweep") || s.Contains("mop") ||
s.Contains("medical") || s.Contains("surgery") || s.Contains("operate") ||
s.Contains("butcher") || s.Contains("slaughter");
⋮----
public static List<StatDef> StatsForJob(JobDef jobDef) => StatsForJob(jobDef, null);
public static List<StatDef> StatsForJob(JobDef jobDef, Pawn pawn)
⋮----
// Quiet debug/info logs unless author attention is needed
⋮----
list.Add(ST_StatDefOf.DiggingSpeed);
⋮----
// Explicit mapping for vanilla Research job (precedes generic substring heuristic)
⋮----
list.Add(ST_StatDefOf.ResearchSpeed);
⋮----
list.Add(ST_StatDefOf.TreeFellingSpeed);
⋮----
list.Add(ST_StatDefOf.CleaningSpeed);
⋮----
// Crafting / bills / production tasks -> WorkSpeedGlobal
// Many mods and vanilla use 'DoBill' or 'bill' in job names for production; catch those.
if (s.Contains("dobill") || s.Contains("do_bill") || s.Contains("bill") || s.Contains("craft") || s.Contains("fabricate") || s.Contains("produce") || s.Contains("manufacture") || s.Contains("smith") || s.Contains("tailor") || s.Contains("art") || s.Contains("sculpt"))
⋮----
list.Add(ST_StatDefOf.WorkSpeedGlobal);
⋮----
// Cooking / food production -> WorkSpeedGlobal (catch cook/cookfillhopper)
if (s.Contains("cook") || s.Contains("cookfillhopper") || s.Contains("preparefood") || s.Contains("food"))
⋮----
list.Add(ST_StatDefOf.PlantHarvestingSpeed);
⋮----
if (s.Contains("felltree"))
⋮----
return list; // exclude false positive
if (s.Contains("construct") || s.Contains("build") || s.Contains("frame") ||
s.Contains("smooth") || s.Contains("install") || s.Contains("buildroof") ||
s.Contains("removeroof"))
⋮----
list.Add(StatDefOf.ConstructionSpeed);
⋮----
if (s.Contains("repair") || s.Contains("maintain") || s.Contains("maintenance") ||
s.Contains("fixbroken") || s.Contains("tendmachine") || s.Contains("fix"))
⋮----
list.Add(ST_StatDefOf.MaintenanceSpeed);
⋮----
if (s.Contains("uninstall") || s.Contains("deconstruct") || s.Contains("teardown"))
⋮----
list.Add(ST_StatDefOf.DeconstructionSpeed);
⋮----
// Salvage / dismantle synonyms -> DeconstructionSpeed
if (s.Contains("salvage") || s.Contains("dismantle") || s.Contains("scrap"))
⋮----
if (s.Contains("sow") || s.Contains("plantsow") || s.Contains("plantgrow"))
⋮----
list.Add(ST_StatDefOf.SowingSpeed);
⋮----
if (s.Contains("plant") || s.Contains("harvest") || s.Contains("cut"))
⋮----
if (s.Contains("research") || s.Contains("experiment") || s.Contains("study"))
⋮----
if (s.Contains("clean") || s.Contains("sweep") || s.Contains("mop"))
⋮----
if (s.Contains("medical") || s.Contains("surgery") || s.Contains("operate") || s.Contains("tend") ||
s.Contains("doctor") || (s.Contains("install") && s.Contains("bionic")))
⋮----
list.Add(ST_StatDefOf.MedicalOperationSpeed);
list.Add(ST_StatDefOf.MedicalSurgerySuccessChance);
⋮----
if (s.Contains("butcher") || s.Contains("slaughter") || s.Contains("skin") || s.Contains("carve"))
⋮----
list.Add(ST_StatDefOf.ButcheryFleshSpeed);
list.Add(ST_StatDefOf.ButcheryFleshEfficiency);
⋮----
// If this jobDef appears tool-relevant but we didn't match any known patterns,
// log once per jobDef to help mod authors diagnose unmapped jobs.
⋮----
if (!loggedJobStatKeys.Contains(key))
⋮----
loggedJobStatKeys.Add(key);
⋮----
public static bool RequiresSurvivalTool(this StatDef stat)
⋮----
if (stat?.parts.SafeAny() != true) return false;
⋮----
public static bool IsSurvivalTool(this BuildableDef def, out SurvivalToolProperties toolProps)
⋮----
return def.IsSurvivalTool();
⋮----
public static bool IsSurvivalTool(this BuildableDef def)
⋮----
// Actual SurvivalTool class?
if (typeof(SurvivalTool).IsAssignableFrom(tDef.thingClass))
⋮----
// Or "enhanced" item with our extension & factors
⋮----
// Also consider defs that provide relevant stats via statBases (eg WorkSpeedGlobal)
⋮----
return ext != null && ext != SurvivalToolProperties.defaultValues && (ext.baseWorkStatFactors.SafeAny() || hasStatBases);
⋮----
public static bool CanUseSurvivalTools(this Pawn pawn) =>
⋮----
public static bool IsUnderSurvivalToolCarryLimitFor(this int count, Pawn pawn) =>
!SurvivalTools.Settings.toolLimit || count < pawn.GetStatValue(ST_StatDefOf.SurvivalToolCarryCapacity);
public static IEnumerable<Thing> GetHeldSurvivalTools(this Pawn pawn)
⋮----
// Real tools
var normalTools = pawn.inventory.innerContainer.Where(t => t.def.IsSurvivalTool());
// Tool-stuffs => wrap into virtual tool objects (still Things)
⋮----
.Where(t => t.def.IsToolStuff())
.Select(t => (Thing)VirtualTool.FromThing(t))
.Where(vt => vt != null);
return normalTools.Concat(virtualTools);
⋮----
public static int HeldSurvivalToolCount(this Pawn pawn) =>
pawn.inventory?.innerContainer?.Count(t => t.def.IsSurvivalTool()) ?? 0;
public static bool CanCarryAnyMoreSurvivalTools(this Pawn pawn, int heldToolOffset = 0) =>
(pawn.RaceProps.Humanlike && (pawn.HeldSurvivalToolCount() + heldToolOffset).IsUnderSurvivalToolCarryLimitFor(pawn))
|| pawn.IsFormingCaravan() || pawn.IsCaravanMember();
public static IEnumerable<Thing> GetUsableHeldSurvivalTools(this Pawn pawn)
⋮----
// Historical behavior: we truncated the list to the pawn's carry limit so that
// excess tools (beyond limit) were ignored by optimizers and drawing logic.
// This caused a correctness bug: if the only matching/expected tool (e.g. an axe
// for TreeFellingSpeed) happened to be positioned beyond the truncated index range
// (e.g. third tool while carry limit stat allowed only two), best-tool selection
// and renderer passed over it, yielding null despite the pawn physically holding
// a valid improving tool. We now return the full set of held tools for selection
// purposes. Other systems that decide to drop excess tools still use the carry
// limit stat explicitly; they are unaffected by this change.
return pawn.GetHeldSurvivalTools();
⋮----
public static IEnumerable<Thing> GetAllUsableSurvivalTools(this Pawn pawn)
⋮----
var eqTools = pawn.equipment?.GetDirectlyHeldThings().Where(t => t.def.IsSurvivalTool()) ?? Enumerable.Empty<Thing>();
// Inventory tools (include all; no carry-limit truncation here).
// Wrap tool-stuff into virtual tools so downstream code can treat them uniformly.
⋮----
invRaw = pawn.inventory.innerContainer.InnerListForReading; // use underlying list for perf
⋮----
.Where(t => t != null && t.def != null && (t.def.IsSurvivalTool() || t.def.IsToolStuff()))
.Select(t => t.def.IsToolStuff() ? (Thing)VirtualTool.FromThing(t) : t)
.Where(t => t != null);
return eqTools.Concat(invTools);
⋮----
public static bool CanUseSurvivalTool(this Pawn pawn, ThingDef def)
⋮----
// Consider statBases as a valid source of tool stats (e.g., global work speed)
⋮----
// Check explicit baseWorkStatFactors
⋮----
// Fallback: check statBases on the def itself
⋮----
public static IEnumerable<SurvivalTool> BestSurvivalToolsFor(Pawn pawn) =>
SurvivalToolStats.Select(stat => pawn.GetBestSurvivalTool(stat)).Where(t => t != null);
⋮----
/// True if this tool is actively "used" by its holder for the current job's required stats.
/// Handles both real tools and virtual wrappers (tool-stuff).
⋮----
public static bool IsToolInUse(SurvivalTool tool)
⋮----
if (holder == null || !holder.CanUseSurvivalTools() || !holder.CanUseSurvivalTool(tool.def)) return false;
⋮----
if (req.NullOrEmpty()) return false;
var toolStats = tool.WorkStatFactors.Select(m => m.stat).ToList();
var relevant = req.Where(s => toolStats.Contains(s)).ToList();
if (relevant.NullOrEmpty()) return false;
// Compare the canonical backing Thing for equality so virtual wrappers match their
// underlying physical item. This avoids false negatives where VirtualTool
// instances are ephemeral and differ by reference.
Thing toolBacking = BackingThing(tool, holder);
⋮----
var best = holder.GetBestSurvivalTool(s);
⋮----
Thing bestBacking = BackingThing(best, holder);
⋮----
// Fallback: compare by reference to handle real SurvivalTool instances
⋮----
/// Compute final work stat factors for a real SurvivalTool (def + stuff + effectiveness).
⋮----
public static IEnumerable<StatModifier> CalculateWorkStatFactors(SurvivalTool tool)
⋮----
var tProps = SurvivalToolProperties.For(tool.def);
var sProps = StuffPropsTool.For(tool.Stuff);
float effectiveness = tool.GetStatValue(ST_StatDefOf.ToolEffectivenessFactor);
// Apply quality-based multiplier if enabled in settings. We read CompQuality from the physical tool.
⋮----
float qualityFactor = ToolQualityCurve.Evaluate((int)qc);
⋮----
yield return new StatModifier { stat = baseModifier.stat, value = finalFactor };
⋮----
// (kept for possible legacy callers; not used by the function above)
private static float CalculateFinalStatFactor(StatModifier baseModifier, float effectiveness, StuffPropsTool stuffProps)
⋮----
var m = stuffProps.toolStatFactors.FirstOrDefault(x => x?.stat == baseModifier.stat);
⋮----
private static float CalculateFinalStatFactor(StatModifier baseModifier, float effectiveness, StuffPropsTool stuffProps, SurvivalToolProperties toolProps, ThingDef stuff)
⋮----
// Stuff factors
⋮----
// Stuff power multiplier (if defined)
⋮----
var mult = toolProps.stuffPowerMultiplier.FirstOrDefault(x => x?.stat == baseModifier.stat);
⋮----
// Use an existing "power" stat as a proxy to scale
float stuffPower = stuff.GetStatValueAbstract(StatDefOf.StuffPower_Armor_Sharp);
⋮----
public static bool HasSurvivalTool(this Pawn pawn, ThingDef tool) =>
pawn.GetHeldSurvivalTools().Any(t => t.def == tool);
public static SurvivalTool GetBestSurvivalTool(this Pawn pawn, List<StatDef> stats)
⋮----
if (!pawn.CanUseSurvivalTools() || stats.NullOrEmpty()) return null;
var expectedKind = ToolUtility.ToolKindForStats(stats);
SurvivalTool best = null;
⋮----
// Wrap tool-stuff or virtualizable items
if (thing.def != null && thing.def.IsToolStuff())
cand = VirtualTool.FromThing(thing);
⋮----
cand = ToolUtility.TryWrapVirtual(thing);
⋮----
if (expectedKind != STToolKind.None && ToolUtility.ToolKindOf(thing) != expectedKind) continue;
⋮----
// Fallback: if expected kind filtering eliminated all candidates (best==null),
// re-run without expectedKind restriction so we still display/recognize an
// improving tool of a different kind (e.g. hammer improving ConstructionSpeed
// when axe is beyond prior carry-limit ordering).
⋮----
LogDebug($"[SurvivalTools.Debug] Fallback (multi-stat) re-scan without expectedKind for {pawn.LabelShort} (expected {expectedKind}) stats=[{string.Join(",", stats.Select(s => s.defName))}]", $"Fallback_Multi_{pawn?.ThingID}_{expectedKind}");
⋮----
public static float GetStatFactorFromList(this SurvivalTool tool, StatDef stat) =>
tool.WorkStatFactors.GetStatFactorFromList(stat);
⋮----
public static bool HasSurvivalToolFor(this Pawn pawn, StatDef stat)
⋮----
if (pawn == null || stat == null || !stat.RequiresSurvivalTool()) return false;
// Scan usable tools (inventory + worn + eq) once, check factor improvement.
var tools = pawn.GetAllUsableSurvivalTools();
⋮----
SurvivalTool st = thing as SurvivalTool;
if (st == null && thing.def != null && thing.def.IsToolStuff()) st = VirtualTool.FromThing(thing);
⋮----
/// Attempt to find a useful tool on the map/storage and enqueue a TakeInventory pickup job for the pawn.
/// Returns true if a pickup job was enqueued.
⋮----
public static bool TryEnqueuePickupForMissingTool(Pawn pawn, List<StatDef> requiredStats)
⋮----
if (!pawn.CanUseSurvivalTools()) return false;
// If pawn already has a helpful tool, nothing to do
if (pawn.GetAllUsableSurvivalTools().OfType<SurvivalTool>().Any(st => ToolImprovesAny(st, requiredStats)))
⋮----
SurvivalTool bestTool = null;
⋮----
// 1) Radial scan around pawn (fast, preferred)
⋮----
foreach (var thing in GenRadial.RadialDistinctThingsAround(pawn.Position, map, SearchRadius, true))
⋮----
SurvivalTool candidate = null;
⋮----
else if (thing.def != null && thing.def.IsToolStuff()) candidate = VirtualTool.FromThing(thing);
⋮----
if (seen.Contains(backing.thingIDNumber)) continue;
seen.Add(backing.thingIDNumber);
⋮----
if (backing.IsForbidden(pawn)) continue;
if (!pawn.CanReserveAndReach(backing, PathEndMode.OnCell, pawn.NormalMaxDanger())) continue;
⋮----
score -= 0.01f * backing.Position.DistanceTo(pawn.Position);
⋮----
// 2) Storage / haulable scans: storage-first, nearby, then wider fallback
var candidates = map.listerThings.ThingsInGroup(ThingRequestGroup.HaulableEver);
⋮----
// Storage items within StorageSearchRadius
⋮----
if (!item.IsInAnyStorage()) continue;
⋮----
if (item.Position.DistanceTo(pawn.Position) > StorageSearchRadius) continue;
⋮----
else if (item.def != null && item.def.IsToolStuff()) candidate = VirtualTool.FromThing(item);
⋮----
// Nearby haulable (within StorageSearchRadius)
⋮----
if (item.IsInAnyStorage()) continue;
⋮----
// Wider-area fallback
⋮----
if (item.Position.DistanceTo(pawn.Position) > FallbackSearchRadius) continue;
⋮----
var pickupJob = JobMaker.MakeJob(JobDefOf.TakeInventory, backingThing);
⋮----
pawn.jobs.jobQueue.EnqueueFirst(pickupJob);
⋮----
public static bool HasSurvivalToolFor(this Pawn pawn, StatDef stat, out SurvivalTool tool, out float statFactor)
⋮----
var tools = pawn.GetAllUsableSurvivalTools(); if (tools == null) return false;
SurvivalTool best = null; float bestFactor = baseline;
⋮----
public static SurvivalTool GetBestSurvivalTool(this Pawn pawn, StatDef stat)
⋮----
if (!pawn.CanUseSurvivalTools() || stat == null || !stat.RequiresSurvivalTool()) return null;
⋮----
// Unified baseline & scoring path using existing helpers so behavior matches multi-stat overload
⋮----
var expectedKind = ToolUtility.ToolKindForStats(new[] { stat });
SurvivalTool best = null; float bestDelta = 0f; // store delta above baseline not absolute factor
⋮----
SurvivalTool candidate = thing as SurvivalTool;
⋮----
// Wrap tool-stuff or other virtualizable items
⋮----
candidate = VirtualTool.FromThing(thing);
⋮----
candidate = ToolUtility.TryWrapVirtual(thing);
⋮----
// Fallback pass without expectedKind filtering if nothing selected.
⋮----
try { LessonAutoActivator.TeachOpportunity(ST_ConceptDefOf.UsingSurvivalTools, OpportunityType.Important); } catch { }
⋮----
public static string GetSurvivalToolOverrideReportText(SurvivalTool tool, StatDef stat)
⋮----
var b = new StringBuilder();
b.AppendLine(stat.description);
b.AppendLine();
b.AppendLine($"{tool.def.LabelCap}: {tool.def.GetModExtension<SurvivalToolProperties>().baseWorkStatFactors.GetStatFactorFromList(stat).ToStringByStyle(ToStringStyle.Integer, ToStringNumberSense.Factor)}");
⋮----
b.AppendLine($"{ST_StatDefOf.ToolEffectivenessFactor.LabelCap}: {tool.GetStatValue(ST_StatDefOf.ToolEffectivenessFactor).ToStringByStyle(ToStringStyle.Integer, ToStringNumberSense.Factor)}");
if (stuffPropsTool != null && stuffPropsTool.toolStatFactors.GetStatFactorFromList(stat) != 1f)
⋮----
b.AppendLine($"{"StatsReport_Material".Translate()} ({tool.Stuff.LabelCap}): {stuffPropsTool.toolStatFactors.GetStatFactorFromList(stat).ToStringByStyle(ToStringStyle.Integer, ToStringNumberSense.Factor)}");
⋮----
b.AppendLine($"{"StatsReport_FinalValue".Translate()}: {statFactorList.ToList().GetStatFactorFromList(stat).ToStringByStyle(ToStringStyle.Integer, ToStringNumberSense.Factor)}");
return b.ToString();
⋮----
public static void TryDegradeTool(Pawn pawn, StatDef stat)
⋮----
var tool = pawn.GetBestSurvivalTool(stat);
float toolFactor = tool != null ? tool.WorkStatFactors.ToList().GetStatFactorFromList(stat) : -1f;
⋮----
LessonAutoActivator.TeachOpportunity(ST_ConceptDefOf.SurvivalToolDegradation, OpportunityType.GoodToKnow);
⋮----
realTool.TakeDamage(new DamageInfo(DamageDefOf.Deterioration, 1));
⋮----
if (!_virtualToolDegradeCounters.TryGetValue(key, out var counter)) counter = 0;
⋮----
float lifespanDays = tool.GetStatValue(ST_StatDefOf.ToolEstimatedLifespan);
int hp = Math.Max(1, twc.MaxHitPoints);
int threshold = Math.Max(1, (int)Math.Floor((lifespanDays * GenDate.TicksPerDay) / hp));
⋮----
twc.TakeDamage(new DamageInfo(DamageDefOf.Deterioration, 1));
⋮----
int threshold = Math.Max(1, (int)Math.Floor(100f / Math.Max(0.001f, factor)));
⋮----
var one = backing.SplitOff(1);
one.Destroy(DestroyMode.Vanish);
⋮----
public static bool MeetsWorkGiverStatRequirements(this Pawn pawn, List<StatDef> requiredStats) =>
pawn.MeetsWorkGiverStatRequirements(requiredStats, null, null);
public static bool MeetsWorkGiverStatRequirements(this Pawn pawn, List<StatDef> requiredStats, WorkGiverDef workGiver = null, JobDef jobDef = null)
⋮----
if (requiredStats.NullOrEmpty()) return true;
⋮----
var toolStats = requiredStats.Where(st => st != null && st.RequiresSurvivalTool()).ToList();
if (toolStats.NullOrEmpty()) return true;
⋮----
// Unified gating check (uses StatGatingHelper)
if (StatGatingHelper.ShouldBlockJobForStat(stat, s, pawn))
⋮----
// Normal mode fallback — still reject if stat value is zero or less
⋮----
float v = pawn.GetStatValue(stat);
⋮----
public static bool CanFellTrees(this Pawn pawn)
⋮----
return pawn.MeetsWorkGiverStatRequirements(req);
⋮----
public static IEnumerable<WorkGiver> AssignedToolRelevantWorkGivers(this Pawn pawn)
⋮----
Log.ErrorOnce($"Tried to get tool-relevant work givers for {pawn} but has null workSettings", 11227);
⋮----
if (ext?.requiredStats?.Any(s => s.RequiresSurvivalTool()) == true)
⋮----
public static List<StatDef> AssignedToolRelevantWorkGiversStatDefs(this Pawn pawn)
⋮----
var all = pawn.AssignedToolRelevantWorkGivers()
.SelectMany(g => g.def.GetModExtension<WorkGiverExtension>().requiredStats)
.Where(s => s != null)
.Distinct()
.ToList();
// Consider WorkSpeedGlobal: if pawn has any assigned WorkGiver that maps to WorkSpeedGlobal
// and the per-job gating setting is enabled, include WorkSpeedGlobal in the relevant stats.
⋮----
foreach (var wg in WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs())
⋮----
// Check pawn has this workgiver (in normal order list) and gating enabled for that job
bool pawnHasWg = pawn.workSettings.WorkGiversInOrderNormal.Any(wgInst => wgInst?.def == wg);
if (pawnHasWg && settings.workSpeedGlobalJobGating.GetValueOrDefault(wg.defName, true))
⋮----
if (!all.Contains(ST_StatDefOf.WorkSpeedGlobal))
all.Add(ST_StatDefOf.WorkSpeedGlobal);
⋮----
catch { /* best-effort: do not break callers on error */ }
// Only those we can actually satisfy with tools available in this game
⋮----
/// For alerts: include research/cleaning/butchery/etc., but still ensure tools exist in this run.
⋮----
public static List<StatDef> AssignedToolRelevantWorkGiversStatDefsForAlerts(this Pawn pawn)
⋮----
return all.Where(ToolsExistForStat).ToList();
⋮----
public static bool NeedsSurvivalTool(this Pawn pawn, SurvivalTool tool)
⋮----
var relevant = pawn.AssignedToolRelevantWorkGiversStatDefs();
return tool.WorkStatFactors.Any(f => relevant.Contains(f.stat));
⋮----
public static bool BetterThanWorkingToollessFor(this SurvivalTool tool, StatDef stat)
⋮----
Log.ErrorOnce($"Tried to check if {tool} is better than working toolless for {stat} which has no StatPart_SurvivalTool", 8120196);
⋮----
float toolFactor = tool.WorkStatFactors.ToList().GetStatFactorFromList(stat);
float noToolPenalty = ToolFactorCache.GetOrComputeNoToolPenalty(stat);
⋮----
/// Get the factor from a modifier list or 1.0 if absent (neutral).
⋮----
public static float GetStatFactorFromList(this IEnumerable<StatModifier> modifiers, StatDef stat)
⋮----
var m = modifiers.FirstOrDefault(x => x.stat == stat);
⋮----
public static Job DequipAndTryStoreSurvivalTool(this Pawn pawn, Thing tool, bool enqueueCurrent = true)
⋮----
pawn.jobs.jobQueue.EnqueueFirst(pawn.CurJob);
// If we got a virtual wrapper, target the real thing for vanilla hauling/storage.
Thing realThing = tool;
⋮----
if (StoreUtility.TryFindBestBetterStoreCellFor(realThing, pawn, pawn.MapHeld, StoreUtility.CurrentStoragePriorityOf(realThing), pawn.Faction, out IntVec3 c))
⋮----
var haulJob = new Job(JobDefOf.HaulToCell, realThing, c) { count = 1 };
// Invalidate cache for the moved tool so any precomputed factors that depend on
// ownership/location/stuff are refreshed when needed.
try { ToolFactorCache.InvalidateForThing(realThing); } catch { }
pawn.jobs.jobQueue.EnqueueFirst(haulJob);
⋮----
// Drop job targets the physical thing.
return new Job(ST_JobDefOf.DropSurvivalTool, realThing);
⋮----
public static bool CanRemoveExcessSurvivalTools(this Pawn pawn) =>
!pawn.Drafted && !pawn.IsWashing() && !pawn.IsFormingCaravan() && !pawn.IsCaravanMember() &&
⋮----
!pawn.IsBurning() && !(pawn.carryTracker?.CarriedThing is SurvivalTool);
private static bool IsWashing(this Pawn pawn) =>
ModCompatibilityCheck.DubsBadHygiene && pawn.health.hediffSet.HasHediff(DefDatabase<HediffDef>.GetNamed("Washing"));
public static string GetStatCategoryDescription(StatDef stat)
⋮----
private static string GetJobContextDescription(WorkGiverDef workGiver, JobDef jobDef)
⋮----
/// True if at least one loaded thing provides the specified stat via SurvivalToolProperties.
⋮----
public static bool ToolsExistForStat(StatDef stat)
⋮----
// Check mod extension baseWorkStatFactors
⋮----
// Also check statBases on the def (for stats like WorkSpeedGlobal)
⋮----
/// Filters out stats that have no available tools in this run (prevents pointless alerts).
⋮----
public static List<StatDef> FilterStatsWithAvailableTools(IEnumerable<StatDef> stats) =>
stats?.Where(ToolsExistForStat).ToList() ?? new List<StatDef>();
</file>
<file path="Source/SurvivalToolsSettings.cs">
// Rimworld 1.6 / C# 7.3
// Source/SurvivalToolsSettings.cs
⋮----
namespace SurvivalTools
⋮----
public class SurvivalToolsSettings : ModSettings
⋮----
// UI Layout constants
⋮----
// Logging toggles (only effective in DEBUG builds)
⋮----
// Normal mode penalty settings
⋮----
// Enable quality-based tool scaling (multiplies tool factors by quality curve)
⋮----
// Tree felling system toggle
⋮----
// Individual optional tool requirements
⋮----
// ResearchReinvented compatibility
⋮----
// QoL: upgrade suggestion toggle
⋮----
// Visual feedback: denial/slow motes toggle
public bool showDenialMotes = true; // When true, spawn text motes for blocked/slow tool-gated jobs
// Job gating
⋮----
// Cached availability of optional tool types
⋮----
public void InitializeOptionalToolCache()
⋮----
_hasCleaningToolsCache = SurvivalToolUtility.ToolsExistForStat(ST_StatDefOf.CleaningSpeed);
_hasButcheryToolsCache = SurvivalToolUtility.ToolsExistForStat(ST_StatDefOf.ButcheryFleshSpeed) ||
SurvivalToolUtility.ToolsExistForStat(ST_StatDefOf.ButcheryFleshEfficiency);
_hasMedicalToolsCache = SurvivalToolUtility.ToolsExistForStat(ST_StatDefOf.MedicalOperationSpeed) ||
SurvivalToolUtility.ToolsExistForStat(ST_StatDefOf.MedicalSurgerySuccessChance);
⋮----
public void ResetOptionalToolCache()
⋮----
public bool IsStatRequiredInExtraHardcore(StatDef stat)
⋮----
if (RRHelpers.Settings.IsRRCompatibilityEnabled && RRHelpers.Settings.IsRRStatRequiredInExtraHardcore(stat))
⋮----
public override void ExposeData()
⋮----
Scribe_Values.Look(ref hardcoreMode, nameof(hardcoreMode), false);
Scribe_Values.Look(ref toolMapGen, nameof(toolMapGen), true);
Scribe_Values.Look(ref toolLimit, nameof(toolLimit), true);
Scribe_Values.Look(ref toolDegradationFactor, nameof(toolDegradationFactor), 1f);
Scribe_Values.Look(ref toolOptimization, nameof(toolOptimization), true);
Scribe_Values.Look(ref debugLogging, nameof(debugLogging), false);
Scribe_Values.Look(ref compatLogging, nameof(compatLogging), false);
Scribe_Values.Look(ref pickupFromStorageOnly, nameof(pickupFromStorageOnly), false);
Scribe_Values.Look(ref allowPacifistEquip, nameof(allowPacifistEquip), true);
Scribe_Values.Look(ref autoTool, nameof(autoTool), true);
Scribe_Values.Look(ref enableSurvivalToolTreeFelling, nameof(enableSurvivalToolTreeFelling), true);
Scribe_Values.Look(ref extraHardcoreMode, nameof(extraHardcoreMode), false);
Scribe_Values.Look(ref requireCleaningTools, nameof(requireCleaningTools), true);
Scribe_Values.Look(ref requireButcheryTools, nameof(requireButcheryTools), true);
Scribe_Values.Look(ref requireMedicalTools, nameof(requireMedicalTools), true);
Scribe_Values.Look(ref noToolStatFactorNormal, nameof(noToolStatFactorNormal), 0.4f);
Scribe_Values.Look(ref useQualityToolScaling, nameof(useQualityToolScaling), true);
Scribe_Values.Look(ref enableNormalModePenalties, nameof(enableNormalModePenalties), true);
Scribe_Values.Look(ref enableRRCompatibility, nameof(enableRRCompatibility), true);
Scribe_Values.Look(ref rrResearchRequiredInExtraHardcore, nameof(rrResearchRequiredInExtraHardcore), false);
Scribe_Values.Look(ref rrFieldResearchRequiredInExtraHardcore, nameof(rrFieldResearchRequiredInExtraHardcore), false);
Scribe_Values.Look(ref showUpgradeSuggestions, nameof(showUpgradeSuggestions), true);
Scribe_Values.Look(ref showDenialMotes, nameof(showDenialMotes), true);
Scribe_Collections.Look(ref workSpeedGlobalJobGating, nameof(workSpeedGlobalJobGating), LookMode.Value, LookMode.Value);
⋮----
base.ExposeData();
⋮----
private Vector2 mainScrollPosition; // Add scroll position for main window
public void DoSettingsWindowContents(Rect inRect)
⋮----
// Reserve space at the bottom for the pinned Enhanced Settings button so it's always visible
const float bottomReserved = 60f; // button height + padding
// Calculate content height for scrolling
⋮----
// Scroll area (exclude reserved bottom area)
var scrollRect = new Rect(inRect.x, inRect.y, inRect.width, Mathf.Max(0f, inRect.height - bottomReserved));
// Inner view rect: width accounts for vertical scrollbar, height is at least the visible scroll area
var viewRect = new Rect(0, 0, scrollRect.width - 20f, Mathf.Max(scrollRect.height, contentHeight));
Widgets.BeginScrollView(scrollRect, ref mainScrollPosition, viewRect);
var listing = new Listing_Standard();
listing.Begin(viewRect);
⋮----
listing.End();
Widgets.EndScrollView();
// Draw pinned Enhanced Settings button centered in the reserved bottom area
⋮----
var buttonArea = new Rect(inRect.x, inRect.yMax - bottomReserved, inRect.width, bottomReserved);
var buttonRect = new Rect(
⋮----
GUI.color = new Color(1f, 0.3f, 0.3f); // Red color
if (Widgets.ButtonText(buttonRect, "Settings_OpenEnhancedButton".Translate()))
⋮----
var existingWindow = Find.WindowStack.Windows.OfType<SurvivalToolsResizableSettingsWindow>().FirstOrDefault();
⋮----
Find.WindowStack.TryRemove(existingWindow);
⋮----
var window = new SurvivalToolsResizableSettingsWindow(this);
Find.WindowStack.Add(window);
⋮----
/// <summary>
/// Calculate the total height needed for the main settings window content
/// </summary>
private float CalculateMainWindowContentHeight()
⋮----
float height = 50f; // Base spacing
// Basic Settings Section
height += 35f; // Section header
height += 25f * 7; // Checkboxes (hardcore mode, tools in ruins, tool limit, etc.)
// Normal Mode Work Speed Settings
⋮----
height += 80f; // Description text area
height += 25f; // Enable penalties checkbox
height += 40f; // Penalty slider
height += 25f; // Tool degradation slider
// Enhanced Settings Button
height += 40f; // Button height + spacing
// Debug Settings
⋮----
height += 50f; // Debug content area
// Add some extra padding for safety
⋮----
/// Draw all the settings content in the scrollable area
⋮----
public void DrawSettingsContent(Listing_Standard listing)
⋮----
// Basic Settings Section Header
⋮----
listing.Label("Settings_BasicSection".Translate());
⋮----
listing.Gap();
// Hardcore Mode section
GUI.color = new Color(1f, 0.2f, 0.2f);
⋮----
listing.CheckboxLabeled("Settings_HardcoreMode".Translate(), ref hardcoreMode, "Settings_HardcoreMode_Tooltip".Translate());
// Auto-disable Extra Hardcore Mode when Hardcore Mode is disabled
⋮----
// Validate existing jobs when hardcore mode is enabled or changed
⋮----
SurvivalToolValidation.ValidateExistingJobs("Hardcore mode enabled");
⋮----
// General settings
listing.CheckboxLabeled("Settings_ToolMapGen".Translate(), ref toolMapGen, "Settings_ToolMapGen_Tooltip".Translate());
listing.CheckboxLabeled("Settings_ToolLimit".Translate(), ref toolLimit, "Settings_ToolLimit_Tooltip".Translate());
listing.CheckboxLabeled("Settings_AutoTool".Translate(), ref autoTool, "Settings_AutoTool_Tooltip".Translate());
listing.CheckboxLabeled("Settings_ToolOptimization".Translate(), ref toolOptimization, "Settings_ToolOptimization_Tooltip".Translate());
listing.CheckboxLabeled("Settings_EnableTreeFelling".Translate(), ref enableSurvivalToolTreeFelling, "Settings_EnableTreeFelling_Tooltip".Translate());
listing.CheckboxLabeled("Settings_PickupFromStorageOnly".Translate(), ref pickupFromStorageOnly, "Settings_PickupFromStorageOnly_Tooltip".Translate());
listing.CheckboxLabeled("Settings_AllowPacifistEquip".Translate(), ref allowPacifistEquip, "Settings_AllowPacifistEquip_Tooltip".Translate());
listing.CheckboxLabeled("Settings_ShowUpgradeSuggestions".Translate(), ref showUpgradeSuggestions, "Settings_ShowUpgradeSuggestions_Tooltip".Translate());
listing.CheckboxLabeled("Settings_ShowDenialMotes".Translate(), ref showDenialMotes, "Settings_ShowDenialMotes_Tooltip".Translate());
⋮----
// Normal Mode Penalty Settings
listing.GapLine();
⋮----
listing.Label("Settings_NormalModeSection".Translate());
⋮----
// Explanation section
GUI.color = new Color(0.8f, 0.9f, 1f); // Light blue background
⋮----
var explanationRect = listing.GetRect(60f);
Widgets.DrawBoxSolid(explanationRect, new Color(0.1f, 0.1f, 0.2f, 0.3f));
var textRect = explanationRect.ContractedBy(6f);
Widgets.Label(textRect, "Settings_NormalMode_Explanation".Translate());
⋮----
listing.Gap(4f);
// Enable/disable penalties entirely
listing.CheckboxLabeled("Settings_EnableNormalModePenalties".Translate(), ref enableNormalModePenalties,
"Settings_EnableNormalModePenalties_Tooltip".Translate());
// Penalty severity slider (only show when penalties are enabled)
⋮----
var penaltyLabel = "Settings_NormalModeToolPenalty".Translate();
⋮----
listing.Label($"{penaltyLabel}: {penaltyPercent:F0}% slower without tools");
noToolStatFactorNormal = 1f - (listing.Slider(1f - noToolStatFactorNormal, 0f, 0.8f));
noToolStatFactorNormal = Mathf.Clamp(Mathf.Round(noToolStatFactorNormal * 100f) / 100f, 0.2f, 1f);
// Helper text
⋮----
listing.Label("Settings_NormalModePenalties_HelperText".Translate());
⋮----
// Show what this means when disabled
⋮----
listing.Label("Settings_NormalModePenalties_Disabled".Translate());
⋮----
// Quality-based tool scaling toggle
listing.CheckboxLabeled("Settings_QualityToolScaling".Translate(), ref useQualityToolScaling, "Settings_QualityToolScaling_Tooltip".Translate());
// Degradation slider
var degrLabel = "Settings_ToolDegradationRate".Translate();
listing.Label(degrLabel + ": " + toolDegradationFactor.ToStringByStyle(ToStringStyle.FloatTwo, ToStringNumberSense.Factor));
toolDegradationFactor = listing.Slider(toolDegradationFactor, 0f, 2f);
toolDegradationFactor = Mathf.Clamp(Mathf.Round(toolDegradationFactor * 100f) / 100f, 0f, 2f);
⋮----
// Debug logging section (Dev mode only)
⋮----
listing.Label("Settings_DebugSection".Translate());
⋮----
listing.CheckboxLabeled("Settings_DebugLogging".Translate(), ref debugLogging, "Settings_DebugLogging_Tooltip".Translate());
⋮----
// Show compatibility logging option only when debug logging is enabled
⋮----
listing.CheckboxLabeled("Settings_CompatLogging".Translate(), ref compatLogging, "Settings_CompatLogging_Tooltip".Translate());
⋮----
listing.Gap(6f);
// Restore original styling (button is pinned below the scroll area)
⋮----
/// Draw button to open WorkSpeedGlobal job configuration window
⋮----
public void DrawWorkSpeedGlobalConfigButton(Listing_Standard listing)
⋮----
// Create button rect
⋮----
(listing.ColumnWidth - buttonWidth) / 2f, // Center horizontally
⋮----
// Draw blue WorkSpeedGlobal config button
GUI.color = new Color(0.3f, 0.5f, 1f); // Blue color
if (Widgets.ButtonText(buttonRect, "WorkSpeedGlobal_OpenConfigButton".Translate()))
⋮----
// Close any existing WorkSpeedGlobal window first
var existingWindow = Find.WindowStack.Windows.OfType<WorkSpeedGlobalConfigWindow>().FirstOrDefault();
⋮----
var window = new WorkSpeedGlobalConfigWindow(this);
⋮----
// Advance listing position manually since we drew outside of listing
listing.Gap(buttonHeight + 6f);
// Restore original styling
⋮----
/// Draws a display showing how different jobs behave in the current mode
⋮----
private void DrawJobStatusDisplay(Listing_Standard listing)
⋮----
// Header
⋮----
// Create a rect for the centered header with tooltip
var titleRect = listing.GetRect(Text.LineHeight + 4f);
var headerText = "JobTable_SectionTitle".Translate();
Widgets.Label(titleRect, headerText);
// Add tooltip to the header
if (Mouse.IsOver(titleRect))
TooltipHandler.TipRegion(titleRect, "JobTable_SectionTooltip".Translate());
⋮----
// Get all survival tool work givers and their stats
⋮----
listing.Label("JobTable_NoJobsFound".Translate());
⋮----
// Determine which mode(s) to show based on current settings
⋮----
// Calculate number of active columns and their widths
⋮----
listing.Label("JobTable_NoActiveMode".Translate());
⋮----
const float columnSpacing = 12f; // Increased spacing between columns
const float minColumnWidth = 200f; // Increased significantly to provide much more room for content
// Calculate dynamic job label width based on actual content
⋮----
Text.Font = GameFont.Medium; // Use same font as rendering
var jobLabelText = "JobTable_JobType".Translate();
var dynamicJobLabelWidth = Mathf.Max(Text.CalcSize(jobLabelText).x + 50f, 180f); // Increased padding and minimum significantly
// Check all job categories for max width needed
⋮----
dynamicJobLabelWidth = Mathf.Max(dynamicJobLabelWidth, Text.CalcSize(category.Name).x + 50f);
⋮----
// Also check the column headers to ensure they fit with more generous padding
var extraHardcoreHeaderWidth = Text.CalcSize("JobTable_ExtraHardcore".Translate()).x + 80f; // Increased padding significantly
var requiredTextWidth = Text.CalcSize("JobTable_Required".Translate()).x + 80f;
var gatedTextWidth = Text.CalcSize("JobTable_GatedExample".Translate()).x + 80f; // Account for worst case gated text with extra padding
var minNeededColumnWidth = Mathf.Max(extraHardcoreHeaderWidth, Mathf.Max(requiredTextWidth, gatedTextWidth));
Text.Font = measureFont; // Restore font
⋮----
// Ensure column width is sufficient for the text content - use the larger of calculated or needed width
var columnWidth = Mathf.Max(calculatedColumnWidth, Mathf.Max(minColumnWidth, minNeededColumnWidth));
// Calculate total table height for border
var tableHeight = (Text.LineHeight + 10f) + (Text.LineHeight * 1.5f * jobCategories.Count) + 8f; // Header + rows with bigger font spacing + padding
var tableBorderRect = listing.GetRect(tableHeight);
// Draw outer table border
var tableBorderColor = new Color(0.6f, 0.6f, 0.6f, 0.8f);
⋮----
// Draw border frame
⋮----
// Top border
GUI.DrawTexture(new Rect(tableBorderRect.x, tableBorderRect.y, tableBorderRect.width, borderThickness), BaseContent.WhiteTex);
// Bottom border
GUI.DrawTexture(new Rect(tableBorderRect.x, tableBorderRect.yMax - borderThickness, tableBorderRect.width, borderThickness), BaseContent.WhiteTex);
// Left border
GUI.DrawTexture(new Rect(tableBorderRect.x, tableBorderRect.y, borderThickness, tableBorderRect.height), BaseContent.WhiteTex);
// Right border
GUI.DrawTexture(new Rect(tableBorderRect.xMax - borderThickness, tableBorderRect.y, borderThickness, tableBorderRect.height), BaseContent.WhiteTex);
// Create inner content area (inside the border)
var innerTableRect = new Rect(tableBorderRect.x + borderThickness + 4f, tableBorderRect.y + borderThickness + 4f,
⋮----
// Column headers with enhanced styling - increased height for better fonts
var headerRect = new Rect(innerTableRect.x, innerTableRect.y, innerTableRect.width, Text.LineHeight + 8f); // Increased from +4f to +8f
// Draw header background
var headerBgColor = new Color(0.1f, 0.1f, 0.1f, 0.6f); // Dark background for header
⋮----
GUI.DrawTexture(headerRect, BaseContent.WhiteTex);
// Draw header bottom border
var borderRect = new Rect(headerRect.x, headerRect.yMax - 2f, headerRect.width, 2f);
var borderColor = new Color(0.6f, 0.6f, 0.6f, 0.8f);
⋮----
GUI.DrawTexture(borderRect, BaseContent.WhiteTex);
var currentX = headerRect.x + dynamicJobLabelWidth; // Offset for job labels
// Job Types label
var jobHeaderRect = new Rect(headerRect.x, headerRect.y + 2f, dynamicJobLabelWidth, headerRect.height - 4f);
⋮----
Text.Font = GameFont.Small; // Changed from Tiny to Small for better visibility
⋮----
Widgets.Label(jobHeaderRect, "JobTable_JobTypes".Translate());
⋮----
var normalRect = new Rect(currentX, headerRect.y + 2f, columnWidth, headerRect.height - 4f);
⋮----
Text.Font = GameFont.Small; // Ensure consistent font size
⋮----
Widgets.Label(normalRect, "JobTable_NormalMode".Translate());
⋮----
var hardcoreRect = new Rect(currentX, headerRect.y + 2f, columnWidth, headerRect.height - 4f);
⋮----
Widgets.Label(hardcoreRect, "JobTable_HardcoreMode".Translate());
⋮----
var extraHardcoreRect = new Rect(currentX, headerRect.y + 2f, columnWidth, headerRect.height - 4f);
⋮----
Widgets.Label(extraHardcoreRect, "JobTable_ExtraHardcore".Translate());
⋮----
// Draw job categories with alternating row colors inside the bordered table
var currentRowY = headerRect.yMax + 4f; // Start below the header
var rowHeight = Text.LineHeight * 1.5f; // Increased height for bigger fonts
⋮----
var rowRect = new Rect(innerTableRect.x, currentRowY, innerTableRect.width, rowHeight);
⋮----
// Restore saved color
⋮----
public void DrawJobCategoryRowInTable(Rect rowRect, JobCategory category, float jobLabelWidth, float columnWidth, float columnSpacing, bool showNormal, bool showHardcore, bool showExtraHardcore, int rowIndex)
⋮----
// Draw alternating row background
if (rowIndex % 2 == 1) // Every other row (1, 3, 5...)
⋮----
var bgColor = new Color(0.2f, 0.2f, 0.2f, 0.3f); // Subtle dark background
⋮----
GUI.DrawTexture(rowRect, BaseContent.WhiteTex);
⋮----
// Job category name (leftmost, bigger font for consistency)
⋮----
var jobLabelRect = new Rect(rowRect.x, rowRect.y, jobLabelWidth, rowRect.height);
⋮----
Widgets.Label(jobLabelRect, category.Name);
⋮----
// Draw vertical separator after job label
⋮----
GUI.color = new Color(0.6f, 0.6f, 0.6f, 0.6f);
GUI.DrawTexture(new Rect(sepX - 0.5f, rowRect.y, 1f, rowRect.height), BaseContent.WhiteTex);
⋮----
// Draw columns based on which modes are active
var currentX = rowRect.x + jobLabelWidth + columnSpacing; // Start after job label
// Set bigger font for column values
⋮----
var normalRect = new Rect(currentX, rowRect.y, columnWidth, rowRect.height);
⋮----
Widgets.Label(normalRect, GetModeStatusText(category, GameMode.Normal));
⋮----
// Draw vertical separator after normal mode column (if more columns follow)
⋮----
GUI.DrawTexture(new Rect(normalSepX - 0.5f, rowRect.y, 1f, rowRect.height), BaseContent.WhiteTex);
⋮----
var hardcoreRect = new Rect(currentX, rowRect.y, columnWidth, rowRect.height);
⋮----
Widgets.Label(hardcoreRect, GetModeStatusText(category, GameMode.Hardcore));
⋮----
// Draw vertical separator after hardcore mode column (if extra hardcore follows)
⋮----
GUI.DrawTexture(new Rect(hardcoreSepX - 0.5f, rowRect.y, 1f, rowRect.height), BaseContent.WhiteTex);
⋮----
var extraHardcoreRect = new Rect(currentX, rowRect.y, columnWidth, rowRect.height);
⋮----
Widgets.Label(extraHardcoreRect, GetModeStatusText(category, GameMode.ExtraHardcore));
⋮----
// Reset font and settings
⋮----
public List<JobCategory> GetJobCategories()
⋮----
// Get all WorkGivers with tool requirements
⋮----
.Where(wg => wg.HasModExtension<WorkGiverExtension>())
.ToList();
// Group by stat type to create logical categories
⋮----
if (!statGroups.ContainsKey(categoryName))
⋮----
if (!statGroups[categoryName].Contains(stat))
statGroups[categoryName].Add(stat);
⋮----
// Add compatibility stats from active mods
var compatStats = CompatAPI.GetAllCompatibilityStats();
⋮----
// Add WorkSpeedGlobal category if there are any configured jobs
if (WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs().Any())
⋮----
if (!statGroups[categoryName].Contains(workSpeedGlobalStat))
statGroups[categoryName].Add(workSpeedGlobalStat);
⋮----
// Create job categories
⋮----
categories.Add(new JobCategory
⋮----
return categories.OrderBy(c => c.Name).ToList();
⋮----
private string GetStatCategoryName(StatDef stat)
⋮----
// WorkSpeedGlobal stat handling
⋮----
// Research Reinvented compatibility
⋮----
return stat.LabelCap.ToString() ?? stat.defName;
⋮----
private bool IsOptionalJobCategory(string categoryName, List<StatDef> stats)
⋮----
// Cleaning and butchery are always optional (never required even in hardcore)
⋮----
// Medical is optional in extra hardcore mode based on settings
⋮----
// General Work Speed is configurable - some jobs are gated, some aren't
⋮----
// Research Reinvented categories - treat as core research work, not optional
⋮----
private string GetModeStatusText(JobCategory category, GameMode mode)
⋮----
return "JobTable_Enhanced".Translate(); // Tools provide bonuses but aren't required
⋮----
// Special handling for General Work Speed based on job gating
⋮----
var gatedJobs = WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs().Count(j => workSpeedGlobalJobGating.GetValueOrDefault(j.defName, true));
var totalJobs = WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs().Count();
if (gatedJobs == totalJobs) return "JobTable_Required".Translate();
if (gatedJobs == 0) return "JobTable_Enhanced".Translate();
return "JobTable_GatedFormat".Translate(gatedJobs, totalJobs);
⋮----
return "JobTable_Enhanced".Translate(); // Still optional in hardcore
return "JobTable_Required".Translate(); // Tools are required to do the job
⋮----
if (category.Name == "Cleaning" && !requireCleaningTools) return "JobTable_Enhanced".Translate();
if (category.Name == "Butchery" && !requireButcheryTools) return "JobTable_Enhanced".Translate();
if (category.Name == "Medical" && !requireMedicalTools) return "JobTable_Enhanced".Translate();
return "JobTable_Required".Translate(); // Tools are required based on settings
⋮----
return "JobTable_Status_Unknown".Translate();
⋮----
private Color GetModeColor(JobCategory category, GameMode mode)
⋮----
// Compare with localized equivalents
if (status == "JobTable_Enhanced".Translate()) return Color.green;
if (status == "JobTable_Required".Translate()) return Color.yellow;
if (status == "JobTable_Blocked".Translate()) return Color.red;
⋮----
public class JobCategory
⋮----
private void ResetAllToDefaults()
⋮----
// Extra hardcore settings
⋮----
public class SurvivalTools : Mod
⋮----
public static SurvivalToolsSettings Settings;
⋮----
public override string SettingsCategory() => "SurvivalToolsSettingsCategory".Translate();
public override void DoSettingsWindowContents(Rect inRect)
⋮----
// Ensure we have an instance (paranoia)
⋮----
// If your basic/enhanced UI needs the caches, prime them here
Settings.InitializeOptionalToolCache();
// Draw the real settings UI (the one with checkboxes + “Open Enhanced Settings” button)
Settings.DoSettingsWindowContents(inRect);
⋮----
/// Initialize settings cache (called from StaticConstructorClass)
⋮----
public static void InitializeSettings()
⋮----
/// Enhanced settings window with scrollable content and improved job table
⋮----
public class SurvivalToolsResizableSettingsWindow : Window
⋮----
private readonly SurvivalToolsSettings settings;
private Vector2 scrollPosition = Vector2.zero;
private Vector2 enhancedScrollPosition = Vector2.zero; // For job table scrolling
// Window size - fixed, no resizing
private readonly Vector2 windowSize = new Vector2(800f, 700f);
⋮----
// Window properties
⋮----
// Set window size and position
windowRect = new Rect(
⋮----
public override void PreClose()
⋮----
// Save settings when window closes
settings.Write();
// Apply conditional feature registration based on updated settings
ConditionalRegistration.ResetConditionals();
ConditionalRegistration.ApplyTreeFellingConditionals();
base.PreClose();
⋮----
public override void DoWindowContents(Rect inRect)
⋮----
// Content area (no title, starts at top)
var contentRect = new Rect(inRect.x, inRect.y, inRect.width, inRect.height);
// Calculate dynamic content height
⋮----
// Ensure the inner view rect height is at least the visible view height so bottom controls remain reachable
var viewRect = new Rect(0, 0, contentRect.width - 20f, Mathf.Max(contentRect.height, contentHeight));
Widgets.BeginScrollView(contentRect, ref scrollPosition, viewRect);
⋮----
// Draw all settings content
⋮----
private float CalculateDynamicContentHeight(float availableWidth)
⋮----
// Calculate content height for enhanced window (job table + extra hardcore only)
// This ensures content scales properly with window size
float baseHeight = 50f; // Base spacing (reduced since no title area)
// Extra hardcore settings (when enabled and applicable)
⋮----
baseHeight += 35f * 4; // Extra hardcore options
⋮----
// Job requirements table - this is the main content
float tableWidth = availableWidth - 40f; // Account for margins
⋮----
float rowHeight = 30f; // Increased for bigger fonts
float headerHeight = 60f; // Header + tooltip space
baseHeight += headerHeight + (jobCount * rowHeight) + 40f; // Table + padding
// Add extra space for the Close button at the bottom (RimWorld automatic close button)
baseHeight += 60f; // Space for close button + padding
return baseHeight + 100f; // Extra padding
⋮----
private void DrawDynamicSettingsContent(Listing_Standard listing, float availableWidth)
⋮----
// Pacifist Tool Equipping
⋮----
listing.CheckboxLabeled("Settings_AllowPacifistEquip".Translate(), ref settings.allowPacifistEquip, "Settings_AllowPacifistEquip_Tooltip".Translate());
⋮----
// Extra Hardcore Mode section (only shown if hardcore is enabled and optional tools exist)
⋮----
// Extra hardcore checkbox
GUI.color = new Color(1f, 0.1f, 0.1f); // Even more red than hardcore
⋮----
listing.CheckboxLabeled("Settings_ExtraHardcoreMode".Translate(), ref settings.extraHardcoreMode, "Settings_ExtraHardcoreMode_Tooltip".Translate());
// Auto-enable individual options when extra hardcore is first enabled
⋮----
Helpers.SurvivalToolValidation.ValidateExistingJobs("Extra hardcore mode enabled");
⋮----
// Individual optional tool requirement checkboxes (only if extra hardcore is enabled)
⋮----
// Indented individual options
⋮----
var cleaningRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(cleaningRect, "Settings_RequireCleaningTools".Translate(), ref settings.requireCleaningTools);
if (Mouse.IsOver(cleaningRect))
TooltipHandler.TipRegion(cleaningRect, "Settings_RequireCleaningTools_Tooltip".Translate());
⋮----
var butcheryRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(butcheryRect, "Settings_RequireButcheryTools".Translate(), ref settings.requireButcheryTools);
if (Mouse.IsOver(butcheryRect))
TooltipHandler.TipRegion(butcheryRect, "Settings_RequireButcheryTools_Tooltip".Translate());
⋮----
var medicalRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(medicalRect, "Settings_RequireMedicalTools".Translate(), ref settings.requireMedicalTools);
if (Mouse.IsOver(medicalRect))
TooltipHandler.TipRegion(medicalRect, "Settings_RequireMedicalTools_Tooltip".Translate());
⋮----
// ResearchReinvented compatibility settings (only show if RR is detected)
⋮----
listing.Label("Research Reinvented Compatibility");
var rrEnableRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(rrEnableRect, "Enable Research Reinvented compatibility", ref settings.enableRRCompatibility);
if (Mouse.IsOver(rrEnableRect))
TooltipHandler.TipRegion(rrEnableRect, "When enabled, integrates with Research Reinvented mod features and tool requirements.");
⋮----
var rrResearchRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(rrResearchRect, "Require research tools in Extra Hardcore", ref settings.rrResearchRequiredInExtraHardcore);
if (Mouse.IsOver(rrResearchRect))
TooltipHandler.TipRegion(rrResearchRect, "When enabled, pawns need research tools to perform research tasks in Extra Hardcore mode.");
var rrFieldResearchRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(rrFieldResearchRect, "Require field research tools in Extra Hardcore", ref settings.rrFieldResearchRequiredInExtraHardcore);
if (Mouse.IsOver(rrFieldResearchRect))
TooltipHandler.TipRegion(rrFieldResearchRect, "When enabled, pawns need field research tools to perform field research tasks in Extra Hardcore mode.");
⋮----
listing.Gap(12f);
⋮----
// WorkSpeedGlobal Job Configuration Button
settings.DrawWorkSpeedGlobalConfigButton(listing);
// Job Requirements Table - centered and properly sized for the window
⋮----
// Add some spacing after the job table to prevent Close button overlap
⋮----
/// Draw the job requirements table centered and properly sized for the enhanced window
⋮----
private void DrawCenteredJobTable(Listing_Standard listing, float availableWidth)
⋮----
// ---- Title ----
⋮----
Widgets.Label(titleRect, "JobTable_SectionTitle".Translate());
⋮----
// ---- Data ----
var jobCategories = settings.GetJobCategories();
⋮----
var noJobsRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.Label(noJobsRect, "JobTable_NoJobsFound".Translate());
⋮----
listing.Label("No active mode selected.");
⋮----
// ---- Measure widths (use the same font we render with) ----
⋮----
string jobLabelText = "JobTable_JobType".Translate();
string normalHeaderText = "JobTable_Normal".Translate();
string hardcoreHeaderText = "JobTable_Hardcore".Translate();
string extraHardcoreHeaderText = "JobTable_ExtraHardcore".Translate();
float jobLabelWidth = Mathf.Max(Text.CalcSize(jobLabelText).x + 30f, 140f);
⋮----
if (showNormal) columnWidth = Mathf.Max(columnWidth, Text.CalcSize(normalHeaderText).x + 40f);
if (showHardcore) columnWidth = Mathf.Max(columnWidth, Text.CalcSize(hardcoreHeaderText).x + 40f);
if (showExtraHardcore) columnWidth = Mathf.Max(columnWidth, Text.CalcSize(extraHardcoreHeaderText).x + 40f);
string reqText = "JobTable_Required".Translate();
string enhText = "JobTable_Enhanced".Translate();
⋮----
jobLabelWidth = Mathf.Max(jobLabelWidth, Text.CalcSize(cat.Name).x + 30f);
columnWidth = Mathf.Max(columnWidth, Text.CalcSize(reqText).x + 20f);
columnWidth = Mathf.Max(columnWidth, Text.CalcSize(enhText).x + 20f);
⋮----
// ---- Table geometry ----
⋮----
// Reserve space for the pinned header
float pinnedHeaderSpace = headerHeight + 6f; // Extra space for visual separation
// Calculate maximum content height for scrolling (available space minus header and padding)
float maxContentHeight = 300f; // Maximum height before scrolling
⋮----
// Reserve vertical space from the listing and center horizontally
Rect reserved = listing.GetRect(totalTableHeight);
float tableStartX = Mathf.Max(0f, (availableWidth - totalTableWidth) / 2f);
// Outer frame
Rect tableRect = new Rect(reserved.x + tableStartX, reserved.y, totalTableWidth, totalTableHeight);
GUI.color = new Color(0.1f, 0.1f, 0.1f, 0.3f);
GUI.DrawTexture(tableRect, BaseContent.WhiteTex);
GUI.color = new Color(0.6f, 0.6f, 0.6f, 0.8f);
Widgets.DrawBox(tableRect, 1);
⋮----
// ---- Pinned Header Area ----
Rect pinnedHeaderRect = new Rect(tableRect.x + pad, tableRect.y + pad, tableRect.width - pad * 2f, headerHeight);
// Header background - darker and more prominent
GUI.color = new Color(0.1f, 0.1f, 0.1f, 0.9f);
GUI.DrawTexture(pinnedHeaderRect, BaseContent.WhiteTex);
GUI.color = new Color(0.6f, 0.6f, 0.6f, 1f);
Widgets.DrawBox(pinnedHeaderRect, 1);
⋮----
// ---- Pinned Header Content ----
// Job Type header cell
Rect jobHeaderRect = new Rect(pinnedHeaderRect.x, pinnedHeaderRect.y, jobLabelWidth, pinnedHeaderRect.height);
⋮----
Widgets.Label(new Rect(jobHeaderRect.x + 4f, jobHeaderRect.y + 2f, jobHeaderRect.width - 8f, jobHeaderRect.height - 4f),
"JobTable_JobType".Translate());
⋮----
// Vertical separators for pinned header
⋮----
GUI.DrawTexture(new Rect(firstSepX - 0.5f, sepTop, 1f, sepHeight), BaseContent.WhiteTex);
⋮----
// Mode headers in pinned area
⋮----
Rect normalRect = new Rect(currentX, pinnedHeaderRect.y + 2f, columnWidth, pinnedHeaderRect.height - 4f);
GUI.color = new Color(0.5f, 1f, 0.5f);
⋮----
Widgets.Label(normalRect, normalHeaderText);
⋮----
GUI.DrawTexture(new Rect(sepX - 0.5f, sepTop, 1f, sepHeight), BaseContent.WhiteTex);
⋮----
Rect hardcoreRect = new Rect(currentX, pinnedHeaderRect.y + 2f, columnWidth, pinnedHeaderRect.height - 4f);
GUI.color = new Color(1f, 1f, 0.5f);
⋮----
Widgets.Label(hardcoreRect, hardcoreHeaderText);
⋮----
Rect extraRect = new Rect(currentX, pinnedHeaderRect.y + 2f, columnWidth, pinnedHeaderRect.height - 4f);
GUI.color = new Color(1f, 0.5f, 0.5f);
⋮----
Widgets.Label(extraRect, extraHardcoreHeaderText);
⋮----
// ---- Scrollable Content Area ----
Rect contentAreaRect = new Rect(tableRect.x + pad, pinnedHeaderRect.yMax + 3f, tableRect.width - pad * 2f, actualContentHeight);
⋮----
// Use scroll view for content. Ensure view height is at least the visible content area to prevent clipping
Rect viewRect = new Rect(0, 0, contentAreaRect.width - 20f, Mathf.Max(contentAreaRect.height, contentHeight));
Widgets.BeginScrollView(contentAreaRect, ref enhancedScrollPosition, viewRect);
// Draw rows in scroll view
⋮----
Rect rowRect = new Rect(0, rowY, viewRect.width, rowHeight);
⋮----
GUI.color = new Color(1f, 1f, 1f, 0.05f);
⋮----
settings.DrawJobCategoryRowInTable(rowRect, category, jobLabelWidth, columnWidth, columnSpacing,
⋮----
// Draw rows directly without scrolling
⋮----
Rect rowRect = new Rect(contentAreaRect.x, rowY, contentAreaRect.width, rowHeight);
⋮----
// Reset text state
⋮----
// restore GUI state
⋮----
private float CountVisibleJobs()
⋮----
// Count jobs that will be displayed in the table
// Use a simple estimate since we don't need the exact method
return 12f; // Approximate number of job types typically shown
</file>
<file path="About/About.xml">
<?xml version="1.0" encoding="utf-8"?>
<ModMetaData>
    <packageId>jellypowered.survivaltools</packageId>
    <name>Survival Tools Reborn</name>
    <author>Jellypowered</author>
    <url>https://github.com/Jellypowered/SurvivalTools/</url>
    <supportedVersions>
        <li>1.6</li>
    </supportedVersions>
    <description><![CDATA[
Current version: v1.6 (September 2025)
Transforms RimWorld into a challenging tool-dependent survival experience where proper equipment becomes essential for colony success.
KEY FEATURES:
• Smart Tool System: Colonists automatically acquire optimal tools before starting work
• Hardcore Mode: Tools become essential - most work impossible without proper equipment
• Extra Hardcore Mode: Ultimate difficulty with 87.5% faster tool wear and strict tool requirements
• Granular Controls: Choose exactly which tasks require tools (cleaning, butchery, medical)
• Intelligent Management: Advanced tool optimization and automatic swapping systems
• Realistic Degradation: Tools wear down with use and must be maintained or replaced
• Early Game Survival: Find tools in ruins or craft them to establish your colony
DIFFICULTY MODES:
• Normal: Tools improve efficiency but work remains possible without them
• Hardcore: Most tasks become impossible without proper tools, 50% faster wear
• Extra Hardcore: Maximum challenge - strict tool requirements, 87.5% faster wear
QUALITY OF LIFE:
• Automatic tool pickup before jobs begin
• Smart tool swapping for optimal efficiency
• Detailed alerts for missing or worn tools
• Comprehensive mod compatibility patches
• Extensive debugging and logging options
Originally by XeoNovaDan. Rebuilt and enhanced for RimWorld 1.6 with improvements to tool mechanics, hardcore survival features, and intelligent automation systems.
    ]]>    </description>
</ModMetaData>
</file>
</files>
</file>

<file path="LICENSE">
MIT License

Copyright (c) 2018 XeoNovaDan

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>

<file path="Source/Compatibility/CommonSense/CommonSenseDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/CommonSense/CommonSenseDebug.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
/// <summary>
/// Debug helpers for CommonSense compatibility.
/// Use to output detailed diagnostic info when developing compat code.
/// </summary>
internal static class CommonSenseDebug
⋮----
public static void Log(string msg)
⋮----
if (!CommonSenseHelpers.IsCommonSenseActive()) return;
⋮----
// swallow
</file>

<file path="Source/Compatibility/CommonSense/CommonSenseHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/CommonSense/CommonSenseHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
/// <summary>
/// Helper utilities for CommonSense compatibility.
/// All methods are defensive and safe to call when CommonSense is not loaded.
/// </summary>
public static class CommonSenseHelpers
⋮----
/// Returns true if CommonSense mod is active/available.
/// Use this before calling any CommonSense-specific APIs.
⋮----
public static bool IsCommonSenseActive()
⋮----
// Safe check via ModLister if available at runtime
return Verse.ModLister.GetActiveModWithIdentifier("com.rimworld.caister.commonsense") != null;
⋮----
/// Centralized check whether a pawn should be exempt from SurvivalTools logic
/// when CommonSense provides alternate handling (e.g. wanderers, gear UI overrides).
⋮----
public static bool ShouldBypassForCommonSense(Pawn pawn)
⋮----
// Placeholder for future CommonSense-specific heuristics.
</file>

<file path="Source/Compatibility/CommonSense/CommonSensePatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/CommonSense/CommonSensePatches.cs
⋮----
/// <summary>
/// Compatibility module for CommonSense mod.
/// Implements ICompatibilityModule so CompatAPI can discover and initialize it.
/// All operations are defensive and safe to run when the mod is not present.
/// </summary>
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
internal sealed class CommonSenseCompatibilityModule : ICompatibilityModule
⋮----
private Harmony _harmony;
⋮----
public bool IsModActive => CommonSenseHelpers.IsCommonSenseActive();
public void Initialize()
⋮----
_harmony = new Harmony("com.jellypowered.survivaltools.compat.commonsense");
// Example patch: intercept CommonSense.JobDriver_Ingest.PrepareToIngestToils
var jobType = AccessTools.TypeByName("CommonSense.JobDriver_Ingest");
⋮----
var method = AccessTools.Method(jobType, "PrepareToIngestToils");
⋮----
var prefix = new HarmonyMethod(typeof(CommonSenseCompatibilityModule).GetMethod(nameof(Prefix_PrepareToIngestToils)));
var postfix = new HarmonyMethod(typeof(CommonSenseCompatibilityModule).GetMethod(nameof(Postfix_PrepareToIngestToils)));
_harmony.Patch(method, prefix, postfix);
⋮----
public List<StatDef> GetCompatibilityStats()
⋮----
// CommonSense does not add stats relevant to SurvivalTools by default.
⋮----
public Dictionary<string, string> GetDebugInfo()
⋮----
var info = new Dictionary<string, string> { ["Active"] = IsModActive.ToString() };
⋮----
// Prefix - safe no-op unless CommonSense is active
public static bool Prefix_PrepareToIngestToils(object __instance)
⋮----
if (!CommonSenseHelpers.IsCommonSenseActive()) return true;
// Allow SurvivalTools to harmonize gear/drug policy interactions here.
return true; // continue original
⋮----
public static void Postfix_PrepareToIngestToils(object __instance)
⋮----
if (!CommonSenseHelpers.IsCommonSenseActive()) return;
// Reconcile SurvivalTools state after CommonSense sets up toils.
</file>

<file path="Source/Compatibility/SmarterConstruction/SmarterConstructionDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterConstruction/SmarterConstructionDebug.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
internal static class SmarterConstructionDebug
⋮----
public static void D(string msg)
⋮----
if (!SmarterConstructionHelpers.IsSmarterConstructionActive()) return;
</file>

<file path="Source/Compatibility/SmarterConstruction/SmarterConstructionHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterConstruction/SmarterConstructionHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Helpers for SmarterConstruction compatibility.
/// Defensive, minimal surface area for reflection lookups.
/// </summary>
internal static class SmarterConstructionHelpers
⋮----
public static bool IsSmarterConstructionActive()
⋮----
return ModLister.GetActiveModWithIdentifier("smarterconstruction.author") != null;
⋮----
/// Safe type lookup for SmarterConstruction job driver types.
⋮----
public static Type GetJobDriverConstructType()
⋮----
try { return AccessTools.TypeByName("SmarterConstruction.JobDriver_ConstructFinishFrame"); }
</file>

<file path="Source/Compatibility/SmarterConstruction/SmarterConstructionPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterConstruction/SmarterConstructionPatches.cs
⋮----
/// <summary>
/// Harmony patches for SmarterConstruction compat.
/// Ensures roofing jobs don't loop and tooling hooks degrade gracefully.
/// Integrates with core gating/blacklist helpers and applies tiered penalties via WorkSpeedGlobalHelper.
/// </summary>
internal sealed class SmarterConstructionCompatibilityModule : ICompatibilityModule
⋮----
private Harmony _harmony;
⋮----
public bool IsModActive => SmarterConstructionHelpers.IsSmarterConstructionActive();
public void Initialize()
⋮----
_harmony = new Harmony("com.jellypowered.survivaltools.compat.smarterconstruction");
// Patch JobOnThing if present
var type = AccessTools.TypeByName("SmarterConstruction.WorkGiver_Construct");
⋮----
var method = AccessTools.Method(type, "JobOnThing");
⋮----
try { _harmony.Patch(method, prefix: new HarmonyMethod(typeof(SmarterConstructionCompatibilityModule).GetMethod(nameof(Prefix_JobOnThing)))); }
⋮----
// Patch constructor finish toils (prevent infinite loops and respect tiers)
var jdType = AccessTools.TypeByName("SmarterConstruction.JobDriver_ConstructFinishFrame");
⋮----
var m = AccessTools.Method(jdType, "MakeNewToils");
⋮----
try { _harmony.Patch(m, prefix: new HarmonyMethod(typeof(SmarterConstructionCompatibilityModule).GetMethod(nameof(Prefix_MakeNewToils)))); }
⋮----
public List<StatDef> GetCompatibilityStats() => new List<StatDef>();
public Dictionary<string, string> GetDebugInfo() => new Dictionary<string, string> { ["Active"] = IsModActive.ToString() };
// Prefix to safeguard JobOnThing and avoid infinite roofing loops
public static bool Prefix_JobOnThing(object __instance, Thing t, Pawn pawn, ref Job __result)
⋮----
if (!SmarterConstructionHelpers.IsSmarterConstructionActive()) return true;
⋮----
// Respect core blacklist — if pawn is blacklisted, allow original behaviour
if (!PawnToolValidator.CanUseSurvivalTools(pawn)) return true;
// Basic roofing loop guard: if job targets a roofed cell but roofing job already exists, skip.
⋮----
if (t.def != null && t.def.building != null && t.Position.Roofed(t.Map))
⋮----
// scan all pawns on the map and check their current job for a RemoveRoof targeting same thing/cell
⋮----
catch { /* swallow */ }
// Additionally, gate roofing early if settings/hardcore require construction tools
⋮----
WorkGiverDef wgDef = null;
try { wgDef = DefDatabase<WorkGiverDef>.GetNamedSilentFail("BuildRoofs"); } catch { }
// Prefer StatGatingHelper to keep parity with core gating rules
⋮----
if (StatGatingHelper.ShouldBlockBuildRoof(pawn, out string scKey, t.Position))
⋮----
if (ST_Logging.IsCompatLogging())
⋮----
// Prefix to inspect MakeNewToils and avoid endless toil spawns
public static bool Prefix_MakeNewToils(object __instance)
⋮----
// Defensive: ensure any JobDriver toils that rely on SurvivalTools are aware of current pawn/tool state
// (Heavy instrumentation or tiered penalty registration would be done in StatPart_SurvivalTool via GetStatValue)
</file>

<file path="Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionDebug.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
internal static class SmarterDeconstructionDebug
⋮----
public static void D(string msg)
⋮----
if (!SmarterDeconstructionHelpers.IsSmarterDeconstructionActive()) return;
</file>

<file path="Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
internal static class SmarterDeconstructionHelpers
⋮----
public static bool IsSmarterDeconstructionActive()
⋮----
try { return ModLister.GetActiveModWithIdentifier("smarterdeconstruction.author") != null; }
⋮----
public static bool IsTDEnhancementPackActive()
⋮----
try { return ModLister.GetActiveModWithIdentifier("td.enhancement.pack") != null; }
⋮----
/// <summary>
/// Determines if SmarterDeconstruction should be considered the authoritative owner for WorkGiver_Scanner compatibility hooks.
/// This helps deduplicate patches when multiple mods (e.g., TD Enhancement Pack) attempt to patch the same targets.
/// </summary>
public static bool ShouldOwnWorkGiverScannerHooks()
⋮----
// Default to true when SmarterDeconstruction is active. Other compat modules can check CompatibilityRegistry to decide.
</file>

<file path="Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SmarterDeconstruction/SmarterDeconstructionPatches.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Patches to integrate with SmarterDeconstruction and related mods.
/// Handles pacifist equip logic, roof handling, mining damage tuning, and gating.
/// </summary>
internal sealed class SmarterDeconstructionCompatibilityModule : ICompatibilityModule
⋮----
// Indicates whether SmarterDeconstruction compat applied the WorkGiver_Scanner hooks.
⋮----
private Harmony _harmony;
⋮----
public bool IsModActive => SmarterDeconstructionHelpers.IsSmarterDeconstructionActive();
public void Initialize()
⋮----
_harmony = new Harmony("com.jellypowered.survivaltools.compat.smarterdeconstruction");
// Pacifist equip logic is provided by core SurvivalTools (Patch_EquipmentUtility_CanEquip_PacifistTools).
// Do not apply a duplicate CanEquip postfix here; rely on core behaviour instead.
// Patch WorkGiver_PlantsCut.JobOnThing to gate survival tool checks
var wgType = AccessTools.TypeByName("SmarterDeconstruction.WorkGiver_PlantsCut");
⋮----
var m = AccessTools.Method(wgType, "JobOnThing");
⋮----
try { _harmony.Patch(m, prefix: new HarmonyMethod(typeof(SmarterDeconstructionCompatibilityModule).GetMethod(nameof(Prefix_JobOnThing)))); }
⋮----
// SmarterDeconstruction relies on the core WorkGiver_Scanner gating patch (Patch_WorkGiver_Scanner_ToolGate.cs)
// to avoid duplicating scanner-level hooks. We keep per-WG patches (e.g., WorkGiver_PlantsCut) above.
⋮----
public List<StatDef> GetCompatibilityStats() => new List<StatDef>();
public Dictionary<string, string> GetDebugInfo() => new Dictionary<string, string> { ["Active"] = IsModActive.ToString() };
// Pacifist equip logic is handled by core SurvivalTools; no postfix required here.
public static bool Prefix_JobOnThing(object __instance)
⋮----
if (!SmarterDeconstructionHelpers.IsSmarterDeconstructionActive()) return true;
⋮----
/// Canonical prefix for WorkGiver_Scanner.JobOnThing.
/// Gates jobs that SurvivalTools wants to block when the pawn lacks appropriate survival tools.
/// Returns true to continue original when allowed, false to skip job creation.
⋮----
public static bool Prefix_WorkGiverScanner_JobOnThing(object __instance, Pawn pawn, Thing t)
⋮----
// Determine the WorkGiverDef from the instance if possible
WorkGiverDef wgDef = null;
try { wgDef = (WorkGiverDef)AccessTools.Field(__instance.GetType(), "def").GetValue(__instance); } catch { }
// If this job should be gated by SurvivalTools, enforce pawn must have a survival tool for the job's main stat
⋮----
JobDef jobDef = null;
try { jobDef = (JobDef)AccessTools.Field(__instance.GetType(), "def").GetValue(__instance); } catch { }
// Use SurvivalToolUtility heuristics: ShouldGateByDefault(WorkGiverDef) and PawnHasSurvivalTool
⋮----
if (SurvivalToolUtility.ShouldGateByDefault(wgDef))
⋮----
// Determine required stats for this workgiver/job
var requiredStats = SurvivalToolUtility.RelevantStatsFor(wgDef, jobDef ?? (JobDef)null) ?? new List<StatDef>();
// If research stats are relevant, honor Research tools via CompatAPI
if ((requiredStats == null || requiredStats.Count == 0) && CompatAPI.PawnHasResearchTools(pawn))
⋮----
// Pawn already satisfied by research tools
⋮----
// Always call central blacklist / capability check first
if (!PawnToolValidator.CanUseSurvivalTools(pawn))
⋮----
// Pawn is blacklisted by core rules (mechanoid/quest/other) — allow original behaviour
⋮----
// Use the unified gating helper which respects hardcore mode and settings
if (!pawn.MeetsWorkGiverStatRequirements(requiredStats, wgDef, jobDef))
⋮----
if (ST_Logging.ShouldLogJobForPawn(pawn, jobDef ?? JobDefOf.Refuel))
⋮----
// Avoid LINQ in this hot-path logging: build a short comma-separated list
⋮----
// Hook into Pawn_JobTracker.TryTakeOrderedJob to gate jobs requiring survival tools
public static bool Prefix_TryTakeOrderedJob(Pawn_JobTracker __instance)
⋮----
// Let original run; could add gating logic here to check survival tool availability.
⋮----
// Example mining damage adjustment hook (placeholder). Ensure mechanoids are blacklisted.
public static void Postfix_AdjustMiningDamage(ref float __result, Pawn pawn, ThingDef target)
⋮----
if (!SmarterDeconstructionHelpers.IsSmarterDeconstructionActive()) return;
⋮----
if (pawn.RaceProps.IsMechanoid) return; // do not modify mechanoid behavior
// Placeholder: reduce mining damage if survival tool has wear or stats
</file>

<file path="Source/Compatibility/TDEnhancementPack/TDEnhancementPackDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/TDEnhancementPack/TDEnhancementPackDebug.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
internal static class TDEnhancementPackDebug
⋮----
public static void LogStatus()
⋮----
Log.Message($"[SurvivalTools Compat] TD Enhancement Pack active: {TDEnhancementPackHelpers.IsTDEnhancementPackActive()}");
⋮----
public static void D(string msg)
⋮----
if (!TDEnhancementPackHelpers.IsTDEnhancementPackActive()) return;
</file>

<file path="Source/Compatibility/TDEnhancementPack/TDEnhancementPackHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/TDEnhancementPack/TDEnhancementPackHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Helper utilities for TD Enhancement Pack compatibility.
/// Uses safe mod detection via ModLister and routes logs through ST_Logging.
/// </summary>
internal static class TDEnhancementPackHelpers
⋮----
/// Returns true when TD Enhancement Pack is active. Safe no-op if ModLister API is unavailable.
⋮----
public static bool IsTDEnhancementPackActive()
⋮----
try { return Verse.ModLister.GetActiveModWithIdentifier("td.enhancement.pack") != null; }
⋮----
// Fallback: be conservative and treat mod as not present.
⋮----
/// Wrapper to log compatibility messages consistently.
⋮----
public static void LogCompat(string message)
⋮----
try { ST_Logging.LogCompatMessage(message); }
catch { /* swallow logging failures */ }
</file>

<file path="Source/Compatibility/TDEnhancementPack/TDEnhancementPackPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/TDEnhancementPack/TDEnhancementPackPatches.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Harmony patches for TD Enhancement Pack compatibility.
/// Patches are safe no-ops when the mod is absent.
/// </summary>
⋮----
internal static class TDEnhancementPackPatches
⋮----
if (!TDEnhancementPackHelpers.IsTDEnhancementPackActive())
⋮----
var harmony = new Harmony("com.survivaltools.compat.tdenhancementpack");
// Placeholder for any early static patches that are safe to apply.
// Most hooks are registered via the ICompatibilityModule below to allow dedup logic.
⋮----
/// TD Enhancement Pack compatibility. Deduplicates overlapping hooks with SmarterDeconstruction.
⋮----
internal sealed class TDEnhancementPackCompatibilityModule : ICompatibilityModule
⋮----
private Harmony _harmony;
⋮----
public bool IsModActive => TDEnhancementPackHelpers.IsTDEnhancementPackActive();
public void Initialize()
⋮----
_harmony = new Harmony("com.jellypowered.survivaltools.compat.tdenhancementpack");
// If SmarterDeconstruction compat is present, avoid duplicating WorkGiver_Scanner hooks.
var sdModule = CompatibilityRegistry.GetModule("SmarterDeconstruction");
⋮----
// Prefer the helper method on SmarterDeconstruction for a robust ownership check
if (SmarterDeconstruction.SmarterDeconstructionHelpers.ShouldOwnWorkGiverScannerHooks())
⋮----
catch { /* ignore and proceed to apply TD hooks if needed */ }
⋮----
// Apply TD-specific hooks here. Keep them defensive and lightweight.
// Parity: ensure TD's build-roof logic respects SurvivalTools gating in extra-hardcore.
⋮----
var t = AccessTools.TypeByName("WorkGiver_BuildRoof") ?? AccessTools.TypeByName("WorkGiver_BuildRoofs");
⋮----
var hasCell = AccessTools.Method(t, "HasJobOnCell", new Type[] { typeof(Pawn), typeof(IntVec3), typeof(bool) });
⋮----
var prefix = new HarmonyMethod(typeof(TDEnhancementPackCompatibilityModule).GetMethod(nameof(Prefix_BuildRoof_HasJobOnCell), BindingFlags.NonPublic | BindingFlags.Static));
_harmony.Patch(hasCell, prefix: prefix);
⋮----
var jobOnCell = AccessTools.Method(t, "JobOnCell", new Type[] { typeof(Pawn), typeof(IntVec3) });
⋮----
var prefix2 = new HarmonyMethod(typeof(TDEnhancementPackCompatibilityModule).GetMethod(nameof(Prefix_BuildRoof_JobOnCell), BindingFlags.NonPublic | BindingFlags.Static));
_harmony.Patch(jobOnCell, prefix: prefix2);
⋮----
// Lightweight prefixes are defined in class scope below.
⋮----
public List<StatDef> GetCompatibilityStats() => new List<StatDef>();
public Dictionary<string, string> GetDebugInfo() => new Dictionary<string, string> { ["Active"] = IsModActive.ToString() };
// Lightweight prefixes to keep TD's roofing behavior in parity with core gating
// These mirror the core gating: deny BuildRoof assignment in extra-hardcore when pawn lacks construction tools.
private static bool Prefix_BuildRoof_HasJobOnCell(object __instance, Pawn pawn, IntVec3 c, bool forced, ref bool __result)
⋮----
if (StatGatingHelper.ShouldBlockBuildRoof(pawn, out string sk, c))
⋮----
try { if (ShouldLogWithCooldown(sk)) Log.Message($"[SurvivalTools.ToolGate] TD: denying BuildRoof for {pawn.LabelShort} at {c}"); } catch { }
⋮----
private static bool Prefix_BuildRoof_JobOnCell(object __instance, Pawn pawn, IntVec3 c, ref Job __result)
⋮----
if (StatGatingHelper.ShouldBlockBuildRoof(pawn, out string sk2, c))
⋮----
try { if (ShouldLogWithCooldown(sk2)) Log.Message($"[SurvivalTools.ToolGate] TD: skipping BuildRoof.JobOnCell for {pawn.LabelShort} at {c}"); } catch { }
</file>

<file path="Source/DebugTools/DebugAction_DumpHarmonyPatches.cs">
internal static class DebugAction_DumpHarmonyPatches
⋮----
public static void DumpHarmonyPatches()
⋮----
var sb = new StringBuilder();
sb.AppendLine("=== SurvivalTools Harmony Patch Hotspot Analysis ===");
sb.AppendLine($"Generated: {DateTime.Now:yyyy-MM-dd HH:mm:ss}");
sb.AppendLine();
// Define hotspot methods that are common collision points
⋮----
// Job system hotspots
⋮----
// UI hotspots
⋮----
// Tool/equipment hotspots
new { Type = typeof(Pawn_EquipmentTracker), Method = "TryDropEquipment", Params = new[] { typeof(ThingWithComps), typeof(ThingWithComps).MakeByRefType(), typeof(IntVec3), typeof(bool) } },
⋮----
// Work system hotspots
⋮----
sb.AppendLine($"=== {hotspot.Type.Name}.{hotspot.Method} ===");
var method = AccessTools.Method(hotspot.Type, hotspot.Method, hotspot.Params);
⋮----
sb.AppendLine("  Method not found");
⋮----
var info = Harmony.GetPatchInfo(method);
⋮----
sb.AppendLine("  No patches found");
⋮----
sb.AppendLine($"  Total patches: {info.Prefixes.Count} prefixes, {info.Postfixes.Count} postfixes, {info.Transpilers.Count} transpilers");
⋮----
// Analyze all patches
var allPatches = info.Prefixes.Concat(info.Postfixes).Concat(info.Transpilers);
⋮----
var patchType = info.Prefixes.Contains(patch) ? "PREFIX" :
info.Postfixes.Contains(patch) ? "POSTFIX" : "TRANSPILER";
⋮----
sb.AppendLine($"  {marker} {patchType}: {dt.FullName}.{m.Name}");
sb.AppendLine($"       Owner: {patch.owner}");
sb.AppendLine($"       Assembly: {dt.Assembly.GetName().Name}");
if (isOurs && dt.Namespace != null && dt.Namespace.StartsWith("SurvivalTools", StringComparison.Ordinal))
⋮----
sb.AppendLine($"       ST Type: {dt.Name}");
⋮----
// Write to desktop
var desktopPath = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);
⋮----
var fullPath = Path.Combine(desktopPath, fileName);
⋮----
File.WriteAllText(fullPath, sb.ToString());
Log.Message($"[SurvivalTools.DebugTools] Harmony patch dump written to: {fullPath}");
Messages.Message($"Harmony patch dump written to Desktop: {fileName}", MessageTypeDefOf.PositiveEvent, false);
⋮----
Log.Error($"[SurvivalTools.DebugTools] Failed to write harmony dump: {ex}");
Messages.Message($"Failed to write harmony dump: {ex.Message}", MessageTypeDefOf.RejectInput, false);
</file>

<file path="Source/DebugTools/DebugAction_GearTabTools.cs">
// RimWorld 1.6 / C# 7.3
// Source/DebugTools/DebugAction_GearTabTools.cs
//
// Phase 7: Debug tools for Gear tab testing and validation
⋮----
public static class DebugAction_GearTabTools
⋮----
public static void CompareGearVsStatExplanation()
⋮----
Messages.Message("Select a pawn first", MessageTypeDefOf.RejectInput);
⋮----
var sb = new StringBuilder();
sb.AppendLine($"=== Gear vs Stat Explanation Comparison for {selectedPawn.NameShortColored} ===");
sb.AppendLine();
// Get all tool-related stats
⋮----
sb.AppendLine($"--- {stat.LabelCap} ---");
// Get stat explanation
var req = StatRequest.For(selectedPawn);
var explanation = stat.Worker.GetExplanationUnfinalized(req, ToStringNumberSense.Absolute);
var finalValue = selectedPawn.GetStatValue(stat);
sb.AppendLine($"Final Value: {finalValue:F2}");
sb.AppendLine("Explanation:");
sb.AppendLine(explanation);
// Get gear tab scoring - find best tool for this stat
var bestTool = ToolScoring.GetBestTool(selectedPawn, stat, out float bestScore);
⋮----
sb.AppendLine($"Gear Tab Score: {bestScore:F2}");
sb.AppendLine($"Tool: {bestTool.LabelShort}");
// Get detailed breakdown
var contributors = ToolScoring.TopContributors(bestTool, selectedPawn, stat, 3);
⋮----
sb.AppendLine("Top Contributors:");
⋮----
sb.AppendLine($"  {contributor.Item1.LabelShort}: +{contributor.Item2:F2}");
⋮----
sb.AppendLine("Gear Tab Score: No suitable tools found");
⋮----
Log.Message(sb.ToString());
// Also show in a dialog
Find.WindowStack.Add(new Dialog_MessageBox(sb.ToString(), "Gear vs Stat Comparison"));
⋮----
public static void GearPanelGCCheck()
⋮----
// Force GC before test
GC.Collect();
GC.WaitForPendingFinalizers();
⋮----
var beforeMem = GC.GetTotalMemory(false);
var beforeGen0 = GC.CollectionCount(0);
var beforeGen1 = GC.CollectionCount(1);
var beforeGen2 = GC.CollectionCount(2);
// Simulate multiple gear panel draws
var testRect = new Rect(0, 0, UI.GearTab_ST.DesiredWidth, 400f);
⋮----
var stopwatch = System.Diagnostics.Stopwatch.StartNew();
⋮----
UI.GearTab_ST.Draw(testRect, selectedPawn);
⋮----
Log.Error($"[SurvivalTools] Gear panel draw failed on iteration {i}: {ex}");
⋮----
stopwatch.Stop();
var afterMem = GC.GetTotalMemory(false);
var afterGen0 = GC.CollectionCount(0);
var afterGen1 = GC.CollectionCount(1);
var afterGen2 = GC.CollectionCount(2);
⋮----
sb.AppendLine($"=== Gear Panel GC Check ({iterations} iterations) ===");
sb.AppendLine($"Pawn: {selectedPawn.NameShortColored}");
sb.AppendLine($"Average Draw Time: {avgTimeMs:F2}ms");
⋮----
sb.AppendLine("Memory Impact:");
sb.AppendLine($"  Before: {beforeMem:N0} bytes");
sb.AppendLine($"  After:  {afterMem:N0} bytes");
sb.AppendLine($"  Delta:  {memoryDelta:N0} bytes");
⋮----
sb.AppendLine("GC Collections:");
sb.AppendLine($"  Gen 0: {gen0Collections}");
sb.AppendLine($"  Gen 1: {gen1Collections}");
sb.AppendLine($"  Gen 2: {gen2Collections}");
⋮----
sb.AppendLine("✓ NO GC COLLECTIONS - Performance target met!");
⋮----
sb.AppendLine("✓ Minimal GC impact - Good performance");
⋮----
sb.AppendLine("⚠ Significant GC activity detected - May need optimization");
⋮----
sb.AppendLine("✓ Memory usage acceptable");
⋮----
sb.AppendLine($"⚠ Memory leak suspected: {memoryDelta:N0} bytes retained");
⋮----
Messages.Message($"GC Check: {gen0Collections} collections, {avgTimeMs:F1}ms avg", MessageTypeDefOf.TaskCompletion);
⋮----
public static void TestGearTabCaching()
⋮----
sb.AppendLine($"=== Gear Tab Caching Test for {selectedPawn.NameShortColored} ===");
⋮----
// Test cache invalidation scenarios
⋮----
// Initial draw
⋮----
sb.AppendLine("✓ Initial cache population");
// Second draw (should use cache)
⋮----
sb.AppendLine("✓ Cache hit test");
// Simulate equipment change
⋮----
selectedPawn.equipment.Remove(firstEquipment);
⋮----
sb.AppendLine("✓ Cache invalidation on equipment removal");
selectedPawn.equipment.AddEquipment(firstEquipment);
⋮----
sb.AppendLine("✓ Cache refresh on equipment addition");
⋮----
// Test with different pawn
⋮----
var otherPawn = otherPawns.First();
UI.GearTab_ST.Draw(testRect, otherPawn);
sb.AppendLine($"✓ Different pawn test: {otherPawn.NameShortColored}");
⋮----
sb.AppendLine("All caching tests completed successfully!");
⋮----
Messages.Message("Caching test completed", MessageTypeDefOf.TaskCompletion);
</file>

<file path="Source/DebugTools/DebugAction_TestToolAssignment.cs">
// RimWorld 1.6 / C# 7.3
// Source/DebugTools/DebugAction_TestToolAssignment.cs
//
// Debug action to manually test tool assignment system
⋮----
public static class DebugAction_TestToolAssignment
⋮----
public static void TestToolAssignment()
⋮----
Log.Warning("[SurvivalTools.Debug] Testing tool assignment system...");
// Find a colonist
⋮----
Log.Warning("[SurvivalTools.Debug] No colonists found on current map");
⋮----
Log.Warning($"[SurvivalTools.Debug] Testing with colonist: {colonist.LabelShort}");
// Test if AssignmentSearch is accessible
bool result = AssignmentSearch.TryUpgradeFor(
⋮----
Log.Warning($"[SurvivalTools.Debug] AssignmentSearch.TryUpgradeFor returned: {result}");
⋮----
Log.Error($"[SurvivalTools.Debug] Test failed: {ex}");
⋮----
public static void CheckHarmonyPatches()
⋮----
Log.Warning("[SurvivalTools.Debug] Checking Harmony patches...");
⋮----
var patched = HarmonyLib.Harmony.GetAllPatchedMethods().ToList();
Log.Warning($"[SurvivalTools.Debug] Total patched methods in game: {patched.Count}");
// Check for our specific patch
var targetMethod = typeof(Verse.AI.Pawn_JobTracker).GetMethod("TryTakeOrderedJob");
⋮----
Log.Warning("[SurvivalTools.Debug] TryTakeOrderedJob method not found!");
⋮----
var patchInfo = HarmonyLib.Harmony.GetPatchInfo(targetMethod);
⋮----
Log.Warning("[SurvivalTools.Debug] No patches found on TryTakeOrderedJob");
⋮----
Log.Warning($"[SurvivalTools.Debug] TryTakeOrderedJob has {patchInfo.Prefixes.Count} prefixes, {patchInfo.Postfixes.Count} postfixes");
⋮----
Log.Warning($"[SurvivalTools.Debug] Prefix: {prefix.owner} - {prefix.PatchMethod.DeclaringType?.Name}.{prefix.PatchMethod.Name} (Priority: {prefix.priority})");
⋮----
// Check if our patch is there
bool ourPatchFound = patchInfo.Prefixes.Any(p => p.owner == "Jelly.SurvivalToolsReborn" || p.PatchMethod.DeclaringType?.Name == "PreWork_AutoEquip");
Log.Warning($"[SurvivalTools.Debug] Our patch found: {ourPatchFound}");
⋮----
Log.Error($"[SurvivalTools.Debug] Harmony check failed: {ex}");
</file>

<file path="Source/Gating/GatingEnforcer.cs">
// RimWorld 1.6 / C# 7.3
// Source/Gating/GatingEnforcer.cs
//
// Enforces tool gating by canceling now-invalid jobs on mode changes and save loads
// - Cancels current job if blocked in new mode
// - Prunes queued jobs that would be blocked
// - Allocation-free hot loops for performance
// - Throttled to avoid spam
⋮----
public static class GatingEnforcer
⋮----
// Throttle so we don't spam in the same tick
⋮----
public static int EnforceAllRunningJobs(bool fromSettingsChange, string reasonKey = "ST_Gate_ModeChanged")
⋮----
// Iterate maps without LINQ (allocation-free)
⋮----
var pawns = map.mapPawns.FreeColonistsSpawned; // only colonists; skip animals/mechs/guests
⋮----
// Cancel current job if blocked
⋮----
// Prune queued jobs that would be blocked
⋮----
private static int CancelIfBlocked(Pawn pawn, string reasonKey)
⋮----
// Use exact JobGate logic
if (JobGate.ShouldBlock(pawn, null, cur.def, forced: false, out var k, out var a1, out var a2))
⋮----
// End current job; choose a non-spam condition
jobs.EndCurrentJob(JobCondition.Incompletable, startNewJob: true);
⋮----
private static int PruneQueue(Pawn pawn, string reasonKey)
⋮----
// Create a list of jobs to remove (avoid modifying while iterating)
⋮----
if (JobGate.ShouldBlock(pawn, null, item.job.def, forced: false, out var k, out var a1, out var a2))
⋮----
toRemove.Add(item.job);
⋮----
// Remove blocked jobs using the job queue's dequeue method
⋮----
// Find and remove the job from queue
⋮----
// Use reflection-safe removal via list manipulation
⋮----
queueList.RemoveAt(qIdx);
</file>

<file path="Source/Helpers/ToolQuirkApplier.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ToolQuirkApplier.cs
⋮----
/// <summary>
/// Safe, no-alloc utility for applying tool quirks during stat resolution.
/// Provides controlled access to modify tool stats with validation.
/// </summary>
public class ToolQuirkApplier
⋮----
_info = info ?? throw new ArgumentNullException(nameof(info));
⋮----
/// The tool def being processed
⋮----
/// The stuff def (material) being processed
⋮----
/// The stat being resolved
⋮----
/// Current factor value
⋮----
/// Source of the current factor ("Explicit", "StatBases", "NameHint", "Default")
⋮----
/// Multiply the current factor by a value
⋮----
/// <param name="multiplier">Multiplier to apply</param>
/// <param name="tag">Optional tag for tracking</param>
public void MultiplyFactor(float multiplier, string tag = null)
⋮----
if (float.IsNaN(multiplier) || float.IsInfinity(multiplier))
⋮----
if (!string.IsNullOrEmpty(tag))
_info.QuirkTags.Add($"*{multiplier:F2} ({tag})");
⋮----
/// Add a flat value to the current factor
⋮----
/// <param name="bonus">Bonus to add</param>
⋮----
public void AddBonus(float bonus, string tag = null)
⋮----
if (float.IsNaN(bonus) || float.IsInfinity(bonus))
⋮----
_info.QuirkTags.Add($"+{bonus:F2} ({tag})");
⋮----
/// Set the factor to a specific value
⋮----
/// <param name="newFactor">New factor value</param>
⋮----
public void SetFactor(float newFactor, string tag = null)
⋮----
if (float.IsNaN(newFactor) || float.IsInfinity(newFactor))
⋮----
_info.QuirkTags.Add($"={newFactor:F2} ({tag})");
⋮----
/// Apply a factor if a condition is true
⋮----
/// <param name="condition">Condition to check</param>
/// <param name="multiplier">Multiplier to apply if condition is true</param>
⋮----
public void MultiplyIf(bool condition, float multiplier, string tag = null)
⋮----
/// Apply a bonus if a condition is true
⋮----
/// <param name="bonus">Bonus to add if condition is true</param>
⋮----
public void AddIf(bool condition, float bonus, string tag = null)
⋮----
/// Set factor to minimum of current value and ceiling
⋮----
/// <param name="ceiling">Maximum allowed value</param>
⋮----
public void ClampMax(float ceiling, string tag = null)
⋮----
_info.QuirkTags.Add($"max({ceiling:F2}) ({tag})");
⋮----
/// Set factor to maximum of current value and floor
⋮----
/// <param name="floor">Minimum allowed value</param>
⋮----
public void ClampMin(float floor, string tag = null)
⋮----
_info.QuirkTags.Add($"min({floor:F2}) ({tag})");
⋮----
/// Clamp factor to a range
⋮----
/// <param name="min">Minimum value</param>
/// <param name="max">Maximum value</param>
⋮----
public void ClampRange(float min, float max, string tag = null)
⋮----
_info.Factor = Math.Max(min, Math.Min(max, _info.Factor));
if (Math.Abs(_info.Factor - oldFactor) > 0.001f && !string.IsNullOrEmpty(tag))
_info.QuirkTags.Add($"clamp({min:F2}-{max:F2}) ({tag})");
⋮----
/// Check if tool has a specific mod extension
⋮----
/// <typeparam name="T">Mod extension type</typeparam>
/// <returns>True if tool has the extension</returns>
public bool HasModExtension<T>() where T : DefModExtension
⋮----
/// Check if stuff has a specific mod extension
⋮----
/// <returns>True if stuff has the extension</returns>
public bool StuffHasModExtension<T>() where T : DefModExtension
⋮----
/// Check if tool label contains specific text (case-insensitive)
⋮----
/// <param name="text">Text to search for</param>
/// <returns>True if tool label contains the text</returns>
public bool ToolLabelContains(string text)
⋮----
return !string.IsNullOrEmpty(ToolDef?.label) &&
ToolDef.label.IndexOf(text, StringComparison.OrdinalIgnoreCase) >= 0;
⋮----
/// Check if stuff label contains specific text (case-insensitive)
⋮----
/// <returns>True if stuff label contains the text</returns>
public bool StuffLabelContains(string text)
⋮----
return !string.IsNullOrEmpty(StuffDef?.label) &&
StuffDef.label.IndexOf(text, StringComparison.OrdinalIgnoreCase) >= 0;
⋮----
/// Check tech level match
⋮----
/// <param name="techLevel">Tech level to check</param>
/// <returns>True if tool matches tech level</returns>
public bool IsTechLevel(TechLevel techLevel)
⋮----
/// Check if tech level is at least the specified level
⋮----
/// <param name="minTechLevel">Minimum tech level</param>
/// <returns>True if tool tech level is at least the minimum</returns>
public bool IsTechLevelAtLeast(TechLevel minTechLevel)
⋮----
/// Add a developer note without affecting stats (for debugging/tracking)
⋮----
/// <param name="note">Development note to add</param>
public void AddDevNote(string note)
⋮----
if (!string.IsNullOrEmpty(note))
_info.QuirkTags.Add($"[{note}]");
⋮----
/// Get all applied quirk tags for debugging
⋮----
/// <returns>List of quirk modification tags</returns>
internal List<string> GetQuirkTags()
⋮----
/// Get quirk summary for display
⋮----
/// <returns>Formatted string of all quirk modifications</returns>
internal string GetQuirkSummary()
⋮----
return _info.QuirkTags.Count > 0 ? string.Join(", ", _info.QuirkTags) : null;
</file>

<file path=".gitignore">
/.vscode/obj
/*.sln 
/*/RR Compat
# /*/Assemblies
# /*/Assemblies/*.pdb
# /.vscode
# /Source
</file>

<file path="1.6/Defs/ThingDefs/Apparel_Belts.xml">
<Defs>
    <ThingDef ParentName="ApparelMakeableBase">
        <defName>SurvivalTools_ToolBelt</defName>
        <label>tool belt</label>
        <description>A sturdy leather belt that allows the wearer to carry two additional tools.</description>
        <thingClass>Apparel</thingClass>
        <graphicData>
            <texPath>Things/Pawn/Humanlike/Apparel/ToolBelt/ToolBelt</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <comps Inherit="False">
            <li Class="CompProperties_Forbiddable"/>
            <li>
                <compClass>CompColorable</compClass>
            </li>
            <li>
                <compClass>CompQuality</compClass>
            </li>
        </comps>
        <statBases>
            <Mass>0.5</Mass>
            <WorkToMake>2700</WorkToMake>
            <Flammability>1.0</Flammability>
            <EquipDelay>2</EquipDelay>
        </statBases>
        <equippedStatOffsets>
            <SurvivalToolCarryCapacity>2</SurvivalToolCarryCapacity>
        </equippedStatOffsets>
        <costStuffCount>40</costStuffCount>
        <stuffCategories>
            <li>Leathery</li>
        </stuffCategories>
        <costList>
            <Steel>10</Steel>
        </costList>
        <thingCategories>
            <li>Apparel</li>
        </thingCategories>
        <recipeMaker>
            <researchPrerequisite>Smithing</researchPrerequisite>
        </recipeMaker>
        <apparel>
            <careIfWornByCorpse>false</careIfWornByCorpse>
            <bodyPartGroups>
                <li>Waist</li>
            </bodyPartGroups>
            <layers>
                <li>Belt</li>
            </layers>
            <defaultOutfitTags>
                <li>Worker</li>
            </defaultOutfitTags>
        </apparel>
    </ThingDef>
</Defs>
</file>

<file path="1.6/Defs/Tutor/Concepts_NotedOpportunistic.xml">
<Defs>
    <ConceptDef>
        <defName>UsingSurvivalTools</defName>
        <label>Survival Tools: Intelligent Tool Usage</label>
        <priority>50</priority>
        <helpText>The mod features advanced tool management systems that maximize efficiency and productivity:
AUTOMATIC OPTIMIZATION:
• Colonists automatically select the best available tools for each task
• They prioritize equipped tools over inventory tools when multiple options exist
• Tools currently being used are marked as 'in use' to prevent conflicts
SMART FEATURES:
• Pre-work tool pickup: Colonists acquire optimal tools before starting jobs
• Automatic tool swapping: They'll upgrade to better tools when available
• Intelligent inventory management: Excess or inferior tools are dropped as needed
This creates a seamless workflow where colonists always work with the most effective equipment available.</helpText>
        <needsOpportunity>true</needsOpportunity>
    </ConceptDef>
    <ConceptDef>
        <defName>SurvivalToolDegradation</defName>
        <label>Survival Tools: Maintenance and Durability</label>
        <priority>50</priority>
        <helpText>Tools are not permanent and require ongoing maintenance to remain effective:
DEGRADATION MECHANICS:
• Tools wear down with each use, eventually breaking completely
• Degradation rate varies by difficulty mode (up to 87.5% faster in Extra Hardcore)
• Different materials and tool quality affect durability significantly
MANAGEMENT STRATEGIES:
• Check tool condition via info cards to plan replacements
• Maintain backup tools for critical tasks
• Monitor the "Tools need replacing" alert for tools near failure
• Consider material choice when crafting - better materials last longer
The estimated lifespan shown on tool info cards reflects continuous usage but doesn't account for current condition, so damaged tools will break sooner than indicated.</helpText>
        <needsOpportunity>true</needsOpportunity>
    </ConceptDef>
</Defs>
</file>

<file path="1.6/Defs/Tutor/Concepts_NotedSelfshow.xml">
<Defs>
    <ConceptDef>
        <defName>EquippingSurvivalTools</defName>
        <label>Survival Tools: Essential Equipment Management</label>
        <priority>30</priority>
        <helpText>Proper tools are crucial for effective colony operations and survival. Without the right equipment, colonists may work inefficiently or become completely unable to perform critical tasks.
TO EQUIP TOOLS:
• Select a colonist and right-click any tool
• Choose to equip it in their main hand or add to inventory
• Colonists can carry up to 2-3 tools in inventory simultaneously
• Tool belts (crafted at tailoring benches) increase carrying capacity
STRATEGIC CONSIDERATIONS:
• Different tools excel at specific tasks (axes for trees, pickaxes for mining)
• Tool quality and material significantly affect performance
• In Hardcore modes, many tasks become impossible without proper tools
• Plan tool distribution among colonists based on their work assignments</helpText>
    </ConceptDef>
</Defs>
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/StatDef/Stats_Pawn_WorkGeneral.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- Tool Carrying Capacity -->
  <SurvivalToolCarryCapacity.label>工具载量</SurvivalToolCarryCapacity.label>
  <SurvivalToolCarryCapacity.description>殖民者被允许携带工具的数量。如果他们携带的工具超过允许的数量，多余的工具将不被允许装备或拾起。</SurvivalToolCarryCapacity.description>
  <!-- Mining-related -->
  <DiggingSpeed.label>挖掘速度</DiggingSpeed.label>
  <DiggingSpeed.description>殖民者在矿石上挖掘的速度.</DiggingSpeed.description>
  <MiningYieldDigging.label>开采量（挖掘）</MiningYieldDigging.label>
  <MiningYieldDigging.description>矿工开采矿石的百分比.这只适用于矿石的开采,并不影响岩石块的生产速率.</MiningYieldDigging.description>
  <!-- Plant-related -->
  <PlantHarvestingSpeed.label>植物收获速度</PlantHarvestingSpeed.label>
  <PlantHarvestingSpeed.description>殖民者收获植物的速度.</PlantHarvestingSpeed.description>
  <SowingSpeed.label>播种速度</SowingSpeed.label>
  <SowingSpeed.description>殖民者播种和种植作物的速度.</SowingSpeed.description>
  <TreeFellingSpeed.label>伐木速度</TreeFellingSpeed.label>
  <TreeFellingSpeed.description>殖民者砍伐树木的速度.</TreeFellingSpeed.description>
  <!-- Maintenance and repair-related -->
  <MaintenanceSpeed.label>维护速度</MaintenanceSpeed.label>
  <MaintenanceSpeed.description>殖民者对建筑物和设备进行维护和修理的速度.</MaintenanceSpeed.description>
  <DeconstructionSpeed.label>拆除速度</DeconstructionSpeed.label>
  <DeconstructionSpeed.description>殖民者拆除建筑物和设备的速度.</DeconstructionSpeed.description>
  <!-- Research-related -->
  <ResearchSpeed.label>研究速度</ResearchSpeed.label>
  <ResearchSpeed.description>殖民者进行研究和实验的速度.</ResearchSpeed.description>
  <!-- Cleaning-related -->
  <CleaningSpeed.label>清洁速度</CleaningSpeed.label>
  <CleaningSpeed.description>殖民者清理污垢和杂物的速度。任何人都可以清洁，但使用合适的工具会更快.</CleaningSpeed.description>
  <!-- Medical-related -->
  <MedicalOperationSpeed.label>医疗手术速度</MedicalOperationSpeed.label>
  <MedicalOperationSpeed.description>殖民者进行医疗手术的速度.</MedicalOperationSpeed.description>
  <MedicalSurgerySuccessChance.label>医疗手术成功率</MedicalSurgerySuccessChance.label>
  <MedicalSurgerySuccessChance.description>殖民者的医疗手术成功而无并发症的可能性.</MedicalSurgerySuccessChance.description>
  <!-- Butchery-related -->
  <ButcheryFleshSpeed.label>屠宰速度</ButcheryFleshSpeed.label>
  <ButcheryFleshSpeed.description>殖民者屠宰动物和处理肉类的速度.</ButcheryFleshSpeed.description>
  <ButcheryFleshEfficiency.label>屠宰效率</ButcheryFleshEfficiency.label>
  <ButcheryFleshEfficiency.description>殖民者从动物尸体中提取肉类和其他产品的数量.</ButcheryFleshEfficiency.description>
</LanguageData>
</file>

<file path="1.6/Languages/English/DefInjected/JobDef/Jobs_Work.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <FellTree.reportString>felling TargetA.</FellTree.reportString>
    <FellTreeDesignated.reportString>felling TargetA.</FellTreeDesignated.reportString>
    <HarvestTree.reportString>felling TargetA.</HarvestTree.reportString>
    <HarvestTreeDesignated.reportString>felling TargetA.</HarvestTreeDesignated.reportString>
</LanguageData>
</file>

<file path="1.6/Patches/Core/ThingDefs_Items/Cloths_CleaningTool.xml">
<?xml version="1.0" encoding="utf-8"?>
<Patch>
    <!-- Cloth (Basic) - 40% effectiveness -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="Cloth"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.4</CleaningSpeed>
                    <MedicalOperationSpeed>0.4</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.4</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.75</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Synthread (Synthetic) - 55% effectiveness -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="Synthread"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.55</CleaningSpeed>
                    <MedicalOperationSpeed>0.55</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.55</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.5</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Devilstrand Cloth (Premium Natural) - 70% effectiveness -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="DevilstrandCloth"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.7</CleaningSpeed>
                    <MedicalOperationSpeed>0.7</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.7</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.0</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Hyperweave (Ultra-tech) - 85% effectiveness -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="Hyperweave"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.85</CleaningSpeed>
                    <MedicalOperationSpeed>0.85</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.85</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>1.5</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Sheep Wool - 35% -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="WoolSheep"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.35</CleaningSpeed>
                    <MedicalOperationSpeed>0.35</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.35</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>3.5</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Alpaca Wool - 40% -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="WoolAlpaca"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.4</CleaningSpeed>
                    <MedicalOperationSpeed>0.4</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.4</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>3.0</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Megasloth Wool - 60% -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="WoolMegasloth"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.6</CleaningSpeed>
                    <MedicalOperationSpeed>0.6</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.6</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.2</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Muffalo Wool - 45% -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="WoolMuffalo"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.45</CleaningSpeed>
                    <MedicalOperationSpeed>0.45</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.45</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.8</toolWearFactor>
            </li>
        </value>
    </Operation>
    <!-- Bison Wool - 50% -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>/Defs/ThingDef[defName="WoolBison"]</xpath>
        <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.5</CleaningSpeed>
                    <MedicalOperationSpeed>0.5</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>0.5</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                    <li>Doctor</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>2.5</toolWearFactor>
            </li>
        </value>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/WorkGiverDefs/WorkGivers.xml">
<Patch>
    <!-- ===== Mine ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="Mine"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <!-- Ensure our extension exists -->
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Mine"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="Mine"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>DiggingSpeed</li>
                                    <li>MiningYieldDigging</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <!-- Add missing stats if extension already present -->
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Mine"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="DiggingSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="Mine"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>DiggingSpeed</li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Mine"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="MiningYieldDigging"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="Mine"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>MiningYieldDigging</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== All Construction WorkGivers ===== -->
    <Operation Class="PatchOperationSequence">
        <success>Always</success>
        <operations>
            <!-- Add extension everywhere it's missing -->
            <li Class="PatchOperationAddModExtension">
                <xpath>Defs/WorkGiverDef[workType="Construction" and not(modExtensions/li[@Class='SurvivalTools.WorkGiverExtension'])]</xpath>
                <value>
                    <li Class="SurvivalTools.WorkGiverExtension">
                        <requiredStats>
                            <li>ConstructionSpeed</li>
                        </requiredStats>
                    </li>
                </value>
            </li>
            <!-- Append missing stat if extension exists but lacks it -->
            <li Class="PatchOperationAdd">
                <xpath>Defs/WorkGiverDef[workType="Construction"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats[not(li[text()='ConstructionSpeed'])]</xpath>
                <value>
                    <li>ConstructionSpeed</li>
                </value>
            </li>
        </operations>
    </Operation>
    <!-- ===== GrowerHarvest ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="GrowerHarvest"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="GrowerHarvest"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="GrowerHarvest"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>PlantHarvestingSpeed</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="GrowerHarvest"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="PlantHarvestingSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="GrowerHarvest"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>PlantHarvestingSpeed</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== PlantsCut ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="PlantsCut"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="PlantsCut"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="PlantsCut"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>PlantHarvestingSpeed</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="PlantsCut"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="PlantHarvestingSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="PlantsCut"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>PlantHarvestingSpeed</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== GrowerSow ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="GrowerSow"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="GrowerSow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="GrowerSow"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>SowingSpeed</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="GrowerSow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="SowingSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="GrowerSow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>SowingSpeed</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== Research ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="Research"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Research"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="Research"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>ResearchSpeed</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Research"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="ResearchSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="Research"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>ResearchSpeed</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== Cleaning ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="CleanFilth" or defName="CleanClearSnow"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="CleanFilth" or defName="CleanClearSnow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="CleanFilth" or defName="CleanClearSnow"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>CleaningSpeed</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="CleanFilth" or defName="CleanClearSnow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="CleaningSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="CleanFilth" or defName="CleanClearSnow"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>CleaningSpeed</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== Butchery ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>ButcheryFleshSpeed</li>
                                    <li>ButcheryFleshEfficiency</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="ButcheryFleshSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>ButcheryFleshSpeed</li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="ButcheryFleshEfficiency"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsButcherFlesh"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>ButcheryFleshEfficiency</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== Medical Operations ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>MedicalOperationSpeed</li>
                                    <li>MedicalSurgerySuccessChance</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="MedicalOperationSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>MedicalOperationSpeed</li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="MedicalSurgerySuccessChance"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="DoBillsMedicalHumanOperation" or defName="DoBillsMedicalAnimalOperation"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>MedicalSurgerySuccessChance</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- ===== Medical Tending (Doctor work type) ===== -->
    <Operation Class="PatchOperationSequence">
        <success>Always</success>
        <operations>
            <!-- Add extension everywhere it's missing for Doctor workType -->
            <li Class="PatchOperationAddModExtension">
                <xpath>Defs/WorkGiverDef[workType="Doctor" and not(modExtensions/li[@Class='SurvivalTools.WorkGiverExtension'])]</xpath>
                <value>
                    <li Class="SurvivalTools.WorkGiverExtension">
                        <requiredStats>
                            <li>MedicalOperationSpeed</li>
                            <li>MedicalSurgerySuccessChance</li>
                        </requiredStats>
                    </li>
                </value>
            </li>
            <!-- Append missing stats if extension exists but lacks them -->
            <li Class="PatchOperationAdd">
                <xpath>Defs/WorkGiverDef[workType="Doctor"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats[not(li[text()='MedicalOperationSpeed'])]</xpath>
                <value>
                    <li>MedicalOperationSpeed</li>
                </value>
            </li>
            <li Class="PatchOperationAdd">
                <xpath>Defs/WorkGiverDef[workType="Doctor"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats[not(li[text()='MedicalSurgerySuccessChance'])]</xpath>
                <value>
                    <li>MedicalSurgerySuccessChance</li>
                </value>
            </li>
        </operations>
    </Operation>
    <!-- ===== Animal Slaughter ===== -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/WorkGiverDef[defName="Slaughter"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Slaughter"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]</xpath>
                    <nomatch Class="PatchOperationAddModExtension">
                        <xpath>Defs/WorkGiverDef[defName="Slaughter"]</xpath>
                        <value>
                            <li Class="SurvivalTools.WorkGiverExtension">
                                <requiredStats>
                                    <li>ButcheryFleshSpeed</li>
                                    <li>ButcheryFleshEfficiency</li>
                                </requiredStats>
                            </li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Slaughter"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="ButcheryFleshSpeed"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="Slaughter"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>ButcheryFleshSpeed</li>
                        </value>
                    </nomatch>
                </li>
                <li Class="PatchOperationConditional">
                    <xpath>Defs/WorkGiverDef[defName="Slaughter"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats/li[text()="ButcheryFleshEfficiency"]</xpath>
                    <nomatch Class="PatchOperationAdd">
                        <xpath>Defs/WorkGiverDef[defName="Slaughter"]/modExtensions/li[@Class="SurvivalTools.WorkGiverExtension"]/requiredStats</xpath>
                        <value>
                            <li>ButcheryFleshEfficiency</li>
                        </value>
                    </nomatch>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/RimBees/Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Alpha Bees</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- RB_Beeswax -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="RB_Beeswax"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="RB_Beeswax"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.3</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.3</PlantHarvestingSpeed>
                  <DiggingSpeed>0.4</DiggingSpeed>
                  <MiningYieldDigging>0.7</MiningYieldDigging>
                  <ConstructionSpeed>0.4</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.6</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- RB_Brittlewax -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="RB_Brittlewax"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="RB_Brittlewax"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.25</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.25</PlantHarvestingSpeed>
                  <DiggingSpeed>0.3</DiggingSpeed>
                  <MiningYieldDigging>0.6</MiningYieldDigging>
                  <ConstructionSpeed>0.3</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.7</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- RB_RedBeeswax -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="RB_RedBeeswax"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="RB_RedBeeswax"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.4</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.4</PlantHarvestingSpeed>
                  <DiggingSpeed>0.5</DiggingSpeed>
                  <MiningYieldDigging>0.8</MiningYieldDigging>
                  <ConstructionSpeed>0.5</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.5</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- RB_WhiteBeeswax -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="RB_WhiteBeeswax"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="RB_WhiteBeeswax"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.35</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.35</PlantHarvestingSpeed>
                  <DiggingSpeed>0.45</DiggingSpeed>
                  <MiningYieldDigging>0.75</MiningYieldDigging>
                  <ConstructionSpeed>0.45</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.55</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
        <!-- RB_BlackBeeswax -->
        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="RB_BlackBeeswax"]/modExtensions/li[@Class="SurvivalTools.StuffPropsTool"]</xpath>
          <nomatch Class="PatchOperationAddModExtension">
            <xpath>Defs/ThingDef[defName="RB_BlackBeeswax"]</xpath>
            <value>
              <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                  <TreeFellingSpeed>0.3</TreeFellingSpeed>
                  <PlantHarvestingSpeed>0.3</PlantHarvestingSpeed>
                  <DiggingSpeed>0.4</DiggingSpeed>
                  <MiningYieldDigging>0.7</MiningYieldDigging>
                  <ConstructionSpeed>0.4</ConstructionSpeed>
                </toolStatFactors>
                <wearFactorMultiplier>1.6</wearFactorMultiplier>
              </li>
            </value>
          </nomatch>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="docs/summary.md">
# Survival Tools Reborn — Session Summary (Refactor branch)

Date: 2025-09-22

## Overview

This session focused on stabilizing and refining the Harmony "brain" for Survival Tools Reborn: deterministic tool upgrades before work, gating by difficulty, preserving original jobs, and reducing churn/log noise. We fixed edge cases (notably a queued-start NullReference and construction rescues for unassigned pawns), tightened gating rules, and centralized/resilient logging.

## Problems Observed

- Rescue/upgrade triggered for a pawn not assigned to a work type (e.g., Patton rescuing a hammer while Construction priority was 0).
- Occasional NullReferenceException when starting a queued acquisition job (equip/take-inventory).
- Log spam:
  - Repeated focus-block entries.
  - Large, verbose job queue dumps.
  - Duplicated acquisition/drop entries.
- Ping-pong with carry limit 1: just-acquired tools being dropped immediately.
- Risk of losing the original job when auto-equipping before work.
- Build warnings:
  - Obsolete API usage in `JobGate` (CompatAPI forwarder).
  - Unused field in `PreWork_AutoEquip`.

## What We Tried (and what didn’t work)

- Gating only for disabled work types: prevented some rescues, but still allowed rescues for unassigned (priority 0) work types.
- Starting acquisition jobs directly from the queue without cloning: could lead to race conditions and a rare NullReference when list mutated.
- Printing full job queues every time: useful for debugging, but produced excessive noise with long queues.
- Threshold-only rescue logic: without a short “focus” window, cross-stat upgrades could thrash.

## Final Solutions Implemented

### 1) Skip rescue/gating for unassigned work

- Tighten early-out in `JobGate.ShouldBlock` to skip rescue and gating when:
  - Work type is disabled for the pawn, OR
  - Work type is not active (`WorkIsActive` is false), AND
  - The action isn’t forced.
- Mirror the same guard in `PreWork_AutoEquip` WorkGiver prefix to avoid opportunistic rescues.
- Result: No more construction rescues for pawns unassigned to Construction.

Files:

- `Source/Gating/JobGate.cs`
- `Source/Assign/PreWork_AutoEquip.cs`

### 2) Preserve original jobs across auto-equip

- Pre-work hooks requeue the original job at the front when an upgrade is queued, then block the start so equip jobs run first.
- Applied to both ordered (`TryTakeOrderedJob`) and AI (`StartJob`) paths; skips tool-management jobs to avoid loops.

Files:

- `Source/Assign/PreWork_AutoEquip.cs`

### 3) Harden queued-start helper (NullReference fix)

- Snapshot matching queued jobs before starting one, guard `targetA` access, and purge duplicates after a job starts.
- Applies to both acquisition (`Equip`/`TakeInventory`) and drop jobs (`DropSurvivalTool`/`DropEquipment`).

Files:

- `Source/Assign/AssignmentSearch.cs` (method: `TryStartQueuedToolJobFor`)

### 4) Reduce log spam and make diagnostics useful

- Focus-block logging now on cooldown per pawn+stat key.
- Job queue dumps capped to a max of 20 entries with a “+N more” suffix.
- Added queued-job dedupe checks before enqueue; remove duplicates after start.

Files:

- `Source/Assign/AssignmentSearch.cs`
- `Source/Helpers/ST_Logging.cs` (cooldowns/dedup already in place and used)

### 5) Avoid ping-pong at carry-limit 1

- Added a short “recent acquisition” protection window to prevent immediate drops of the just-acquired tool.
- When carry-limit is effectively 1, drop the worst tool while protecting the best-for-focus stat tool (`FindWorstCarriedToolRespectingFocus`).

Files:

- `Source/Assign/AssignmentSearch.cs`

### 6) Deterministic, LINQ-light tool search and scoring

- Deterministic scoring order with pooled buffers (`_candidateBuffer`, `_inventoryBuffer`, `_stockpileBuffer`).
- Hysteresis window to require extra gain for re-upgrading the same tool.
- Short focus window per stat to avoid cross-stat thrashing.

Files:

- `Source/Assign/AssignmentSearch.cs`
- `Source/Scoring/*` (pre-existing APIs used)

### 7) Centralize WorkGiver → stat mapping and remove obsolete API warning

- Switched `JobGate` to use `StatGatingHelper.GetStatsForWorkGiver(wg)` instead of the obsolete `CompatAPI` forwarder.
- Updated debug message to reflect resolver usage.

Files:

- `Source/Gating/JobGate.cs`
- `Source/Helpers/StatGatingHelper.cs` (mapping logic)

### 8) Clean up build warnings

- Removed unused `_patchApplied` field from `PreWork_AutoEquip`.
- Eliminated obsolete API usage warning in `JobGate`.

Files:

- `Source/Assign/PreWork_AutoEquip.cs`
- `Source/Gating/JobGate.cs`

## Notable Behavior Changes

- Gating/rescue won’t trigger for disabled or unassigned work types unless the user forces the job.
- Player orders are preserved: if an upgrade is needed, the original job is put back at the front of the queue.
- Reduced log noise while keeping actionable, cooldowned diagnostics.

## Example Log Improvements (from Patton scenario)

- Before: Patton (Construction priority 0) repeatedly attempted to grab a hammer while mining.
- After: Log now shows a single cooldowned line such as:
  - `[JobGate] Skipping gate/rescue for disabled or inactive work type Construction on Patton`
  - No construction-tool rescues are queued unless the job is forced.

## Quality gates

- Build: PASS (Debug), warnings addressed.
- Packaging: DLL mirrored to Mods path, ZIP generated.
- Runtime smoke: Log lines reflect skip behavior for inactive work types; no observed NRE from queued-start.

## Files touched (high-level)

- `Source/Assign/AssignmentSearch.cs` — focus/hysteresis, dedupe, queued-start hardening, carry-limit handling, logging caps/cooldowns.
- `Source/Assign/PreWork_AutoEquip.cs` — ordered/AI job preservation, WG skip for inactive/disabled, selective logging.
- `Source/Gating/JobGate.cs` — skip inactive/disabled, use resolver mapping, rescue-first allow-job behavior.
- `Source/Helpers/StatGatingHelper.cs` — WG→stat mapping used by JobGate.
- `Source/Helpers/ST_Logging.cs` — leveraged cooldown/dedup; no functional changes required this session.

## Follow-ups

- Field validation under larger mod stacks to catch rare edge cases.
- Consider demoting some PreWork initialization messages from Warning to Debug to reduce baseline noise.
- Evaluate removing/locking down `CompatAPI` forwarders after refactor stabilizes.

---

This summary captures the intent, attempts, and concrete fixes from this session to improve determinism, preserve jobs, avoid inappropriate rescues, and keep logs readable while retaining visibility into the upgrade pipeline.
</file>

<file path="README.md">
# Survival Tools Reborn

A comprehensive survival tools mod for RimWorld that adds essential equipment to enhance colonist efficiency across all work types.

## Overview

Survival Tools introduces a progression-based tool system with 18 different tools spanning from primitive bone implements to advanced glitterworld technology. Each tool provides meaningful bonuses to specific work types while maintaining game balance through research requirements and material costs.

## Tool Categories

### 🗿 Primitive Tier (Stonecutting Research)

**Basic survival tools for early colonies**

- **Axe** - Essential for tree felling and forestry work
- **Pickaxe** - Improves mining speed and yield
- **Hammer** - Boosts construction speed
- **Sickle** - Enhances plant harvesting efficiency
- **Hoe** - Increases sowing speed for farming
- **Knife** - Basic tool for butchery and medical work
- **Hand Saw** - Manual lumber processing and construction
- **Bone Sickle** - Primitive harvesting tool (lower durability)
- **Pry Bar** - Basic leverage tool for maintenance/deconstruction
- **Abacus** - Ancient calculating device for research

### 🔧 Industrial Tier (Smithing Research)

**Advanced steel tools for established colonies**

- **Steel Knife** - Superior butchery and medical tool
- **Crosscut Saw** - Industrial-grade construction and lumber processing

### ⚙️ Precision Tier (Machining Research)

**High-tech tools for advanced operations**

- **Wrench** - Precision mechanical maintenance tool
- **Carbide Pickaxe** - Advanced mining with superior durability
- **Precision Scalpel** - Expert medical instrument
- **Power Drill** - Mechanized construction and drilling
- **Microscope** - Advanced research instrument

### 🌟 Spacer Tier (Advanced Fabrication Research)

**Glitterworld technology for ultimate efficiency**

- **Glitterworld Multitool** - Universal tool for all work types

## Key Features

### 🎯 **Balanced Progression System**

- Tools unlock through research progression
- Material costs scale with tool effectiveness
- Higher-tier tools offer better performance but require advanced resources

### 🛠️ **Flexible Crafting**

- Most tools can be made from multiple material types (wood, stone, metal)
- Recipe flexibility ensures compatibility with different map types
- Quality system affects tool effectiveness

### 🔄 **Tool Assignment System**

- Automatic tool optimization for colonists
- Manual assignment options for precise control
- Tools integrate seamlessly with vanilla work priorities

### 🌍 **Full Localization Support**

- Complete translations for multiple languages
- Consistent terminology across all game elements

## Installation

1. Subscribe to the mod on Steam Workshop
2. Ensure Harmony is installed (required dependency)
3. Add to your mod list and enjoy enhanced colony efficiency

## Compatibility

- **RimWorld Version**: 1.6+
- **Required Mods**: Harmony
- **Compatible with most mods** including Combat Extended, VGP, and popular overhauls
- Extensive patch system for material and recipe compatibility

## Development Status

- ✅ Core tool system complete
- ✅ Research progression implemented
- ✅ Localization complete
- ⏳ Commissioned artwork in progress (placeholder textures currently)
- ⏳ Additional tool varieties under consideration

## Contributing

Found a bug or have suggestions? Please report issues on the Steam Workshop page or GitHub repository.

---

_Transform your colony's efficiency with the right tools for every job!_
</file>

<file path="Source/Alerts/Alert_ToolGatedWork.cs">
// RimWorld 1.6 / C# 7.3
// Source/Alerts/Alert_ToolGatedWork.cs
//
// Lightweight, non-spam alert for tool gating feedback
// - Updates every 600 ticks, only in Hardcore/Nightmare with alert enabled
// - Shows pawns blocked from work due to missing tools
// - Throttles per-pawn repetition (3000 ticks)
// - Allocation-free hot loops, pooled lists
// - Uses exact JobGate.ShouldBlock logic for accuracy
⋮----
namespace SurvivalTools
⋮----
public sealed class Alert_ToolGatedWork : Alert
⋮----
private const int UpdateIntervalTicks = 600; // Update rarely
private const int PawnThrottleTicks = 3000; // Don't repeat same pawn too often
private const int MaxPawnsToShow = 10; // Keep explanation short
// Representative WorkGiverDefs for checking (avoid scanning all)
private static WorkGiverDef _miningWG;
private static WorkGiverDef _constructWG;
private static WorkGiverDef _plantCutWG;
private static WorkGiverDef _plantHarvestWG;
⋮----
// Cache representative WorkGivers for performance
_miningWG = DefDatabase<WorkGiverDef>.GetNamedSilentFail("Mine");
_constructWG = DefDatabase<WorkGiverDef>.GetNamedSilentFail("ConstructDeliverResourcesToBlueprints")
?? DefDatabase<WorkGiverDef>.GetNamedSilentFail("ConstructFinishFrames");
_plantCutWG = DefDatabase<WorkGiverDef>.GetNamedSilentFail("CutPlants")
?? DefDatabase<WorkGiverDef>.GetNamedSilentFail("PlantsCut");
_plantHarvestWG = DefDatabase<WorkGiverDef>.GetNamedSilentFail("PlantHarvest")
?? DefDatabase<WorkGiverDef>.GetNamedSilentFail("GrowerHarvest");
⋮----
public override AlertReport GetReport()
⋮----
// Only show in Hardcore/Nightmare with alert enabled
⋮----
// Update gated pawns list periodically
⋮----
public override string GetLabel()
⋮----
return "ST_Alert_ToolGating_Label".Translate();
⋮----
public override TaggedString GetExplanation()
⋮----
var sb = new StringBuilder(256);
⋮----
sb.AppendLine($"{issue.pawn.LabelShort}: {issue.workType} ({issue.reason})");
⋮----
sb.AppendLine($"… {"ST_Alert_ToolGating_AndMore".Translate(remaining)}");
⋮----
return sb.ToString().TrimEnd();
⋮----
private void UpdateGatedPawns(int currentTick)
⋮----
_gatedPawns.Clear();
⋮----
// Check colonists for tool gating issues (no LINQ in hot loop)
⋮----
if (pawn == null || pawn.Dead || pawn.Downed || !pawn.Awake()) continue;
⋮----
// Throttle per-pawn repetition
if (_lastShownTick.TryGetValue(pawn, out int lastShown))
⋮----
// Check work types with available work
⋮----
private void CheckPawnForGatedWork(Pawn pawn, Map map, int currentTick)
⋮----
// Check Mining (if any mine designations exist)
if (_miningWG != null && pawn.workSettings != null && pawn.workSettings.GetPriority(WorkTypeDefOf.Mining) > 0)
⋮----
if (HasMiningWork(map) && IsBlockedForWork(pawn, _miningWG, "ST_Alert_WorkType_Mining".Translate()))
⋮----
return; // One issue per pawn per update
⋮----
// Check Construction (if any blueprints/frames exist)
if (_constructWG != null && pawn.workSettings != null && pawn.workSettings.GetPriority(WorkTypeDefOf.Construction) > 0)
⋮----
if (HasConstructionWork(map) && IsBlockedForWork(pawn, _constructWG, "ST_Alert_WorkType_Construction".Translate()))
⋮----
// Check Plant Cutting (if any cut designations exist)
if (_plantCutWG != null && pawn.workSettings != null && pawn.workSettings.GetPriority(WorkTypeDefOf.PlantCutting) > 0)
⋮----
if (HasPlantCuttingWork(map) && IsBlockedForWork(pawn, _plantCutWG, "ST_Alert_WorkType_PlantCutting".Translate()))
⋮----
// Check Plant Harvesting (if any harvest designations exist)
if (_plantHarvestWG != null && pawn.workSettings != null && pawn.workSettings.GetPriority(WorkTypeDefOf.PlantCutting) > 0)
⋮----
if (HasPlantHarvestWork(map) && IsBlockedForWork(pawn, _plantHarvestWG, "ST_Alert_WorkType_PlantHarvest".Translate()))
⋮----
private bool IsBlockedForWork(Pawn pawn, WorkGiverDef workGiver, string workTypeLabel)
⋮----
// Use exact JobGate.ShouldBlock logic
if (JobGate.ShouldBlock(pawn, workGiver, null, false, out var key, out var a1, out var a2))
⋮----
string reason = key.Translate(a1, a2);
_gatedPawns.Add(new PawnGatingIssue
⋮----
private static bool HasMiningWork(Map map)
⋮----
// Check for mine designations (no LINQ)
⋮----
private static bool HasConstructionWork(Map map)
⋮----
// Check for construction frames or blueprints
⋮----
private static bool HasPlantCuttingWork(Map map)
⋮----
// Check for plant cut designations (no LINQ)
⋮----
private static bool HasPlantHarvestWork(Map map)
⋮----
// Check for plant harvest designations (no LINQ)
⋮----
public Pawn pawn;
</file>

<file path="Source/Compatibility/PrimitiveTools/PTDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/PrimitiveTools/PTDebug.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// Minimal debug helpers for PrimitiveTools compatibility.
public static class PrimitiveToolsDebug
⋮----
public static void LogStatus()
⋮----
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.IsCompatLogging())
⋮----
ST_Logging.LogCompatMessage($"PrimitiveTools active={PrimitiveToolsHelpers.IsPrimitiveToolsActive()}");
</file>

<file path="Source/Compatibility/PrimitiveTools/PTHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/PrimitiveTools/PrimitiveToolsHelpers.cs
// Canonical helpers file for Primitive Tools compatibility (renamed from PrimitiveToolsCompat.cs)
// The canonical public class name is `PrimitiveToolsHelpers`.
⋮----
public static class PrimitiveToolsHelpers
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// Known/fallback defNames (kept from your original)
⋮----
// Package ID fingerprints (normalized)
⋮----
"vby.primitivetools",        // canonical-ish
"primitivetools",            // generic substring
"virusbombay.primitivetools" // safety alias if mod renames
⋮----
public static void ResetCaches()
⋮----
public static bool IsPrimitiveToolsActive()
⋮----
// 1) Identifier-based probe (fast path)
⋮----
// Prefer ModLister API when available; fall back to ModsConfig enumeration
// Guarded in try/catch for cross-version safety.
⋮----
var pid = (m.PackageId ?? string.Empty).ToLowerInvariant();
var name = (m.Name ?? string.Empty).ToLowerInvariant();
if (PackageIdHints.Any(h => pid.Contains(h)) ||
name.Contains("primitive tools"))
⋮----
catch { /* swallow */ }
// 2) Content verification: any ThingDef from the suspected pack?
⋮----
var anyFromPack = DefDatabase<ThingDef>.AllDefsListForReading.Any(d =>
⋮----
return PackageIdHints.Any(h => pkg.Contains(h)) ||
⋮----
// 3) Final verification: at least one known def exists (super cheap and stable)
bool hasKnownDef = KnownPrimitiveToolDefNames.Any(n => DefDatabase<ThingDef>.GetNamedSilentFail(n) != null);
⋮----
if (ST_Logging.IsCompatLogging() && ST_Logging.IsDebugLoggingEnabled)
ST_Logging.LogCompatMessage($"[PT-Compat] Active={_isActive} (foundMod={foundMod}, content={contentMatches}, knownDef={hasKnownDef})");
⋮----
Log.Error($"[SurvivalTools PT-Compat] Exception during detection: {ex}");
⋮----
public static List<ThingDef> GetPrimitiveToolDefs()
⋮----
if (_primitiveToolDefs != null) return _primitiveToolDefs.ToList();
⋮----
return _primitiveToolDefs.ToList();
⋮----
// A) Dynamic discovery by content pack + tool identity
⋮----
bool fromPT = PackageIdHints.Any(h => pkg.Contains(h)) ||
⋮----
// Treat as a PT survival tool if:
//  - Has SurvivalToolProperties extension, OR
//  - thingClass is SurvivalTool (or subclass).
⋮----
(def.thingClass != null && typeof(SurvivalTool).IsAssignableFrom(def.thingClass));
⋮----
_primitiveToolDefs.Add(def);
⋮----
// B) Fallback: include explicitly-known defs
⋮----
var d = DefDatabase<ThingDef>.GetNamedSilentFail(name);
if (d != null) _primitiveToolDefs.Add(d);
⋮----
ST_Logging.LogCompatMessage($"[PT-Compat] Discovered {_primitiveToolDefs.Count} primitive tool defs");
⋮----
Log.Error($"[SurvivalTools PT-Compat] Exception while gathering defs: {ex}");
⋮----
public static bool IsPrimitiveTool(ThingDef def)
⋮----
// Lazy hydrate outside lock (safe enough), then re-check under lock if still null.
⋮----
if (set != null && set.Contains(def)) return true;
// One-shot heuristic if cache missed (no allocation)
⋮----
bool clsOk = def.thingClass != null && typeof(SurvivalTool).IsAssignableFrom(def.thingClass);
⋮----
public static bool IsPrimitiveTool(Thing thing) => thing?.def != null && IsPrimitiveTool(thing.def);
⋮----
public static bool PawnHasPrimitiveTools(Pawn pawn)
⋮----
// Equipped
⋮----
// Inventory
⋮----
Log.Error($"[SurvivalTools PT-Compat] Exception checking pawn tools: {ex}");
⋮----
public static List<Thing> GetPawnPrimitiveTools(Pawn pawn)
⋮----
if (eq != null && IsPrimitiveTool(eq)) result.Add(eq);
⋮----
if (IsPrimitiveTool(t)) result.Add(t);
⋮----
Log.Error($"[SurvivalTools PT-Compat] Exception collecting pawn tools: {ex}");
⋮----
public static bool ShouldOptimizeForPrimitiveTools()
⋮----
/// <summary>
/// Get stat defs that Primitive Tools contribute to.
/// Returns only valid StatDefs (null-safe).
/// </summary>
public static List<StatDef> GetPrimitiveToolStats()
⋮----
if (def != null) stats.Add(def);
⋮----
// Custom ST defs
⋮----
// Vanilla defs
⋮----
public static List<string> CheckForConflicts()
⋮----
var isSTClass = d.thingClass != null && typeof(SurvivalTool).IsAssignableFrom(d.thingClass);
⋮----
conflicts.Add($"{d.defName} missing SurvivalToolProperties and not a SurvivalTool thingClass");
⋮----
conflicts.Add($"{d.defName} has SurvivalToolProperties but no baseWorkStatFactors");
⋮----
Log.Error($"[SurvivalTools PT-Compat] Exception in conflict check: {ex}");
conflicts.Add($"Exception during conflict check: {ex.Message}");
</file>

<file path="Source/Compatibility/PrimitiveTools/PTPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/PrimitiveTools/PTPatches.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// Placeholder for future Harmony patches targeting Primitive Tools integration.
// Kept minimal so the file exists for documentation and extension.
⋮----
public static class PrimitiveToolsPatches
⋮----
// Intentionally empty; patches will be added when required.
</file>

<file path="Source/Compatibility/ResearchReinvented/RRDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/ResearchReinvented/RRDebug.cs
⋮----
public static class RRDebug
⋮----
public static void DumpResearchReinventedPatches_DebugAction() => DumpResearchReinventedPatches();
⋮----
public static void DumpResearchReinventedPatches()
⋮----
Verse.Log.Message("[SurvivalTools] ResearchReinventedPatchLogger: starting debug dump...");
var patchedMethods = Harmony.GetAllPatchedMethods()?.ToList();
⋮----
Verse.Log.Message("[SurvivalTools] DumpRR: no patched methods found at all.");
Verse.Log.Message("[SurvivalTools] ResearchReinventedPatchLogger: debug dump complete.");
⋮----
var info = Harmony.GetPatchInfo(method);
⋮----
if (IsLikelyRRPatch(p)) rrPatches.Add((p, "PREFIX"));
⋮----
if (IsLikelyRRPatch(p)) rrPatches.Add((p, "POSTFIX"));
⋮----
if (IsLikelyRRPatch(p)) rrPatches.Add((p, "TRANSPILER"));
⋮----
Verse.Log.Message($"[SurvivalTools] DumpRRHeur: target -> {FormatMethodFullDescription(method)}");
⋮----
Verse.Log.Message($"   {kind}: {patchDesc} (owner={patch.owner}, priority={patch.priority}, index={patch.index})");
⋮----
Verse.Log.Message("[SurvivalTools] DumpRRHeur: No Research Reinvented patches found (owner/name filters).");
⋮----
Verse.Log.Message($"[SurvivalTools] DumpRRHeur: found {targetsFound} target(s) with RR-like patches.");
⋮----
Verse.Log.Error($"[SurvivalTools] DumpRR: failed to enumerate patches: {e}");
⋮----
private static bool IsLikelyRRPatch(HarmonyLib.Patch p)
⋮----
if (!string.IsNullOrEmpty(p.owner))
⋮----
if (owner.IndexOf("researchreinvented", StringComparison.OrdinalIgnoreCase) >= 0) return true;
if (owner.IndexOf("petetimesix", StringComparison.OrdinalIgnoreCase) >= 0) return true;
⋮----
if (asmName.IndexOf("researchreinvented", StringComparison.OrdinalIgnoreCase) >= 0) return true;
⋮----
if (fullName.IndexOf("ResearchReinvented", StringComparison.OrdinalIgnoreCase) >= 0) return true;
if (fullName.IndexOf("PeteTimesSix", StringComparison.OrdinalIgnoreCase) >= 0) return true;
⋮----
public static string FormatMethodFullDescription(MethodBase mb)
⋮----
var parameters = mi.GetParameters();
var paramStr = string.Join(", ", parameters.Select(p => $"{p.ParameterType.Name} {p.Name}"));
⋮----
var parameters = ci.GetParameters();
⋮----
catch { return mb.ToString(); }
</file>

<file path="Source/Compatibility/ResearchReinvented/RRHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/ResearchReinvented/RRHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
public static class RRHelpers
⋮----
// ---- detection cache ------------------------------------------------
⋮----
bool byPkg = ModLister.GetActiveModWithIdentifier("PeteTimesSix.ResearchReinvented", true) != null;
bool byType = AccessTools.TypeByName("PeteTimesSix.ResearchReinvented.Utilities.PawnExtensions") != null;
⋮----
// ---- reflection targets --------------------------------------------
private static Type _pawnExtensionsType;
private static MethodInfo _miCanEverDoResearch;
private static MethodInfo _miCanNowDoResearch;
private static bool TryResolve()
⋮----
_pawnExtensionsType = AccessTools.TypeByName("PeteTimesSix.ResearchReinvented.Utilities.PawnExtensions");
⋮----
_miCanEverDoResearch = AccessTools.Method(_pawnExtensionsType, "CanEverDoResearch", new[] { typeof(Pawn) });
_miCanNowDoResearch = AccessTools.Method(_pawnExtensionsType, "CanNowDoResearch", new[] { typeof(Pawn) });
⋮----
public static void Initialize()
⋮----
var h = new Harmony("SurvivalTools.Compat.ResearchReinvented");
⋮----
Log.Message("[SurvivalTools Compat] RRHelpers.Initialize() completed.");
⋮----
Log.Warning($"[SurvivalTools Compat] RRHelpers.Initialize() failed: {e}");
⋮----
public static Dictionary<string, string> GetReflectionStatus()
⋮----
["IsActive"] = IsRRActive.ToString(),
⋮----
["HasCanEver"] = (_miCanEverDoResearch != null).ToString(),
["HasCanNow"] = (_miCanNowDoResearch != null).ToString()
⋮----
public static void ApplyHarmonyHooks(Harmony h)
⋮----
Log.Warning("[SurvivalTools Compat] RR types/methods not found; skipping RR patches.");
⋮----
var postfix = new HarmonyMethod(typeof(RRPostfixes), nameof(RRPostfixes.CanEverDoResearch_Postfix));
h.Patch(_miCanEverDoResearch, postfix: postfix);
⋮----
var postfix = new HarmonyMethod(typeof(RRPostfixes), nameof(RRPostfixes.CanNowDoResearch_Postfix));
h.Patch(_miCanNowDoResearch, postfix: postfix);
⋮----
// ---- runtime adapters ------------------------------------------------
public static class Runtime
⋮----
public static bool PawnHasResearchTools(Pawn p) => CompatAPI.PawnHasResearchTools(p);
public static List<StatDef> RequiredResearchStatsFor(WorkGiverDef wgd, Job jobOrNull)
⋮----
return SurvivalToolUtility.RelevantStatsFor(wgd, jobOrNull);
return SurvivalToolUtility.RelevantStatsFor(wgd, (JobDef)null);
⋮----
// ---- helper queries used by patches ---------------------------------
public static WorkGiverDef ResolveWorkGiverForJob(Job job)
=> job?.def != null ? JobDefToWorkGiverDefHelper.GetWorkGiverDefForJob(job.def) : null;
public static WorkGiverDef ResolveWorkGiverForJob(JobDef jobDef)
=> JobDefToWorkGiverDefHelper.GetWorkGiverDefForJob(jobDef);
public static List<StatDef> GetRequiredStatsForWorkGiver(WorkGiverDef wgd, Job job = null)
⋮----
if (job != null) return SurvivalToolUtility.RelevantStatsFor(wgd, job);
⋮----
public static bool IsRRWorkGiver(WorkGiverDef wgd)
⋮----
string defName = wgd.defName.ToLower();
return defName.Contains("research") && !defName.Contains("field");
⋮----
public static bool IsFieldResearchWorkGiver(WorkGiverDef wgd)
⋮----
return defName.Contains("fieldresearch") || defName.Contains("survey");
⋮----
public static bool RequiresResearchTools(WorkGiverDef wgDef)
⋮----
if (ext == null || ext.requiredStats.NullOrEmpty()) return false;
var researchStat = CompatAPI.GetResearchSpeedStat() ?? ST_StatDefOf.ResearchSpeed;
if (researchStat != null && ext.requiredStats.Contains(researchStat)) return true;
var fieldStat = CompatAPI.GetFieldResearchSpeedStat() ??
DefDatabase<StatDef>.GetNamedSilentFail("FieldResearchSpeedMultiplier");
if (fieldStat != null && ext.requiredStats.Contains(fieldStat)) return true;
⋮----
// ---- RR settings bridge ---------------------------------------------
public static class Settings
⋮----
public static bool IsRRStatRequiredInExtraHardcore(StatDef stat)
⋮----
if (stat == CompatAPI.GetResearchSpeedStat()) return TreatResearchAsRequiredInExtraHardcore;
if (stat == CompatAPI.GetFieldResearchSpeedStat()) return TreatFieldResearchAsRequiredInExtraHardcore;
⋮----
public static bool IsRRStatOptional(StatDef stat)
⋮----
return stat == CompatAPI.GetResearchSpeedStat() || stat == CompatAPI.GetFieldResearchSpeedStat();
⋮----
// ---- AutoTool helpers (thin, cached by defName) ----------------------
⋮----
public static List<StatDef> GetRequiredStatsForWorkGiverCached(WorkGiverDef wgd, Job jobOrNull)
⋮----
if (_requiredStatsCache.TryGetValue(key, out var cached)) return cached;
⋮----
public static void ClearCachesOnDefsChanged()
⋮----
_requiredStatsCache.Clear();
⋮----
// ---- postfixes ------------------------------------------------------
internal static class RRPostfixes
⋮----
// Use the deduplicated tool-gate logger to avoid spamming ResearchReinvented's frequent checks.
// Keyed by pawn+job/stat, the logger immediately emits the first denial and suppresses repeats for
// a short window, then prints a summary when suppressed counts exist.
public static void CanEverDoResearch_Postfix(Pawn __0, ref bool __result)
⋮----
if (!CompatAPI.PawnHasResearchTools(__0) && ShouldRRReturnFalseWhenNoTool())
⋮----
// Use ResearchSpeed stat where available
var stat = CompatAPI.GetResearchSpeedStat() ?? ST_StatDefOf.ResearchSpeed;
ST_Logging.LogToolGateEvent(__0, null, stat, "missing research tool (RR CanEverDoResearch)");
⋮----
public static void CanNowDoResearch_Postfix(Pawn __0, ref bool __result)
⋮----
ST_Logging.LogToolGateEvent(__0, null, stat, "missing research tool (RR CanNowDoResearch)");
⋮----
internal static bool ShouldRRReturnFalseWhenNoTool() => SurvivalTools.Settings?.extraHardcoreMode == true;
</file>

<file path="Source/Compatibility/ResearchReinvented/RRPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/ResearchReinvented/RRPatches.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
internal static class RRPatches
⋮----
private static readonly Harmony harmony;
⋮----
harmony = new Harmony(HARMONY_ID);
⋮----
// Patch RR pawn extension methods (postfixes are applied by RRHelpers.Initialize which calls ApplyHarmonyHooks)
RRHelpers.Initialize();
// Patch base WorkGiver_Scanner methods to gate jobs early when hardcore enforcement is active
⋮----
var miThing = AccessTools.Method(baseType, "HasJobOnThing");
⋮----
harmony.Patch(miThing,
prefix: new HarmonyMethod(typeof(RRPatches), nameof(Prefix_WorkGiverScanner_HasJobOnThing)) { priority = Priority.First });
⋮----
var miCell = AccessTools.Method(baseType, "HasJobOnCell");
⋮----
harmony.Patch(miCell,
prefix: new HarmonyMethod(typeof(RRPatches), nameof(Prefix_WorkGiverScanner_HasJobOnCell)) { priority = Priority.First });
⋮----
// Patch recipe toils so research/crafting progress respects tool tiers (defensive)
var toilsType = AccessTools.TypeByName("Toils_Recipe");
⋮----
var doWork = AccessTools.Method(toilsType, "DoRecipeWork");
⋮----
harmony.Patch(doWork, prefix: new HarmonyMethod(typeof(RRPatches), nameof(Prefix_Toils_Recipe_DoRecipeWork)));
⋮----
var makeUnfinished = AccessTools.Method(toilsType, "MakeUnfinishedThingIfNeeded");
⋮----
harmony.Patch(makeUnfinished, prefix: new HarmonyMethod(typeof(RRPatches), nameof(Prefix_Toils_Recipe_MakeUnfinishedThingIfNeeded)));
⋮----
Log.Error($"[SurvivalTools Compat] RR gating patch init failed: {e}");
⋮----
private static bool Prefix_WorkGiverScanner_HasJobOnThing(WorkGiver_Scanner __instance, Pawn pawn, Thing t, ref bool __result)
⋮----
private static bool Prefix_WorkGiverScanner_HasJobOnCell(WorkGiver_Scanner __instance, Pawn pawn, IntVec3 c, ref bool __result)
⋮----
private static bool CheckWorkGiverGate(WorkGiverDef wgDef, Pawn pawn, ref bool __result, string context)
⋮----
if (!RRHelpers.RequiresResearchTools(wgDef)) return true;
if (!CompatAPI.PawnHasResearchTools(pawn))
⋮----
// Defensive prefix for Toils_Recipe.DoRecipeWork – adjust or block progress when research tools are required
private static bool Prefix_Toils_Recipe_DoRecipeWork(object __instance, JobDriver __state)
⋮----
// Attempt to locate the pawn performing the toil
Pawn pawn = null;
try { pawn = (Pawn)AccessTools.Field(__instance.GetType(), "actor").GetValue(__instance); } catch { }
⋮----
// Resolve the job/workgiver context
Job job = pawn.CurJob;
var wgd = RRHelpers.ResolveWorkGiverForJob(job);
// Required stats for RR-sensitive workgivers
var required = RRHelpers.GetRequiredStatsForWorkGiverCached(wgd, job);
⋮----
// If in extra-hardcore RR mode and pawn lacks research tools, block
⋮----
if (RRHelpers.Settings.IsRRStatRequiredInExtraHardcore(st) && !CompatAPI.PawnHasResearchTools(pawn))
⋮----
return false; // skip original toil
⋮----
// Otherwise allow original and let StatPart_SurvivalTool / WorkSpeedGlobal adjust speed
⋮----
// Defensive prefix for Toils_Recipe.MakeUnfinishedThingIfNeeded – block creation of unfinished items if research tools are missing under extra-hardcore
private static bool Prefix_Toils_Recipe_MakeUnfinishedThingIfNeeded(object __instance)
</file>

<file path="Source/Compatibility/SeparateTreeChopping/STCDebug.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SeparateTreeChopping/STCDebug.cs
⋮----
public static class SeparateTreeChoppingDebug
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
public static void LogStatus()
⋮----
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.IsCompatLogging())
ST_Logging.LogCompatMessage($"SeparateTreeChopping active={SeparateTreeChoppingHelpers.IsSeparateTreeChoppingActive()}");
</file>

<file path="Source/Compatibility/SeparateTreeChopping/STCHelpers.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SeparateTreeChopping/STCHelpers.cs
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
⋮----
/// <summary>
/// Compatibility module for Separate Tree Chopping (Continued) mod.
/// Handles conflict detection, resolution strategies, and feature coordination.
/// </summary>
public static class SeparateTreeChoppingHelpers
⋮----
/// Check if Separate Tree Chopping (Continued) mod is currently active.
⋮----
public static bool IsSeparateTreeChoppingActive()
⋮----
bool hasSeparateTreeMod = activeMods.Any(mod =>
⋮----
string name = (mod?.Name ?? string.Empty).ToLowerInvariant();
string id = (mod?.PackageId ?? string.Empty).ToLowerInvariant();
return name.Contains("separate tree chopping") ||
name.Contains("separatetreechopping") ||
id.Contains("separatetreechopping") ||
id.Contains("treechopping");
⋮----
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.IsCompatLogging())
ST_Logging.LogCompatMessage($"Separate Tree Chopping detection: {_isSeparateTreeChoppingActive}");
⋮----
ST_Logging.LogCompatError($"Exception during Separate Tree Chopping detection: {ex}");
⋮----
/// Check if there are conflicts between SurvivalTools tree felling and Separate Tree Chopping.
⋮----
public static bool HasTreeFellingConflict()
⋮----
/// Get recommended resolution strategy for tree felling conflicts.
⋮----
public static TreeFellingConflictResolution GetRecommendedResolution()
⋮----
/// Apply the recommended conflict resolution automatically.
⋮----
public static bool ApplyRecommendedResolution()
⋮----
ST_Logging.LogCompatMessage("Auto-disabled SurvivalTools tree felling due to Separate Tree Chopping conflict");
⋮----
/// Describe current conflict state in plain text.
⋮----
private static string DescribeConflict()
⋮----
/// Check for all potential conflicts and return detailed information.
⋮----
public static List<string> CheckForConflicts()
⋮----
conflicts.Add("Both SurvivalTools and Separate Tree Chopping handle tree felling  may cause duplicate jobs");
var fellTreesWorkGiver = DefDatabase<WorkGiverDef>.GetNamedSilentFail("ST_FellTrees");
⋮----
conflicts.Add("SurvivalTools FellTrees WorkGiver may overlap with Separate Tree Chopping");
⋮----
ST_Logging.LogCompatError($"Exception checking Separate Tree Chopping conflicts: {ex}");
conflicts.Add($"Exception during conflict check: {ex.Message}");
⋮----
public static bool ShouldAutoDisableSTTreeFelling()
⋮----
public static string GetTreeFellingDisabledMessage()
⋮----
public static List<string> GetUserRecommendations()
⋮----
recs.Add("Separate Tree Chopping detected.");
⋮----
recs.Add("Recommendation: Disable 'Enable Tree Felling System' in SurvivalTools settings.");
recs.Add("This allows Separate Tree Chopping to handle tree cutting without conflicts.");
recs.Add("SurvivalTools tools (axes etc.) still give stat bonuses.");
⋮----
recs.Add("No tree felling conflicts detected. Both mods should work together smoothly.");
⋮----
/// Conflict resolution strategies for tree felling systems.
⋮----
DisableSeparateTreeChopping, // Not recommended
UserChoice // Let user decide manually
</file>

<file path="Source/Compatibility/SeparateTreeChopping/STCPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/SeparateTreeChopping/STCPatches.cs
⋮----
public static class SeparateTreeChoppingPatches
⋮----
// Placeholder for future Harmony integrations.
</file>

<file path="Source/DebugTools/DebugAction_AssignmentSystem.cs">
// RimWorld 1.6 / C# 7.3
// Source/DebugTools/DebugAction_AssignmentSystem.cs
//
// Phase 6: Debug tools for assignment system testing
// - Preview assignment decisions for selected pawns
// - Performance benchmarking for AssignmentSearch
// - Tool analysis and gating diagnostics
⋮----
public static class DebugAction_AssignmentSystem
⋮----
/// <summary>
/// Preview assignment decisions for the selected pawn.
/// Shows what tools would be assigned for various work stats.
/// </summary>
⋮----
public static void PreviewAssignments()
⋮----
Messages.Message("Select a pawn first", MessageTypeDefOf.RejectInput);
⋮----
Messages.Message("Assignment system is disabled in settings", MessageTypeDefOf.RejectInput);
⋮----
report.Add($"Assignment Preview for {selectedPawn.LabelShort}:");
report.Add("");
⋮----
var currentTool = ToolScoring.GetBestTool(selectedPawn, workStat, out float currentScore);
float baseline = SurvivalToolUtility.GetNoToolBaseline(workStat);
report.Add($"--- {workStat.label} ---");
report.Add($"Current tool: {currentTool?.LabelShort ?? "none"}");
report.Add($"Current score: {currentScore:F3} (baseline: {baseline:F3})");
⋮----
report.Add($"Gated: {(isGated ? "YES" : "no")}");
// Test assignment search
⋮----
bool wouldAssign = AssignmentSearch.TryUpgradeFor(selectedPawn, workStat, minGainPct, searchRadius, pathCostBudget, AssignmentSearch.QueuePriority.Append);
report.Add($"Would assign: {(wouldAssign ? "YES" : "no")}");
⋮----
// Get updated score after assignment
var newTool = ToolScoring.GetBestTool(selectedPawn, workStat, out float newScore);
⋮----
float gainPct = (newScore - currentScore) / Math.Max(currentScore, 0.001f);
report.Add($"Assigned tool: {newTool?.LabelShort ?? "none"}");
report.Add($"New score: {newScore:F3} (+{gainPct:P1})");
⋮----
report.Add($"ERROR testing {workStat.label}: {ex.Message}");
⋮----
Find.WindowStack.Add(new Dialog_MessageBox(string.Join("\n", report)));
⋮----
/// Run performance benchmark on AssignmentSearch.TryUpgradeFor.
/// Tests 100 iterations to ensure zero GC allocation requirement.
⋮----
public static void BenchmarkAssignmentSearch()
⋮----
// Test with common work stat
⋮----
Messages.Message("No valid work stat found for testing", MessageTypeDefOf.RejectInput);
⋮----
report.Add($"Assignment Search Benchmark - {iterations} iterations");
report.Add($"Pawn: {selectedPawn.LabelShort}");
report.Add($"Work Stat: {workStat.label}");
⋮----
// Warm up
⋮----
AssignmentSearch.TryUpgradeFor(selectedPawn, workStat, settings.assignMinGainPct,
⋮----
// Measure GC before
GC.Collect();
GC.WaitForPendingFinalizers();
⋮----
long gcBefore = GC.GetTotalMemory(false);
// Benchmark
var stopwatch = Stopwatch.StartNew();
⋮----
if (AssignmentSearch.TryUpgradeFor(selectedPawn, workStat, settings.assignMinGainPct,
⋮----
stopwatch.Stop();
// Measure GC after
long gcAfter = GC.GetTotalMemory(false);
⋮----
// Results
⋮----
report.Add($"Total time: {stopwatch.Elapsed.TotalMilliseconds:F2}ms");
report.Add($"Average per call: {avgMs:F3}ms");
report.Add($"Successful assignments: {successCount}/{iterations}");
report.Add($"GC allocated: {gcAllocated} bytes");
⋮----
report.Add("⚠️ WARNING: High GC allocation detected!");
report.Add("Phase 6 requirement: Zero allocation in hot path");
⋮----
report.Add("✅ GC allocation within acceptable range");
⋮----
/// Show detailed tool analysis for a pawn and work stat.
/// Displays scoring breakdown and available alternatives.
⋮----
public static void AnalyzeToolScoring()
⋮----
// Get primary work stat for analysis
⋮----
Messages.Message("No valid work stat found for analysis", MessageTypeDefOf.RejectInput);
⋮----
report.Add($"Tool Scoring Analysis");
⋮----
// Current best tool
⋮----
report.Add("=== CURRENT BEST TOOL ===");
report.Add($"Tool: {currentTool?.LabelShort ?? "none"}");
report.Add($"Score: {currentScore:F3}");
report.Add($"Baseline: {baseline:F3}");
report.Add($"Improvement: {((currentScore - baseline) / baseline):P1}");
⋮----
// Available tools analysis
report.Add("=== AVAILABLE TOOLS ===");
var availableTools = selectedPawn.GetAllUsableSurvivalTools().ToList();
if (availableTools.Any())
⋮----
float score = ToolScoring.Score(tool, selectedPawn, workStat);
⋮----
toolScores.Sort((a, b) => b.score.CompareTo(a.score));
foreach (var (tool, score) in toolScores.Take(5))
⋮----
report.Add($"{tool.LabelShort}: {score:F3}{improvement}{isCurrent}");
⋮----
report.Add("No tools available");
⋮----
// Tool contributors breakdown
⋮----
report.Add("=== SCORE CONTRIBUTORS ===");
var contributors = ToolScoring.TopContributors(currentTool, selectedPawn, workStat, 3);
⋮----
report.Add($"{contributorTool.LabelShort}: +{contribution:F3}");
⋮----
report.Add($"ERROR: {ex.Message}");
⋮----
/// Test assignment system integration with different settings.
/// Validates that settings changes affect assignment behavior correctly.
⋮----
public static void TestAssignmentSettings()
⋮----
Messages.Message("Settings not available", MessageTypeDefOf.RejectInput);
⋮----
report.Add("Assignment Settings Test");
⋮----
report.Add("=== CURRENT SETTINGS ===");
report.Add($"Enabled: {settings.enableAssignments}");
report.Add($"Min Gain %: {settings.assignMinGainPct:P1}");
report.Add($"Search Radius: {settings.assignSearchRadius}");
report.Add($"Path Cost Budget: {settings.assignPathCostBudget}");
report.Add($"Rescue on Gate: {settings.assignRescueOnGate}");
⋮----
report.Add("=== DIFFICULTY SCALING ===");
report.Add($"Current Mode: {settings.CurrentMode}");
// Calculate scaled values
⋮----
report.Add($"Scaled Min Gain %: {minGainPct:P1}");
report.Add($"Scaled Search Radius: {searchRadius}");
report.Add($"Scaled Path Cost Budget: {pathCostBudget}");
</file>

<file path="Source/DefOfs/ST_ConceptDefOf.cs">
//Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_ConceptDefOf.cs
⋮----
/// <summary>
/// ConceptDefs used by SurvivalTools.
/// Initialized automatically by RimWorld's DefOf system.
/// </summary>
⋮----
public static class ST_ConceptDefOf
⋮----
/// <summary>Concept tutorial shown when pawns first use survival tools.</summary>
public static ConceptDef UsingSurvivalTools;
/// <summary>Concept tutorial explaining tool degradation mechanics.</summary>
public static ConceptDef SurvivalToolDegradation;
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_ConceptDefOf));
</file>

<file path="Source/DefOfs/ST_JobDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_JobDefOf.cs
⋮----
/// <summary>
/// JobDefs used by SurvivalTools.
/// Initialized automatically by RimWorld's DefOf system.
/// </summary>
⋮----
public static class ST_JobDefOf
⋮----
/// <summary>Job: Fell a tree using survival tools (non-designated).</summary>
public static JobDef FellTree;
/// <summary>Job: Fell a tree that has been explicitly designated.</summary>
public static JobDef FellTreeDesignated;
/// <summary>Job: Harvest usable wood from a tree (non-designated).</summary>
public static JobDef HarvestTree;
/// <summary>Job: Harvest usable wood from a designated tree.</summary>
public static JobDef HarvestTreeDesignated;
/// <summary>Job: Drop a carried survival tool.</summary>
public static JobDef DropSurvivalTool;
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_JobDefOf));
</file>

<file path="Source/DefOfs/ST_RecipeDefOf.cs">
// RimWorld 1.6 / C# 7.3
// Source/DefOfs/ST_RecipeDefOf.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// RecipeDefs used by SurvivalTools.
/// Initialized automatically by RimWorld's DefOf system.
/// </summary>
⋮----
public static class ST_RecipeDefOf
⋮----
/// <summary>Recipe: Smelt survival tool into raw materials.</summary>
public static RecipeDef SmeltSurvivalTool;
/// <summary>Recipe: Destroy survival tool (no material return).</summary>
public static RecipeDef DestroySurvivalTool;
/// <summary>Recipe: Smelt weapon into raw materials.</summary>
public static RecipeDef SmeltWeapon;
/// <summary>Recipe: Destroy weapon (no material return).</summary>
public static RecipeDef DestroyWeapon;
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_RecipeDefOf));
</file>

<file path="Source/DefOfs/ST_StatCategoryDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_StatCategoryDefOf.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Stat categories used by SurvivalTools.
/// These group survival tool stats into logical sections in the UI.
/// </summary>
⋮----
public static class ST_StatCategoryDefOf
⋮----
/// General survival tool stats (e.g. efficiency, wear).
⋮----
public static StatCategoryDef SurvivalTool;
⋮----
/// Material-based survival tool stats (e.g. durability, modifiers).
⋮----
public static StatCategoryDef SurvivalToolMaterial;
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_StatCategoryDefOf));
</file>

<file path="Source/DefOfs/ST_ThingCategoryDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_ThingCategoryDefOf.cs
⋮----
namespace SurvivalTools
⋮----
public static class ST_ThingCategoryDefOf
⋮----
// -------------------------------
// Custom SurvivalTools categories
⋮----
public static ThingCategoryDef SurvivalTools;           // root category
public static ThingCategoryDef SurvivalToolsNeolithic;  // primitive / early tech
public static ThingCategoryDef SurvivalToolsIndustrial; // industrial tier
public static ThingCategoryDef SurvivalToolsSpacer;     // spacer / advanced tier
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_ThingCategoryDefOf));
</file>

<file path="Source/DefOfs/ST_ThingDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_ThingDefOf.cs
⋮----
namespace SurvivalTools
⋮----
public static class ST_ThingDefOf
⋮----
// -------------------------------
// Custom SurvivalTools ThingDefs
⋮----
public static ThingDef SurvivalTools_Multitool; // advanced spacer-tier survival tool
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_ThingDefOf));
</file>

<file path="Source/DefOfs/ST_ThingSetMakerDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_ThingSetMakerDefOf.cs
⋮----
namespace SurvivalTools
⋮----
public static class ST_ThingSetMakerDefOf
⋮----
// -------------------------------
// Custom SurvivalTools ThingSetMakers
⋮----
public static ThingSetMakerDef MapGen_AncientRuinsSurvivalTools;
// Custom: spawns survival tools as part of ancient ruins map generation
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_ThingSetMakerDefOf));
</file>

<file path="Source/DefOfs/ST_WorkGiverDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_WorkGiverDefOf.cs
⋮----
namespace SurvivalTools
⋮----
public static class ST_WorkGiverDefOf
⋮----
// -------------------------------
// Custom SurvivalTools WorkGivers
⋮----
public static WorkGiverDef FellTrees;
// Custom: SurvivalTools WorkGiver for tree felling jobs
// (conflicts with Separate Tree Chopping if both enabled, handled by compat layer)
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_WorkGiverDefOf));
</file>

<file path="Source/Game/ST_GameComponent.cs">
// RimWorld 1.6 / C# 7.3
// Source/Game/ST_GameComponent.cs
// WorldComponent_DelayedValidation.cs needs merged into this. All the Game Components can be one file. This should be where they all live.
// TODO: Merge WorldComponent_DelayedValidation.cs into this file and delete WorldComponent_DelayedValidation.cs
// TODO: Rename this file to ST_GameComponents.cs
// TODO: Rename class to ST_GameComponents
// TODO: Add other game components here as needed and remove their separate files
//
// Game component for enforcing tool gating on save loads
// - Schedules enforcement after map/pawn initialization
// - Runs once per save load with delay to allow proper initialization
// - Lightweight and allocation-free
⋮----
namespace SurvivalTools
⋮----
public sealed class ST_GameComponent : GameComponent
⋮----
public override void StartedNewGame()
⋮----
public override void LoadedGame()
⋮----
public override void GameComponentTick()
⋮----
Gating.GatingEnforcer.EnforceAllRunningJobs(false);
⋮----
Log.Warning($"[SurvivalTools] Gating enforcer failed on save load: {ex.Message}");
⋮----
private void Schedule()
⋮----
// Give maps/pawns time to spawn properly
⋮----
enforceAtTick = now + 90; // ~1.5 seconds
</file>

<file path="Source/Harmony/HarmonyPatches_CacheInvalidation.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/HarmonyPatches_CacheInvalidation.cs
// From Refactor Phase 4: KEEP
// Phase 4: Cache invalidation hooks for inventory and equipment changes.
// Provides minimal, safe hooks to maintain ScoreCache freshness.
⋮----
/// <summary>
/// Phase 4: Minimal cache invalidation patches for ScoreCache freshness.
/// Uses guarded patches to handle signature changes gracefully.
/// </summary>
⋮----
internal static class HarmonyPatches_CacheInvalidation
⋮----
/// Invalidate cache when pawn inventory changes (item removed)
/// Note: Pawn_InventoryTracker only has Notify_ItemRemoved, not Notify_ItemAdded
⋮----
internal static void Postfix_InventoryRemoved(Pawn_InventoryTracker __instance)
⋮----
ScoreCache.NotifyInventoryChanged(__instance.pawn);
⋮----
// Guarded patch: if signature differs, no-op
⋮----
/// Invalidate cache when pawn equipment changes (item added)
⋮----
internal static void Postfix_EquipmentAdded(Pawn_EquipmentTracker __instance)
⋮----
/// Invalidate cache when pawn equipment changes (item removed)
⋮----
internal static void Postfix_EquipmentRemoved(Pawn_EquipmentTracker __instance)
⋮----
/// Primary safety net: catch ThingOwner changes that affect pawn inventories/equipment
/// This covers both additions and removals for all pawn containers
⋮----
internal static void Postfix_ThingOwnerAdded(ThingOwner __instance, Thing item)
⋮----
// Check if this ThingOwner belongs to a pawn's inventory or equipment
⋮----
ScoreCache.NotifyInventoryChanged(inventoryTracker.pawn);
⋮----
ScoreCache.NotifyInventoryChanged(equipmentTracker.pawn);
⋮----
internal static void Postfix_ThingOwnerRemoved(ThingOwner __instance, Thing item)
</file>

<file path="Source/Harmony/WorkGiver_Gates.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/WorkGiver_Gates.cs
// Phase 5: Authoritative WorkGiver-level gating via Harmony patches.
// Centralizes gating logic, eliminates scattered job checks, and provides clear failure reasons.
// Refactor code, KEEP.
⋮----
static class WorkGiver_Gates
⋮----
static readonly Harmony H = new Harmony("jellypowered.survivaltools.gating");
⋮----
// Postfix JobOnThing/JobOnCell (authoritative)
⋮----
// Optional early-out Prefix on HasJob*
⋮----
// Invalidate caches when resolver bumps/settings change
Compat.CompatAPI.OnAfterDefsLoaded(() => JobGate.ClearCaches());
⋮----
static void TryPatchPostfix(System.Type t, string name, System.Type[] sig, string postfix)
⋮----
var m = AccessTools.Method(t, name, sig);
⋮----
H.Patch(m, postfix: new HarmonyMethod(typeof(WorkGiver_Gates), postfix));
⋮----
// Guard: if signature differs, skip patch (Normal mode still works)
⋮----
static void TryPatchPrefix(System.Type t, string name, System.Type[] sig, string prefix)
⋮----
H.Patch(m, prefix: new HarmonyMethod(typeof(WorkGiver_Gates), prefix));
⋮----
// Postfix: if we created a job but gating says block in Hardcore/Nightmare, null it and add a reason
static void Post_JobOnThing(WorkGiver_Scanner __instance, Pawn pawn, Thing t, bool forced, ref Job __result)
⋮----
if (JobGate.ShouldBlock(pawn, __instance.def, __result.def, forced, out var key, out var a1, out var a2))
⋮----
JobFailReason.Is(key.Translate(a1, a2), null);
⋮----
static void Post_JobOnCell(WorkGiver_Scanner __instance, Pawn pawn, IntVec3 c, bool forced, ref Job __result)
⋮----
// Prefix early-out for perf; we can only pass WG here (no JobDef yet)
static bool Pre_HasJobOnThing(WorkGiver_Scanner __instance, Pawn pawn, Thing t, bool forced, ref bool __result)
⋮----
if (JobGate.ShouldBlock(pawn, __instance.def, null, forced, out var key, out var a1, out var a2))
⋮----
static bool Pre_HasJobOnCell(WorkGiver_Scanner __instance, Pawn pawn, IntVec3 c, bool forced, ref bool __result)
⋮----
// -------------------------------------------------------------------------
// Strangler Pattern Kill List (Phase 5):
// - Remove now: (no deletes yet; comments only)
// - Any reflection-based fallback gating (e.g., old Patch_Pawn_JobTracker_ExtraHardcore)
// - Duplicated "missing tool" checks in individual JobDrivers
// - Per-job blocking logic outside the WorkGiver_Scanner patches
//
// Rationale:
// - These patches provide authoritative blocking at the WorkGiver level
// - Eliminates need for reflection-based job interception
// - Centralized gating logic with clear failure reasons
</file>

<file path="Source/Helpers/ScoreCache.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ScoreCache.cs
// Refactor Code Phase 3: KEEP
// Phase 3: Fast tool scoring cache with struct keys and invalidation hooks.
// Provides deterministic, zero-allocation caching for ToolScoring APIs.
⋮----
/// <summary>
/// Phase 3: Fast tool scoring cache with struct keys and automatic invalidation.
/// Uses IEquatable struct keys for zero string allocations and efficient lookups.
/// </summary>
internal static class ScoreCache
⋮----
// Fast struct-based cache key (no string concatenation)
⋮----
public bool Equals(CacheKey other)
⋮----
public override bool Equals(object obj)
⋮----
public override int GetHashCode()
⋮----
// Pooled value holder to avoid boxing floats
⋮----
// Main cache with struct keys for performance
⋮----
// Cache statistics
⋮----
// Current resolver version for automatic invalidation
⋮----
/// Try to get cached score for tool/pawn/stat combination.
/// Uses struct keys for zero allocation lookups.
⋮----
public static bool TryGet(Pawn pawn, Thing tool, StatDef stat, out float score)
⋮----
// Auto-invalidate if resolver version changed
⋮----
_scoreCache.Clear();
⋮----
var key = new CacheKey(pawn, tool, stat, 0, currentVersion);
if (_scoreCache.TryGetValue(key, out var cached))
⋮----
// Update access time for LRU cleanup
_scoreCache[key] = new CacheValue(cached.Score, _accessCounter);
⋮----
/// Cache a computed score with current resolver version.
/// Uses struct keys for efficient storage.
⋮----
public static void Set(Pawn pawn, Thing tool, StatDef stat, float score)
⋮----
_scoreCache[key] = new CacheValue(score, _accessCounter);
// Periodic cleanup to prevent unbounded growth
⋮----
/// Notify cache that pawn's inventory changed (invalidate pawn's entries).
/// Scaffolding hook for future gameplay integration.
⋮----
public static void NotifyInventoryChanged(Pawn pawn)
⋮----
// For Phase 3, just clear entire cache to be safe
// Future optimization: only clear entries for this pawn
⋮----
/// Notify cache that tool's properties changed (invalidate tool's entries).
⋮----
public static void NotifyToolChanged(Thing tool)
⋮----
// Future optimization: only clear entries for this tool
⋮----
/// Notify cache that mod settings changed (full invalidation).
⋮----
public static void NotifySettingsChanged()
⋮----
/// Notify cache that resolver version was bumped (auto-handled).
/// Scaffolding hook for debugging and monitoring.
⋮----
public static void NotifyResolverBumped(int newVersion)
⋮----
// Cache automatically invalidates on version mismatch
// This method is for monitoring/debugging only
⋮----
/// Clear all cached scores and reset statistics.
⋮----
public static void ClearCache()
⋮----
/// Get cache statistics for debugging and monitoring.
⋮----
public static (int entryCount, int hits, int misses, int resolverVersion) GetCacheStats()
⋮----
/// Remove old cache entries to prevent unbounded growth.
/// Keeps the most recently accessed entries.
⋮----
private static void CleanupOldEntries()
⋮----
// Find cutoff access time (keep most recent half)
⋮----
accessTimes.Add(value.LastAccess);
⋮----
accessTimes.Sort();
⋮----
// Remove entries older than cutoff
⋮----
keysToRemove.Add(kvp.Key);
⋮----
_scoreCache.Remove(key);
</file>

<file path="Source/Helpers/ST_FileIO.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ST_FileIO.cs
// Refactor Code: KEEP
// Purpose: Helper methods for file I/O operations.
⋮----
namespace SurvivalTools
⋮----
internal static class ST_FileIO
⋮----
internal static string DesktopPath()
⋮----
var p = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);
if (!string.IsNullOrEmpty(p)) return p;
⋮----
catch { /* ignore */ }
// Fallbacks for platforms without a Desktop
⋮----
internal static string WriteUtf8Atomic(string fileName, string content)
⋮----
try { Directory.CreateDirectory(dir); } catch { }
var path = Path.Combine(dir, fileName);
⋮----
File.WriteAllText(tmp, content, new UTF8Encoding(encoderShouldEmitUTF8Identifier: false));
try { if (File.Exists(path)) File.Delete(path); } catch { }
File.Move(tmp, path);
</file>

<file path="Source/Helpers/ToolGateMoteHelper.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ToolGateMoteHelper.cs
// TODO: Remove this file and all references to it if motes are not desired in the mod.
//       (Settings.showDenialMotes = false is sufficient to disable all mote spawning.)
//
// Provides unified, rate-limited spawning of denial / slowdown motes for tool-gated work.
// Edge considerations:
//  - Per pawn+stat cooldown (default 3s) to avoid spam when WorkGiver queries repeat.
//  - Skips if settings.showDenialMotes == false.
//  - Avoids duplicating existing Cleaning/WorkSpeedGlobal penalty motes (caller should skip those or pass skipCleaningAndGlobal=true).
//  - Builds text using translation keys + stat category description for player clarity.
//  - Normal mode slowdown: show slowed factor; hardcore block: show blocked message.
//  - Combined message (Needs + Slowed) available for future hybrid cases.
⋮----
namespace SurvivalTools
⋮----
public static class ToolGateMoteHelper
⋮----
public bool Equals(Key other) => PawnId == other.PawnId && StatId == other.StatId;
public override bool Equals(object obj) => obj is Key k && Equals(k);
public override int GetHashCode() => (PawnId * 397) ^ StatId;
⋮----
private const int CooldownTicks = 1800; // 30 seconds at 60 TPS
private static bool CanShow(Pawn pawn, StatDef stat)
⋮----
var key = new Key(pawn.thingIDNumber, stat.index);
⋮----
if (_lastShownTick.TryGetValue(key, out float last) && (curTick - last) < CooldownTicks)
⋮----
private static string GetCategoryLabel(StatDef stat)
⋮----
return SurvivalToolUtility.GetStatCategoryDescription(stat) ?? stat?.label ?? stat?.defName ?? "?";
⋮----
public static void TryShowBlockedMote(Pawn pawn, StatDef stat)
⋮----
string text = "SurvivalTools_Mote_Blocked".Translate(cat);
MoteMaker.ThrowText(pawn.DrawPos, pawn.Map, text, 3.5f);
⋮----
public static void TryShowSlowedMote(Pawn pawn, StatDef stat, float factor)
⋮----
string text = "SurvivalTools_Mote_Slowed".Translate(factor.ToString("F2"));
⋮----
public static void TryShowNeedsAndSlowedMote(Pawn pawn, StatDef stat, float factor)
⋮----
string text = "SurvivalTools_Mote_NeedsAndSlowed".Translate(cat, factor.ToString("F2"));
</file>

<file path="Source/ModCompatibilityCheck.cs">
// RimWorld 1.6 / C# 7.3
// Source/ModCompatibilityCheck.cs
⋮----
namespace SurvivalTools
⋮----
public static class ModCompatibilityCheck
⋮----
// Cache the active list once
private static readonly List<ModMetaData> Active = ModsConfig.ActiveModsInLoadOrder.ToList();
private static bool Has(string nameOrId)
⋮----
if (string.IsNullOrEmpty(nameOrId)) return false;
return Active.Any(m =>
string.Equals(m.PackageId, nameOrId, StringComparison.OrdinalIgnoreCase) ||
string.Equals(m.PackageIdNonUnique, nameOrId, StringComparison.OrdinalIgnoreCase) ||
string.Equals(m.Name, nameOrId, StringComparison.OrdinalIgnoreCase));
⋮----
private static bool HasAny(params string[] namesOrIds) =>
namesOrIds != null && namesOrIds.Any(Has);
// Known package IDs (best-effort; keep names as fallbacks)
⋮----
// Useful aggregate
</file>

<file path="Source/Scoring/ToolScoring.cs">
// RimWorld 1.6 / C# 7.3
// Source/Scoring/ToolScoring.cs
// Refactor for Phase 3 Keep this code/functionality.
// Phase 3: Deterministic tool scoring system using ToolStatResolver.
// Provides unified scoring APIs with zero allocations in hot path and
// consistent results for cache-friendly performance.
⋮----
/// <summary>
/// Phase 3: Centralized tool scoring system using ToolStatResolver only.
/// Replaces scattered legacy scoring logic with deterministic, cache-friendly APIs.
/// </summary>
public static class ToolScoring
⋮----
// Constants for scoring behavior (match current legacy behavior)
private const float MultiStatBonusPerExtra = 0.05f; // Extra 5% per additional stat improved
private const float ConditionMinimum = 0.5f; // Minimum condition factor (50%)
private const float DistancePenaltyPerTile = 0.01f; // Map search distance penalty
// Pooled temporary arrays to avoid allocations in hot path
⋮----
// Quality curve for tool scaling (matches SurvivalToolUtility.ToolQualityCurve)
private static readonly SimpleCurve QualityCurve = new SimpleCurve
⋮----
new CurvePoint(0f, 0.7f), // Awful
new CurvePoint(1f, 0.85f), // Poor
new CurvePoint(2f, 1f), // Normal
new CurvePoint(3f, 1.15f), // Good
new CurvePoint(4f, 1.3f), // Excellent
new CurvePoint(5f, 1.45f), // Masterwork
new CurvePoint(6f, 1.6f) // Legendary
⋮----
/// Score a tool for a specific work stat and pawn.
/// Uses ToolStatResolver exclusively for consistent, cache-friendly results.
/// Zero allocations in hot path.
⋮----
/// <param name="tool">Tool to score (Thing with tool properties)</param>
/// <param name="pawn">Pawn who would use the tool</param>
/// <param name="workStat">Work stat to score for</param>
/// <returns>Tool score (higher = better), 0 if tool doesn't improve stat</returns>
public static float Score(Thing tool, Pawn pawn, StatDef workStat)
⋮----
// Try cache first
if (ScoreCache.TryGet(pawn, tool, workStat, out float cachedScore))
⋮----
// Calculate score
⋮----
// Cache result
ScoreCache.Set(pawn, tool, workStat, score);
⋮----
/// Internal scoring calculation without caching.
⋮----
private static float CalculateScore(Thing tool, Pawn pawn, StatDef workStat)
⋮----
// Get tool stat factor using resolver
float toolFactor = ToolStatResolver.GetToolStatFactor(tool.def, tool.Stuff, workStat);
float baseline = SurvivalToolUtility.GetNoToolBaseline(workStat);
// If tool doesn't improve over baseline, score is 0
⋮----
// Base score is improvement over baseline
⋮----
// Apply difficulty multipliers if settings exist
⋮----
// In normal mode, apply penalty settings if enabled
⋮----
// Tool factors are already clamped in resolver, apply any additional penalties here
// Current behavior: keep defaults identical, so no additional penalties
⋮----
// Apply quality scaling if enabled and tool has quality
⋮----
score *= QualityCurve.Evaluate((int)qualityComp.Quality);
⋮----
// Apply condition penalty (50%-100% based on hit points)
⋮----
// Optional carry/mass penalties (read settings, keep defaults identical to current)
// Current behavior: no mass penalties by default
⋮----
/// Find the best tool for a pawn and work stat.
/// Searches pawn inventory and optionally the map.
⋮----
/// <param name="pawn">Pawn looking for tool</param>
/// <param name="workStat">Work stat to optimize for</param>
/// <param name="score">Output: score of best tool found</param>
/// <returns>Best tool found, or null if none improve baseline</returns>
public static Thing GetBestTool(Pawn pawn, StatDef workStat, out float score)
⋮----
Thing bestTool = null;
⋮----
// Search pawn's held/equipped tools first (zero distance penalty)
foreach (var thing in pawn.GetAllUsableSurvivalTools())
⋮----
// TODO: Add map search when map tools are needed
// For Phase 3, focus on held tools only to avoid gameplay changes
⋮----
/// Get top contributing factors for a tool's score.
/// Used for detailed tool analysis and UI display.
⋮----
/// <param name="tool">Tool to analyze</param>
/// <param name="pawn">Pawn who would use tool</param>
/// <param name="workStat">Work stat to analyze</param>
/// <param name="max">Maximum number of contributors to return</param>
/// <returns>Array of (factor source, contribution) pairs</returns>
public static (Thing, float)[] TopContributors(Thing tool, Pawn pawn, StatDef workStat, int max = 2)
⋮----
_tempScoredTools.Clear();
⋮----
// Get base tool factor
float baseFactor = ToolStatResolver.GetToolStatFactor(tool.def, tool.Stuff, workStat);
⋮----
_tempScoredTools.Add((tool, baseFactor - baseline));
⋮----
// For now, just return the tool itself as the main contributor
// In future phases, this could break down material vs tool vs quirk contributions
⋮----
// Sort by contribution (highest first) and take top 'max'
_tempScoredTools.Sort((a, b) => b.Item2.CompareTo(a.Item2));
int resultCount = Math.Min(max, _tempScoredTools.Count);
⋮----
/// Clear pooled collections for memory management.
/// Call during mod cleanup or when memory pressure is high.
⋮----
internal static void ClearPools()
⋮----
_tempStatList.Clear();
</file>

<file path="Source/Stats/StatPart_SurvivalTools.cs">
// RimWorld 1.6 / C# 7.3
// Source/Stats/StatPart_SurvivalTools.cs
//
// Phase 4: StatPart as the single math path for survival tool bonuses/penalties.
// Uses ToolScoring and ScoreCache for deterministic, cache-friendly calculations.
⋮----
/// <summary>
/// Phase 4: Unified StatPart for all survival tool stat modifications.
/// Replaces scattered legacy stat math with a single deterministic path.
/// </summary>
public sealed class StatPart_SurvivalTools : StatPart
⋮----
// Supported vanilla work stats (O(1) membership test)
⋮----
// Cached StringBuilder for ExplanationPart (reuse to avoid allocations)
private static readonly StringBuilder _explanationBuilder = new StringBuilder(256);
// HP bucket tracking for cache invalidation (quantized to 10% steps)
⋮----
// Lazy initialization flag
⋮----
/// Ensure supported stats are initialized (lazy, thread-safe)
⋮----
private static void EnsureSupportedStatsInitialized()
⋮----
SupportedWorkStats.Clear();
// Add vanilla work stats we support
if (StatDefOf.MiningSpeed != null) SupportedWorkStats.Add(StatDefOf.MiningSpeed);
if (StatDefOf.MiningYield != null) SupportedWorkStats.Add(StatDefOf.MiningYield);
if (StatDefOf.ConstructionSpeed != null) SupportedWorkStats.Add(StatDefOf.ConstructionSpeed);
if (StatDefOf.PlantWorkSpeed != null) SupportedWorkStats.Add(StatDefOf.PlantWorkSpeed);
if (StatDefOf.PlantHarvestYield != null) SupportedWorkStats.Add(StatDefOf.PlantHarvestYield);
// Add ST custom stats if available
⋮----
if (ST_StatDefOf.DiggingSpeed != null) SupportedWorkStats.Add(ST_StatDefOf.DiggingSpeed);
if (ST_StatDefOf.TreeFellingSpeed != null) SupportedWorkStats.Add(ST_StatDefOf.TreeFellingSpeed);
if (ST_StatDefOf.PlantHarvestingSpeed != null) SupportedWorkStats.Add(ST_StatDefOf.PlantHarvestingSpeed);
if (ST_StatDefOf.SowingSpeed != null) SupportedWorkStats.Add(ST_StatDefOf.SowingSpeed);
if (ST_StatDefOf.MaintenanceSpeed != null) SupportedWorkStats.Add(ST_StatDefOf.MaintenanceSpeed);
if (ST_StatDefOf.DeconstructionSpeed != null) SupportedWorkStats.Add(ST_StatDefOf.DeconstructionSpeed);
if (ST_StatDefOf.ResearchSpeed != null) SupportedWorkStats.Add(ST_StatDefOf.ResearchSpeed);
if (ST_StatDefOf.CleaningSpeed != null) SupportedWorkStats.Add(ST_StatDefOf.CleaningSpeed);
if (ST_StatDefOf.MedicalOperationSpeed != null) SupportedWorkStats.Add(ST_StatDefOf.MedicalOperationSpeed);
if (ST_StatDefOf.MedicalSurgerySuccessChance != null) SupportedWorkStats.Add(ST_StatDefOf.MedicalSurgerySuccessChance);
if (ST_StatDefOf.ButcheryFleshSpeed != null) SupportedWorkStats.Add(ST_StatDefOf.ButcheryFleshSpeed);
if (ST_StatDefOf.ButcheryFleshEfficiency != null) SupportedWorkStats.Add(ST_StatDefOf.ButcheryFleshEfficiency);
if (ST_StatDefOf.MiningYieldDigging != null) SupportedWorkStats.Add(ST_StatDefOf.MiningYieldDigging);
⋮----
// If ST stats are not available, continue with vanilla stats only
⋮----
/// Transform stat value using unified tool scoring system.
/// Zero allocations in hot path.
⋮----
public override void TransformValue(StatRequest req, ref float val)
⋮----
if (parentStat == null || !SupportedWorkStats.Contains(parentStat))
⋮----
// Early-out blacklist
⋮----
if (pawn.IsQuestLodger() || pawn.Downed || pawn.GetPosture() != PawnPosture.Standing)
⋮----
// Check if pawn has required capacities (no LINQ)
⋮----
if (!pawn.health.capacities.CapableOf(PawnCapacityDefOf.Manipulation))
⋮----
if (!pawn.health.capacities.CapableOf(PawnCapacityDefOf.Consciousness))
⋮----
// Get the effective tool using ToolScoring
var effectiveTool = ToolScoring.GetBestTool(pawn, parentStat, out float score);
⋮----
// No meaningful tool - apply baseline penalty in Normal mode only
⋮----
// In Hardcore/Nightmare: do not block here, just leave value unmodified
// The actual blocking happens in Phase 5 gating
⋮----
// Check for HP bucket changes for cache invalidation
⋮----
// Apply tool factor using resolver (exactly matching current behavior)
float toolFactor = ToolStatResolver.GetToolStatFactor(effectiveTool.def, effectiveTool.Stuff, parentStat);
⋮----
/// Provide explanation text for stat calculation.
/// Uses cached StringBuilder to avoid allocations.
⋮----
public override string ExplanationPart(StatRequest req)
⋮----
_explanationBuilder.Clear();
_explanationBuilder.AppendLine("ST_StatPart_Header".Translate());
⋮----
// No tool case
⋮----
_explanationBuilder.AppendLine("ST_StatPart_NoToolPenalty".Translate(settings.noToolStatFactorNormal.ToStringPercent()));
⋮----
_explanationBuilder.AppendLine("ST_StatPart_NoToolPenalty".Translate("100%"));
⋮----
// Tool applied
⋮----
_explanationBuilder.AppendLine("ST_StatPart_ToolApplied".Translate(effectiveTool.LabelCap, toolFactor.ToStringPercent()));
// Top contributors
var contributors = ToolScoring.TopContributors(effectiveTool, pawn, parentStat, 2);
⋮----
_explanationBuilder.AppendLine("ST_StatPart_TopContrib".Translate(thing.LabelCap, (contribution * 100f).ToString("F1")));
⋮----
return _explanationBuilder.ToString();
⋮----
/// Check if pawn can use survival tools (simplified check)
⋮----
private static bool CanUseSurvivalTools(Pawn pawn)
⋮----
if (pawn.IsQuestLodger() || pawn.Downed) return false;
⋮----
/// Check if tool's HP bucket has changed and invalidate cache if needed.
/// Quantized to 10% steps to avoid excessive invalidation.
⋮----
private static void CheckHpBucketChange(Thing tool)
⋮----
int currentBucket = (tool.HitPoints * 10) / tool.MaxHitPoints; // 0-10 scale
if (_lastHpBuckets.TryGetValue(thingId, out int lastBucket))
⋮----
ScoreCache.NotifyToolChanged(tool);
⋮----
/// Clear HP bucket tracking for cleanup
⋮----
public static void ClearHpBucketTracking()
⋮----
_lastHpBuckets.Clear();
</file>

<file path="Source/UI/GearTab_ST.cs">
// RimWorld 1.6 / C# 7.3
// Source/UI/GearTab_ST.cs
// From our refactor branch, keep.
// Phase 7: Gear iTab implementation
// - Readable panel inside vanilla Gear tab
// - Tool scoring display with alloc-free loops
// - Performance optimized with pooled buffers
⋮----
public static class GearTab_ST
⋮----
// UI constants
⋮----
private const float TOOL_ROW_HEIGHT = 42f; // Two lines at 21px each
⋮----
// Cached data
private static Pawn _cachedPawn;
⋮----
private static StringBuilder _tooltipBuilder = new StringBuilder();
private static Vector2 _scrollPos = Vector2.zero;
// Pooled arrays for performance
⋮----
public Thing Tool;
⋮----
public static void Draw(Rect hostRect, Pawn pawn)
⋮----
// Update cache if needed
⋮----
// Draw background
Widgets.DrawBoxSolid(hostRect, new Color(0.1f, 0.1f, 0.1f, 0.8f));
Widgets.DrawBox(hostRect);
var contentRect = hostRect.ContractedBy(MARGIN);
⋮----
// Header
DrawHeader(new Rect(contentRect.x, curY, contentRect.width, HEADER_HEIGHT));
⋮----
// Tool list with scroll view
var listRect = new Rect(contentRect.x, curY, contentRect.width, contentRect.yMax - curY);
⋮----
private static void DrawHeader(Rect rect)
⋮----
var titleRect = new Rect(rect.x, rect.y, rect.width - 80f, rect.height);
var settingsButtonRect = new Rect(rect.xMax - 75f, rect.y, 75f, rect.height);
// Title
⋮----
Widgets.Label(titleRect, "ST_GearTab_Header".Translate());
// Settings button
⋮----
if (Widgets.ButtonText(settingsButtonRect, "Settings"))
⋮----
Find.WindowStack.Add(new Dialog_ModSettings(LoadedModManager.GetMod<SurvivalTools>()));
⋮----
private static void DrawToolList(Rect listRect, Pawn pawn)
⋮----
var viewRect = new Rect(0f, 0f, listRect.width - SCROLL_BAR_WIDTH, _cachedToolInfo.Count * TOOL_ROW_HEIGHT + 20f);
// Consume input only within our rect
⋮----
bool mouseInside = listRect.Contains(Event.current.mousePosition);
GUI.BeginGroup(listRect);
_scrollPos = GUI.BeginScrollView(new Rect(0, 0, listRect.width, listRect.height), _scrollPos, viewRect);
⋮----
// Empty state
⋮----
var emptyRect = new Rect(0, viewRect.height * 0.5f - 20f, viewRect.width, 40f);
Widgets.Label(emptyRect, "ST_GearTab_NoTools".Translate());
⋮----
// Draw tools
⋮----
var toolRect = new Rect(0, curY, viewRect.width, TOOL_ROW_HEIGHT);
⋮----
GUI.EndScrollView();
GUI.EndGroup();
⋮----
private static void DrawToolRow(Rect rect, ToolDisplayInfo toolInfo, bool allowTooltip)
⋮----
// Alternate background
⋮----
var bgColor = new Color(0.2f, 0.2f, 0.2f, 0.5f);
GUI.DrawTexture(rect, TexUI.HighlightTex, ScaleMode.StretchToFill, true, 0f, bgColor, 0f, 0f);
⋮----
var line1Rect = new Rect(rect.x + 4f, rect.y + 2f, rect.width - 8f, 21f);
var line2Rect = new Rect(rect.x + 4f, rect.y + 21f, rect.width - 8f, 21f);
// Line 1: Tool label + scores
⋮----
var labelWidth = Text.CalcSize(toolInfo.Label).x + 10f;
var labelRect = new Rect(line1Rect.x, line1Rect.y, labelWidth, line1Rect.height);
var scoreRect = new Rect(labelRect.xMax, line1Rect.y, line1Rect.width - labelWidth, line1Rect.height);
Widgets.Label(labelRect, toolInfo.Label);
⋮----
Widgets.Label(scoreRect, toolInfo.ScoreText);
⋮----
// Line 2: Why text
⋮----
Widgets.Label(line2Rect, toolInfo.WhyText);
⋮----
// Tooltip
if (allowTooltip && Mouse.IsOver(rect) && !string.IsNullOrEmpty(toolInfo.TooltipText))
⋮----
TooltipHandler.TipRegion(rect, toolInfo.TooltipText);
⋮----
private static void UpdateCacheIfNeeded(Pawn pawn)
⋮----
_cachedToolInfo.Clear();
// Update mode/carry text
⋮----
string carry = "Auto"; // Simplified for now
_cachedModeCarryText = "ST_Gear_ModeCarry".Translate(mode, carry);
// Update gating status
⋮----
// Quick check if pawn would be blocked from any work
var testWorkGiver = DefDatabase<WorkGiverDef>.GetNamedSilentFail("Mine");
⋮----
isGated = Gating.JobGate.ShouldBlock(pawn, testWorkGiver, null, false, out var _, out var _, out var _);
⋮----
_cachedGatingText = isGated ? "ST_Gear_Gated".Translate().ToString() : "";
// Build tool list
⋮----
private static void BuildToolList(Pawn pawn)
⋮----
// Add equipped tool
if (pawn.equipment?.Primary != null && ToolUtility.IsSurvivalTool(pawn.equipment.Primary))
⋮----
tools.Add(pawn.equipment.Primary);
⋮----
// Add inventory tools
⋮----
if (ToolUtility.IsSurvivalTool(item))
⋮----
tools.Add(item);
⋮----
// Only add virtual tools if the pawn actually has them in inventory
⋮----
// Check if pawn actually has this material
⋮----
// Only create virtual tool if pawn has the material AND it can be used as a tool
if (hasInInventory && Helpers.ToolStatResolver.GetToolCandidates().Contains(candidate))
⋮----
// Create virtual representation
var virtualTool = ThingMaker.MakeThing(candidate);
⋮----
tools.Add(virtualTool);
⋮----
// Convert to display info
_tooltipBuilder.Clear();
⋮----
_cachedToolInfo.Add(displayInfo);
⋮----
private static ToolDisplayInfo CreateToolDisplayInfo(Thing tool, Pawn pawn)
⋮----
var info = new ToolDisplayInfo
⋮----
// Get relevant stats for this specific tool
⋮----
// Build score text using only relevant stats
⋮----
var scoreBuilder = new StringBuilder();
var whyBuilder = new StringBuilder();
⋮----
var score = Scoring.ToolScoring.Score(tool, pawn, stat);
⋮----
if (scoreBuilder.Length > 0) scoreBuilder.Append(" ");
scoreBuilder.Append($"{GetStatAbbreviation(stat)}:{score:F2}");
// Get top contributors for "why" text
if (whyBuilder.Length == 0) // Only show for first stat
⋮----
var contributors = Scoring.ToolScoring.TopContributors(tool, pawn, stat, 2);
⋮----
whyBuilder.Append("ST_GearTab_Why".Translate(stat.LabelCap, pct.ToString("F0")));
⋮----
// Build tooltip using ToolStatInfo
var statInfo = Helpers.ToolStatResolver.GetToolStatInfo(tool.def, tool.Stuff, stat);
_tooltipBuilder.AppendLine($"{stat.LabelCap}: {statInfo.Factor:F3} ({statInfo.Source})");
if (!string.IsNullOrEmpty(statInfo.QuirkSummary))
⋮----
_tooltipBuilder.AppendLine($"  Quirks: {statInfo.QuirkSummary}");
⋮----
info.ScoreText = scoreBuilder.ToString();
info.WhyText = whyBuilder.Length > 0 ? whyBuilder.ToString() : "Base values";
info.TooltipText = _tooltipBuilder.ToString();
⋮----
private static string GetStatAbbreviation(StatDef stat)
⋮----
return stat.defName.Substring(0, Math.Min(4, stat.defName.Length));
⋮----
private static List<StatDef> GetRelevantStatsForTool(Thing tool)
⋮----
// Check what stats this tool actually affects by testing the tool stat resolver
⋮----
// If the tool has a meaningful impact on this stat (not just base 1.0), include it
if (statInfo.Factor > 1.001f || !string.IsNullOrEmpty(statInfo.QuirkSummary))
⋮----
relevantStats.Add(stat);
⋮----
// Also include if the tool is equipped and provides any bonus
⋮----
var score = Scoring.ToolScoring.Score(tool, _cachedPawn, stat);
⋮----
// If no stats were found, fall back to checking tool type patterns
⋮----
var toolName = tool.def.defName.ToLowerInvariant();
var toolLabel = tool.LabelNoCount.ToLowerInvariant();
// Mining tools
if (toolName.Contains("pickaxe") || toolName.Contains("drill") ||
toolLabel.Contains("pickaxe") || toolLabel.Contains("drill"))
⋮----
relevantStats.Add(ST_StatDefOf.DiggingSpeed);
⋮----
// Tree felling tools
if (toolName.Contains("axe") || toolName.Contains("chainsaw") ||
toolLabel.Contains("axe") || toolLabel.Contains("chainsaw"))
⋮----
relevantStats.Add(ST_StatDefOf.TreeFellingSpeed);
⋮----
// Construction tools
if (toolName.Contains("hammer") || toolName.Contains("drill") ||
toolLabel.Contains("hammer") || toolLabel.Contains("drill"))
⋮----
relevantStats.Add(StatDefOf.ConstructionSpeed);
⋮----
// Plant harvesting tools
if (toolName.Contains("sickle") || toolName.Contains("scythe") || toolName.Contains("hoe") ||
toolLabel.Contains("sickle") || toolLabel.Contains("scythe") || toolLabel.Contains("hoe"))
⋮----
relevantStats.Add(ST_StatDefOf.PlantHarvestingSpeed);
⋮----
// Virtual tools (cloth/wood) - show what they can substitute for
⋮----
relevantStats.Add(ST_StatDefOf.PlantHarvestingSpeed); // Cloth can substitute for plant harvesting
⋮----
relevantStats.Add(StatDefOf.ConstructionSpeed); // Wood can substitute for construction
⋮----
private static int GetCacheInvalidationKey(Pawn pawn)
⋮----
// Include resolver version
⋮----
// Include score cache state
var cacheStats = Helpers.ScoreCache.GetCacheStats();
⋮----
// Include pawn inventory/equipment state
⋮----
hash ^= pawn.equipment.Primary.GetHashCode();
⋮----
// Sample a few items to detect changes without full enumeration
for (int i = 0; i < Math.Min(3, pawn.inventory.innerContainer.Count); i++)
⋮----
hash ^= item.GetHashCode() << (i * 2);
</file>

<file path="Source/VirtualTool.cs">
// RimWorld 1.6 / C# 7.3
// Source/VirtualTool.cs
//
// VirtualTool
// - Wrapper so tool-stuff (cloth, hyperweave, etc.) or other qualifying Things behave like SurvivalTool at runtime.
// - Exposes work stat modifiers via SurvivalToolProperties / statBases through the SurvivalTool base caches.
// - Not saved separately; ephemeral adapter used in scoring/assignment paths.
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// A lightweight wrapper so tool-stuff or other resource Things can act like SurvivalTools transparently.
/// Wraps a physical Thing (stack) and exposes tool stat modifiers from its def (extension + statBases).
/// </summary>
public class VirtualTool : SurvivalTool
⋮----
/// <summary>Physical thing (stack) that this wrapper represents.</summary>
⋮----
/// <summary>Definition of the wrapped thing.</summary>
⋮----
/// <summary>Precomputed stat factors pulled from SurvivalToolProperties on the source def.</summary>
⋮----
/// Hide the base property since it's not virtual. For virtual tools this returns only
/// non-null, non-zero stat modifiers defined in SurvivalToolProperties.baseWorkStatFactors.
⋮----
.ToList()
⋮----
// Present as the same def for labeling/inspection consistency.
⋮----
/// Factory method that wraps a physical Thing (like cloth or hyperweave) into a VirtualSurvivalTool.
/// Returns null if the Thing's def does not declare SurvivalToolProperties.
⋮----
public static VirtualTool FromThing(Thing thing)
⋮----
return new VirtualTool(thing);
⋮----
public override string LabelCap => LabelNoCount.CapitalizeFirst();
⋮----
private static bool LooksLikeToolStuff(ThingDef def)
</file>

<file path="Source/WorldComponent_DelayedValidation.cs">
// RimWorld 1.6 / C# 7.3
// Source/WorldComponent_DelayedValidation.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// World component that handles delayed job validation after game load
/// </summary>
public class WorldComponent_DelayedValidation : WorldComponent
⋮----
public override void WorldComponentTick()
⋮----
ST_Logging.LogInfo("[SurvivalTools.JobValidation] Executing delayed job validation after tool stats have been properly initialized.");
SurvivalToolValidation.ValidateExistingJobs("delayed validation after game load");
⋮----
public void ScheduleValidation(int targetTick)
⋮----
ST_Logging.LogInfo($"[SurvivalTools.JobValidation] Scheduled validation for tick {targetTick} (current: {Find.TickManager.TicksGame})");
⋮----
public override void ExposeData()
⋮----
base.ExposeData();
// Don't save validation state - we want it to reset each time we load
</file>

<file path="1.6/Languages/English/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>axe</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>A fundamental forestry tool designed for efficient tree felling. Its weighted head delivers powerful cutting strikes, making it indispensable for colonists working with wood. The balance and leverage make it far superior to improvised cutting methods. Also serves as a reliable melee weapon when survival demands it.</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>pickaxe</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>An essential mining implement featuring a heavy, pointed head mounted on a sturdy handle. Specifically engineered to break through solid rock and extract valuable materials efficiently. The concentrated force and leverage it provides are crucial for productive mining operations. Can double as an improvised weapon when circumstances require it.</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>hammer</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>The cornerstone tool of any construction project. This versatile hammer provides the precision and force needed for driving fasteners, shaping materials, and assembling structures. Essential for colonists engaged in building and maintenance work. Its balanced design ensures effective strikes while minimizing fatigue during extended construction tasks.</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>sickle</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>A specialized agricultural tool featuring a curved cutting blade perfectly designed for harvesting crops and cutting plant matter. The ergonomic design allows for efficient, repetitive cutting motions while reducing strain on the user. Essential for productive farming operations and plant maintenance tasks.</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>hoe</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>A fundamental agricultural implement engineered for soil preparation and seed planting. The pointed design efficiently breaks through earth and creates optimal planting conditions. Indispensable for establishing productive farming operations and maintaining crop yields. Its sturdy construction ensures reliable performance season after season.</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>knife</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>A versatile cutting implement with a sharp blade essential for precise work. Perfect for butchery operations, medical procedures, and general cutting tasks. The balanced design allows for controlled, accurate cuts while the keen edge ensures clean work. An indispensable tool for any serious colonist.</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>hand saw</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>A traditional woodworking tool featuring a metal blade with precisely cut teeth designed for manual lumber processing. Essential for construction projects requiring custom-cut timber and detailed woodwork. The steady rhythm of hand-sawing may take longer than power tools, but provides excellent control and precision.</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>bone sickle</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>A primitive harvesting tool crafted from carved bone with a sharpened edge. While not as durable as metal variants, this traditional implement serves admirably for crop harvesting and plant cutting. The curved design follows ancient patterns proven effective across countless generations of agricultural work.</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>pry bar</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>A primitive but effective leverage tool crafted from durable materials. Essential for dismantling structures, prying apart materials, and performing basic mechanical operations. Represents the ingenuity of early civilizations in developing practical solutions for construction and deconstruction tasks without advanced technology.</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>abacus</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>An ancient calculating instrument featuring movable beads arranged on rods for performing arithmetic operations. Essential for organizing research data, managing complex calculations, and maintaining accurate records in societies without advanced computational devices. Represents the foundation of mathematical thinking and data organization.</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>steel knife</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>A precision-forged steel knife with superior edge retention and durability. The high-carbon steel blade maintains its sharpness through extensive use, making it ideal for demanding butchery and medical work. The ergonomic handle provides excellent control for delicate operations.</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>crosscut saw</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>A precision industrial saw designed for efficient lumber processing and construction work. The specially designed teeth and reinforced steel construction allow for clean, accurate cuts through various materials. Essential for large-scale construction projects and advanced woodworking operations.</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>wrench</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>A precision mechanical tool engineered for gripping, turning, and manipulating fasteners and mechanical components. Critical for maintenance operations, machinery repair, and construction projects requiring exact adjustments. The adjustable jaw design accommodates various sizes while providing optimal leverage and control.</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>microscope</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>A precision optical instrument that magnifies small objects and specimens for detailed examination. Essential for advanced research, biological studies, and scientific analysis.</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>carbide pickaxe</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>An advanced mining implement featuring carbide-tipped edges that maintain their sharpness through the most demanding excavation work. The precision-engineered head cuts through rock more efficiently than standard tools, while the reinforced construction ensures exceptional durability in harsh mining conditions.</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>precision scalpel</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>An ultra-sharp surgical instrument crafted from the finest steel alloys. The carefully balanced blade maintains its edge through repeated sterilization and use, while the ergonomic handle ensures precise control during delicate medical procedures. Standard equipment in advanced medical facilities.</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>power drill</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>A mechanized drilling tool powered by an internal motor, capable of boring through tough materials with precision and speed. The variable-speed motor and interchangeable bits make it invaluable for construction and mechanical work. Requires periodic maintenance to keep the motor running smoothly.</SurvivalTools_PowerDrill.description>
    <!-- Cleaning Tools -->
    <SurvivalTools_PileOfRags.label>pile of rags</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>A collection of cloth pieces bundled together for cleaning purposes. These simple rags are effective for basic cleaning tasks, though they wear out more quickly than proper cleaning tools. Essential for maintaining colony hygiene and cleanliness.</SurvivalTools_PileOfRags.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>glitterworld multitool</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>A high-tech universal tool commonly used by domestic mechanoids in glitterworld societies. This advanced device can seamlessly adapt to any task - construction, mining, forestry, maintenance, and deconstruction - making it the ultimate all-in-one survival tool. Though designed for mechanoids, it's perfectly usable by humanoids due to physiological similarities.</SurvivalTools_Multitool.description>
    <!-- =================================================== -->
    <!-- MULTIPURPOSE GENERAL WORK TOOLS (WorkSpeedGlobal)   -->
    <!-- Newly added tool defs requiring DefInjected entries -->
    <!-- =================================================== -->
    <!-- Tribal / Primitive Tier -->
    <SurvivalTools_MultipurposeStoneTool.label>multipurpose stone tool</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>A rugged, versatile stone implement shaped to cover many general tasks. While primitive, it grants a modest improvement to overall work speed.</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>carved bone implements</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>A collection of carefully carved bone implements bundled together for multi-purpose use. Fragile, but shaped for efficiency, giving a noticeable boost to general work speed.</SurvivalTools_CarvedBoneImplements.description>
    <!-- Medieval Tier -->
    <SurvivalTools_ArtisansToolkit.label>artisan's toolkit</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>A curated collection of quality medieval-era implements for crafting, shaping, and assembly. Improves overall work throughput across many tasks.</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>woodworker's kit</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>A specialized assortment of saws, chisels, planes and gauges optimized for timber shaping and joinery. Its organization and quality grant a strong boost to general work speed.</SurvivalTools_WoodworkersKit.description>
    <!-- Industrial Tier -->
    <SurvivalTools_MechanicsToolkit.label>mechanic's toolkit</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>An organized industrial-era toolkit containing precision wrenches, gauges, torque implements and fast-retrieval storage. Greatly improves overall task flow and coordination in general work.</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>workshop hammer drill</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>A heavy-duty powered hammer drill with interchangeable percussion and rotary modules. Its integrated clamping and alignment system accelerates virtually any mechanical or construction task.</SurvivalTools_WorkshopHammerDrill.description>
    <!-- Spacer / Ultra Tech Tier -->
    <SurvivalTools_NanofabricatorInterface.label>nanofabricator interface</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>A sleek control and augmentation module that synchronizes the user's motions with adaptive nano-assembly routines. Dramatically improves general task execution efficiency.</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>omni-tool gauntlet</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>A cutting-edge modular gauntlet embedding field projectors, micro-fabricators and force-aligned manipulators. Provides an unparalleled increase to general work speed through predictive optimization.</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>

<file path="1.6/Languages/English/keyed/ST_Gating.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Job gating failure message -->
    <ST_Gate_MissingToolStat>Requires a tool for {0} to do {1}.</ST_Gate_MissingToolStat>
    <!-- Tool gating alert -->
    <ST_Alert_ToolGating_Label>Tool gating</ST_Alert_ToolGating_Label>
    <ST_Alert_ToolGating_AndMore>and {0} more</ST_Alert_ToolGating_AndMore>
    <!-- Work type labels for alert -->
    <ST_Alert_WorkType_Mining>Mining</ST_Alert_WorkType_Mining>
    <ST_Alert_WorkType_Construction>Construction</ST_Alert_WorkType_Construction>
    <ST_Alert_WorkType_PlantCutting>Plant Cutting</ST_Alert_WorkType_PlantCutting>
    <ST_Alert_WorkType_PlantHarvest>Plant Harvest</ST_Alert_WorkType_PlantHarvest>
    <ST_Alert_WorkType_Smithing>Smithing</ST_Alert_WorkType_Smithing>
    <!-- Settings UI -->
    <Settings_ShowGatingAlert>Show 'Tool gating' alert</Settings_ShowGatingAlert>
    <Settings_ShowGatingAlert_Tooltip>When enabled, shows an alert when pawns are unable to work due to missing required tools in Hardcore/Nightmare modes.</Settings_ShowGatingAlert_Tooltip>
    <Settings_EnforceOnModeChange>Cancel now-invalid jobs when difficulty changes</Settings_EnforceOnModeChange>
    <Settings_EnforceOnModeChange_Tooltip>When enabled, automatically cancels running jobs that would be blocked by tool gating when switching to Hardcore or Nightmare mode.</Settings_EnforceOnModeChange_Tooltip>
    <!-- Gating enforcer messages -->
    <ST_Gate_ModeChanged>Difficulty mode changed</ST_Gate_ModeChanged>
</LanguageData>
</file>

<file path="1.6/Languages/French/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>hache</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>Un outil forestier de base conçu pour un travail d'abattage efficace. Sa tête lourde offre une force de frappe puissante, en faisant un outil indispensable pour les colons engagés dans le travail du bois. Son équilibre et son effet de levier le rendent bien plus efficace que les méthodes de coupe improvisées. Sert également d'arme de mêlée fiable lorsque la survie l'exige.</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>pioche</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>Un outil minier essentiel doté d'une tête lourde et pointue fixée à un manche robuste. Spécialement conçu pour briser la roche dure et extraire efficacement les matériaux précieux. Sa force concentrée et son effet de levier sont essentiels pour des opérations minières productives. Peut également servir d'arme improvisée lorsque les circonstances l'exigent.</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>marteau</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>Un outil fondamental pour tout projet de construction. Ce marteau polyvalent fournit la précision et la force nécessaires pour enfoncer les attaches, façonner les matériaux et assembler les structures. Indispensable pour les colons engagés dans les travaux de construction et de maintenance. Sa conception équilibrée assure des coups efficaces avec une fatigue minimale pendant les travaux de construction prolongés.</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>faucille</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>Un outil agricole spécialisé doté d'une lame courbe parfaitement conçue pour récolter les cultures et couper le matériel végétal. Sa conception ergonomique permet des mouvements de coupe efficaces et répétitifs avec une contrainte minimale sur l'utilisateur. Indispensable pour les opérations agricoles productives et les travaux d'entretien des plantes.</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>houe</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>Un outil agricole de base conçu pour la préparation du sol et la plantation de graines. Sa conception pointue brise efficacement le sol, créant des conditions de plantation optimales. Indispensable pour établir des opérations agricoles productives et maintenir les rendements des cultures. Sa construction robuste assure des performances fiables à travers les saisons.</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>couteau</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>Un outil de coupe polyvalent avec une lame tranchante indispensable pour les travaux de précision. Idéal pour les travaux de boucherie, les procédures médicales et les tâches de coupe générales. Sa conception équilibrée permet des coupes contrôlées et précises, tandis que la lame tranchante assure un travail propre. Un outil indispensable pour tout colon sérieux.</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>scie à main</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>Un outil de menuiserie traditionnel doté d'une lame métallique avec des dents précisément coupées pour le travail du bois manuel. Indispensable pour les projets de construction nécessitant du bois coupé sur mesure et des travaux de menuiserie détaillés. Le rythme régulier d'une scie à main peut prendre plus de temps que les outils électriques, mais offre un excellent contrôle et une précision.</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>faucille en os</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>Un outil de récolte primitif fait d'os sculpté avec un bord aiguisé. Bien qu'il ne soit pas aussi durable que ses homologues métalliques, cet instrument traditionnel sert admirablement pour récolter les cultures et couper les plantes. Sa conception courbe suit des modèles anciens qui ont prouvé leur efficacité à travers d'innombrables générations de travail agricole.</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>levier</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>Un outil de levier primitif mais efficace fabriqué à partir de matériaux durables. Indispensable pour démonter les structures, séparer les matériaux et effectuer des opérations mécaniques de base. Représente l'ingéniosité des premières civilisations dans le développement de solutions pratiques pour les travaux de construction et de démolition sans technologie avancée.</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>boulier</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>Un instrument de calcul ancien avec des perles mobiles disposées sur des tiges pour effectuer des opérations arithmétiques. Indispensable pour organiser les données de recherche, gérer les calculs complexes et maintenir des registres précis dans les sociétés sans dispositifs de calcul avancés. Représente la fondation de la pensée mathématique et de l'organisation des données.</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>couteau en acier</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>Un couteau en acier forgé avec précision avec une rétention de tranchant et une durabilité supérieures. La lame en acier carbone maintient son tranchant à travers une utilisation extensive, le rendant idéal pour les travaux de boucherie et médicaux exigeants. Le manche ergonomique offre un excellent contrôle pour les travaux fins.</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>scie à tronçonner</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>Une scie industrielle de précision conçue pour un travail du bois et de construction efficace. Ses dents spécialement conçues et sa construction en acier renforcé permettent des coupes nettes et précises à travers divers matériaux. Indispensable pour les grands projets de construction et les travaux de menuiserie avancés.</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>clé</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>Un outil mécanique de précision conçu pour saisir, tourner et manipuler les attaches et les composants mécaniques. Crucial pour les travaux de maintenance, les réparations de machines et les projets de construction nécessitant des ajustements précis. Le système de mâchoires ajustables s'adapte à diverses tailles tout en offrant un effet de levier et un contrôle optimaux.</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>microscope</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>Un instrument optique de précision qui grossit les petits objets et échantillons pour un examen détaillé. Indispensable pour la recherche avancée, les études biologiques et l'analyse scientifique.</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>pioche au carbure</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>Un outil minier avancé doté d'une pointe au carbure qui maintient son tranchant à travers les travaux d'excavation les plus exigeants. La tête conçue avec précision coupe la roche plus efficacement que les outils standard, tandis que sa construction renforcée assure une durabilité exceptionnelle dans des conditions minières difficiles.</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>scalpel de précision</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>Un instrument chirurgical ultra-tranchant fabriqué à partir d'alliages d'acier de qualité supérieure. La lame soigneusement équilibrée maintient son tranchant à travers une stérilisation et une utilisation répétées, tandis que le manche ergonomique assure un contrôle précis pendant les procédures médicales fines. Équipement standard pour les installations médicales avancées.</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>perceuse électrique</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>Un outil de perçage mécanisé alimenté par un moteur intégré capable de percer des matériaux durs avec précision et vitesse. Le moteur à vitesse variable et les mèches interchangeables le rendent extrêmement précieux pour les travaux de construction et mécaniques. Nécessite un entretien régulier pour maintenir le moteur en bon état de fonctionnement.</SurvivalTools_PowerDrill.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>multi-outil glittermonde</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>Un outil universel haute technologie couramment utilisé par les mécanoides domestiques dans les sociétés glittermonde. Cet appareil avancé s'adapte sans effort à toute tâche - construction, minage, foresterie, maintenance, démolition - en faisant l'outil de survie tout-en-un ultime. Bien que conçu pour les mécanoides, il est parfaitement utilisable par les humanoïdes en raison de similitudes physiologiques.</SurvivalTools_Multitool.description>
    <SurvivalTools_PileOfRags.label>tas de chiffons</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>Un simple outil de nettoyage fait de chiffons et de morceaux de tissu. Utile pour les tâches de nettoyage de base mais s'use rapidement.</SurvivalTools_PileOfRags.description>
    <!-- =================================================== -->
    <!-- OUTILS GÉNÉRAUX MULTI-USAGES (WorkSpeedGlobal)       -->
    <!-- Nouvelles définitions nécessitant des entrées        -->
    <!-- =================================================== -->
    <!-- Palier tribal / primitif -->
    <SurvivalTools_MultipurposeStoneTool.label>outil en pierre polyvalent</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>Un instrument en pierre robuste et polyvalent, façonné pour couvrir de nombreuses tâches générales. Bien que primitif, il confère une légère amélioration de la vitesse de travail globale.</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>implements en os sculptés</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>Un ensemble d'outils en os soigneusement sculptés et groupés pour un usage multi‑fonction. Fragiles mais bien profilés, ils procurent un gain notable à la vitesse générale de travail.</SurvivalTools_CarvedBoneImplements.description>
    <!-- Palier médiéval -->
    <SurvivalTools_ArtisansToolkit.label>trousse de l'artisan</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>Une collection sélectionnée d'outils de qualité d'époque médiévale pour l'artisanat, le façonnage et l'assemblage. Améliore le débit global à travers de nombreuses tâches.</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>kit du menuisier</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>Un assortiment spécialisé de scies, ciseaux, rabots et jauges optimisés pour le façonnage et l'assemblage du bois. Son organisation et sa qualité accordent un fort bonus à la vitesse de travail générale.</SurvivalTools_WoodworkersKit.description>
    <!-- Palier industriel -->
    <SurvivalTools_MechanicsToolkit.label>trousse du mécanicien</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>Une trousse industrielle organisée contenant clés de précision, jauges, outils de couple et rangement à accès rapide. Améliore grandement le flux et la coordination des tâches générales.</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>marteau-perforateur d'atelier</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>Un marteau-perforateur robuste avec modules percussifs et rotatifs interchangeables. Son système intégré de serrage et d'alignement accélère presque toute tâche mécanique ou de construction.</SurvivalTools_WorkshopHammerDrill.description>
    <!-- Palier ultra‑tech / spatial -->
    <SurvivalTools_NanofabricatorInterface.label>interface de nanofabrication</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>Un module élégant de contrôle et d'augmentation qui synchronise les mouvements de l'utilisateur avec des routines adaptatives nano‑assemblées. Améliore profondément l'efficacité d'exécution des tâches générales.</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>gantelet omni‑outil</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>Un gantelet modulaire de pointe incorporant projecteurs de champ, micro‑fabricateurs et manipulateurs à alignement de force. Fournit un accroissement inégalé de la vitesse générale de travail via une optimisation prédictive.</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>

<file path="1.6/Languages/French/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <NoTool>Aucun outil</NoTool>
    <ToolInUse>(en cours d'utilisation)</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>Outils de Survie</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>Paramètres de base</Settings_BasicSection>
    <Settings_DebugSection>Paramètres de débogage</Settings_DebugSection>
    <Settings_HardcoreMode>Mode hardcore</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>Augmente considérablement la difficulté en rendant les outils essentiels à la survie. Sans outils appropriés, les colons deviennent incapables d'exécuter efficacement la plupart des tâches de travail. Les outils s'usent aussi 50% plus rapidement, nécessitant un remplacement plus fréquent et une meilleure gestion des outils. Transforme le jeu en une véritable expérience de survie dépendante des outils.</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>Mode hardcore extrême</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>DIFFICULTÉ MAXIMALE : Le défi de survie ultime. Lorsqu'il est combiné avec le mode hardcore, les colons deviennent complètement impuissants sans les bons outils. Les tâches qui n'étaient que simplement inefficaces (comme le nettoyage à la main ou les soins médicaux improvisés) deviennent impossibles à tenter. Les outils se dégradent 87,5% plus rapidement que la normale, créant une pression constante pour la production et la maintenance d'outils. Utilisez les cases à cocher ci-dessous pour contrôler exactement quels types de travail deviennent dépendants des outils. ATTENTION : Le début de jeu devient extrêmement difficile - l'acquisition d'outils devient critique pour la survie de la colonie !</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>Outils de nettoyage requis</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>Force les colons à utiliser des outils de nettoyage appropriés (comme des balais ou des serpillières) pour toutes les tâches de nettoyage. Sans les bons outils, ils ne peuvent pas nettoyer les sols, enlever la saleté ou déblayer la neige. Essentiel pour maintenir l'hygiène de la colonie dans les modes de difficulté extrême.</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>Outils de boucherie requis</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>Exige des outils de coupe appropriés (comme des couteaux ou des hachoirs) pour toutes les opérations de boucherie et d'abattage. Les colons ne peuvent pas traiter la viande ou abattre des animaux sans lames appropriées. Critique pour les chaînes de production alimentaire dans les scénarios hardcore.</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>Outils médicaux requis</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>Impose l'utilisation d'instruments médicaux spécialisés pour les procédures chirurgicales et les soins médicaux avancés. Les opérations deviennent impossibles sans outils chirurgicaux appropriés, rendant l'acquisition d'équipement médical vitale pour la santé et la survie de la colonie.</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>Outils dans les bâtiments en ruine</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>Génère des outils de survie de base dans les ruines antiques et les structures écrasées pendant la génération de carte. Ces outils altérés fournissent des ressources importantes en début de jeu mais sont typiquement de faible qualité. Inestimables pour commencer des colonies dans des modes de difficulté difficiles où l'accès initial aux outils est critique.</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>Limite de transport d'outils</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>Restreint les colons à porter un maximum de 2-3 outils simultanément dans leur inventaire (excluant les voyages en caravane). Force la gestion stratégique des outils et la spécialisation parmi les colons. Les ceintures à outils et équipements similaires peuvent augmenter cette limite au-delà de la valeur de base. Ajoute des contraintes d'inventaire réalistes à l'utilisation des outils.</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>Taux de dégradation des outils</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>Optimisation automatique des outils</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>Active la gestion intelligente des outils où les colons sélectionnent et portent automatiquement les outils les plus efficaces pour leur travail assigné. Ils améliorent vers de meilleurs outils et abandonnent les inférieurs selon les besoins. Désactivez ceci si vous préférez le contrôle manuel des outils ou rencontrez des problèmes de performance avec des matériaux modifiés.</Settings_ToolOptimization_Tooltip>
    <Settings_PickupFromStorageOnly>Restreindre la collecte d'outils aux zones de stockage</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>Lorsqu'activé, les colons n'acquerront des outils que depuis les zones de stockage désignées, maintenant une meilleure organisation et les empêchant de saisir des outils depuis les zones de travail. Lorsque désactivé, ils peuvent ramasser n'importe quel outil accessible dans la zone Maison (excluant les objets interdits ou en feu), offrant plus de flexibilité mais moins de contrôle.</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_AllowPacifistEquip>Permettre aux pacifistes d'équiper des outils de survie</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>Permet aux colons pacifistes d'équiper des outils de survie classifiés comme armes (comme les haches, pics ou couteaux). Bien que ces outils aient des capacités de combat, ils sont essentiels pour les tâches de travail comme l'abattage d'arbres, l'extraction minière ou la préparation alimentaire. Lorsqu'activé, les pacifistes peuvent utiliser ces outils pour un travail productif tout en refusant de s'engager dans la violence.</Settings_AllowPacifistEquip_Tooltip>
    <Settings_DebugLogging>Activer la journalisation de débogage détaillée</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>Active la journalisation complète des décisions de sélection d'outils, du comportement de collecte automatique et de la logique de correspondance travail-outil. Essentiel pour dépanner les problèmes d'outils ou comprendre pourquoi les colons choisissent des outils spécifiques. Recommandé seulement pour le développement de mods ou lors de problèmes liés aux outils. Peut affecter les performances avec une sortie de journalisation extensive.</Settings_DebugLogging_Tooltip>
    <Settings_AutoTool>Collecte d'outils intelligente pré-travail</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>Révolutionne l'efficacité du flux de travail en faisant que les colons acquièrent automatiquement l'outil optimal avant de commencer tout travail. Ils échangent intelligemment les outils, améliorent vers de meilleures variantes et s'assurent d'avoir l'équipement approprié pour une productivité maximale. La fonctionnalité fondamentale pour un gameplay basé sur les outils sans faille.</Settings_AutoTool_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>Le colon manque d'outils essentiels</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>Les colons manquent d'outils essentiels</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>Ces colons ont besoin d'outils appropriés pour leur travail assigné, mais il leur manque l'équipement nécessaire. Leur productivité est sévèrement compromise.</ColonistNeedsSurvivalToolDesc>
    <SurvivalToolsNeedReplacing>Outils approchant de la défaillance</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>Ces colons utilisent des outils qui vont bientôt se briser. Remplacez-les immédiatement pour éviter l'interruption du travail.</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>Gérer les assignations d'outils</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>Assignation d'outil</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>Constructeur</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>Mineur</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>Travailleur des plantes</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>Chercheur</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>Nettoyeur</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>Médical</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>Boucher</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>Sélectionner l'assignation d'outil...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>Nouvelle assignation d'outil</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>Supprimer l'assignation d'outil...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>L'assignation d'outil est utilisée par {0}</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>Aucune assignation d'outil sélectionnée</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>Outils forcés</ForcedSurvivalTools>
    <!-- Settings -->
    <Settings_CompatLogging>Activer la journalisation de débogage de compatibilité</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Active la journalisation détaillée pour les systèmes de compatibilité de mods incluant l'intégration Research Reinvented, la détection de statistiques et le câblage WorkGiver. Affiche les processus étape par étape de configuration et d'intégration de compatibilité. Seulement affiché quand la journalisation de débogage générale est activée. Utile pour diagnostiquer les problèmes avec les interactions de mods.</Settings_CompatLogging_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Cliquez sur le bouton ci-dessous pour ouvrir la fenêtre de paramètres améliorée et redimensionnable avec toutes les options du mod.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Ouvrir les Paramètres Améliorés</Settings_OpenEnhancedButton>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>Types de Travaux</JobTable_JobTypes>
    <JobTable_JobType>Type de Travail</JobTable_JobType>
    <JobTable_NormalMode>Mode Normal</JobTable_NormalMode>
    <JobTable_HardcoreMode>Mode Hardcore</JobTable_HardcoreMode>
    <JobTable_ExtraHardcore>Hardcore Extrême</JobTable_ExtraHardcore>
    <JobTable_Enhanced>Amélioré</JobTable_Enhanced>
    <JobTable_Required>Requis</JobTable_Required>
    <JobTable_NoJobsFound>Aucun travail amélioré par des outils trouvé.</JobTable_NoJobsFound>
    <JobTable_SectionTitle>Exigences d'Outils par Mode</JobTable_SectionTitle>
    <JobTable_SectionTooltip>Ce tableau montre comment les différents types de travaux se comportent dans chaque mode de difficulté. 'Amélioré' signifie que les outils apportent des bonus mais ne sont pas obligatoires. 'Obligatoire' signifie que les outils sont nécessaires pour effectuer le travail. Utilisez ceci pour comprendre quels outils vos colons auront besoin selon vos paramètres actuels.</JobTable_SectionTooltip>
    <!-- Job Table Headers -->
    <JobTable_Normal>Normal</JobTable_Normal>
    <JobTable_Hardcore>Hardcore</JobTable_Hardcore>
    <JobTable_ExtraHardcore>Super Hardcore</JobTable_ExtraHardcore>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Cliquez sur le bouton ci-dessous pour ouvrir la fenêtre de paramètres améliorée et redimensionnable avec toutes les options du mod.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Ouvrir les Paramètres Améliorés</Settings_OpenEnhancedButton>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>Recherche Réinventée</Compat_ResearchReinvented>
    <Compat_FieldResearch>Recherche de Terrain</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>Recherche Réinventée</Compat_ReinventedResearchAlert>
    <!-- Configuration WorkSpeedGlobal (ajout) -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>Configuration des travaux vitesse générale</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>Sélectionnez quels travaux utilisant la statistique de vitesse de travail générale doivent être soumis aux outils de survie. Les travaux non soumis ignorent les pénalités d'outils lorsque les colons manquent d'équipement.</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>Type de travail</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>Soumis</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>Description</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>Aucun travail de vitesse générale trouvé.</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>Tout activer</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>Tout désactiver</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>Réinitialiser</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>Tracer WorkGivers</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>Nécessite des outils en modes hardcore</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>Aucune pénalité d'outil</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>Configurer les travaux vitesse générale</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (ajout) -->
    <JobTable_NoActiveMode>Aucun mode actif sélectionné.</JobTable_NoActiveMode>
    <JobTable_GatedFormat>Soumis ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>Soumis (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>Inconnu</JobTable_Status_Unknown>
    <JobTable_Blocked>Bloqué</JobTable_Blocked>
</LanguageData>
</file>

<file path="1.6/Languages/German/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>Axt</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>Ein grundlegendes Forstwerkzeug, das für effiziente Holzfällerarbeiten entwickelt wurde. Der gewichtige Kopf bietet kraftvolle Schlagkraft und macht es zu einem unverzichtbaren Werkzeug für Siedler, die in der Holzwirtschaft tätig sind. Seine Ausgewogenheit und sein Hebeleffekt machen es weitaus effektiver als improvisierte Schneidemethoden. Fungiert auch als zuverlässige Nahkampfwaffe, wenn das Überleben es erfordert.</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>Spitzhacke</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>Ein unverzichtbares Bergbauwerkzeug mit einem schweren, spitzen Kopf, der an einem robusten Griff befestigt ist. Speziell entwickelt, um harte Gesteine aufzubrechen und wertvolle Materialien effizient zu extrahieren. Seine konzentrierte Kraft und sein Hebeleffekt sind für produktive Bergbauoperationen unerlässlich. Kann auch als improvisierte Waffe verwendet werden, wenn es die Umstände erfordern.</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>Hammer</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>Ein grundlegendes Werkzeug für jedes Bauprojekt. Dieser vielseitige Hammer bietet die nötige Präzision und Kraft zum Einschlagen von Befestigungselementen, Formen von Materialien und Zusammenbauen von Strukturen. Unverzichtbar für Siedler, die in Bau- und Wartungsarbeiten tätig sind. Sein ausgewogenes Design gewährleistet effektive Schläge bei minimaler Ermüdung während längerer Bauarbeiten.</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>Sichel</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>Ein spezialisiertes landwirtschaftliches Werkzeug mit einer gekrümmten Schneide, die perfekt für das Ernten von Feldfrüchten und das Schneiden von Pflanzenmaterial entwickelt wurde. Das ergonomische Design ermöglicht effiziente, wiederholende Schneidebewegungen bei minimaler Belastung des Benutzers. Unverzichtbar für produktive landwirtschaftliche Betriebe und Pflanzenwartungsarbeiten.</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>Hacke</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>Ein grundlegendes landwirtschaftliches Werkzeug, das für die Bodenbearbeitung und das Pflanzen von Samen entwickelt wurde. Sein spitzes Design bricht den Boden effizient auf und schafft optimale Pflanzenbedingungen. Unverzichtbar für die Etablierung produktiver landwirtschaftlicher Betriebe und die Aufrechterhaltung der Ernteerträge. Seine robuste Konstruktion gewährleistet zuverlässige Leistung durch die Saisons.</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>Messer</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>Ein vielseitiges Schneidewerkzeug mit einer scharfen Klinge, die für Präzisionsarbeiten unverzichtbar ist. Ideal für Fleischzerlegungsarbeiten, medizinische Verfahren und allgemeine Schneidaufgaben. Sein ausgewogenes Design ermöglicht kontrollierte, präzise Schnitte, während die scharfe Klinge saubere Arbeit gewährleistet. Ein unverzichtbares Werkzeug für jeden ernsthaften Siedler.</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>Handsäge</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>Ein traditionelles Holzbearbeitungswerkzeug mit einer Metallklinge mit präzise geschnittenen Zähnen für die manuelle Holzbearbeitung. Unverzichtbar für Bauprojekte, die maßgeschnittenes Holz und detaillierte Holzarbeiten erfordern. Das gleichmäßige Tempo einer Handsäge mag länger dauern als Elektrowerkzeuge, bietet aber hervorragende Kontrolle und Präzision.</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>Knochensichel</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>Ein primitives Erntewerkzeug aus geschnitzten Knochen mit einer geschärften Kante. Obwohl nicht so langlebig wie ihre Metallgegenstücke, dient dieses traditionelle Werkzeug bewundernswert beim Ernten von Feldfrüchten und Schneiden von Pflanzen. Sein gekrümmtes Design folgt alten Mustern, die ihre Wirksamkeit durch unzählige Generationen landwirtschaftlicher Arbeit bewiesen haben.</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>Brecheisen</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>Ein primitives, aber effektives Hebelwerkzeug aus langlebigen Materialien. Unverzichtbar zum Auseinandernehmen von Strukturen, Trennen von Materialien und Durchführen grundlegender mechanischer Operationen. Repräsentiert den Einfallsreichtum früher Zivilisationen bei der Entwicklung praktischer Lösungen für Bau- und Abrissarbeiten ohne fortgeschrittene Technologie.</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>Abakus</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>Ein altes Rechenwerkzeug mit beweglichen Perlen, die auf Stäben angeordnet sind, um arithmetische Operationen durchzuführen. Unverzichtbar für die Organisation von Forschungsdaten, die Verwaltung komplexer Berechnungen und die Führung genauer Aufzeichnungen in Gesellschaften ohne fortgeschrittene Rechengeräte. Repräsentiert die Grundlage mathematischen Denkens und Datenorganisation.</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>Stahlmesser</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>Ein präzise geschmiedetes Stahlmesser mit überlegener Schärfehaltung und Haltbarkeit. Die Kohlenstoffstahlklinge behält ihre Schärfe durch extensive Nutzung bei und macht es ideal für anspruchsvolle Fleischzerlegungs- und medizinische Arbeiten. Der ergonomische Griff bietet hervorragende Kontrolle bei feinen Arbeiten.</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>Quersäge</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>Eine Präzisions-Industriesäge für effiziente Holzbearbeitung und Bauarbeiten. Ihre speziell entwickelten Zähne und verstärkte Stahlkonstruktion ermöglichen saubere, präzise Schnitte durch verschiedene Materialien. Unverzichtbar für große Bauprojekte und fortgeschrittene Holzarbeiten.</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>Schraubenschlüssel</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>Ein Präzisions-Maschinenwerkzeug zum Greifen, Drehen und Manipulieren von Befestigungselementen und mechanischen Komponenten. Entscheidend für Wartungsarbeiten, Maschinenreparaturen und Bauprojekte, die präzise Anpassungen erfordern. Das verstellbare Backensystem bietet optimalen Hebeleffekt und Kontrolle bei der Anpassung an verschiedene Größen.</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>Mikroskop</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>Ein präzises optisches Instrument, das kleine Objekte und Proben zur detaillierten Untersuchung vergrößert. Unverzichtbar für fortgeschrittene Forschung, biologische Studien und wissenschaftliche Analysen.</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>Hartmetall-Spitzhacke</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>Ein fortgeschrittenes Bergbauwerkzeug mit einer Hartmetall-Spitze, die ihre Schärfe durch die anspruchsvollsten Grabarbeiten behält. Der präzise entwickelte Kopf schneidet Gestein effizienter als Standardwerkzeuge, während seine verstärkte Konstruktion außergewöhnliche Haltbarkeit unter rauen Bergbaubedingungen gewährleistet.</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>Präzisionsskalpell</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>Ein ultrascherfer chirurgischer Instrument aus hochwertigen Stahllegierungen gefertigt. Die sorgfältig ausgewogene Klinge behält ihre Schärfe durch wiederholte Sterilisation und Verwendung bei, während der ergonomische Griff präzise Kontrolle während feiner medizinischer Verfahren gewährleistet. Standardausrüstung für fortgeschrittene medizinische Einrichtungen.</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>Elektrische Bohrmaschine</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>Ein mechanisiertes Bohrwerkzeug, das von einem eingebauten Motor angetrieben wird und harte Materialien mit Präzision und Geschwindigkeit durchbohren kann. Der variable Geschwindigkeitsmotor und austauschbare Bits machen es äußerst wertvoll für Bau- und Maschinenarbeiten. Erfordert regelmäßige Wartung, um den Motor reibungslos am Laufen zu halten.</SurvivalTools_PowerDrill.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>Glitterwelt-Multitool</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>Ein hochtechnologisches Universalwerkzeug, das häufig von Hausmechanoiden in Glitterwelt-Gesellschaften verwendet wird. Dieses fortgeschrittene Gerät passt sich nahtlos an jede Aufgabe an - Bau, Bergbau, Forstwirtschaft, Wartung, Abriss - und macht es zum ultimativen All-in-One-Überlebenswerkzeug. Obwohl für Mechanoiden entwickelt, ist es aufgrund physiologischer Ähnlichkeiten vollständig von Humanoiden verwendbar.</SurvivalTools_Multitool.description>
    <SurvivalTools_PileOfRags.label>Lumpenhaufen</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>Ein einfaches Reinigungswerkzeug aus Lumpen und Stoffresten. Nützlich für grundlegende Reinigungsarbeiten, aber nutzt sich schnell ab.</SurvivalTools_PileOfRags.description>
    <!-- =================================================== -->
    <!-- MEHRZWECK-ALLGEMEINWERKZEUGE (WorkSpeedGlobal)       -->
    <!-- Neue Tool-Defs benötigen Einträge                   -->
    <!-- =================================================== -->
    <!-- Tribal / Primitiv Stufe -->
    <SurvivalTools_MultipurposeStoneTool.label>mehrzweck-steinwerkzeug</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>Ein robustes, vielseitiges Steinwerkzeug, geformt um viele allgemeine Aufgaben abzudecken. Primitiv, aber verleiht einen kleinen Bonus auf die gesamte Arbeitsgeschwindigkeit.</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>geschnitzte knochenimplements</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>Ein Bündel sorgfältig geschnitzter Knochengeräte für Mehrzweckgebrauch. Zerbrechlich, aber effizient geformt und verleiht einen bemerkbaren Schub zur allgemeinen Arbeitsgeschwindigkeit.</SurvivalTools_CarvedBoneImplements.description>
    <!-- Mittelalter Stufe -->
    <SurvivalTools_ArtisansToolkit.label>werkzeugsatz des handwerkers</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>Eine kuratierte Sammlung mittelalterlicher Qualitätswerkzeuge zum Fertigen, Formen und Montieren. Verbessert den Gesamtdurchsatz vieler Aufgaben.</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>holzarbeiter-kit</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>Eine spezialisierte Auswahl aus Sägen, Meißeln, Hobeln und Lehren für Holzformung und Verbindungen. Organisation und Qualität gewähren einen starken Bonus auf die allgemeine Arbeitsgeschwindigkeit.</SurvivalTools_WoodworkersKit.description>
    <!-- Industrielle Stufe -->
    <SurvivalTools_MechanicsToolkit.label>werkzeugsatz des mechanikers</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>Ein gut organisierter Industriesatz mit Präzisionsschlüsseln, Lehren, Drehmomentwerkzeugen und Schnellzugriffsaufbewahrung. Verbessert den Ablauf und die Koordination allgemeiner Aufgaben stark.</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>werkstatt-schlagbohrer</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>Ein schwerer, angetriebener Schlagbohrer mit austauschbaren Schlag- und Rotationsmodulen. Das integrierte Spann- und Ausrichtungssystem beschleunigt nahezu jede mechanische oder bauliche Aufgabe.</SurvivalTools_WorkshopHammerDrill.description>
    <!-- Spacer / Ultra-Tech Stufe -->
    <SurvivalTools_NanofabricatorInterface.label>nanofabrikations-interface</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>Ein schlankes Steuer- und Verstärkungsmodul, das die Bewegungen des Benutzers mit adaptiven Nano-Assemblierungsroutinen synchronisiert. Steigert die Effizienz allgemeiner Aufgaben dramatisch.</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>omni-werkzeugstulpe</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>Eine hochmoderne modulare Stulpe mit Feldprojektoren, Mikro-Fabrikatoren und kraftausgerichteten Manipulatoren. Bietet durch prädiktive Optimierung einen unerreichten Anstieg der allgemeinen Arbeitsgeschwindigkeit.</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>

<file path="1.6/Languages/German/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <NoTool>Kein Werkzeug</NoTool>
    <ToolInUse>(im Gebrauch)</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>Überlebenswerkzeuge</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>Grundeinstellungen</Settings_BasicSection>
    <Settings_DebugSection>Debug-Einstellungen</Settings_DebugSection>
    <Settings_HardcoreMode>Hardcore-Modus</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>Erhöht die Schwierigkeit erheblich, indem Werkzeuge für das Überleben unverzichtbar werden. Ohne geeignete Werkzeuge können Kolonisten die meisten Arbeitsaufgaben nicht effektiv ausführen. Werkzeuge verschleißen auch 50% schneller und erfordern häufigeren Austausch und besseres Werkzeugmanagement. Verwandelt das Spiel in eine echte werkzeugabhängige Überlebenserfahrung.</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>Extrem-Hardcore-Modus</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>MAXIMALE SCHWIERIGKEIT: Die ultimative Überlebensherausforderung. In Kombination mit dem Hardcore-Modus werden Kolonisten ohne die richtigen Werkzeuge völlig hilflos. Aufgaben, die nur ineffizient waren (wie Reinigung von Hand oder improvisierte medizinische Versorgung), werden unmöglich zu versuchen. Werkzeuge verschleißen 87,5% schneller als normal und erzeugen ständigen Druck für Werkzeugproduktion und -wartung. Verwenden Sie die Kontrollkästchen unten, um genau zu steuern, welche Arbeitstypen werkzeugabhängig werden. WARNUNG: Das frühe Spiel wird extrem herausfordernd - Werkzeugbeschaffung wird kritisch für das Kolonieüberleben!</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>Reinigungswerkzeuge erforderlich</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>Zwingt Kolonisten, geeignete Reinigungswerkzeuge (wie Besen oder Wischmöpps) für alle Reinigungsaufgaben zu verwenden. Ohne die richtigen Werkzeuge können sie keine Böden reinigen, Schmutz entfernen oder Schnee räumen. Unverzichtbar für die Aufrechterhaltung der Koloniehygiene in extremen Schwierigkeitsmodi.</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>Schlachterwerkzeuge erforderlich</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>Verlangt geeignete Schneidwerkzeuge (wie Messer oder Hackmesser) für alle Schlachtungs- und Tötungsoperationen. Kolonisten können ohne geeignete Klingen kein Fleisch verarbeiten oder Tiere schlachten. Kritisch für Nahrungsproduktionsketten in Hardcore-Szenarien.</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>Medizinische Werkzeuge erforderlich</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>Erzwingt die Verwendung spezialisierter medizinischer Instrumente für chirurgische Eingriffe und fortgeschrittene medizinische Versorgung. Operationen werden ohne geeignete chirurgische Werkzeuge unmöglich, wodurch die Beschaffung medizinischer Ausrüstung für Koloniegesundheit und Überleben lebenswichtig wird.</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>Werkzeuge in verfallenen Gebäuden</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>Erzeugt grundlegende Überlebenswerkzeuge in antiken Ruinen und abgestürzten Strukturen während der Kartengenerierung. Diese verwitterten Werkzeuge bieten wichtige Ressourcen für das frühe Spiel, sind aber typischerweise von geringer Qualität. Unschätzbar wertvoll für startende Kolonien in harten Schwierigkeitsmodi, wo anfänglicher Werkzeugzugang kritisch ist.</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>Werkzeugtragelimit</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>Beschränkt Kolonisten darauf, maximal 2-3 Werkzeuge gleichzeitig in ihrem Inventar zu tragen (außer Karawanenreisen). Erzwingt strategisches Werkzeugmanagement und Spezialisierung unter Kolonisten. Werkzeuggürtel und ähnliche Ausrüstung können dieses Limit über den Grundwert hinaus erhöhen. Fügt realistische Inventarbeschränkungen zur Werkzeugnutzung hinzu.</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>Werkzeugverschleißrate</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>Automatische Werkzeugoptimierung</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>Ermöglicht intelligentes Werkzeugmanagement, bei dem Kolonisten automatisch die effektivsten Werkzeuge für ihre zugewiesene Arbeit auswählen und tragen. Sie upgraden zu besseren Werkzeugen und lassen schlechtere fallen, wie benötigt. Deaktivieren Sie dies, wenn Sie manuelle Werkzeugkontrolle bevorzugen oder Leistungsprobleme mit modierten Materialien erleben.</Settings_ToolOptimization_Tooltip>
    <Settings_PickupFromStorageOnly>Werkzeugaufnahme auf Lagerbereiche beschränken</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>Wenn aktiviert, erhalten Kolonisten nur Werkzeuge aus bestimmten Lagerzonen, wodurch bessere Organisation gewährleistet und verhindert wird, dass sie Werkzeuge aus Arbeitsbereichen greifen. Wenn deaktiviert, können sie jedes zugängliche Werkzeug im Heimbereich aufheben (außer verbotene oder brennende Gegenstände), was mehr Flexibilität bietet, aber weniger Kontrolle.</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_DebugLogging>Detaillierte Debug-Protokollierung aktivieren</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>Aktiviert umfassende Protokollierung von Werkzeugauswahlentscheidungen, automatischem Aufnahmeverhalten und Job-Werkzeug-Matching-Logik. Wesentlich für die Fehlerbehebung bei Werkzeugproblemen oder das Verstehen, warum Kolonisten bestimmte Werkzeuge wählen. Nur für Mod-Entwicklung oder bei werkzeugbezogenen Problemen empfohlen. Kann die Leistung mit umfangreicher Protokollausgabe beeinträchtigen.</Settings_DebugLogging_Tooltip>
    <Settings_AutoTool>Intelligente Werkzeugaufnahme vor der Arbeit</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>Revolutioniert die Workflow-Effizienz, indem Kolonisten automatisch das optimale Werkzeug erhalten, bevor sie mit einer Arbeit beginnen. Sie tauschen intelligent Werkzeuge aus, upgraden zu besseren Varianten und sorgen dafür, dass sie die richtige Ausrüstung für maximale Produktivität haben. Die Grundlagenfunktion für nahtloses werkzeugbasiertes Gameplay.</Settings_AutoTool_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>Kolonist benötigt unverzichtbare Werkzeuge</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>Kolonisten benötigen unverzichtbare Werkzeuge</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>Diese Kolonisten benötigen geeignete Werkzeuge für ihre zugewiesene Arbeit, aber ihnen fehlt die notwendige Ausrüstung. Ihre Produktivität ist schwer beeinträchtigt.</ColonistNeedsSurvivalToolDesc>
    <SurvivalToolsNeedReplacing>Werkzeuge nähern sich dem Versagen</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>Diese Kolonisten verwenden Werkzeuge, die bald brechen werden. Ersetzen Sie sie sofort, um Arbeitsunterbrechungen zu vermeiden.</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>Werkzeugzuweisungen verwalten</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>Werkzeugzuweisung</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>Bauarbeiter</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>Bergarbeiter</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>Pflanzenarbeiter</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>Forscher</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>Reiniger</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>Medizinisch</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>Schlachter</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>Werkzeugzuweisung auswählen...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>Neue Werkzeugzuweisung</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>Werkzeugzuweisung löschen...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>Werkzeugzuweisung wird von {0} verwendet</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>Keine Werkzeugzuweisung ausgewählt</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>Erzwungene Werkzeuge</ForcedSurvivalTools>
    <!-- Settings -->
    <Settings_CompatLogging>Kompatibilitäts-Debug-Protokollierung aktivieren</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Aktiviert detaillierte Protokollierung für Mod-Kompatibilitätssysteme einschließlich Research Reinvented Integration, Statistikerkennung und WorkGiver-Verkabelung. Zeigt schrittweise Kompatibilitäts-Setup und Integrationsprozesse. Wird nur angezeigt, wenn die allgemeine Debug-Protokollierung aktiviert ist. Nützlich zur Diagnose von Problemen mit Mod-Interaktionen.</Settings_CompatLogging_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Klicken Sie auf die Schaltfläche unten, um das erweiterte, größenveränderbare Einstellungsfenster mit allen Mod-Optionen zu öffnen.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Erweiterte Einstellungen Öffnen</Settings_OpenEnhancedButton>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>Arbeitstypen</JobTable_JobTypes>
    <JobTable_JobType>Arbeitstyp</JobTable_JobType>
    <JobTable_NormalMode>Normaler Modus</JobTable_NormalMode>
    <JobTable_HardcoreMode>Hardcore-Modus</JobTable_HardcoreMode>
    <JobTable_ExtraHardcore>Extrem-Hardcore</JobTable_ExtraHardcore>
    <JobTable_Enhanced>Verbessert</JobTable_Enhanced>
    <JobTable_Required>Erforderlich</JobTable_Required>
    <JobTable_NoJobsFound>Keine werkzeugverbesserten Arbeiten gefunden.</JobTable_NoJobsFound>
    <JobTable_SectionTitle>Werkzeuganforderungen nach Modus</JobTable_SectionTitle>
    <JobTable_SectionTooltip>Diese Tabelle zeigt, wie sich verschiedene Arbeitstypen in jedem Schwierigkeitsmodus verhalten. 'Verbessert' bedeutet, dass Werkzeuge Boni bieten, aber nicht erforderlich sind. 'Erforderlich' bedeutet, dass Werkzeuge zur Ausführung der Arbeit notwendig sind. Verwenden Sie dies, um zu verstehen, welche Werkzeuge Ihre Kolonisten basierend auf Ihren aktuellen Einstellungen benötigen.</JobTable_SectionTooltip>
    <!-- Job Table Headers -->
    <JobTable_Normal>Normal</JobTable_Normal>
    <JobTable_Hardcore>Hardcore</JobTable_Hardcore>
    <JobTable_ExtraHardcore>Extra Hardcore</JobTable_ExtraHardcore>
    <!-- Pacifist Tool Settings -->
    <Settings_AllowPacifistEquip>Pazifisten das Ausrüsten von Überlebenswerkzeugen erlauben</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>Erlaubt pazifistischen Kolonisten, Überlebenswerkzeuge auszurüsten, die als Waffen klassifiziert sind (wie Äxte, Spitzhacken oder Messer). Obwohl diese Werkzeuge Kampffähigkeiten haben, sind sie für Arbeitsaufgaben wie Baumfällung, Bergbau oder Nahrungszubereitung unverzichtbar. Wenn aktiviert, können Pazifisten diese Werkzeuge für produktive Arbeit verwenden, während sie sich weiterhin weigern, sich an Gewalt zu beteiligen.</Settings_AllowPacifistEquip_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Klicken Sie auf die Schaltfläche unten, um das erweiterte, in der Größe veränderbare Einstellungsfenster mit allen Mod-Optionen zu öffnen.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Erweiterte Einstellungen Öffnen</Settings_OpenEnhancedButton>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>Neu Erfundene Forschung</Compat_ResearchReinvented>
    <Compat_FieldResearch>Feldforschung</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>Neu Erfundene Forschung</Compat_ReinventedResearchAlert>
    <!-- WorkSpeedGlobal Konfiguration (hinzugefügt) -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>Konfiguration allgemeine Arbeitsgeschwindigkeit</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>Wählen Sie, welche Arbeiten, die die allgemeine Arbeitsgeschwindigkeits-Stat verwenden, durch Überlebenswerkzeuge begrenzt werden sollen. Nicht begrenzte Arbeiten ignorieren Werkzeugstrafen ohne passende Werkzeuge.</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>Arbeitstyp</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>Begrenzt</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>Beschreibung</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>Keine allgemeinen Arbeitsgeschwindigkeits-Jobs gefunden.</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>Alle aktivieren</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>Alle deaktivieren</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>Standard wiederherstellen</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>WorkGivers protokollieren</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>Benötigt Werkzeuge in Hardcore-Modi</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>Keine Werkzeugstrafen</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>Allgemeine Arbeitsgeschwindigkeits-Jobs konfigurieren</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (hinzugefügt) -->
    <JobTable_NoActiveMode>Kein aktiver Modus ausgewählt.</JobTable_NoActiveMode>
    <JobTable_GatedFormat>Begrenzt ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>Begrenzt (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>Unbekannt</JobTable_Status_Unknown>
    <JobTable_Blocked>Blockiert</JobTable_Blocked>
</LanguageData>
</file>

<file path="1.6/Languages/Japanese/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>斧</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>効率的な伐採作業のために設計された基本的な林業工具。重みのある刃頭が強力な切断力を発揮し、木材作業に従事する入植者にとって不可欠な道具です。バランスとレバレッジにより、即席の切断方法よりもはるかに優れた性能を発揮します。生存が求められる時には信頼できる近接武器としても機能します。</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>つるはし</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>頑丈な柄に取り付けられた重く尖った頭部を特徴とする必須の採掘道具。固い岩を破砕し、貴重な材料を効率的に抽出するために特別に設計されています。集中した力とレバレッジは生産的な採掘作業に不可欠です。状況が必要とする時には即席の武器としても使用できます。</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>ハンマー</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>あらゆる建設プロジェクトの基礎となる工具。この多目的ハンマーは、留め具の打ち込み、材料の成形、構造物の組み立てに必要な精度と力を提供します。建設・保守作業に従事する入植者にとって不可欠です。バランスの取れた設計により、長時間の建設作業中の疲労を最小限に抑えながら効果的な打撃を確保します。</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>鎌</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>作物の収穫と植物材料の切断のために完璧に設計された湾曲した切断刃を特徴とする専門的な農業工具。人間工学的設計により、ユーザーの負担を軽減しながら効率的で反復的な切断動作を可能にします。生産的な農業運営と植物保守作業に不可欠です。</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>鍬</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>土壌準備と種子植え付けのために設計された基本的な農業器具。尖った設計により土を効率的に破砕し、最適な植え付け条件を作り出します。生産的な農業運営の確立と作物収量の維持に不可欠です。頑丈な構造により、季節を通じて信頼できる性能を保証します。</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>ナイフ</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>精密作業に不可欠な鋭い刃を持つ多目的切断器具。食肉解体作業、医療処置、一般的な切断作業に最適です。バランスの取れた設計により制御された正確な切断を可能にし、鋭い刃がきれいな作業を保証します。真剣な入植者にとって不可欠な工具です。</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>手鋸</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>手動での木材加工のために設計された精密に切断された歯を持つ金属刃を特徴とする伝統的な木工工具。カスタムカットされた木材と詳細な木工を必要とする建設プロジェクトに不可欠です。手鋸の安定したリズムは電動工具よりも時間がかかるかもしれませんが、優れた制御と精度を提供します。</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>骨の鎌</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>研がれた縁を持つ彫刻された骨から作られた原始的な収穫工具。金属版ほど耐久性はありませんが、この伝統的な器具は作物の収穫と植物の切断に見事に役立ちます。湾曲した設計は、数え切れない世代の農業作業を通じて効果が証明された古代のパターンに従っています。</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>バール</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>耐久性のある材料から作られた原始的だが効果的なレバレッジ工具。構造物の解体、材料の分離、基本的な機械操作の実行に不可欠です。先進技術なしに建設・解体作業の実用的な解決策を開発する初期文明の創意工夫を表しています。</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>そろばん</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>算術演算を実行するためにロッドに配置された可動ビーズを特徴とする古代の計算器具。研究データの整理、複雑な計算の管理、先進的な計算装置のない社会での正確な記録の維持に不可欠です。数学的思考とデータ組織の基礎を表しています。</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>鋼鉄ナイフ</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>優れた刃保持力と耐久性を持つ精密鍛造された鋼鉄ナイフ。高炭素鋼の刃は広範囲な使用を通じてその鋭さを維持し、要求の厳しい食肉解体と医療作業に理想的です。人間工学的なハンドルは繊細な作業での優れた制御を提供します。</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>横挽き鋸</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>効率的な木材加工と建設作業のために設計された精密工業用鋸。特別に設計された歯と強化された鋼構造により、様々な材料を通じてきれいで正確な切断を可能にします。大規模建設プロジェクトと先進的な木工作業に不可欠です。</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>レンチ</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>留め具と機械部品の把持、回転、操作のために設計された精密機械工具。保守作業、機械修理、正確な調整を必要とする建設プロジェクトに重要です。調整可能なジョー設計により、最適なレバレッジと制御を提供しながら様々なサイズに対応します。</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>顕微鏡</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>小さな物体と標本を詳細に検査するために拡大する精密光学器具。先進的な研究、生物学的研究、科学的分析に不可欠です。</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>カーバイドつるはし</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>最も要求の厳しい掘削作業を通じてその鋭さを維持するカーバイド先端刃を特徴とする先進的な採掘器具。精密設計された頭部は標準工具よりも効率的に岩を切断し、強化された構造は過酷な採掘条件での例外的な耐久性を保証します。</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>精密メス</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>最高級の鋼合金から作られた超鋭利な外科器具。慎重にバランス調整された刃は繰り返しの殺菌と使用を通じてその刃を維持し、人間工学的なハンドルは繊細な医療処置中の精密な制御を保証します。先進的な医療施設の標準設備です。</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>電動ドリル</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>内蔵モーターによって駆動され、精度と速度で堅い材料を穿孔できる機械化された穿孔工具。可変速度モーターと交換可能なビットにより、建設と機械作業に非常に貴重です。モーターをスムーズに動作させ続けるために定期的なメンテナンスが必要です。</SurvivalTools_PowerDrill.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>グリッターワールドマルチツール</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>グリッターワールド社会で家庭用メカノイドによって一般的に使用される高技術汎用工具。この先進的な装置は、建設、採掘、林業、保守、解体など、あらゆる作業にシームレスに適応でき、究極のオールインワン生存工具となります。メカノイド用に設計されていますが、生理学的類似性により人間型にも完全に使用可能です。</SurvivalTools_Multitool.description>
    <SurvivalTools_PileOfRags.label>ぼろ布の山</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>ぼろ布と布切れで作られたシンプルな清掃道具。基本的な清掃作業には有用ですが、すぐに摩耗します。</SurvivalTools_PileOfRags.description>
    <!-- =================================================== -->
    <!-- 汎用多目的作業ツール (WorkSpeedGlobal)             -->
    <!-- 新規ツール定義のローカライズ                       -->
    <!-- =================================================== -->
    <!-- 部族 / 原始ティア -->
    <SurvivalTools_MultipurposeStoneTool.label>多目的石器</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>多くの一般作業をカバーする形状に整えられた頑丈で多用途な石製器具。原始的ではあるが、全体的な作業速度をわずかに高める。</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>彫刻骨製用具束</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>丁寧に彫刻された複数の骨製小道具を束ねた多目的セット。脆いが効率的な形状で、一般作業速度に目立つ向上を与える。</SurvivalTools_CarvedBoneImplements.description>
    <!-- 中世ティア -->
    <SurvivalTools_ArtisansToolkit.label>職人工具セット</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>製作・整形・組立のために厳選された中世期品質の工具コレクション。多数の作業全体の処理スループットを向上させる。</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>木工職人工具キット</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>木材成形と仕口作業に最適化された鋸・鑿・鉋・ゲージ類の専門アソート。整理と品質により一般作業速度へ強力なボーナスを付与。</SurvivalTools_WoodworkersKit.description>
    <!-- 産業ティア -->
    <SurvivalTools_MechanicsToolkit.label>整備技師ツールキット</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>精密レンチ、ゲージ、トルク用具と迅速アクセス収納を収めた産業期の整理済みキット。一般タスクの流れと連携を大幅に改善する。</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>工房用ヘビーデューティーハンマードリル</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>打撃と回転モジュールを交換可能な重作業用動力ハンマードリル。統合されたクランプとアライメント機構がほぼ全ての機械/建設タスクを加速する。</SurvivalTools_WorkshopHammerDrill.description>
    <!-- スペーサー / 超先進ティア -->
    <SurvivalTools_NanofabricatorInterface.label>ナノファブリケータ・インターフェース</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>ユーザーの動作を適応型ナノ組立ルーチンと同期させる流線型の制御・強化モジュール。一般タスク遂行効率を劇的に向上させる。</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>オムニツール・ガントレット</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>フィールドプロジェクタ、マイクロファブリケータ、力整列マニピュレータを内蔵した最先端モジュラーガントレット。予測的最適化により一般作業速度を比類なきほど引き上げる。</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>

<file path="1.6/Languages/Japanese/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <NoTool>ツールなし</NoTool>
    <ToolInUse>（使用中）</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>サバイバルツール</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>基本設定</Settings_BasicSection>
    <Settings_DebugSection>デバッグ設定</Settings_DebugSection>
    <Settings_HardcoreMode>ハードコアモード</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>ツールを生存に不可欠なものにして、難易度を大幅に向上させます。適切なツールがないと、入植者はほとんどの作業タスクを効果的に実行できなくなります。ツールの摩耗も50%速くなり、より頻繁な交換とより良いツール管理が必要になります。ゲームを真のツール依存のサバイバル体験に変えます。</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>エクストリームハードコアモード</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>最大難易度：究極のサバイバルチャレンジ。ハードコアモードと組み合わせると、入植者は適切なツールなしに完全に無力になります。単に非効率だったタスク（手作業での清掃や即席の医療ケア）が試行不可能になります。ツールは通常よりも87.5%速く劣化し、ツール製造と保守に継続的な圧力をかけます。下のチェックボックスでどの作業タイプがツール依存になるかを正確に制御してください。警告：初期ゲームが極めて困難になります - ツールの獲得がコロニーの生存に重要になります！</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>清掃ツールが必要</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>すべての清掃タスクで適切な清掃ツール（ほうきやモップなど）の使用を強制します。適切なツールがないと、床を清掃したり、汚れを除去したり、雪を片付けたりできません。極端な難易度モードでコロニーの衛生を維持するために不可欠です。</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>屠畜ツールが必要</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>すべての屠畜と殺処分作業で適切な切断ツール（ナイフや肉切り包丁など）を義務付けます。適切な刃物がないと、入植者は肉を処理したり動物を殺処分したりできません。ハードコアシナリオでの食料生産チェーンに重要です。</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>医療ツールが必要</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>外科手術と高度な医療ケアで専門の医療器具の使用を強制します。適切な手術ツールがないと手術が不可能になり、医療機器の獲得をコロニーの健康と生存に不可欠にします。</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>廃墟の建物にツール</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>マップ生成中に古代の廃墟や墜落した構造物に基本的なサバイバルツールを生成します。これらの風化したツールは重要な初期ゲームリソースを提供しますが、通常は低品質です。初期ツールアクセスが重要な厳しい難易度モードでコロニーを開始するのに非常に価値があります。</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>ツール携帯制限</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>入植者が同時にインベントリに運べるツールを最大2-3個に制限します（キャラバン旅行を除く）。入植者間での戦略的ツール管理と専門化を強制します。ツールベルトと類似の装備はこの制限を増加させることができます。ツール使用に現実的なインベントリ制約を追加します。</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>ツール劣化率</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>自動ツール最適化</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>入植者が割り当てられた作業のために最も効果的なツールを自動的に選択して運ぶインテリジェントツール管理を有効にします。必要に応じてより良いツールにアップグレードし、劣ったツールを落とします。手動ツール制御を好むか、モッド材料でパフォーマンスの問題を経験する場合はこれを無効にしてください。</Settings_ToolOptimization_Tooltip>
    <Settings_PickupFromStorageOnly>ストレージエリアからのツール取得制限</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>有効にすると、入植者は指定されたストレージゾーンからのみツールを取得し、より良い組織を維持し、作業エリアからツールを掴むのを防ぎます。無効にすると、ホームエリア内のアクセス可能なツール（禁止されたアイテムや燃えているアイテムを除く）を拾うことができ、より柔軟性を提供しますが制御は少なくなります。</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_DebugLogging>詳細デバッグログを有効</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>ツール選択決定、自動取得行動、ジョブ-ツールマッチングロジックの包括的なログ記録を有効にします。ツールの問題のトラブルシューティングや入植者が特定のツールを選ぶ理由を理解するために不可欠です。モッド開発やツール関連の問題を経験している場合のみ推奨します。広範なログ出力でパフォーマンスに影響する可能性があります。</Settings_DebugLogging_Tooltip>
    <Settings_AutoTool>スマート作業前ツール取得</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>入植者が任意の仕事を始める前に自動的に最適なツールを取得することで、ワークフロー効率を革命的に改善します。ツールをインテリジェントに交換し、より良いバリエーションにアップグレードし、最大生産性のために適切な機器を確保します。シームレスなツールベースのゲームプレイの基盤機能です。</Settings_AutoTool_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>入植者が必要なツールを欠いている</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>入植者が必要なツールを欠いている</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>これらの入植者は割り当てられた作業に適切なツールが必要ですが、必要な機器がありません。生産性が深刻に損なわれています。</ColonistNeedsSurvivalToolDesc>
    <SurvivalToolsNeedReplacing>ツールが故障近い</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>これらの入植者は間もなく壊れる危険な状態のツールを使用しています。作業中断を避けるため即座に交換してください。</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>ツール割り当て管理</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>ツール割り当て</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>建設者</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>採掘者</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>植物作業者</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>研究者</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>清掃者</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>医療</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>屠畜者</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>ツール割り当てを選択...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>新しいツール割り当て</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>ツール割り当てを削除...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>ツール割り当ては{0}によって使用されています</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>ツール割り当てが選択されていません</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>強制ツール</ForcedSurvivalTools>
    <!-- Settings -->
    <Settings_CompatLogging>互換性デバッグログを有効にする</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Research Reinvented統合、統計検出、WorkGiver配線を含むMOD互換性システムの詳細ログを有効にします。互換性設定と統合プロセスのステップバイステップを表示します。一般的なデバッグログが有効な場合にのみ表示されます。MODの相互作用の問題の診断に役立ちます。</Settings_CompatLogging_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>下のボタンをクリックして、すべてのモッドオプションを含む拡張されたリサイズ可能な設定ウィンドウを開いてください。</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>拡張設定を開く</Settings_OpenEnhancedButton>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>ジョブタイプ</JobTable_JobTypes>
    <JobTable_JobType>ジョブタイプ</JobTable_JobType>
    <JobTable_Normal>ノーマル</JobTable_Normal>
    <JobTable_Hardcore>ハードコア</JobTable_Hardcore>
    <JobTable_NormalMode>ノーマルモード</JobTable_NormalMode>
    <JobTable_HardcoreMode>ハードコアモード</JobTable_HardcoreMode>
    <JobTable_ExtraHardcore>エクストリームハードコア</JobTable_ExtraHardcore>
    <JobTable_Enhanced>強化</JobTable_Enhanced>
    <JobTable_Required>必須</JobTable_Required>
    <JobTable_NoJobsFound>ツール強化されたジョブが見つかりませんでした。</JobTable_NoJobsFound>
    <JobTable_SectionTitle>モード別ジョブツール要件</JobTable_SectionTitle>
    <JobTable_SectionTooltip>このテーブルは、各難易度モードで異なるジョブタイプがどのように動作するかを示します。「強化」はツールがボーナスを提供するが必須ではないことを意味します。「必須」はジョブを実行するためにツールが必要であることを意味します。現在の設定に基づいて入植者にどのツールが必要かを理解するためにこれを使用してください。</JobTable_SectionTooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>下のボタンをクリックして、すべてのMODオプションを含む拡張されたサイズ変更可能な設定ウィンドウを開きます。</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>拡張設定を開く</Settings_OpenEnhancedButton>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>研究再発明</Compat_ResearchReinvented>
    <Compat_FieldResearch>フィールド研究</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>研究再発明</Compat_ReinventedResearchAlert>
    <!-- Pacifist Tool Settings -->
    <Settings_AllowPacifistEquip>平和主義者がサバイバルツールを装備することを許可</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>武器として分類されているサバイバルツール（斧、つるはし、ナイフなど）を平和主義の入植者が装備することを許可します。これらのツールは戦闘能力を持っていますが、木の伐採、採掘、食料準備などの作業タスクに不可欠です。有効にすると、平和主義者は暴力に関与することを拒否しながら、生産的な作業にこれらのツールを使用できます。</Settings_AllowPacifistEquip_Tooltip>
    <!-- WorkSpeedGlobal 設定（追加） -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>一般作業速度ジョブ設定</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>「一般作業速度」ステータスを使用するジョブのうち、生存ツールによる制限（ゲート）対象にするものを選択します。制限されていないジョブは適切なツールがなくてもペナルティを受けません。</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>ジョブタイプ</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>制限</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>説明</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>一般作業速度ジョブが見つかりません。</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>全て有効</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>全て無効</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>デフォルトに戻す</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>WorkGiverをトレース</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>ハードコア系モードでツール必須</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>ツールペナルティなし</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>一般作業速度ジョブを設定</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (追加) -->
    <JobTable_NoActiveMode>有効なモードが選択されていません。</JobTable_NoActiveMode>
    <JobTable_GatedFormat>制限 ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>制限 (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>不明</JobTable_Status_Unknown>
    <JobTable_Blocked>ブロック</JobTable_Blocked>
</LanguageData>
</file>

<file path="1.6/Languages/Russian/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>топор</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>Базовый лесохозяйственный инструмент, предназначенный для эффективной рубки леса. Его тяжелая головка обеспечивает мощную силу удара, что делает его незаменимым инструментом для колонистов, занимающихся работой с древесиной. Его баланс и рычажный эффект делают его гораздо более эффективным, чем импровизированные методы резки. Также служит надежным оружием ближнего боя, когда выживание того требует.</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>кирка</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>Важный горнодобывающий инструмент с тяжелой острой головкой, прикрепленной к прочной рукоятке. Специально разработан для разбивания твердых пород и эффективного извлечения ценных материалов. Его концентрированная сила и рычажный эффект необходимы для продуктивных горнодобывающих операций. Также может служить импровизированным оружием, когда обстоятельства того требуют.</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>молоток</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>Основной инструмент для любого строительного проекта. Этот универсальный молоток обеспечивает точность и силу, необходимые для забивания креплений, формирования материалов и сборки конструкций. Незаменим для колонистов, занимающихся строительными и ремонтными работами. Его сбалансированная конструкция обеспечивает эффективные удары при минимальной усталости во время продолжительных строительных работ.</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>серп</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>Специализированный сельскохозяйственный инструмент с изогнутым лезвием, идеально подходящим для сбора урожая и резки растительного материала. Его эргономичная конструкция позволяет эффективные повторяющиеся режущие движения с минимальным напряжением для пользователя. Незаменим для продуктивных сельскохозяйственных операций и работ по уходу за растениями.</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>мотыга</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>Базовый сельскохозяйственный инструмент, предназначенный для подготовки почвы и посадки семян. Его заостренная конструкция эффективно разбивает почву, создавая оптимальные условия для посадки. Незаменим для создания продуктивных сельскохозяйственных операций и поддержания урожайности. Его прочная конструкция обеспечивает надежную работу в течение сезонов.</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>нож</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>Универсальный режущий инструмент с острым лезвием, незаменимый для точных работ. Идеален для мясницких работ, медицинских процедур и общих задач по резке. Его сбалансированная конструкция позволяет контролируемые точные разрезы, а острое лезвие обеспечивает чистую работу. Незаменимый инструмент для любого серьезного колониста.</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>ручная пила</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>Традиционный деревообрабатывающий инструмент с металлическим лезвием с точно нарезанными зубьями для ручной обработки дерева. Незаменим для строительных проектов, требующих пиломатериалов по индивидуальному заказу и детальной деревообработки. Равномерный темп ручной пилы может занять больше времени, чем электроинструменты, но обеспечивает отличный контроль и точность.</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>костяной серп</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>Примитивный инструмент для сбора урожая, изготовленный из резной кости с заточенным краем. Хотя он не такой прочный, как его металлические аналоги, этот традиционный инструмент превосходно служит для сбора урожая и резки растений. Его изогнутая конструкция следует древним образцам, которые доказали свою эффективность через бесчисленные поколения сельскохозяйственных работ.</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>лом</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>Примитивный, но эффективный рычажный инструмент, изготовленный из прочных материалов. Незаменим для разборки конструкций, разделения материалов и выполнения основных механических операций. Представляет изобретательность ранних цивилизаций в разработке практических решений для строительных и демонтажных работ без передовых технологий.</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>счёты</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>Древний вычислительный инструмент с подвижными бусинами, расположенными на стержнях для выполнения арифметических операций. Незаменим для организации исследовательских данных, управления сложными вычислениями и ведения точных записей в обществах без передовых вычислительных устройств. Представляет основу математического мышления и организации данных.</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>стальной нож</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>Точно кованый стальной нож с превосходным удержанием остроты и долговечностью. Лезвие из углеродистой стали сохраняет остроту при интенсивном использовании, что делает его идеальным для требовательных мясницких и медицинских работ. Эргономичная рукоятка обеспечивает отличный контроль при тонких работах.</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>поперечная пила</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>Точная промышленная пила, предназначенная для эффективной обработки дерева и строительных работ. Её специально разработанные зубья и усиленная стальная конструкция позволяют делать чистые точные разрезы через различные материалы. Незаменима для крупных строительных проектов и продвинутых деревообрабатывающих работ.</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>гаечный ключ</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>Точный механический инструмент, предназначенный для захвата, поворота и манипулирования крепежными элементами и механическими компонентами. Критически важен для ремонтных работ, ремонта машин и строительных проектов, требующих точной настройки. Система регулируемых губок приспосабливается к различным размерам, обеспечивая оптимальный рычажный эффект и контроль.</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>микроскоп</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>Точный оптический инструмент, который увеличивает мелкие объекты и образцы для детального изучения. Незаменим для передовых исследований, биологических исследований и научного анализа.</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>карбидная кирка</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>Передовой горнодобывающий инструмент с карбидным наконечником, который сохраняет остроту при самых требовательных раскопочных работах. Точно спроектированная головка режет породу более эффективно, чем стандартные инструменты, а его усиленная конструкция обеспечивает исключительную долговечность в суровых горнодобывающих условиях.</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>точный скальпель</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>Ультра-острый хирургический инструмент, изготовленный из высококачественных стальных сплавов. Тщательно сбалансированное лезвие сохраняет остроту при повторной стерилизации и использовании, а эргономичная рукоятка обеспечивает точный контроль во время тонких медицинских процедур. Стандартное оборудование для передовых медицинских учреждений.</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>электрическая дрель</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>Механизированный буровой инструмент, приводимый в действие встроенным двигателем, способный сверлить твердые материалы с точностью и скоростью. Двигатель с переменной скоростью и сменные биты делают его чрезвычайно ценным для строительных и механических работ. Требует регулярного обслуживания для поддержания двигателя в рабочем состоянии.</SurvivalTools_PowerDrill.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>мультитул глиттермира</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>Высокотехнологичный универсальный инструмент, обычно используемый домашними механоидами в обществах глиттермира. Это передовое устройство легко адаптируется к любой задаче - строительство, добыча полезных ископаемых, лесное хозяйство, техническое обслуживание, снос - что делает его идеальным универсальным инструментом выживания. Хотя он разработан для механоидов, он полностью пригоден для использования гуманоидами из-за физиологических сходств.</SurvivalTools_Multitool.description>
    <SurvivalTools_PileOfRags.label>груда тряпок</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>Простой инструмент для уборки, изготовленный из тряпок и кусков ткани. Полезен для основных задач по уборке, но быстро изнашивается.</SurvivalTools_PileOfRags.description>
    <!-- =================================================== -->
    <!-- МНОГОФУНКЦИОНАЛЬНЫЕ ОБЩИЕ ИНСТРУМЕНТЫ (WorkSpeedGlobal) -->
    <!-- Новые определения требуют локализации                 -->
    <!-- =================================================== -->
    <!-- Племенной / Примитивный уровень -->
    <SurvivalTools_MultipurposeStoneTool.label>многоцельной каменный инструмент</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>Прочный универсальный каменный инструмент, обтёсанный для покрытия множества общих задач. Примитивен, но слегка повышает общую скорость работы.</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>набор резных костяных принадлежностей</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>Набранный вместе комплект аккуратно вырезанных костяных приспособлений для многоцелевого применения. Хрупок, но эффективная форма даёт заметный прирост общей скорости работы.</SurvivalTools_CarvedBoneImplements.description>
    <!-- Средневековый уровень -->
    <SurvivalTools_ArtisansToolkit.label>набор инструментов ремесленника</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>Курированный набор качественных инструментов средневековой эпохи для изготовления, формования и сборки. Повышает общий пропуск множества задач.</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>набор столяра</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>Специализированный набор пил, стамесок, рубанков и шаблонов, оптимизированных под обработку древесины и соединения. Организация и качество дают сильный бонус к общей скорости.</SurvivalTools_WoodworkersKit.description>
    <!-- Индустриальный уровень -->
    <SurvivalTools_MechanicsToolkit.label>инструментальный набор механика</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>Организованный индустриальный комплект с точными ключами, измерительными приборами, моментными инструментами и быстрой системой хранения. Сильно улучшает поток и координацию общих задач.</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>мастерская ударная дрель</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>Тяжёлая приводная ударная дрель со сменными ударными и вращательными модулями. Интегрированная система зажима и выравнивания ускоряет почти любую механическую или строительную задачу.</SurvivalTools_WorkshopHammerDrill.description>
    <!-- Ультра-тех / Космический уровень -->
    <SurvivalTools_NanofabricatorInterface.label>интерфейс нано-фабрикатора</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>Обтекаемый модуль управления и усиления, синхронизирующий движения пользователя с адаптивными nano-сборочными процедурами. Радикально повышает эффективность выполнения общих задач.</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>перчатка омни-инструмент</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>Передовая модульная перчатка с полевыми проекторами, микро-фабрикаторами и силовыми манипуляторами. Обеспечивает непревзойдённый рост общей скорости работы через предиктивную оптимизацию.</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>

<file path="1.6/Languages/Russian/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <NoTool>Нет инструмента</NoTool>
    <ToolInUse>(используется)</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>Инструменты Выживания</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>Основные настройки</Settings_BasicSection>
    <Settings_DebugSection>Настройки отладки</Settings_DebugSection>
    <Settings_HardcoreMode>Хардкор режим</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>Значительно повышает сложность, делая инструменты жизненно важными для выживания. Без подходящих инструментов колонисты становятся неспособными эффективно выполнять большинство рабочих задач. Инструменты также изнашиваются на 50% быстрее, требуя более частой замены и лучшего управления инструментами. Превращает игру в настоящий зависимый от инструментов опыт выживания.</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>Экстремальный хардкор режим</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>МАКСИМАЛЬНАЯ СЛОЖНОСТЬ: Окончательный вызов выживания. В сочетании с хардкор режимом колонисты становятся полностью беспомощными без правильных инструментов. Задачи, которые были просто неэффективными (как уборка руками или импровизированная медицинская помощь), становятся невозможными для попытки. Инструменты деградируют на 87,5% быстрее обычного, создавая постоянное давление для производства и обслуживания инструментов. Используйте флажки ниже для точного контроля того, какие типы работ становятся зависимыми от инструментов. ПРЕДУПРЕЖДЕНИЕ: Ранняя игра становится чрезвычайно сложной - приобретение инструментов становится критическим для выживания колонии!</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>Требуются инструменты для уборки</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>Принуждает колонистов использовать подходящие инструменты для уборки (такие как метлы или швабры) для всех задач по уборке. Без правильных инструментов они не могут убирать полы, удалять грязь или расчищать снег. Необходимо для поддержания гигиены колонии в экстремальных режимах сложности.</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>Требуются инструменты для разделки</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>Требует подходящие режущие инструменты (такие как ножи или топорики) для всех операций разделки и забоя. Колонисты не могут обрабатывать мясо или забивать животных без подходящих лезвий. Критично для цепочек производства пищи в хардкор сценариях.</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>Требуются медицинские инструменты</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>Принуждает использовать специализированные медицинские инструменты для хирургических процедур и продвинутой медицинской помощи. Операции становятся невозможными без подходящих хирургических инструментов, делая приобретение медицинского оборудования жизненно важным для здоровья и выживания колонии.</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>Инструменты в разрушенных зданиях</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>Генерирует базовые инструменты выживания в древних руинах и разбившихся структурах во время генерации карты. Эти выветренные инструменты предоставляют важные ресурсы ранней игры, но обычно низкого качества. Бесценны для стартующих колоний в жестких режимах сложности, где начальный доступ к инструментам критичен.</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>Лимит переноса инструментов</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>Ограничивает колонистов переносить максимум 2-3 инструмента одновременно в их инвентаре (исключая путешествия каравана). Принуждает к стратегическому управлению инструментами и специализации среди колонистов. Пояса для инструментов и похожее снаряжение могут увеличить этот лимит сверх базового значения. Добавляет реалистичные ограничения инвентаря к использованию инструментов.</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>Скорость деградации инструментов</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>Автоматическая оптимизация инструментов</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>Включает интеллектуальное управление инструментами, где колонисты автоматически выбирают и носят наиболее эффективные инструменты для их назначенной работы. Они улучшают до лучших инструментов и бросают худшие по необходимости. Отключите это, если предпочитаете ручное управление инструментами или испытываете проблемы производительности с модифицированными материалами.</Settings_ToolOptimization_Tooltip>
    <Settings_PickupFromStorageOnly>Ограничить подбор инструментов зонами хранения</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>Когда включено, колонисты будут получать инструменты только из назначенных зон хранения, поддерживая лучшую организацию и предотвращая захват инструментов из рабочих зон. Когда отключено, они могут поднимать любой доступный инструмент в Домашней зоне (исключая запрещенные или горящие предметы), обеспечивая больше гибкости, но меньше контроля.</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_DebugLogging>Включить детальное отладочное логирование</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>Активирует комплексное логирование решений выбора инструментов, автоматического поведения подбора и логики сопоставления работа-инструмент. Необходимо для устранения проблем с инструментами или понимания того, почему колонисты выбирают конкретные инструменты. Рекомендуется только для разработки модов или при проблемах, связанных с инструментами. Может влиять на производительность с обширным выводом логов.</Settings_DebugLogging_Tooltip>
    <Settings_AutoTool>Умный подбор инструментов перед работой</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>Революционизирует эффективность рабочего процесса, заставляя колонистов автоматически получать оптимальный инструмент перед началом любой работы. Они интеллектуально меняют инструменты, улучшают до лучших вариантов и обеспечивают наличие подходящего оборудования для максимальной продуктивности. Основная функция для бесшовного геймплея, основанного на инструментах.</Settings_AutoTool_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>Колонисту не хватает необходимых инструментов</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>Колонистам не хватает необходимых инструментов</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>Этим колонистам нужны подходящие инструменты для назначенной работы, но им не хватает необходимого оборудования. Их продуктивность серьезно скомпрометирована.</ColonistNeedsSurvivalToolDesc>
    <SurvivalToolsNeedReplacing>Инструменты приближаются к поломке</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>Эти колонисты используют инструменты, которые скоро сломаются. Замените их немедленно, чтобы избежать прерывания работы.</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>Управление назначениями инструментов</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>Назначение инструмента</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>Строитель</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>Шахтер</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>Работник растений</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>Исследователь</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>Уборщик</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>Медицинский</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>Мясник</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>Выбрать назначение инструмента...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>Новое назначение инструмента</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>Удалить назначение инструмента...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>Назначение инструмента используется {0}</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>Назначение инструмента не выбрано</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>Принудительные инструменты</ForcedSurvivalTools>
    <!-- Settings -->
    <Settings_CompatLogging>Включить отладочное логирование совместимости</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Активирует подробное логирование для систем совместимости модов, включая интеграцию Research Reinvented, обнаружение статистики и проводку WorkGiver. Показывает пошаговые процессы настройки и интеграции совместимости. Отображается только при включенном общем отладочном логировании. Полезно для диагностики проблем с взаимодействием модов.</Settings_CompatLogging_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Нажмите кнопку ниже, чтобы открыть улучшенное изменяемое окно настроек со всеми опциями мода.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Открыть Улучшенные Настройки</Settings_OpenEnhancedButton>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>Типы работ</JobTable_JobTypes>
    <JobTable_JobType>Тип работы</JobTable_JobType>
    <JobTable_NormalMode>Обычный режим</JobTable_NormalMode>
    <JobTable_HardcoreMode>Хардкор режим</JobTable_HardcoreMode>
    <JobTable_ExtraHardcore>Экстремальный хардкор</JobTable_ExtraHardcore>
    <JobTable_Enhanced>Улучшенный</JobTable_Enhanced>
    <JobTable_Required>Требуется</JobTable_Required>
    <JobTable_NoJobsFound>Не найдено работ, улучшенных инструментами.</JobTable_NoJobsFound>
    <JobTable_SectionTitle>Требования к инструментам по режимам</JobTable_SectionTitle>
    <JobTable_SectionTooltip>Эта таблица показывает, как различные типы работ ведут себя в каждом режиме сложности. 'Улучшенный' означает, что инструменты дают бонусы, но не требуются. 'Требуется' означает, что инструменты необходимы для выполнения работы. Используйте это, чтобы понять, какие инструменты понадобятся вашим колонистам в зависимости от текущих настроек.</JobTable_SectionTooltip>
    <!-- Job Table Headers -->
    <JobTable_Normal>Обычный</JobTable_Normal>
    <JobTable_Hardcore>Хардкор</JobTable_Hardcore>
    <JobTable_ExtraHardcore>Экстра Хардкор</JobTable_ExtraHardcore>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Нажмите кнопку ниже, чтобы открыть расширенное окно настроек с изменяемым размером и всеми опциями мода.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Открыть Расширенные Настройки</Settings_OpenEnhancedButton>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>Исследования Переосмысленные</Compat_ResearchReinvented>
    <Compat_FieldResearch>Полевые Исследования</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>Исследования Переосмысленные</Compat_ReinventedResearchAlert>
    <!-- Pacifist Tool Settings -->
    <Settings_AllowPacifistEquip>Разрешить пацифистам экипировать инструменты выживания</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>Позволяет пацифистским колонистам экипировать инструменты выживания, классифицированные как оружие (такие как топоры, кирки или ножи). Хотя эти инструменты обладают боевыми возможностями, они необходимы для рабочих задач, таких как рубка деревьев, добыча полезных ископаемых или приготовление пищи. При включении пацифисты могут использовать эти инструменты для продуктивной работы, продолжая отказываться от участия в насилии.</Settings_AllowPacifistEquip_Tooltip>
    <!-- WorkSpeedGlobal Конфигурация (добавлено) -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>Конфигурация работ общей скорости</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>Выберите, какие работы, использующие стат общей скорости работы, должны ограничиваться инструментами выживания. Неограниченные работы игнорируют штрафы за отсутствие инструментов.</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>Тип работы</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>Ограничено</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>Описание</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>Работы общей скорости не найдены.</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>Включить все</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>Выключить все</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>Сбросить по умолчанию</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>Трассировать WorkGivers</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>Требует инструменты в хардкор режимах</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>Нет штрафов за инструменты</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>Настроить работы общей скорости</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (добавлено) -->
    <JobTable_NoActiveMode>Не выбран активный режим.</JobTable_NoActiveMode>
    <JobTable_GatedFormat>Ограничено ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>Ограничено (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>Неизвестно</JobTable_Status_Unknown>
    <JobTable_Blocked>Заблокировано</JobTable_Blocked>
</LanguageData>
</file>

<file path="1.6/Languages/Spanish/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Basic/Primitive Tools -->
    <SurvivalTools_Axe.label>hacha</SurvivalTools_Axe.label>
    <SurvivalTools_Axe.description>Una herramienta forestal básica diseñada para trabajo eficiente de tala. Su cabeza pesada proporciona fuerza de golpe poderosa, convirtiéndola en una herramienta indispensable para colonos comprometidos con el trabajo de madera. Su equilibrio y efecto de palanca la hacen mucho más efectiva que métodos de corte improvisados. También sirve como un arma cuerpo a cuerpo confiable cuando la supervivencia lo requiere.</SurvivalTools_Axe.description>
    <SurvivalTools_Pickaxe.label>pico</SurvivalTools_Pickaxe.label>
    <SurvivalTools_Pickaxe.description>Una herramienta de minería esencial que presenta una cabeza pesada y puntiaguda unida a un mango robusto. Especialmente diseñada para romper roca dura y extraer materiales valiosos de manera eficiente. Su fuerza concentrada y efecto de palanca son esenciales para operaciones mineras productivas. También puede servir como arma improvisada cuando las circunstancias lo requieren.</SurvivalTools_Pickaxe.description>
    <SurvivalTools_Hammer.label>martillo</SurvivalTools_Hammer.label>
    <SurvivalTools_Hammer.description>Una herramienta fundamental para cualquier proyecto de construcción. Este martillo versátil proporciona la precisión y fuerza necesarias para clavar sujetadores, dar forma a materiales y ensamblar estructuras. Indispensable para colonos comprometidos con trabajos de construcción y mantenimiento. Su diseño equilibrado asegura golpes efectivos con fatiga mínima durante trabajos de construcción prolongados.</SurvivalTools_Hammer.description>
    <SurvivalTools_Sickle.label>hoz</SurvivalTools_Sickle.label>
    <SurvivalTools_Sickle.description>Una herramienta agrícola especializada que presenta una hoja curva perfectamente diseñada para cosechar cultivos y cortar material vegetal. Su diseño ergonómico permite movimientos de corte eficientes y repetitivos con tensión mínima en el usuario. Indispensable para operaciones agrícolas productivas y trabajos de mantenimiento de plantas.</SurvivalTools_Sickle.description>
    <SurvivalTools_Hoe.label>azada</SurvivalTools_Hoe.label>
    <SurvivalTools_Hoe.description>Una herramienta agrícola básica diseñada para preparación del suelo y plantación de semillas. Su diseño puntiagudo rompe el suelo eficientemente, creando condiciones óptimas de plantación. Indispensable para establecer operaciones agrícolas productivas y mantener rendimientos de cultivos. Su construcción resistente asegura rendimiento confiable a través de las estaciones.</SurvivalTools_Hoe.description>
    <SurvivalTools_Knife.label>cuchillo</SurvivalTools_Knife.label>
    <SurvivalTools_Knife.description>Una herramienta de corte versátil con una hoja afilada indispensable para trabajos de precisión. Ideal para trabajos de carnicería, procedimientos médicos y tareas generales de corte. Su diseño equilibrado permite cortes controlados y precisos, mientras la hoja afilada asegura trabajo limpio. Una herramienta indispensable para cualquier colono serio.</SurvivalTools_Knife.description>
    <SurvivalTools_HandSaw.label>sierra de mano</SurvivalTools_HandSaw.label>
    <SurvivalTools_HandSaw.description>Una herramienta de carpintería tradicional que presenta una hoja de metal con dientes cortados precisamente para trabajo manual de madera. Indispensable para proyectos de construcción que requieren madera cortada a medida y trabajo detallado de carpintería. El ritmo constante de una sierra de mano puede tomar más tiempo que herramientas eléctricas, pero ofrece excelente control y precisión.</SurvivalTools_HandSaw.description>
    <SurvivalTools_BoneSickle.label>hoz de hueso</SurvivalTools_BoneSickle.label>
    <SurvivalTools_BoneSickle.description>Una herramienta de cosecha primitiva hecha de hueso tallado con un borde afilado. Aunque no tan duradero como sus contrapartes metálicas, este instrumento tradicional sirve admirablemente para cosechar cultivos y cortar plantas. Su diseño curvo sigue patrones antiguos que han probado su efectividad a través de incontables generaciones de trabajo agrícola.</SurvivalTools_BoneSickle.description>
    <SurvivalTools_PrimitiveLever.label>palanca</SurvivalTools_PrimitiveLever.label>
    <SurvivalTools_PrimitiveLever.description>Una herramienta de palanca primitiva pero efectiva hecha de materiales duraderos. Indispensable para desarmar estructuras, separar materiales y realizar operaciones mecánicas básicas. Representa el ingenio de civilizaciones tempranas en desarrollar soluciones prácticas para trabajos de construcción y demolición sin tecnología avanzada.</SurvivalTools_PrimitiveLever.description>
    <SurvivalTools_Abacus.label>ábaco</SurvivalTools_Abacus.label>
    <SurvivalTools_Abacus.description>Un instrumento de cálculo antiguo con cuentas móviles dispuestas en varillas para realizar operaciones aritméticas. Indispensable para organizar datos de investigación, manejar cálculos complejos y mantener registros precisos en sociedades sin dispositivos de cálculo avanzados. Representa la fundación del pensamiento matemático y organización de datos.</SurvivalTools_Abacus.description>
    <!-- Industrial Tools -->
    <SurvivalTools_SteelKnife.label>cuchillo de acero</SurvivalTools_SteelKnife.label>
    <SurvivalTools_SteelKnife.description>Un cuchillo de acero forjado con precisión con retención de filo superior y durabilidad. La hoja de acero al carbono mantiene su filo a través de uso extensivo, haciéndolo ideal para trabajos exigentes de carnicería y médicos. El mango ergonómico proporciona excelente control para trabajos finos.</SurvivalTools_SteelKnife.description>
    <SurvivalTools_CrosscutSaw.label>sierra de tronzar</SurvivalTools_CrosscutSaw.label>
    <SurvivalTools_CrosscutSaw.description>Una sierra industrial de precisión diseñada para trabajo eficiente de carpintería y construcción. Sus dientes especialmente diseñados y construcción de acero reforzado permiten cortes limpios y precisos a través de varios materiales. Indispensable para grandes proyectos de construcción y trabajos avanzados de carpintería.</SurvivalTools_CrosscutSaw.description>
    <SurvivalTools_Wrench.label>llave inglesa</SurvivalTools_Wrench.label>
    <SurvivalTools_Wrench.description>Una herramienta mecánica de precisión diseñada para agarrar, girar y manipular sujetadores y componentes mecánicos. Crucial para trabajos de mantenimiento, reparaciones de máquinas y proyectos de construcción que requieren ajustes precisos. El sistema de mordazas ajustables se adapta a varios tamaños mientras proporciona palanca y control óptimos.</SurvivalTools_Wrench.description>
    <SurvivalTools_Microscope.label>microscopio</SurvivalTools_Microscope.label>
    <SurvivalTools_Microscope.description>Un instrumento óptico de precisión que magnifica objetos pequeños y muestras para examen detallado. Indispensable para investigación avanzada, estudios biológicos y análisis científico.</SurvivalTools_Microscope.description>
    <!-- Precision Tools -->
    <SurvivalTools_CarbidePick.label>pico de carburo</SurvivalTools_CarbidePick.label>
    <SurvivalTools_CarbidePick.description>Una herramienta de minería avanzada que presenta una punta de carburo que mantiene su filo a través de los trabajos de excavación más exigentes. La cabeza diseñada con precisión corta roca más eficientemente que herramientas estándar, mientras su construcción reforzada asegura durabilidad excepcional bajo condiciones mineras duras.</SurvivalTools_CarbidePick.description>
    <SurvivalTools_PrecisionScalpel.label>bisturí de precisión</SurvivalTools_PrecisionScalpel.label>
    <SurvivalTools_PrecisionScalpel.description>Un instrumento quirúrgico ultra-afilado fabricado de aleaciones de acero de grado superior. La hoja cuidadosamente equilibrada mantiene su filo a través de esterilización y uso repetidos, mientras el mango ergonómico asegura control preciso durante procedimientos médicos finos. Equipo estándar para instalaciones médicas avanzadas.</SurvivalTools_PrecisionScalpel.description>
    <SurvivalTools_PowerDrill.label>taladro eléctrico</SurvivalTools_PowerDrill.label>
    <SurvivalTools_PowerDrill.description>Una herramienta de perforación mecanizada impulsada por un motor incorporado capaz de perforar materiales duros con precisión y velocidad. El motor de velocidad variable y brocas intercambiables la hacen extremadamente valiosa para trabajos de construcción y mecánicos. Requiere mantenimiento regular para mantener el motor funcionando suavemente.</SurvivalTools_PowerDrill.description>
    <!-- Spacer Tools -->
    <SurvivalTools_Multitool.label>multiherramienta del glitterworld</SurvivalTools_Multitool.label>
    <SurvivalTools_Multitool.description>Una herramienta universal de alta tecnología comúnmente utilizada por mecánicos domésticos en sociedades del glitterworld. Este dispositivo avanzado se adapta sin esfuerzo a cualquier tarea - construcción, minería, silvicultura, mantenimiento, demolición - convirtiéndola en la herramienta de supervivencia todo-en-uno definitiva. Aunque diseñada para mecánicos, es perfectamente utilizable por humanoides debido a similitudes fisiológicas.</SurvivalTools_Multitool.description>
    <SurvivalTools_PileOfRags.label>montón de trapos</SurvivalTools_PileOfRags.label>
    <SurvivalTools_PileOfRags.description>Una herramienta de limpieza simple hecha de trapos y trozos de tela. Útil para tareas básicas de limpieza pero se desgasta rápidamente.</SurvivalTools_PileOfRags.description>
    <!-- =================================================== -->
    <!-- HERRAMIENTAS GENERALES MULTIUSO (WorkSpeedGlobal)     -->
    <!-- Nuevas definiciones que requieren entradas           -->
    <!-- =================================================== -->
    <!-- Nivel tribal / primitivo -->
    <SurvivalTools_MultipurposeStoneTool.label>herramienta de piedra multifunción</SurvivalTools_MultipurposeStoneTool.label>
    <SurvivalTools_MultipurposeStoneTool.description>Un implemento de piedra resistente y versátil moldeado para abarcar muchas tareas generales. Aunque primitivo, otorga una leve mejora a la velocidad global de trabajo.</SurvivalTools_MultipurposeStoneTool.description>
    <SurvivalTools_CarvedBoneImplements.label>implementos de hueso tallados</SurvivalTools_CarvedBoneImplements.label>
    <SurvivalTools_CarvedBoneImplements.description>Un conjunto de implementos de hueso cuidadosamente tallados y atados para uso multiuso. Frágiles, pero con formas eficientes que brindan un aumento notable a la velocidad general de trabajo.</SurvivalTools_CarvedBoneImplements.description>
    <!-- Nivel medieval -->
    <SurvivalTools_ArtisansToolkit.label>juego de herramientas de artesano</SurvivalTools_ArtisansToolkit.label>
    <SurvivalTools_ArtisansToolkit.description>Una colección seleccionada de implementos de calidad de época medieval para fabricar, dar forma y ensamblar. Mejora el rendimiento global a través de muchas tareas.</SurvivalTools_ArtisansToolkit.description>
    <SurvivalTools_WoodworkersKit.label>kit de carpintero</SurvivalTools_WoodworkersKit.label>
    <SurvivalTools_WoodworkersKit.description>Un surtido especializado de sierras, cinceles, cepillos y galgas optimizados para el moldeado y ensamble de madera. Su organización y calidad otorgan un fuerte impulso a la velocidad general de trabajo.</SurvivalTools_WoodworkersKit.description>
    <!-- Nivel industrial -->
    <SurvivalTools_MechanicsToolkit.label>juego de herramientas de mecánico</SurvivalTools_MechanicsToolkit.label>
    <SurvivalTools_MechanicsToolkit.description>Un kit industrial bien organizado que contiene llaves de precisión, galgas, implementos de torque y almacenamiento de acceso rápido. Mejora en gran medida el flujo y coordinación de tareas generales.</SurvivalTools_MechanicsToolkit.description>
    <SurvivalTools_WorkshopHammerDrill.label>taladro percutor de taller</SurvivalTools_WorkshopHammerDrill.label>
    <SurvivalTools_WorkshopHammerDrill.description>Un pesado taladro percutor motorizado con módulos intercambiables de percusión y rotación. Su sistema integrado de sujeción y alineación acelera prácticamente cualquier tarea mecánica o de construcción.</SurvivalTools_WorkshopHammerDrill.description>
    <!-- Nivel espacial / ultra tecnológico -->
    <SurvivalTools_NanofabricatorInterface.label>interfaz de nanofabricador</SurvivalTools_NanofabricatorInterface.label>
    <SurvivalTools_NanofabricatorInterface.description>Un módulo elegante de control y aumento que sincroniza los movimientos del usuario con rutinas adaptativas de nanoensamblaje. Mejora drásticamente la eficiencia de ejecución de tareas generales.</SurvivalTools_NanofabricatorInterface.description>
    <SurvivalTools_OmniToolGauntlet.label>guantelete omni‑herramienta</SurvivalTools_OmniToolGauntlet.label>
    <SurvivalTools_OmniToolGauntlet.description>Un guantelete modular de última generación con proyectores de campo, micro-fabricadores y manipuladores alineados por fuerza. Proporciona un aumento sin igual a la velocidad general de trabajo mediante optimización predictiva.</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>

<file path="1.6/Languages/Spanish/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <NoTool>Sin herramienta</NoTool>
    <ToolInUse>(en uso)</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>Herramientas de Supervivencia</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>Configuración básica</Settings_BasicSection>
    <Settings_DebugSection>Configuración de depuración</Settings_DebugSection>
    <Settings_HardcoreMode>Modo hardcore</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>Aumenta significativamente la dificultad haciendo que las herramientas sean esenciales para la supervivencia. Sin herramientas adecuadas, los colonos se vuelven incapaces de ejecutar efectivamente la mayoría de las tareas de trabajo. Las herramientas también se desgastan 50% más rápido, requiriendo reemplazo más frecuente y mejor gestión de herramientas. Transforma el juego en una verdadera experiencia de supervivencia dependiente de herramientas.</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>Modo hardcore extremo</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>DIFICULTAD MÁXIMA: El desafío de supervivencia definitivo. Cuando se combina con el modo hardcore, los colonos se vuelven completamente indefensos sin las herramientas correctas. Las tareas que eran meramente ineficientes (como limpiar a mano o cuidado médico improvisado) se vuelven imposibles de intentar. Las herramientas se degradan 87.5% más rápido de lo normal, creando presión constante para la producción y mantenimiento de herramientas. Use las casillas de verificación de abajo para controlar exactamente qué tipos de trabajo se vuelven dependientes de herramientas. ¡ADVERTENCIA: El juego temprano se vuelve extremadamente desafiante - la adquisición de herramientas se vuelve crítica para la supervivencia de la colonia!</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>Herramientas de limpieza requeridas</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>Fuerza a los colonos a usar herramientas de limpieza adecuadas (como escobas o trapeadores) para todas las tareas de limpieza. Sin las herramientas correctas, no pueden limpiar pisos, remover suciedad o limpiar nieve. Esencial para mantener la higiene de la colonia en modos de dificultad extrema.</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>Herramientas de carnicería requeridas</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>Obliga a usar herramientas de corte adecuadas (como cuchillos o machetas) para todas las operaciones de carnicería y sacrificio. Los colonos no pueden procesar carne o sacrificar animales sin hojas adecuadas. Crítico para las cadenas de producción de alimentos en escenarios hardcore.</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>Herramientas médicas requeridas</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>Impone el uso de instrumentos médicos especializados para procedimientos quirúrgicos y cuidado médico avanzado. Las operaciones se vuelven imposibles sin herramientas quirúrgicas adecuadas, haciendo que la adquisición de equipo médico sea vital para la salud y supervivencia de la colonia.</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>Herramientas en edificios en ruinas</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>Genera herramientas de supervivencia básicas en ruinas antiguas y estructuras estrelladas durante la generación del mapa. Estas herramientas erosionadas proporcionan recursos importantes del juego temprano pero son típicamente de baja calidad. Invaluables para colonias iniciantes en modos de dificultad duros donde el acceso inicial a herramientas es crítico.</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>Límite de carga de herramientas</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>Restringe a los colonos a cargar un máximo de 2-3 herramientas simultáneamente en su inventario (excluyendo viajes de caravana). Fuerza la gestión estratégica de herramientas y especialización entre colonos. Los cinturones de herramientas y equipo similar pueden aumentar este límite más allá del valor base. Añade restricciones de inventario realistas al uso de herramientas.</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>Tasa de degradación de herramientas</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>Optimización automática de herramientas</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>Habilita la gestión inteligente de herramientas donde los colonos automáticamente seleccionan y cargan las herramientas más efectivas para su trabajo asignado. Mejoran a mejores herramientas y descartan las inferiores según sea necesario. Deshabilite esto si prefiere control manual de herramientas o experimenta problemas de rendimiento con materiales modificados.</Settings_ToolOptimization_Tooltip>
    <Settings_PickupFromStorageOnly>Restringir recogida de herramientas a áreas de almacenamiento</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>Cuando está habilitado, los colonos solo adquirirán herramientas de zonas de almacenamiento designadas, manteniendo mejor organización y evitando que tomen herramientas de áreas de trabajo. Cuando está deshabilitado, pueden recoger cualquier herramienta accesible en el área del Hogar (excluyendo objetos prohibidos o en llamas), proporcionando más flexibilidad pero menos control.</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_DebugLogging>Habilitar registro de depuración detallado</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>Activa el registro comprensivo de decisiones de selección de herramientas, comportamiento de recogida automática y lógica de emparejamiento trabajo-herramienta. Esencial para solucionar problemas de herramientas o entender por qué los colonos eligen herramientas específicas. Recomendado solo para desarrollo de mods o cuando se experimentan problemas relacionados con herramientas. Puede afectar el rendimiento con salida de registro extensiva.</Settings_DebugLogging_Tooltip>
    <Settings_AutoTool>Recogida inteligente de herramientas pre-trabajo</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>Revoluciona la eficiencia del flujo de trabajo haciendo que los colonos automáticamente adquieran la herramienta óptima antes de comenzar cualquier trabajo. Intercambian herramientas inteligentemente, mejoran a mejores variantes y aseguran tener el equipo correcto para máxima productividad. La función fundamental para gameplay basado en herramientas sin costuras.</Settings_AutoTool_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>El colono necesita herramientas esenciales</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>Los colonos necesitan herramientas esenciales</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>Estos colonos necesitan herramientas adecuadas para su trabajo asignado, pero carecen del equipo necesario. Su productividad está severamente comprometida.</ColonistNeedsSurvivalToolDesc>
    <SurvivalToolsNeedReplacing>Herramientas acercándose al fallo</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>Estos colonos están usando herramientas que pronto se romperán. Reemplácelas inmediatamente para evitar interrupciones del trabajo.</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>Gestionar asignaciones de herramientas</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>Asignación de herramienta</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>Constructor</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>Minero</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>Trabajador de plantas</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>Investigador</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>Limpiador</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>Médico</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>Carnicero</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>Seleccionar asignación de herramienta...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>Nueva asignación de herramienta</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>Eliminar asignación de herramienta...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>La asignación de herramienta está siendo usada por {0}</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>No hay asignación de herramienta seleccionada</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>Herramientas forzadas</ForcedSurvivalTools>
    <!-- Settings -->
    <Settings_CompatLogging>Habilitar registro de depuración de compatibilidad</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Activa el registro detallado para sistemas de compatibilidad de mods incluyendo integración de Research Reinvented, detección de estadísticas y cableado de WorkGiver. Muestra procesos paso a paso de configuración e integración de compatibilidad. Solo se muestra cuando el registro de depuración general está habilitado. Útil para diagnosticar problemas con interacciones de mods.</Settings_CompatLogging_Tooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Haga clic en el botón de abajo para abrir la ventana de configuración mejorada y redimensionable con todas las opciones del mod.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Abrir Configuración Mejorada</Settings_OpenEnhancedButton>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>Tipos de Trabajo</JobTable_JobTypes>
    <JobTable_JobType>Tipo de Trabajo</JobTable_JobType>
    <JobTable_Normal>Normal</JobTable_Normal>
    <JobTable_Hardcore>Hardcore</JobTable_Hardcore>
    <JobTable_NormalMode>Modo Normal</JobTable_NormalMode>
    <JobTable_HardcoreMode>Modo Hardcore</JobTable_HardcoreMode>
    <JobTable_ExtraHardcore>Hardcore Extremo</JobTable_ExtraHardcore>
    <JobTable_Enhanced>Mejorado</JobTable_Enhanced>
    <JobTable_Required>Requerido</JobTable_Required>
    <JobTable_NoJobsFound>No se encontraron trabajos mejorados por herramientas.</JobTable_NoJobsFound>
    <JobTable_SectionTitle>Requisitos de Herramientas por Modo</JobTable_SectionTitle>
    <JobTable_SectionTooltip>Esta tabla muestra cómo se comportan diferentes tipos de trabajo en cada modo de dificultad. 'Mejorado' significa que las herramientas proporcionan bonificaciones pero no son requeridas. 'Requerido' significa que las herramientas son necesarias para realizar el trabajo. Use esto para entender qué herramientas necesitarán sus colonos basándose en su configuración actual.</JobTable_SectionTooltip>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Haz clic en el botón de abajo para abrir la ventana de configuración mejorada y redimensionable con todas las opciones del mod.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Abrir Configuración Mejorada</Settings_OpenEnhancedButton>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>Investigación Reinventada</Compat_ResearchReinvented>
    <Compat_FieldResearch>Investigación de Campo</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>Investigación Reinventada</Compat_ReinventedResearchAlert>
    <!-- Pacifist Tool Settings -->
    <Settings_AllowPacifistEquip>Permitir a pacifistas equipar herramientas de supervivencia</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>Permite a los colonos pacifistas equipar herramientas de supervivencia clasificadas como armas (como hachas, picos o cuchillos). Aunque estas herramientas tienen capacidades de combate, son esenciales para tareas laborales como tala de árboles, minería o preparación de alimentos. Cuando está habilitado, los pacifistas pueden usar estas herramientas para trabajo productivo mientras siguen rehusando participar en violencia.</Settings_AllowPacifistEquip_Tooltip>
    <!-- Configuración WorkSpeedGlobal (añadido) -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>Configuración de trabajos velocidad general</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>Seleccione qué trabajos que usan la estadística de velocidad de trabajo general deben estar restringidos por herramientas de supervivencia. Los trabajos no restringidos ignoran penalizaciones por falta de herramientas.</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>Tipo de trabajo</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>Restringido</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>Descripción</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>No se encontraron trabajos de velocidad general.</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>Habilitar todo</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>Deshabilitar todo</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>Restablecer</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>Rastrear WorkGivers</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>Requiere herramientas en modos hardcore</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>Sin penalización de herramientas</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>Configurar trabajos de velocidad general</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (añadido) -->
    <JobTable_NoActiveMode>No hay modo activo seleccionado.</JobTable_NoActiveMode>
    <JobTable_GatedFormat>Restringido ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>Restringido (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>Desconocido</JobTable_Status_Unknown>
    <JobTable_Blocked>Bloqueado</JobTable_Blocked>
</LanguageData>
</file>

<file path="1.6/Patches/DarkAgesMedievalTools/DAMT_Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Dark Ages : Medieval Tools</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <!-- Building Hammer - Construction -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Hammer"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>1.1</ConstructionSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Hammer"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Pickaxe - Mining -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Pickaxe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <DiggingSpeed>1.15</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Miner</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Pickaxe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Scythe - Plant Cutting & Harvesting -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Scythe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <PlantHarvestingSpeed>1.2</PlantHarvestingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Scythe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Meat Cleaver - Butchery -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Cleaver"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ButcheryFleshSpeed>1.2</ButcheryFleshSpeed>
                <ButcheryFleshEfficiency>1.15</ButcheryFleshEfficiency>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Cook</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Cleaver"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Bonesaw - Medical Operations -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Hacksaw"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <MedicalOperationSpeed>1.2</MedicalOperationSpeed>
                <MedicalSurgerySuccessChance>0.9</MedicalSurgerySuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Doctor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Hacksaw"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Broom - Cleaning -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Broom"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <CleaningSpeed>1.35</CleaningSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Cleaner</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="DA_MeleeWeapon_Broom"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/PrimitiveTools/PT_Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Primitive Tools</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_BoneShovel"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <DiggingSpeed>0.75</DiggingSpeed>
                <MiningYieldDigging>0.75</MiningYieldDigging>
                <PlantHarvestingSpeed>0.75</PlantHarvestingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Miner</li>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_BoneShovel"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_FlintAxe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_FlintAxe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_FlintHandAxe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>0.5</TreeFellingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_FlintHandAxe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_BoneSaw"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.0</TreeFellingSpeed>
                <MedicalOperationSpeed>0.8</MedicalOperationSpeed>
                <MedicalSurgerySuccessChance>0.7</MedicalSurgerySuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
                <li>Doctor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_BoneSaw"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_FlintSickle"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <PlantHarvestingSpeed>1.0</PlantHarvestingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_FlintSickle"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_HammerStone"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>0.85</ConstructionSpeed>
                <ConstructSuccessChance>1.0</ConstructSuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_HammerStone"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_StoneHammer"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>0.85</ConstructionSpeed>
                <ConstructSuccessChance>1.0</ConstructSuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_StoneHammer"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="VBY_StoneMallet"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>1.1</ConstructionSpeed>
                <ConstructSuccessChance>0.75</ConstructSuccessChance>
                <!-- Lower chance because big and wieldly -->
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="VBY_StoneMallet"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/RightToolForTheJob/RTFTJ_Patch.xml">
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Right Tool For The Job (Continued)</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Pickaxe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <DiggingSpeed>1.0</DiggingSpeed>
                <MiningYieldDigging>1.0</MiningYieldDigging>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Miner</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_Pickaxe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Hammer"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>1.0</ConstructionSpeed>
                <ConstructSuccessChance>1.0</ConstructSuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_Hammer"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Autohammer"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <ConstructionSpeed>1.1</ConstructionSpeed>
                <ConstructSuccessChance>0.9</ConstructSuccessChance>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_Autohammer"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_HandAxe"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.0</TreeFellingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_HandAxe"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Chainsaw"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_Chainsaw"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Drill"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <DiggingSpeed>1.1</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Miner</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="RTFTJ_Drill"]</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_Toolbelt"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.0</TreeFellingSpeed>
                <DiggingSpeed>1.0</DiggingSpeed>
                <MiningYieldDigging>1.0</MiningYieldDigging>
                <ConstructionSpeed>1.0</ConstructionSpeed>
                <ConstructSuccessChance>1.0</ConstructSuccessChance>
                <PlantHarvestingSpeed>1.0</PlantHarvestingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
                <li>Miner</li>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>Defs/ThingDef[defName="RTFTJ_Toolbelt"]/thingClass</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
        <!-- Should these toolbelts count as a survival tools? 
It adds a lot of stats but toolbelts are not real tools, just storage for tools 
Maybe they need to add carrying capacity and tool slots, more for the advanced one of course -->
        <li Class="PatchOperationAddModExtension">
          <xpath>Defs/ThingDef[defName="RTFTJ_ToolbeltAdv"]</xpath>
          <value>
            <li Class="SurvivalTools.SurvivalToolProperties">
              <baseWorkStatFactors>
                <TreeFellingSpeed>1.1</TreeFellingSpeed>
                <DiggingSpeed>1.1</DiggingSpeed>
                <MiningYieldDigging>1.1</MiningYieldDigging>
                <ConstructionSpeed>1.1</ConstructionSpeed>
                <ConstructSuccessChance>1.1</ConstructSuccessChance>
                <PlantHarvestingSpeed>1.1</PlantHarvestingSpeed>
              </baseWorkStatFactors>
              <defaultSurvivalToolAssignmentTags>
                <li>Constructor</li>
                <li>Miner</li>
                <li>PlantWorker</li>
              </defaultSurvivalToolAssignmentTags>
            </li>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>Defs/ThingDef[defName="RTFTJ_ToolbeltAdv"]/thingClass</xpath>
          <value>
            <thingClass>SurvivalTools.SurvivalTool</thingClass>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
</Patch>
</file>

<file path="1.6/Patches/VWEUTools/VWEUT_Patch.xml">
<Patch>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>VWE Useful Tools</li>
        </mods>
        <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Hammer"]</xpath>
                    <value>
                        <li Class="SurvivalTools.SurvivalToolProperties">
                            <baseWorkStatFactors>
                                <ConstructionSpeed>1.0</ConstructionSpeed>
                                <ConstructSuccessChance>1.0</ConstructSuccessChance>
                            </baseWorkStatFactors>
                            <defaultSurvivalToolAssignmentTags>
                                <li>Constructor</li>
                            </defaultSurvivalToolAssignmentTags>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Hammer"]</xpath>
                    <value>
                        <thingClass>SurvivalTools.SurvivalTool</thingClass>
                    </value>
                </li>
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Pickaxe"]</xpath>
                    <value>
                        <li Class="SurvivalTools.SurvivalToolProperties">
                            <baseWorkStatFactors>
                                <DiggingSpeed>1.1</DiggingSpeed>
                                <MiningYieldDigging>1.1</MiningYieldDigging>
                            </baseWorkStatFactors>
                            <defaultSurvivalToolAssignmentTags>
                                <li>Miner</li>
                            </defaultSurvivalToolAssignmentTags>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Pickaxe"]</xpath>
                    <value>
                        <thingClass>SurvivalTools.SurvivalTool</thingClass>
                    </value>
                </li>
                <!-- hatchets are wood cutters (tree felling) -->
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Hatchet"]</xpath>
                    <value>
                        <li Class="SurvivalTools.SurvivalToolProperties">
                            <baseWorkStatFactors>
                                <TreeFellingSpeed>1.1</TreeFellingSpeed>
                            </baseWorkStatFactors>
                            <defaultSurvivalToolAssignmentTags>
                                <li>PlantWorker</li>
                            </defaultSurvivalToolAssignmentTags>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Hatchet"]</xpath>
                    <value>
                        <thingClass>SurvivalTools.SurvivalTool</thingClass>
                    </value>
                </li>
                <!-- shovels can dig and be used for basic plant work -->
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Shovel"]</xpath>
                    <value>
                        <li Class="SurvivalTools.SurvivalToolProperties">
                            <baseWorkStatFactors>
                                <DiggingSpeed>1.1</DiggingSpeed>
                                <MiningYieldDigging>1.1</MiningYieldDigging>
                                <SowingSpeed>0.8</SowingSpeed>
                            </baseWorkStatFactors>
                            <defaultSurvivalToolAssignmentTags>
                                <li>Miner</li>
                                <li>PlantWorker</li>
                            </defaultSurvivalToolAssignmentTags>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Shovel"]</xpath>
                    <value>
                        <thingClass>SurvivalTools.SurvivalTool</thingClass>
                    </value>
                </li>
                <!-- wrenches for maintenance and repair -->
                <li Class="PatchOperationAddModExtension">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Wrench"]</xpath>
                    <value>
                        <li Class="SurvivalTools.SurvivalToolProperties">
                            <baseWorkStatFactors>
                                <ConstructionSpeed>1.1</ConstructionSpeed>
                                <MaintenanceSpeed>1.2</MaintenanceSpeed>
                                <DeconstructionSpeed>1.1</DeconstructionSpeed>
                            </baseWorkStatFactors>
                            <defaultSurvivalToolAssignmentTags>
                                <li>Constructor</li>
                            </defaultSurvivalToolAssignmentTags>
                        </li>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="VWE_Zal_Wrench"]</xpath>
                    <value>
                        <thingClass>SurvivalTools.SurvivalTool</thingClass>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>
</file>

<file path="1.6/Textures/Things/Item/Equipment/Tool/README_Textures.txt">
=================================================================
COMMISSIONED ARTWORK SHOPPING LIST
=================================================================

=== PRIMITIVE TIER TOOLS ===
1. Knife.png - Basic Utility Knife
   • Resolution: 128x128
   • Style: Primitive/rustic
   • Description: Simple blade with wooden or stone handle
   • Use: Butchery, basic medical work

2. HandSaw.png - Primitive Hand Saw
   • Resolution: 128x128
   • Style: Simple, functional
   • Description: Toothed blade with wooden handle
   • Use: Basic woodworking, construction

3. BoneSickle.png - Bone Sickle
   • Resolution: 128x128
   • Style: Bone/fossil aesthetic
   • Description: Curved blade shaped like carved bone
   • Use: Harvesting crops/plants

4. Hoe.png - Farming Hoe
   • Resolution: 128x128
   • Style: Agricultural
   • Description: Wooden handle, metal or stone blade
   • Use: Soil preparation, farming

5. PryBar.png - Primitive Lever Tool
   • Resolution: 128x128
   • Style: Primitive
   • Description: Wood or stone pry tool
   • Use: Demolition, leverage

6. Abacus.png - Counting Frame
   • Resolution: 128x128
   • Style: Neolithic research aid
   • Description: Wooden frame with beads
   • Use: Research, intellectual work

7. PileOfRags.png - Cleaning Rags
   • Resolution: 128x128
   • Style: Practical
   • Description: Bundle of cloth rags
   • Use: Cleaning, maintenance

8. MultipurposeStoneTool.png - Crude Stone Tool
   • Resolution: 128x128
   • Style: Tribal/neolithic
   • Description: Chipped stone lashed to wood grip with twine
   • Use: WorkSpeedGlobal (primitive tier)

9. CarvedBoneImplements.png - Bundle of Bone Tools
   • Resolution: 128x128
   • Style: Tribal/organic
   • Description: Carved animal bones (scrapers, chisels, awl) tied with sinew
   • Use: WorkSpeedGlobal (primitive tier)

-----------------------------------------------------------------

=== MEDIEVAL / ARTISAN TIER TOOLS ===
10. Artisan’sToolkit.png - Leather Tool Wrap
    • Resolution: 128x128
    • Style: Medieval craftsman
    • Description: Leather roll with hammer, chisel, awl, hand drill
    • Use: WorkSpeedGlobal (medieval)

11. Woodworker’sKit.png - Fine Carpentry Set
    • Resolution: 128x128
    • Style: Late medieval
    • Description: Polished oak box with saws, rasps, knives, brass fittings
    • Use: WorkSpeedGlobal (medieval)

-----------------------------------------------------------------

=== INDUSTRIAL TIER TOOLS ===
12. SteelKnife.png - Professional Knife
    • Resolution: 128x128
    • Style: Industrial
    • Description: High-quality steel blade with ergonomic grip
    • Use: Butchery, medical

13. CrosscutSaw.png - Industrial Saw
    • Resolution: 128x128
    • Style: Heavy-duty
    • Description: Large toothed blade for lumber
    • Use: Advanced construction, woodworking

14. Wrench.png - Adjustable Wrench
    • Resolution: 128x128
    • Style: Industrial
    • Description: Steel adjustable jaw wrench
    • Use: Construction, repairs

15. Mechanic’sToolkit.png - Industrial Toolbox
    • Resolution: 128x128
    • Style: Utilitarian
    • Description: Red metal box with wrenches/pliers, grease smudges
    • Use: WorkSpeedGlobal (industrial)

16. WorkshopHammerDrill.png - Early Power Drill
    • Resolution: 128x128
    • Style: Industrial, rugged
    • Description: Bulky handheld hammer drill with steel bit
    • Use: WorkSpeedGlobal (industrial)

-----------------------------------------------------------------

=== PRECISION / SPACER PREP TOOLS ===
17. CarbidePick.png - Carbide Pickaxe
    • Resolution: 128x128
    • Style: Precision engineered
    • Description: Pickaxe with carbide-tipped metallic head
    • Use: Enhanced mining

18. PrecisionScalpel.png - Surgical Scalpel
    • Resolution: 128x128
    • Style: Medical/sterile
    • Description: Ultra-sharp surgical blade
    • Use: Advanced medical procedures

19. PowerDrill.png - Motorized Drill
    • Resolution: 128x128
    • Style: Industrial/modern
    • Description: Electric drill with motor housing
    • Use: Construction, fabrication

20. Microscope.png - Research Microscope
    • Resolution: 128x128
    • Style: Scientific
    • Description: Optical instrument for research
    • Use: Research boost

-----------------------------------------------------------------

=== SPACER / GLITTERWORLD TOOLS ===
21. NanofabricatorInterface.png - Holo Tablet
    • Resolution: 128x128
    • Style: Sleek spacer tech
    • Description: White/silver handheld slab with cyan holographic projection
    • Use: WorkSpeedGlobal (spacer)

22. OmniToolGauntlet.png - Wrist Gauntlet
    • Resolution: 128x128
    • Style: Glitterworld elegance
    • Description: Wrist-mounted gauntlet with glowing conduits + nano-arms
    • Use: WorkSpeedGlobal (glitterworld)

23. GlitterworldMultitool.png - Ultimate Multitool
    • Resolution: 128x128
    • Style: Sleek, futuristic
    • Description: High-tech universal tool with glow accents
    • Use: All-purpose survival tool

-----------------------------------------------------------------

=== EXISTING TOOL TEXTURES (TO BE REDONE AT 128×128) ===
24. Axe.png - Forestry Axe
    • Resolution: 128x128
    • Style: Functional, primitive-to-industrial variants
    • Use: Tree felling, wood chopping

25. Pickaxe.png - Mining Pickaxe
    • Resolution: 128x128
    • Style: Sturdy, material-adaptive (stone/iron/steel)
    • Use: Mining, digging

26. Hammer.png - Construction Hammer
    • Resolution: 128x128
    • Style: Simple head + wooden/metal shaft
    • Use: Building, construction

27. Sickle.png - Harvesting Sickle
    • Resolution: 128x128
    • Style: Curved blade with wood/metal handle
    • Use: Crop/plant harvesting  

-----------------------------------------------------------------

=== ARTWORK SPECIFICATIONS ===
• Resolution: All textures 128x128  
• Format: PNG with transparency  
• Lighting: RimWorld top-down, NW soft light, SE shadow  
• Style: Match RimWorld vanilla aesthetic  
• Silhouette: Must be distinct/readable at 25% scale  
• Material Adaptability: Wood/stone/metal where applicable  
• Tech Progression: Primitive → Medieval → Industrial → Precision → Spacer → Glitterworld  

-----------------------------------------------------------------

=== COMMISSION DELIVERY GUIDELINES ===
• Provide layered source files (PSD or equivalent) + PNG exports  
• Keep holograms/glow elements on separate layers for flexibility  
• Test readability at 50% and 25% scales  
• Avoid over-detailing fine lines (<1px)  
• Ensure silhouettes remain clear against RimWorld floors  

-----------------------------------------------------------------

TOTAL NEW TEXTURES: 23  
- Primitive/Medieval: 11  
- Industrial: 5  
- Precision: 4  
- Spacer/Glitterworld: 3  
=================================================================
</file>

<file path="About/PublishedFileId.txt">
3554664966
</file>

<file path="Source/AI/JobDriver_FellTree_Designated.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/JobDriver_FellTree_Designated.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Uses the standard CutPlant designation for designated tree felling.
/// Subclass of JobDriver_FellTree that requires the CutPlant designation to operate.
/// </summary>
public class JobDriver_FellTree_Designated : JobDriver_FellTree
⋮----
// Defensive: return the vanilla CutPlant designation if present.
// This is extremely unlikely to be null, but the guard avoids a possible NRE in exotic contexts.
</file>

<file path="Source/AI/JobDriver_HarvestTree_Designated.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/JobDriver_HarvestTree_Designated.cs
⋮----
namespace SurvivalTools
⋮----
// Uses the standard HarvestPlant designation for designated tree harvesting.
public class JobDriver_HarvestTree_Designated : JobDriver_HarvestTree
</file>

<file path="Source/DebugTools/DebugAction_SpawnSurvivalToolWithStuff.cs">
// RimWorld 1.6 / C# 7.3
// Source/DebugTools/DebugAction_SpawnSurvivalToolWithStuff.cs
⋮----
public static class DebugAction_SpawnSurvivalToolWithStuff
⋮----
public static void SpawnToolWithStuff()
⋮----
.Where(def => def.IsSurvivalTool())
.OrderBy(def => def.modContentPack?.Name ?? "Unknown")
.ThenBy(def => def.label)
.ToList();
if (!toolDefs.Any())
⋮----
Messages.Message("No survival tool definitions found.", MessageTypeDefOf.RejectInput);
⋮----
toolOptions.Add(new DebugMenuOption(displayName, DebugMenuOptionMode.Action, () =>
⋮----
// Check if this tool can be made from stuff
⋮----
// For things that can't be made from stuff (like cloth, raw materials, etc.)
// spawn them directly
⋮----
Find.WindowStack.Add(new Dialog_DebugOptionListLister(toolOptions));
⋮----
private static void ShowStuffPicker(ThingDef toolDef)
⋮----
.Where(def => def.IsStuff && def.stuffProps != null && toolDef.MadeFromStuff)
.OrderBy(def => def.label)
⋮----
if (!stuffDefs.Any())
⋮----
Messages.Message($"{toolDef.LabelCap} cannot be made from stuff.", MessageTypeDefOf.RejectInput);
⋮----
// Add a separator for materials with StuffPropsTool
var stuffPropsStuff = stuffDefs.Where(def => def.GetModExtension<StuffPropsTool>() != null).ToList();
if (stuffPropsStuff.Any())
⋮----
stuffOptions.Add(new DebugMenuOption("=== Materials with StuffPropsTool ===", DebugMenuOptionMode.Action, () => { }));
⋮----
stuffOptions.Add(new DebugMenuOption($"{stuffDef.LabelCap} ({statCount} tool stats)", DebugMenuOptionMode.Action, () =>
⋮----
stuffOptions.Add(new DebugMenuOption("", DebugMenuOptionMode.Action, () => { }));
⋮----
// Add materials with SurvivalToolProperties (virtual tools)
var virtualToolStuff = stuffDefs.Where(def => def.GetModExtension<SurvivalToolProperties>() != null).ToList();
if (virtualToolStuff.Any())
⋮----
stuffOptions.Add(new DebugMenuOption("=== Materials with SurvivalToolProperties ===", DebugMenuOptionMode.Action, () => { }));
⋮----
// Add regular materials
var regularStuff = stuffDefs.Where(def =>
⋮----
if (regularStuff.Any())
⋮----
stuffOptions.Add(new DebugMenuOption("=== Regular Materials ===", DebugMenuOptionMode.Action, () => { }));
⋮----
stuffOptions.Add(new DebugMenuOption(stuffDef.LabelCap, DebugMenuOptionMode.Action, () =>
⋮----
Find.WindowStack.Add(new Dialog_DebugOptionListLister(stuffOptions));
⋮----
private static void PrepareToolSpawn(ThingDef toolDef, ThingDef stuffDef)
⋮----
var tool = ThingMaker.MakeThing(toolDef, stuffDef);
⋮----
Messages.Message(errorMessage, MessageTypeDefOf.RejectInput);
⋮----
// Show info about what we're about to spawn
⋮----
// Check if the tool itself has SurvivalToolProperties (virtual tool)
⋮----
Messages.Message(infoMessage, MessageTypeDefOf.NeutralEvent);
// Set up the placement tool
DebugTool placementTool = new DebugTool($"Place {tool.LabelCap}", delegate
⋮----
Messages.Message("No current map.", MessageTypeDefOf.RejectInput);
⋮----
IntVec3 pos = Verse.UI.MouseCell();
if (pos.InBounds(map))
⋮----
GenSpawn.Spawn(tool, pos, map);
Messages.Message($"Spawned {tool.LabelCap}", MessageTypeDefOf.TaskCompletion);
</file>

<file path="Source/DefOfs/ST_StatDefOf.cs">
// Rimworld 1.6 / C# 7.3
// Source/DefOfs/ST_StatDefOf.cs
⋮----
namespace SurvivalTools
⋮----
public static class ST_StatDefOf
⋮----
// -------------------------------
// Pawn-related stats
⋮----
// Custom (SurvivalTools)
public static StatDef SurvivalToolCarryCapacity;
public static StatDef DiggingSpeed;
public static StatDef MiningYieldDigging;
public static StatDef PlantHarvestingSpeed;
public static StatDef SowingSpeed;
public static StatDef TreeFellingSpeed;
public static StatDef MaintenanceSpeed;
public static StatDef DeconstructionSpeed;
// Vanilla (fallback for compat)
public static StatDef ResearchSpeed;
public static StatDef CleaningSpeed;
public static StatDef MedicalOperationSpeed;           // vanilla
public static StatDef MedicalSurgerySuccessChance;     // vanilla
public static StatDef ButcheryFleshSpeed;              // vanilla
public static StatDef ButcheryFleshEfficiency;         // vanilla
public static StatDef WorkSpeedGlobal;                 // vanilla
⋮----
// Thing-related stats
⋮----
public static StatDef ToolEstimatedLifespan;
public static StatDef ToolEffectivenessFactor;
⋮----
DefOfHelper.EnsureInitializedInCtor(typeof(ST_StatDefOf));
</file>

<file path="Source/Gating/JobGate.cs">
// RimWorld 1.6 / C# 7.3
// Source/Gating/JobGate.cs
⋮----
// using SurvivalTools.Helpers; // already included above
⋮----
public static class JobGate
⋮----
// micro-cache: WG/Job -> required stats (resolved once)
⋮----
// epsilon to avoid float jitter
⋮----
// hot path: LINQ-free
public static bool ShouldBlock(Pawn pawn, WorkGiverDef wg, JobDef job, bool forced, out string reasonKey, out string a1, out string a2)
⋮----
// Early-outs (do not gate these)
⋮----
if (settings == null || (!settings.hardcoreMode && !settings.extraHardcoreMode)) return false; // Normal never blocks here
// If this WorkGiver's work type is disabled or not active for the pawn and this is not a forced action,
// do not attempt rescue or gating. Avoids churn for work the pawn wouldn't do anyway.
⋮----
if (pawn.WorkTypeIsDisabled(wg.workType) || (ws != null && !ws.WorkIsActive(wg.workType)))
⋮----
// Resolve required stats once
⋮----
// If no stats, do not gate
⋮----
// PHASE 6 INTEGRATION: enforce rescue-first flow
⋮----
var best = Scoring.ToolScoring.GetBestTool(pawn, stat, out bestScore);
var baseline = SurvivalToolUtility.GetNoToolBaseline(stat);
⋮----
anyQueued |= AssignmentSearch.TryUpgradeFor(pawn, stat, 0.001f, 30f, 1000, AssignmentSearch.QueuePriority.Front, $"JobGate({wg?.defName ?? job?.defName}){(forced ? ":forced" : string.Empty)}");
⋮----
// Allow the job to exist: PreWork hooks will requeue ordered jobs; StartJob hook will requeue AI jobs
⋮----
return false; // Do not block; preserve the job/menu option
⋮----
// Hardcore/Nightmare block only if missing a required tool for ANY required stat
var req = requiredStatsPre; // Already resolved
⋮----
// Compare against toolless baseline from resolver
⋮----
// If we arrive here, either rescue was disabled or we couldn't queue any rescue. Provide standard reason.
reasonKey = "ST_Gate_MissingToolStat"; // "Requires a tool for {0} to do {1}."
⋮----
static StatDef[] ResolveRequiredStats(WorkGiverDef wg, JobDef job)
⋮----
// prefer WG binding; fall back to Job binding
⋮----
if (_wgReq.TryGetValue(wg, out arr)) return arr;
// Use helper directly (CompatAPI forwarder is obsolete)
var statsList = StatGatingHelper.GetStatsForWorkGiver(wg);
⋮----
// DEBUG: Log what stats we found for this WorkGiver
⋮----
LogDebug($"[JobGate.ResolveStats] WorkGiver {wg.defName}: found {arr.Length} stats via resolver: {string.Join(", ", arr.Select(s => s.defName))}", $"JobGate_ResolveStats_{wg.defName}");
⋮----
if (_jobReq.TryGetValue(job, out arr)) return arr;
// PHASE 6 INTEGRATION: Use SurvivalToolUtility for job stats
var statsList = SurvivalToolUtility.StatsForJob(job);
⋮----
// Optional: call when resolver rebuilds or settings change
public static void ClearCaches()
⋮----
_wgReq.Clear();
_jobReq.Clear();
⋮----
// -------------------------------------------------------------------------
// Strangler Pattern Kill List (Phase 5):
// - Remove now: (no deletes yet; comments only)
// - Old JobTracker reflection gate (remove after WG gates proven stable)
// - Any per-job "missing tool" checks outside this path
// - Patch_Pawn_JobTracker_ExtraHardcore reflection fallback
//
// Rationale:
// - WorkGiver_Scanner patches provide authoritative blocking at the right level
// - Eliminates scattered per-job gating logic in favor of unified JobGate
</file>

<file path="Source/Harmony/ITab_Gear_ST.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/ITab_Gear_ST.cs
// From our Phase 7 refactor branch: KEEP.
// Phase 7: Harmony patches for ITab_Pawn_Gear integration
// - Draw our panel alongside vanilla gear list
// - Input isolation to prevent interference
⋮----
public static class ITab_Gear_ST
⋮----
private static FieldInfo _sizeField;
private static PropertyInfo _selPawnProperty;
⋮----
// Cache reflection info for private members
_sizeField = AccessTools.Field(typeof(InspectTabBase), "size");
_selPawnProperty = AccessTools.Property(typeof(ITab), "SelPawn");
⋮----
/// <summary>
/// Expand the gear tab width to accommodate our panel
/// </summary>
⋮----
public static void ExpandGearTabWidth(ITab_Pawn_Gear __instance)
⋮----
// Always expand each instance (remove the global flag)
⋮----
var additionalWidth = UI.GearTab_ST.DesiredWidth + 12f; // Panel width + margin
var newSize = new Vector2(currentSize.x + additionalWidth, currentSize.y);
⋮----
Log.Error($"[SurvivalTools] Failed to expand gear tab: {ex}");
⋮----
/// Intercept vanilla FillTab to constrain its drawing area
⋮----
public static void LimitVanillaDrawArea(ITab_Pawn_Gear __instance)
⋮----
// Get pawn and check if we should constrain
⋮----
// Store the original tab size and set a constrained size for vanilla drawing
⋮----
var constrainedWidth = 425f; // Leave space for our panel
// Only constrain if we have a wide tab
if (currentTabSize.x > constrainedWidth + 50f) // Some buffer
⋮----
var constrainedSize = new Vector2(constrainedWidth, currentTabSize.y);
⋮----
Log.Error($"[SurvivalTools] Error constraining vanilla draw area: {ex}");
⋮----
/// Draw our panel alongside the vanilla gear list
⋮----
public static void DrawSurvivalToolsPanel(ITab_Pawn_Gear __instance)
⋮----
// Get pawn using reflection
⋮----
// Check if we should draw (avoid conflicts with legacy UI)
⋮----
// Restore the full tab size for our drawing
⋮----
var requiredTabWidth = 430f + panelWidth + 12f; // vanilla width + panel + margin
// Restore full size if it was constrained
⋮----
var expandedSize = new Vector2(requiredTabWidth, currentTabSize.y);
⋮----
// Position the panel to the right of vanilla content (at x=430, vanilla area is 0-425)
var panelRect = new Rect(
430f,  // Start right after vanilla content
10f,   // Standard top margin
⋮----
currentTabSize.y - 20f  // Full height minus margins
⋮----
// Draw our tool efficiency panel
UI.GearTab_ST.Draw(panelRect, pawn);
⋮----
Log.Error($"[SurvivalTools] Error drawing survival tools panel: {ex}");
⋮----
/// Get SelPawn using reflection
⋮----
private static Pawn GetSelPawn(ITab_Pawn_Gear instance)
⋮----
/// Get tab size using reflection
⋮----
private static Vector2 GetTabSize(ITab_Pawn_Gear instance)
⋮----
return (Vector2)(_sizeField?.GetValue(instance) ?? new Vector2(432f, 480f));
⋮----
return new Vector2(432f, 480f); // Default size
⋮----
/// Set tab size using reflection
⋮----
private static void SetTabSize(ITab_Pawn_Gear instance, Vector2 newSize)
⋮----
Log.Warning($"[SurvivalTools] Failed to set tab size: {ex.Message}");
⋮----
/// Check if legacy UI is active to avoid conflicts
⋮----
private static bool HasLegacyUIActive()
⋮----
// Check if legacy patches are still active
var original = AccessTools.Method(typeof(ITab_Pawn_Gear), "FillTab");
⋮----
var patches = HarmonyLib.Harmony.GetPatchInfo(original);
⋮----
// If we can't determine, assume legacy is not active
⋮----
/// Unpatch legacy UI if needed (called from settings or startup)
⋮----
public static void UnpatchLegacyUIIfNeeded()
⋮----
harmonyInstance.Unpatch(original, HarmonyPatchType.Postfix, LegacyUIHarmonyId);
⋮----
Log.Warning($"[SurvivalTools] Could not unpatch legacy UI: {ex.Message}");
⋮----
/// Harmony patch guard for method signature changes
⋮----
public static class ITab_Gear_ST_Guard
⋮----
public static bool Prepare()
⋮----
// Verify ITab_Pawn_Gear.FillTab exists with expected signature
var method = AccessTools.Method(typeof(ITab_Pawn_Gear), "FillTab");
⋮----
Log.Warning("[SurvivalTools] ITab_Pawn_Gear.FillTab method not found - skipping gear tab integration");
⋮----
// Verify method signature (should be void FillTab())
var parameters = method.GetParameters();
⋮----
Log.Warning("[SurvivalTools] ITab_Pawn_Gear.FillTab has unexpected signature - skipping gear tab integration");
⋮----
public static System.Reflection.MethodBase TargetMethod()
⋮----
return AccessTools.Method(typeof(ITab_Pawn_Gear), "FillTab");
</file>

<file path="Source/Harmony/ST_PatchGuard.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/ST_PatchGuard.cs
// Phase 6-7: Patch guard to clean up legacy patches from older SurvivalTools versions.
// Removes old patches that are no longer needed or have been replaced by new systems.
⋮----
static class ST_PatchGuard
⋮----
Log.Message("[SurvivalTools.PatchGuard] Starting patch cleanup...");
// Phase 6: Job assignment system (replaces legacy auto-equip patches)
// Signature discovered: TryTakeOrderedJob(Job job, JobTag? tag, bool fromQueue)
⋮----
new[] { typeof(Job), typeof(bool) }, // Fallback for non-nullable
⋮----
// Phase 6: Job start system (add TryStartJob coverage)
⋮----
// Phase 7: Gear tab integration (replaces legacy gear UI patches)
⋮----
// Phase 7: Clean up legacy gear tab DrawThingRow transpilers
⋮----
allowedTypes: new Type[0]); // No allowed types - remove all legacy transpilers
// Phase 5-6: Clean up legacy JobGiver_Work auto-tool patches
⋮----
allowedTypes: new Type[0]); // No allowed types - remove all legacy patches
Log.Message("[SurvivalTools.PatchGuard] Patch cleanup complete.");
⋮----
static void SweepWithFallback<TDecl>(string name, Type[] primarySig, Type[] fallbackSig, Type[] allowedTypes)
⋮----
// Try primary signature first
var orig = AccessTools.Method(typeof(TDecl), name, primarySig);
⋮----
// Fall back to alternate signature
Log.Message($"[SurvivalTools.PatchGuard] Primary signature not found for {typeof(TDecl).Name}.{name}, trying fallback");
⋮----
static void Sweep<TDecl>(string name, Type[] sig, Type[] allowedTypes)
⋮----
var orig = AccessTools.Method(typeof(TDecl), name, sig);
⋮----
Log.Warning($"[SurvivalTools.PatchGuard] Method {typeof(TDecl).Name}.{name} not found");
⋮----
var info = Harmony.GetPatchInfo(orig);
⋮----
Log.Message($"[SurvivalTools.PatchGuard] No patches found on {typeof(TDecl).Name}.{name}");
⋮----
Log.Message($"[SurvivalTools.PatchGuard] Checking {typeof(TDecl).Name}.{name} - {info.Prefixes.Count} prefixes, {info.Postfixes.Count} postfixes");
⋮----
// Remove any ST-owned prefixes/postfixes not in the allowlist
⋮----
Log.Message($"[SurvivalTools.PatchGuard] Removed {removedCount} legacy patches from {typeof(TDecl).Name}.{name}");
⋮----
Log.Message($"[SurvivalTools.PatchGuard] No legacy patches to remove from {typeof(TDecl).Name}.{name}");
⋮----
static bool TryUnpatchIfLegacy(MethodBase original, Patch patch, Type[] allowedTypes)
⋮----
// BULLETPROOF: Assembly validation + namespace check
⋮----
(dt.Namespace != null && dt.Namespace.StartsWith("SurvivalTools", StringComparison.Ordinal));
bool allowed = Array.IndexOf(allowedTypes, dt) >= 0;
⋮----
Log.Message($"[SurvivalTools.PatchGuard] Removing legacy patch: {dt.FullName}.{m.Name} (owner: {patch.owner})");
// Unpatch by method (works regardless of harmonyId)
_harmony.Unpatch(original: original, patch: m);
⋮----
Log.Message($"[SurvivalTools.PatchGuard] Keeping allowed patch: {dt.FullName}.{m.Name} (owner: {patch.owner})");
</file>

<file path="Source/Helpers/JobUtils.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/JobUtils.cs
// A centralized helper methods for Job management:
// - cloning (shallow vs deep)
// - type checks (inventory/tool jobs)
// - validation & logging utilities
// KEEP
⋮----
/// <summary>
/// Centralized helper methods for Job management:
/// - cloning (shallow vs deep)
/// - type checks (inventory/tool jobs)
/// - validation & logging utilities
/// </summary>
public static class JobUtils
⋮----
/// Create a shallow clone of a Job for immediate execution.
/// Preserves references (queues, lists, etc.) from the original.
/// âš ï¸ Only use this if the clone is short-lived and wonâ€™t be mutated
/// in parallel with the original.
⋮----
public static Job ShallowClone(Job originalJob)
⋮----
var clone = new Job(originalJob.def, originalJob.targetA, originalJob.targetB, originalJob.targetC)
⋮----
def = originalJob.def // redundant but explicit
⋮----
/// Create a deep clone of a Job for queue storage.
/// Clones collections (queues/lists) so the copy is safe to enqueue
/// without being affected by mutations to the original.
⋮----
public static Job CloneJobForQueue(Job originalJob)
⋮----
// Deep copy mutable collections
⋮----
/// True if job is related to inventory hauling and shouldnâ€™t be re-queued.
⋮----
public static bool IsInventoryJob(Job job)
⋮----
/// True if job is survival tool management (drop/equip).
/// Used to avoid conflicts with auto-tool logic.
⋮----
public static bool IsToolManagementJob(Job job)
⋮----
/// Build a compact string description for debug logging.
⋮----
public static string GetJobDescription(Job job)
⋮----
/// Returns true if this job requires any survival-tool-relevant stats.
/// Caller gets the resolved stat list.
⋮----
public static bool RequiresSurvivalToolStats(Job job, out List<StatDef> requiredStats)
⋮----
requiredStats = SurvivalToolUtility.StatsForJob(job);
⋮----
// Defensive: donâ€™t propagate exceptions from stat resolution
⋮----
/// Validate that a job is still executable:
/// - targets exist, are not destroyed, and are on the same map
/// - job def is still defined (protects against mod unloads)
⋮----
public static bool IsJobStillValid(Job job, Pawn pawn)
⋮----
// Check primary target
⋮----
// Allow null map for carried items (inventory/equipment)
⋮----
!job.targetA.Cell.InBounds(pawn.Map))
⋮----
// Ensure the JobDef still exists (def removal compatibility guard)
return DefDatabase<JobDef>.AllDefs.Any(def => def == job.def);
</file>

<file path="Source/Helpers/PawnToolValidator.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/PawnToolValidator.cs
// Legacy Code: KEEP, but evaluate merging into a better file.
⋮----
/// <summary>
/// Centralized pawn capability and policy validation for tool usage.
/// Contains methods that were scattered throughout the codebase to validate
/// whether pawns can use tools, acquire tools, or have tools assigned.
///
/// 🔒 Note:
/// - Mechanoids are excluded here (RaceProps.IsMechanoid).
///   They have built-in “tools” and should never interact with SurvivalTools.
///   This prevents edge cases with Biotech mechs or modded mechanoids.
/// - If a future mod adds humanoid mechanoids *intended* to use real tools,
///   add a settings toggle here to re-enable them.
/// </summary>
public static class PawnToolValidator
⋮----
/// Core check if a pawn can use survival tools.
/// This method is used extensively throughout the mod.
⋮----
public static bool CanUseSurvivalTools(Pawn pawn)
⋮----
// Exclude animals entirely as a safeguard regardless of faction
⋮----
!pawn.RaceProps.IsMechanoid &&    // 🚫 Block all mechs
⋮----
/// Determines if a tool meets the policy requirements for acquisition.
/// Used in tool acquisition logic throughout the AI system.
⋮----
public static bool ToolIsAcquirableByPolicy(Pawn pawn, Thing tool)
⋮----
// Basic checks
if (tool.IsForbidden(pawn) || !pawn.CanReach(tool, PathEndMode.ClosestTouch, Danger.Deadly))
⋮----
// Only survival tools or tool-stuff are considered valid
return ToolClassification.IsSurvivalTool(tool) || tool.def.IsToolStuff();
⋮----
/// Check if a pawn is allowed to automatically drop a tool after completing a job.
/// Used in auto-optimization and job completion logic.
⋮----
public static bool AllowedToAutomaticallyDrop(Pawn pawn, Thing toolThing)
⋮----
// Never drop forced items
⋮----
// Check tool assignment rules
⋮----
// If the assignment does not allow this tool, it can be dropped
return !tracker.CurrentSurvivalToolAssignment.Allows(toolThing);
⋮----
// Default: allow dropping if not forced
⋮----
/// Check if a tool is forced for a specific pawn (via forced items or assignment).
⋮----
public static bool IsToolForced(Pawn pawn, Thing toolThing)
⋮----
/// Basic validation that a pawn can reasonably use a survival tool.
/// Includes mental state, capability, faction, and mechanoid checks.
⋮----
/// 🔒 Difference from CanUseSurvivalTools:
/// - Looser: doesn’t require player faction.
/// - Still excludes mechs, downed, dead, and mental pawns.
/// - Useful for utility functions where faction doesn’t matter.
⋮----
public static bool CanUseTools(Pawn pawn)
⋮----
if (pawn.RaceProps?.IsMechanoid == true) return false; // 🚫 Block all mechs
// Exclude animals as a safeguard (consistent with CanUseSurvivalTools)
⋮----
/// Check if a pawn would benefit from using the specified tool.
/// Utility for relevance checks (used in auto-tool pickup logic).
⋮----
public static bool WouldBenefitFromTool(Pawn pawn, Thing tool)
⋮----
// If it's a survival tool wrapper, always potentially beneficial
if (ToolClassification.IsSurvivalTool(tool)) return true;
// If it's tool-stuff, check if it has relevant properties
if (tool.def.IsToolStuff())
</file>

<file path="Source/Helpers/SafetyUtils.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/SafetyUtils.cs
// TODO: Evaluate if these need to be integrated into our refactored codebase or if they are redundant.
⋮----
/// <summary>
/// Utility class providing safe operations and null-safe extensions
/// to reduce crashes and improve error handling.
///
/// Future idea:
/// - Add overloads with context-sensitive logging (e.g. debug vs release).
/// - Add async-safe versions if ever integrating with tasks/threads.
/// - Optionally collect/report recurring exceptions instead of spamming the log.
/// </summary>
public static class SafetyUtils
⋮----
// ---------------------------
// Collection helpers
⋮----
/// Safely gets the count of a collection, returning 0 if null.
⋮----
public static int SafeCount<T>(this ICollection<T> collection)
⋮----
/// Safely gets the count of an enumerable, returning 0 if null.
⋮----
public static int SafeCount<T>(this IEnumerable<T> enumerable)
⋮----
return enumerable == null ? 0 : enumerable.Count();
⋮----
/// Safely gets the first element or default value.
⋮----
public static T SafeFirstOrDefault<T>(this IEnumerable<T> enumerable)
⋮----
return enumerable == null ? default(T) : enumerable.FirstOrDefault();
⋮----
/// Safely gets the first element matching predicate or default value.
⋮----
public static T SafeFirstOrDefault<T>(this IEnumerable<T> enumerable, Func<T, bool> predicate)
⋮----
return (enumerable == null || predicate == null) ? default(T) : enumerable.FirstOrDefault(predicate);
⋮----
/// Safely accesses an element by index, returning default if null or out of bounds.
⋮----
public static T SafeElementAt<T>(this IList<T> list, int index)
⋮----
/// Safely checks if a collection has any elements.
⋮----
public static bool SafeAny<T>(this IEnumerable<T> enumerable)
⋮----
return enumerable != null && enumerable.Any();
⋮----
/// Safely checks if a collection has any elements matching predicate.
⋮----
public static bool SafeAny<T>(this IEnumerable<T> enumerable, Func<T, bool> predicate)
⋮----
return enumerable != null && predicate != null && enumerable.Any(predicate);
⋮----
// Execution helpers
⋮----
/// Safely executes an action with exception handling and logging.
⋮----
public static void SafeExecute(Action action, string context = "SafeExecute")
⋮----
/// Safely executes a function with exception handling and logging, returning default on error.
⋮----
public static T SafeExecute<T>(Func<T> func, T defaultValue = default(T), string context = "SafeExecute")
⋮----
// Def / Pawn / Thing helpers
⋮----
/// Safely gets a ThingDef by name, with fallback and logging if not found.
⋮----
public static ThingDef SafeGetThingDef(string defName, ThingDef fallback = null)
⋮----
if (string.IsNullOrEmpty(defName)) return fallback;
var def = DefDatabase<ThingDef>.GetNamed(defName, errorOnFail: false);
⋮----
/// Validates that a pawn is not null, not dead, and not destroyed.
⋮----
public static bool IsValidPawn(Pawn pawn)
⋮----
/// Validates that a thing is not null and not destroyed.
⋮----
public static bool IsValidThing(Thing thing)
⋮----
// Mod extension helpers
⋮----
/// Safely gets a mod extension from a def, with null checking.
⋮----
public static T SafeGetModExtension<T>(this Def def) where T : DefModExtension
⋮----
/// Safely tries to get a mod extension, returning whether it was found.
⋮----
public static bool TrySafeGetModExtension<T>(this Def def, out T extension) where T : DefModExtension
</file>

<file path="Source/Helpers/SurvivalToolDiscovery.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/SurvivalToolDiscovery.cs
// Evaluate if this is should be integrated into our refactored codebase.
// Legacy code: Needs review.
// Central helper for discovering survival tools, valid replacements, and
// research-gated tool availability. Used by alerts and optimizers.
⋮----
public static class SurvivalToolDiscovery
⋮----
/// <summary>
/// Returns all unlocked (researched) tool ThingDefs that contribute to the given stat.
/// Includes modded tools that define SurvivalToolProperties with that stat.
/// </summary>
public static IEnumerable<ThingDef> GetToolsForStat(StatDef stat)
⋮----
var props = SurvivalToolProperties.For(def);
⋮----
if (props.baseWorkStatFactors.Any(m => m?.stat == stat))
⋮----
// Skip if locked behind research
⋮----
/// Given a pawn and a damaged tool, finds the best researched replacement available
/// (higher stat factor for at least one stat the tool provides).
/// Returns null if none found.
⋮----
public static ThingDef GetBestReplacement(Pawn pawn, SurvivalTool damagedTool)
⋮----
var stats = damagedTool.WorkStatFactors.Select(m => m.stat).Where(s => s != null).Distinct().ToList();
if (stats.NullOrEmpty()) return null;
// Evaluate score of the damaged tool
⋮----
// Scan all tools (real defs) that share at least one relevant stat
⋮----
.Where(d => SurvivalToolProperties.For(d).HasWorkStatFactors &&
SurvivalToolProperties.For(d).baseWorkStatFactors.Any(m => stats.Contains(m.stat)) &&
⋮----
.ToList();
ThingDef best = null;
⋮----
float score = props.baseWorkStatFactors.Where(m => stats.Contains(m.stat)).Sum(m => m.value);
⋮----
/// Returns true if the tool def is considered "researched/unlocked".
/// Tools without research requirements are always unlocked.
⋮----
public static bool IsUnlocked(ThingDef def)
⋮----
if (reqs.NullOrEmpty()) return true;
return reqs.All(r => r != null && r.IsFinished);
⋮----
/// Scores a tool (or virtual tool) based on its stat modifiers.
/// Simple sum of values for its WorkStatFactors.
⋮----
private static float ToolScore(SurvivalTool tool)
</file>

<file path="Source/Helpers/ToolClassification.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ToolClassification.cs
// Evaluate if this is needed or useful, otherwise remove it. Is it used by the refactor?
// Should it be integrated?
⋮----
/// <summary>
/// Helper methods for classifying and identifying tool types, purposes, and capabilities.
/// Centralized from ToolUtility, VirtualTool, and various detection logic.
/// </summary>
public static class ToolClassification
⋮----
/// Determine the tool kind based on the thing's properties, name, and stats.
⋮----
public static STToolKind ClassifyToolKind(Thing thing)
⋮----
// Direct tool classification via mod extension
if (thing.def.IsSurvivalTool())
⋮----
return ClassifyByStats(props.baseWorkStatFactors.Select(f => f.stat));
⋮----
// Tool-stuff classification
if (thing.def.IsToolStuff())
⋮----
return ClassifyByStats(stuffProps.baseWorkStatFactors.Select(f => f.stat));
⋮----
// Fallback to name-based detection
⋮----
/// Classify tool kind based on the stats it improves.
⋮----
public static STToolKind ClassifyByStats(IEnumerable<StatDef> stats)
⋮----
var statSet = new HashSet<StatDef>(stats.Where(s => s != null));
// Priority order matters - more specific matches first
if (statSet.Contains(ST_StatDefOf.DiggingSpeed)) return STToolKind.Pick;
if (statSet.Contains(ST_StatDefOf.TreeFellingSpeed)) return STToolKind.Axe;
if (statSet.Contains(ST_StatDefOf.PlantHarvestingSpeed)) return STToolKind.Sickle;
if (statSet.Contains(ST_StatDefOf.SowingSpeed)) return STToolKind.Hoe;
if (statSet.Contains(StatDefOf.ConstructionSpeed)) return STToolKind.Hammer;
if (statSet.Contains(ST_StatDefOf.MaintenanceSpeed) || statSet.Contains(ST_StatDefOf.DeconstructionSpeed)) return STToolKind.Wrench;
if (statSet.Contains(ST_StatDefOf.CleaningSpeed)) return STToolKind.Cleaning;
if (statSet.Contains(ST_StatDefOf.ResearchSpeed)) return STToolKind.Research;
if (statSet.Contains(ST_StatDefOf.MedicalOperationSpeed) || statSet.Contains(ST_StatDefOf.MedicalSurgerySuccessChance)) return STToolKind.Medical;
if (statSet.Contains(ST_StatDefOf.ButcheryFleshSpeed) || statSet.Contains(ST_StatDefOf.ButcheryFleshEfficiency)) return STToolKind.Knife;
⋮----
/// Classify tool kind based on defName and label patterns.
⋮----
public static STToolKind ClassifyByName(ThingDef def)
⋮----
var name = def.defName.ToLowerInvariant();
⋮----
// Pick/Mining tools
⋮----
// Axe/Tree felling
⋮----
// Sickle/Harvesting
⋮----
// Hoe/Farming
⋮----
// Hammer/Construction
⋮----
// Wrench/Maintenance
⋮----
// Medical tools
⋮----
// Cleaning tools
⋮----
// Knife/Butchery
⋮----
/// Check if a thing can function as a survival tool (real tool or tool-stuff).
⋮----
public static bool IsSurvivalTool(Thing thing)
⋮----
return thing.def.IsSurvivalTool() ||
thing.def.IsToolStuff() ||
⋮----
/// Check if a tool definition looks like tool-stuff based on name patterns.
⋮----
public static bool LooksLikeToolStuff(ThingDef def)
⋮----
// Common tool-stuff patterns
⋮----
/// Check if a tool is considered a "pacifist tool" (non-weapon).
⋮----
public static bool IsPacifistTool(ThingDef def)
⋮----
// These tool types are clearly non-violent
⋮----
/// Get the expected stats that a tool kind should improve.
⋮----
public static IEnumerable<StatDef> GetExpectedStatsForKind(STToolKind kind)
⋮----
/// Check if a string contains any of the specified substrings.
⋮----
private static bool ContainsAny(string text, params string[] substrings)
⋮----
if (string.IsNullOrEmpty(text) || substrings == null) return false;
return substrings.Any(s => !string.IsNullOrEmpty(s) && text.Contains(s));
</file>

<file path="Source/Helpers/WorkSpeedGlobalHelper.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/WorkSpeedGlobalHelper.cs
// Legacy Code: needs review and evaluation.
// May be still required but likely needs refactor to fit with new architecture.
⋮----
/// <summary>
/// Helper methods for WorkSpeedGlobal job detection and management
/// </summary>
public static class WorkSpeedGlobalHelper
⋮----
/// Get all work givers that use the WorkSpeedGlobal stat
⋮----
public static IEnumerable<WorkGiverDef> GetWorkSpeedGlobalJobs()
⋮----
.Where(workGiver => UsesWorkSpeedGlobal(workGiver))
.OrderBy(workGiver => workGiver.workType?.label ?? "Unknown")
.ThenBy(workGiver => workGiver.label ?? workGiver.defName);
⋮----
/// Check if a work giver uses the WorkSpeedGlobal stat
⋮----
public static bool UsesWorkSpeedGlobal(WorkGiverDef workGiver)
⋮----
// Check if it's explicitly listed in vanilla job drivers that use WorkSpeedGlobal
⋮----
if (knownWorkSpeedJobs.Any(job =>
workGiver.defName.Contains(job) ||
(!string.IsNullOrEmpty(workGiver.label) && workGiver.label.ToLower().Contains(job.ToLower()))))
⋮----
// Check work type
⋮----
if (workTypesThatUseWorkSpeed.Any(type =>
workGiver.workType.defName.Contains(type) ||
(!string.IsNullOrEmpty(workGiver.workType.label) && workGiver.workType.label.ToLower().Contains(type.ToLower()))))
⋮----
// Check if it's a bill-based work giver (these typically use WorkSpeedGlobal)
if (workGiver.defName.Contains("DoBill") ||
(!string.IsNullOrEmpty(workGiver.label) && workGiver.label.ToLower().Contains("bill")))
⋮----
/// Check if a specific job should be gated by survival tools based on settings
⋮----
public static bool ShouldGateJob(WorkGiverDef workGiver, SurvivalToolsSettings settings)
⋮----
// If the job doesn't use WorkSpeedGlobal, don't gate it
⋮----
// Check the settings dictionary
return settings.workSpeedGlobalJobGating.GetValueOrDefault(workGiver.defName, true);
</file>

<file path="Source/ModExtensions/StuffPropsTool.cs">
// RimWorld 1.6 / C# 7.3
// Source/ModExtensions/StuffPropsTool.cs
⋮----
namespace SurvivalTools
⋮----
public class StuffPropsTool : DefModExtension
⋮----
public static readonly StuffPropsTool defaultValues = new StuffPropsTool();
// Factors applied to survival tool stats when this stuff is used.
// Initialize to avoid null refs in consumers.
⋮----
// Multiplier for tool wear when made from this stuff (1 = normal).
⋮----
/// <summary>
/// Convenience: get the extension for a stuff def, or defaultValues if absent.
/// </summary>
public static StuffPropsTool For(ThingDef stuffDef)
⋮----
/// Check if this stuff has any tool stat factors defined.
⋮----
/// Get the modifier for a specific stat, or null if not found.
⋮----
public StatModifier GetStatModifier(StatDef stat)
⋮----
/// Get the factor value for a specific stat (1.0 if not found).
⋮----
public float GetStatFactor(StatDef stat)
</file>

<file path="1.6/Languages/ChineseSimplified/DefInjected/ThingDef/Tools.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- Basic/Primitive Tools -->
  <SurvivalTools_Axe.label>斧头</SurvivalTools_Axe.label>
  <SurvivalTools_Axe.description>为高效伐木工作而设计的基础林业工具。其重量级头部提供强大的冲击力，使其成为从事木材工作的殖民者不可或缺的工具。其平衡性和杠杆效应使其比临时切割方法更加有效。当生存需要时，也可作为可靠的近战武器。</SurvivalTools_Axe.description>
  <SurvivalTools_Axe.tools.0.label>手柄</SurvivalTools_Axe.tools.0.label>
  <SurvivalTools_Axe.tools.1.label>前端</SurvivalTools_Axe.tools.1.label>
  <SurvivalTools_Pickaxe.label>镐</SurvivalTools_Pickaxe.label>
  <SurvivalTools_Pickaxe.description>一种重要的采矿工具，具有固定在坚固手柄上的重型尖头。专门设计用于破碎硬岩石并高效提取有价值的材料。其集中力量和杠杆效应对于高产采矿作业至关重要。当情况需要时，也可作为临时武器使用。</SurvivalTools_Pickaxe.description>
  <SurvivalTools_Pickaxe.tools.0.label>手柄</SurvivalTools_Pickaxe.tools.0.label>
  <SurvivalTools_Pickaxe.tools.1.label>前端</SurvivalTools_Pickaxe.tools.1.label>
  <SurvivalTools_Hammer.label>锤子</SurvivalTools_Hammer.label>
  <SurvivalTools_Hammer.description>任何建筑项目的基础工具。这把多功能锤子提供了钉入紧固件、塑造材料和组装结构所需的精度和力量。对于从事建筑和维护工作的殖民者来说是不可或缺的。其平衡设计确保在长时间建筑工作期间以最小疲劳度提供有效打击。</SurvivalTools_Hammer.description>
  <SurvivalTools_Hammer.tools.0.label>手柄</SurvivalTools_Hammer.tools.0.label>
  <SurvivalTools_Hammer.tools.1.label>前端</SurvivalTools_Hammer.tools.1.label>
  <SurvivalTools_Sickle.label>镰刀</SurvivalTools_Sickle.label>
  <SurvivalTools_Sickle.description>一种专用农业工具，具有完美设计的弯曲刀片，用于收割作物和切割植物材料。其人体工程学设计允许高效、重复的切割动作，对用户造成最小的压力。对于高产农业经营和植物维护工作不可或缺。</SurvivalTools_Sickle.description>
  <SurvivalTools_Sickle.tools.0.label>手柄</SurvivalTools_Sickle.tools.0.label>
  <SurvivalTools_Sickle.tools.1.label>前端</SurvivalTools_Sickle.tools.1.label>
  <SurvivalTools_Hoe.label>锄头</SurvivalTools_Hoe.label>
  <SurvivalTools_Hoe.description>为土壤准备和种子种植而设计的基础农业工具。其尖锐设计有效地破碎土壤，创造最佳种植条件。对于建立高产农业经营和维持作物产量不可或缺。其坚固结构确保季节间的可靠性能。</SurvivalTools_Hoe.description>
  <SurvivalTools_Knife.label>刀</SurvivalTools_Knife.label>
  <SurvivalTools_Knife.description>一种多功能切割工具，具有对精密工作不可或缺的锋利刀刃。非常适合屠宰工作、医疗程序和一般切割任务。其平衡设计允许受控、精确的切割，而锋利的刀刃确保干净的工作。任何认真的殖民者的必备工具。</SurvivalTools_Knife.description>
  <SurvivalTools_HandSaw.label>手锯</SurvivalTools_HandSaw.label>
  <SurvivalTools_HandSaw.description>一种传统木工工具，具有精确切割齿的金属刀片，用于手动木材加工。对于需要定制切割木材和详细木工的建筑项目不可或缺。手锯的稳定节奏可能比电动工具需要更长时间，但提供出色的控制和精度。</SurvivalTools_HandSaw.description>
  <SurvivalTools_BoneSickle.label>骨镰刀</SurvivalTools_BoneSickle.label>
  <SurvivalTools_BoneSickle.description>一种由雕刻骨头制成的原始收割工具，具有磨锐的边缘。虽然不如其金属对应物耐用，但这种传统工具在收割作物和切割植物方面表现出色。其弯曲设计遵循已通过无数代农业工作证明其有效性的古老模式。</SurvivalTools_BoneSickle.description>
  <SurvivalTools_PrimitiveLever.label>撬棍</SurvivalTools_PrimitiveLever.label>
  <SurvivalTools_PrimitiveLever.description>一种由耐用材料制成的原始但有效的杠杆工具。对于拆卸结构、分离材料和执行基本机械操作不可或缺。代表了早期文明在没有先进技术的情况下为建筑和拆除工作开发实用解决方案的聪明才智。</SurvivalTools_PrimitiveLever.description>
  <SurvivalTools_Abacus.label>算盘</SurvivalTools_Abacus.label>
  <SurvivalTools_Abacus.description>一种古老的计算工具，在杆上排列可移动珠子以执行算术运算。对于组织研究数据、管理复杂计算和在没有先进计算设备的社会中保持准确记录不可或缺。代表数学思维和数据组织的基础。</SurvivalTools_Abacus.description>
  <!-- Industrial Tools -->
  <SurvivalTools_SteelKnife.label>钢刀</SurvivalTools_SteelKnife.label>
  <SurvivalTools_SteelKnife.description>一把精密锻造的钢刀，具有卓越的保锐性和耐用性。碳钢刀片通过广泛使用保持其锋利度，使其成为要求苛刻的屠宰和医疗工作的理想选择。人体工程学手柄为精细工作提供出色控制。</SurvivalTools_SteelKnife.description>
  <SurvivalTools_CrosscutSaw.label>横锯</SurvivalTools_CrosscutSaw.label>
  <SurvivalTools_CrosscutSaw.description>为高效木工和建筑工作设计的精密工业锯。其专门设计的齿和强化钢结构允许通过各种材料进行干净、精确的切割。对于大型建筑项目和先进木工工作不可或缺。</SurvivalTools_CrosscutSaw.description>
  <SurvivalTools_Wrench.label>扳手</SurvivalTools_Wrench.label>
  <SurvivalTools_Wrench.description>设计用于抓取、转动和操纵紧固件和机械部件的精密机械工具。对于维护工作、机器修理和需要精确调整的建筑项目至关重要。可调夹爪系统适应各种尺寸，同时提供最佳杠杆和控制。</SurvivalTools_Wrench.description>
  <SurvivalTools_Microscope.label>显微镜</SurvivalTools_Microscope.label>
  <SurvivalTools_Microscope.description>一种精密光学仪器，放大小物体和样本以进行详细检查。对于先进研究、生物学研究和科学分析不可或缺。</SurvivalTools_Microscope.description>
  <!-- Precision Tools -->
  <SurvivalTools_CarbidePick.label>硬质合金镐</SurvivalTools_CarbidePick.label>
  <SurvivalTools_CarbidePick.description>一种先进的采矿工具，具有碳化物尖端，在最苛刻的挖掘工作中保持其锋利度。精确设计的头部比标准工具更有效地切割岩石，而其强化结构确保在恶劣的采矿条件下具有卓越的耐用性。</SurvivalTools_CarbidePick.description>
  <SurvivalTools_PrecisionScalpel.label>精密手术刀</SurvivalTools_PrecisionScalpel.label>
  <SurvivalTools_PrecisionScalpel.description>一种由优质钢合金制成的超锋利外科器械。精心平衡的刀片通过反复消毒和使用保持其锋利度，而人体工程学手柄确保在精细医疗程序中的精确控制。先进医疗设施的标准设备。</SurvivalTools_PrecisionScalpel.description>
  <SurvivalTools_PowerDrill.label>电钻</SurvivalTools_PowerDrill.label>
  <SurvivalTools_PowerDrill.description>一种由内置电机驱动的机械化钻孔工具，能够精确快速地钻透坚硬材料。可变速电机和可互换钻头使其对建筑和机械工作极其有价值。需要定期维护以保持电机平稳运行。</SurvivalTools_PowerDrill.description>
  <!-- Spacer Tools -->
  <SurvivalTools_Multitool.label>闪耀世界多用工具</SurvivalTools_Multitool.label>
  <SurvivalTools_Multitool.description>一种在闪耀世界社会中家用机械体常用的高科技通用工具。这种先进设备能够无缝适应任何任务——建筑、采矿、林业、维护、拆除——使其成为终极的一体化生存工具。虽然为机械体设计，但由于生理相似性，人形生物完全可以使用。</SurvivalTools_Multitool.description>
  <SurvivalTools_Multitool.tools.0.label>手柄</SurvivalTools_Multitool.tools.0.label>
  <SurvivalTools_Multitool.tools.1.label>前端</SurvivalTools_Multitool.tools.1.label>
  <SurvivalTools_PileOfRags.label>一堆破布</SurvivalTools_PileOfRags.label>
  <SurvivalTools_PileOfRags.description>简单的清洁工具，由破布和织物碎片制成。对于基本的清洁工作很有用，但磨损很快。</SurvivalTools_PileOfRags.description>
  <!-- =================================================== -->
  <!-- 多用途通用工作工具 (WorkSpeedGlobal)                -->
  <!-- 新增工具定义需要本地化条目                         -->
  <!-- =================================================== -->
  <!-- 部落 / 原始阶层 -->
  <SurvivalTools_MultipurposeStoneTool.label>多用途石制工具</SurvivalTools_MultipurposeStoneTool.label>
  <SurvivalTools_MultipurposeStoneTool.description>一种粗糙但多功能的石制器具，打磨成可覆盖多种通用任务的形状。虽属原始，却能略微提升整体工作速度。</SurvivalTools_MultipurposeStoneTool.description>
  <SurvivalTools_CarvedBoneImplements.label>雕刻骨制多件工具</SurvivalTools_CarvedBoneImplements.label>
  <SurvivalTools_CarvedBoneImplements.description>一组精心雕刻并捆绑在一起的骨制小工具，供多用途使用。较脆弱，但造型高效，可带来显著的通用工作速度提升。</SurvivalTools_CarvedBoneImplements.description>
  <!-- 中世纪阶层 -->
  <SurvivalTools_ArtisansToolkit.label>工匠工具套件</SurvivalTools_ArtisansToolkit.label>
  <SurvivalTools_ArtisansToolkit.description>一套精心挑选的中世纪时期优质工具，用于制作、整形与装配。可提升多类任务的整体处理效率。</SurvivalTools_ArtisansToolkit.description>
  <SurvivalTools_WoodworkersKit.label>木工工具包</SurvivalTools_WoodworkersKit.label>
  <SurvivalTools_WoodworkersKit.description>一组专用锯、凿、刨与量具，优化于木材成形与榫卯作业。良好的组织与品质赋予显著的通用工作速度增益。</SurvivalTools_WoodworkersKit.description>
  <!-- 工业阶层 -->
  <SurvivalTools_MechanicsToolkit.label>机械技师工具箱</SurvivalTools_MechanicsToolkit.label>
  <SurvivalTools_MechanicsToolkit.description>一个整理良好的工业时代工具箱，内含精密扳手、量规、扭矩工具与快速取放的收纳。大幅改善通用任务流程与协调。</SurvivalTools_MechanicsToolkit.description>
  <SurvivalTools_WorkshopHammerDrill.label>重型车间锤击钻</SurvivalTools_WorkshopHammerDrill.label>
  <SurvivalTools_WorkshopHammerDrill.description>一台可更换冲击与旋转模块的重型动力锤击钻。其集成夹持与对准系统几乎加速所有机械或建造相关任务。</SurvivalTools_WorkshopHammerDrill.description>
  <!-- 超科技 / 闪耀阶层 -->
  <SurvivalTools_NanofabricatorInterface.label>纳米制造接口</SurvivalTools_NanofabricatorInterface.label>
  <SurvivalTools_NanofabricatorInterface.description>一个流线型的控制与增强模块，将用户动作与自适应纳米组装流程同步。显著提升通用任务执行效率。</SurvivalTools_NanofabricatorInterface.description>
  <SurvivalTools_OmniToolGauntlet.label>全域多能工具护臂</SurvivalTools_OmniToolGauntlet.label>
  <SurvivalTools_OmniToolGauntlet.description>一只前沿的模块化护臂，内嵌力场投射器、微型制造器与力对齐操作器。通过预测式优化提供无与伦比的通用工作速度提升。</SurvivalTools_OmniToolGauntlet.description>
</LanguageData>
</file>

<file path="1.6/Languages/ChineseSimplified/Keyed/Keys.xml">
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <NoTool>没有工具</NoTool>
  <ToolInUse>（使用中）</ToolInUse>
  <!-- Settings -->
  <SurvivalToolsSettingsCategory>基础工具</SurvivalToolsSettingsCategory>
  <Settings_BasicSection>基本设置</Settings_BasicSection>
  <Settings_DebugSection>调试设置</Settings_DebugSection>
  <Settings_HardcoreMode>极限模式</Settings_HardcoreMode>
  <Settings_HardcoreMode_Tooltip>大幅提升游戏难度，使工具成为生存必需品。没有合适的工具，殖民者将无法有效执行大多数工作任务。工具磨损速度也会增加50%，需要更频繁的更换和更好的工具管理。将游戏转变为真正依赖工具的生存体验。</Settings_HardcoreMode_Tooltip>
  <Settings_ExtraHardcoreMode>超极限模式</Settings_ExtraHardcoreMode>
  <Settings_ExtraHardcoreMode_Tooltip>终极难度：最极端的生存挑战。与极限模式结合时，殖民者在没有合适工具的情况下将变得完全无助。原本只是效率较低的任务（如徒手清洁或临时医疗护理）变得完全无法尝试。工具磨损速度比正常情况快87.5%，对工具生产和维护造成持续压力。使用下方复选框精确控制哪些工作类型需要工具依赖。警告：早期游戏变得极其困难——工具获取成为殖民地生存的关键！</Settings_ExtraHardcoreMode_Tooltip>
  <Settings_RequireCleaningTools>需要清洁工具</Settings_RequireCleaningTools>
  <Settings_RequireCleaningTools_Tooltip>强制殖民者在所有清洁任务中使用适当的清洁工具（如扫帚或拖把）。没有合适的工具，他们无法清洁地板、清除污垢或清理积雪。在极端难度模式下维持殖民地卫生的必要条件。</Settings_RequireCleaningTools_Tooltip>
  <Settings_RequireButcheryTools>需要屠宰工具</Settings_RequireButcheryTools>
  <Settings_RequireButcheryTools_Tooltip>要求在所有屠宰和宰杀作业中使用适当的切割工具（如刀具或切肉刀）。殖民者没有合适的刀具就无法处理肉类或宰杀动物。在硬核场景中对食物生产链至关重要。</Settings_RequireButcheryTools_Tooltip>
  <Settings_RequireMedicalTools>需要医疗工具</Settings_RequireMedicalTools>
  <Settings_RequireMedicalTools_Tooltip>强制在外科手术和高级医疗护理中使用专业医疗器械。没有适当的手术工具就无法进行手术，使医疗设备获取对殖民地健康和生存至关重要。</Settings_RequireMedicalTools_Tooltip>
  <Settings_ToolMapGen>废墟建筑中的工具</Settings_ToolMapGen>
  <Settings_ToolMapGen_Tooltip>在地图生成期间在古代废墟和坠毁结构中生成基本生存工具。这些风化的工具提供重要的早期游戏资源，但通常质量较低。在严酷难度模式下对于初期工具获取至关重要的殖民地来说是无价的。</Settings_ToolMapGen_Tooltip>
  <Settings_ToolLimit>工具携带限制</Settings_ToolLimit>
  <Settings_ToolLimit_Tooltip>限制殖民者同时在库存中最多携带2-3个工具（商队旅行除外）。强制殖民者之间进行战略工具管理和专业化。工具带和类似装备可以增加此限制。为工具使用添加现实的库存约束。</Settings_ToolLimit_Tooltip>
  <Settings_ToolDegradation>工具老化</Settings_ToolDegradation>
  <Settings_ToolDegradation_Tooltip>无论工具是否被使用都会老化。</Settings_ToolDegradation_Tooltip>
  <Settings_ToolDegradationRate>工具老化速度</Settings_ToolDegradationRate>
  <Settings_ToolOptimization>自动工具优化</Settings_ToolOptimization>
  <Settings_ToolOptimization_Tooltip>启用智能工具管理，殖民者会自动选择并携带最有效的工具来完成分配的工作。他们会根据需要升级到更好的工具并丢弃劣质的工具。如果您更喜欢手动工具控制或遇到模组材料的性能问题，请禁用此功能。</Settings_ToolOptimization_Tooltip>
  <Settings_PickupFromStorageOnly>限制从储存区域获取工具</Settings_PickupFromStorageOnly>
  <Settings_PickupFromStorageOnly_Tooltip>启用时，殖民者只能从指定的储存区域获取工具，保持更好的组织性并防止他们从工作区域抓取工具。禁用时，他们可以拾取家园区域中任何可访问的工具（排除被禁止或燃烧的物品），提供更多灵活性但控制性较少。</Settings_PickupFromStorageOnly_Tooltip>
  <Settings_AllowPacifistEquip>允许和平主义者装备生存工具</Settings_AllowPacifistEquip>
  <Settings_AllowPacifistEquip_Tooltip>允许和平主义殖民者装备被归类为武器的生存工具（如斧头、镐或刀具）。虽然这些工具具有战斗能力，但它们对于诸如砍伐树木、采矿或食物准备等工作任务至关重要。启用时，和平主义者可以使用这些工具进行生产性工作，同时仍然拒绝参与暴力。</Settings_AllowPacifistEquip_Tooltip>
  <Settings_DebugLogging>启用详细调试日志</Settings_DebugLogging>
  <Settings_DebugLogging_Tooltip>激活工具选择决策、自动拾取行为和工作-工具匹配逻辑的全面日志记录。对于故障排除工具问题或了解殖民者为什么选择特定工具至关重要。仅建议用于模组开发或遇到工具相关问题时使用。大量日志输出可能影响性能。</Settings_DebugLogging_Tooltip>
  <Settings_AutoTool>智能工作前工具拾取</Settings_AutoTool>
  <Settings_AutoTool_Tooltip>通过让殖民者在开始任何工作前自动获取最优工具来革命性地提高工作流程效率。他们会智能地交换工具、升级到更好的变体，并确保拥有合适的设备以实现最大生产力。基于工具的无缝游戏体验的核心功能。</Settings_AutoTool_Tooltip>
  <!-- Alerts -->
  <ColonistNeedsSurvivalTool>殖民者缺乏必要工具</ColonistNeedsSurvivalTool>
  <ColonistsNeedSurvivalTool>殖民者们缺乏必要工具</ColonistsNeedSurvivalTool>
  <ColonistNeedsSurvivalToolDesc>这些殖民者需要适当的工具来完成分配的工作，但缺乏必要的设备。他们的生产力严重受损。</ColonistNeedsSurvivalToolDesc>
  <SurvivalToolsNeedReplacing>工具即将损坏</SurvivalToolsNeedReplacing>
  <SurvivalToolNeedsReplacingDesc>这些殖民者正在使用即将损坏的工具。立即更换以避免工作中断。</SurvivalToolNeedsReplacingDesc>
  <!-- Tool assignment management -->
  <ManageSurvivalToolAssignments>管理工具配置</ManageSurvivalToolAssignments>
  <SurvivalToolAssignment>工具分配</SurvivalToolAssignment>
  <SurvivalToolAssignmentConstructor>建造</SurvivalToolAssignmentConstructor>
  <SurvivalToolAssignmentMiner>采矿</SurvivalToolAssignmentMiner>
  <SurvivalToolAssignmentPlantWorker>种植</SurvivalToolAssignmentPlantWorker>
  <SurvivalToolAssignmentResearcher>研究</SurvivalToolAssignmentResearcher>
  <SurvivalToolAssignmentCleaner>清洁</SurvivalToolAssignmentCleaner>
  <SurvivalToolAssignmentMedical>医疗</SurvivalToolAssignmentMedical>
  <SurvivalToolAssignmentButcher>屠宰</SurvivalToolAssignmentButcher>
  <SelectSurvivalToolAssignment>选择工具配置…</SelectSurvivalToolAssignment>
  <NewSurvivalToolAssignment>新工具配置</NewSurvivalToolAssignment>
  <DeleteSurvivalToolAssignment>删除工具配置…</DeleteSurvivalToolAssignment>
  <SurvivalToolAssignmentInUse>{0}正在使用工具配置</SurvivalToolAssignmentInUse>
  <NoSurvivalToolAssignmentSelected>没有选择工具配置</NoSurvivalToolAssignmentSelected>
  <ForcedSurvivalTools>强制工具</ForcedSurvivalTools>
  <!-- Settings -->
  <Settings_CompatLogging>启用兼容性调试日志</Settings_CompatLogging>
  <Settings_CompatLogging_Tooltip>激活模组兼容性系统的详细日志记录，包括Research Reinvented集成、统计检测和WorkGiver连线。显示兼容性设置和集成过程的逐步信息。仅在启用常规调试日志记录时显示。对诊断模组交互问题很有用。</Settings_CompatLogging_Tooltip>
  <!-- Resizable Settings Window -->
  <Settings_EnhancedWindowDescription>点击下方按钮打开增强的可调整大小设置窗口，包含所有模组选项。</Settings_EnhancedWindowDescription>
  <Settings_OpenEnhancedButton>打开增强设置</Settings_OpenEnhancedButton>
  <!-- Job Requirements Table -->
  <JobTable_JobTypes>工作类型</JobTable_JobTypes>
  <JobTable_JobType>工作类型</JobTable_JobType>
  <JobTable_NormalMode>普通模式</JobTable_NormalMode>
  <JobTable_HardcoreMode>极限模式</JobTable_HardcoreMode>
  <JobTable_ExtraHardcore>超极限</JobTable_ExtraHardcore>
  <JobTable_Enhanced>增强</JobTable_Enhanced>
  <JobTable_Required>必需</JobTable_Required>
  <JobTable_NoJobsFound>未找到工具增强的工作。</JobTable_NoJobsFound>
  <JobTable_SectionTitle>各模式下的工作工具需求</JobTable_SectionTitle>
  <JobTable_SectionTooltip>此表显示不同工作类型在各种难度模式下的行为。'增强'意味着工具提供奖励但不是必需的。'必需'意味着工具是执行工作所必需的。使用此表了解根据当前设置您的殖民者需要哪些工具。</JobTable_SectionTooltip>
  <!-- Job Table Headers -->
  <JobTable_Normal>普通</JobTable_Normal>
  <JobTable_Hardcore>硬核</JobTable_Hardcore>
  <JobTable_ExtraHardcore>极限硬核</JobTable_ExtraHardcore>
  <!-- Resizable Settings Window -->
  <Settings_EnhancedWindowDescription>点击下面的按钮打开带有所有模组选项的增强可调整大小设置窗口。</Settings_EnhancedWindowDescription>
  <Settings_OpenEnhancedButton>打开增强设置</Settings_OpenEnhancedButton>
  <!-- Mod Compatibility -->
  <Compat_ResearchReinvented>重新发明的研究</Compat_ResearchReinvented>
  <Compat_FieldResearch>实地研究</Compat_FieldResearch>
  <Compat_ReinventedResearchAlert>重新发明的研究</Compat_ReinventedResearchAlert>
  <!-- WorkSpeedGlobal 配置（新增） -->
  <!-- Added WorkSpeedGlobal translation keys -->
  <WorkSpeedGlobal_Title>通用工作速度任务配置</WorkSpeedGlobal_Title>
  <WorkSpeedGlobal_Description>选择哪些使用“通用工作速度”属性的工作需要生存工具进行限制。未限制的工作在缺少工具时不受惩罚。</WorkSpeedGlobal_Description>
  <WorkSpeedGlobal_JobTypeHeader>工作类型</WorkSpeedGlobal_JobTypeHeader>
  <WorkSpeedGlobal_GatedHeader>限制</WorkSpeedGlobal_GatedHeader>
  <WorkSpeedGlobal_DescriptionHeader>描述</WorkSpeedGlobal_DescriptionHeader>
  <WorkSpeedGlobal_NoJobsFound>未找到通用工作速度任务。</WorkSpeedGlobal_NoJobsFound>
  <WorkSpeedGlobal_EnableAll>全部启用</WorkSpeedGlobal_EnableAll>
  <WorkSpeedGlobal_DisableAll>全部禁用</WorkSpeedGlobal_DisableAll>
  <WorkSpeedGlobal_ResetDefaults>恢复默认</WorkSpeedGlobal_ResetDefaults>
  <WorkSpeedGlobal_TraceWorkGivers>跟踪工作提供者</WorkSpeedGlobal_TraceWorkGivers>
  <WorkSpeedGlobal_JobStatus_Gated>在硬核模式中需要工具</WorkSpeedGlobal_JobStatus_Gated>
  <WorkSpeedGlobal_JobStatus_Ungated>不适用工具惩罚</WorkSpeedGlobal_JobStatus_Ungated>
  <WorkSpeedGlobal_OpenConfigButton>配置通用工作速度任务</WorkSpeedGlobal_OpenConfigButton>
  <!-- Job Table Additional (新增) -->
  <JobTable_NoActiveMode>未选择任何模式。</JobTable_NoActiveMode>
  <JobTable_GatedFormat>限制 ({0}/{1})</JobTable_GatedFormat>
  <JobTable_GatedExample>限制 (99/99)</JobTable_GatedExample>
  <JobTable_Status_Unknown>未知</JobTable_Status_Unknown>
  <JobTable_Blocked>阻止</JobTable_Blocked>
</LanguageData>
</file>

<file path="1.6/Patches/Core/Stats/Stats_Pawns_WorkGeneral.xml">
<Patch>
    <!-- Plant Work Speed -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="PlantWorkSpeed"]/label</xpath>
        <value>
            <label>plant sowing speed</label>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="PlantWorkSpeed"]/description</xpath>
        <value>
            <description>The speed at which this person sows plants.</description>
        </value>
    </Operation>
    <!-- Construction Speed -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="ConstructionSpeed"]/minValue</xpath>
        <value>
            <minValue>0</minValue>
        </value>
    </Operation>
    <!-- Ensure <parts/> exists -->
    <Operation Class="PatchOperationSequence">
        <success>Always</success>
        <operations>
            <li Class="PatchOperationTest">
                <xpath>Defs/StatDef[defName="ConstructionSpeed"]/parts</xpath>
                <success>Invert</success>
            </li>
            <li Class="PatchOperationAdd">
                <xpath>Defs/StatDef[defName="ConstructionSpeed"]</xpath>
                <value>
                    <parts />
                </value>
            </li>
        </operations>
    </Operation>
    <!-- Add StatPart_SurvivalTools only if it isn't already present -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/StatDef[defName="ConstructionSpeed"]/parts/li[@Class="SurvivalTools.Stats.StatPart_SurvivalTools"]</xpath>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/StatDef[defName="ConstructionSpeed"]/parts</xpath>
            <value>
                <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
            </value>
        </nomatch>
    </Operation>
    <!-- Mining Speed -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="MiningSpeed"]/description</xpath>
        <value>
            <description>The speed at which this person drills for deep resources or performs mining tasks other than digging at walls.</description>
        </value>
    </Operation>
    <!-- Mining Yield -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="MiningYield"]/label</xpath>
        <value>
            <label>mining yield (other)</label>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/StatDef[defName="MiningYield"]/description</xpath>
        <value>
            <description>The percentage of mined resources a miner will produce. This applies to deep drill mining. This doesn't affect the production rate of rock chunks.</description>
        </value>
    </Operation>
</Patch>
</file>

<file path="1.6/Patches/Core/ThingDefs_Items/Items_Resource_Stuff.xml">
<Patch>
    <!-- Steel -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Steel"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>1.1</TreeFellingSpeed>
                    <ConstructionSpeed>1.1</ConstructionSpeed>
                    <DeconstructionSpeed>1.1</DeconstructionSpeed>
                    <DiggingSpeed>1.1</DiggingSpeed>
                    <MiningYieldDigging>1.1</MiningYieldDigging>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Silver -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Silver"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.7</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.7</PlantHarvestingSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Gold -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Gold"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.6</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                    <DiggingSpeed>1.1</DiggingSpeed>
                    <MiningYieldDigging>1.1</MiningYieldDigging>
                    <ConstructionSpeed>1.1</ConstructionSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Plasteel -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Plasteel"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>1.3</TreeFellingSpeed>
                    <PlantHarvestingSpeed>1.3</PlantHarvestingSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Wood -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="WoodLog"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.6</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.6</PlantHarvestingSpeed>
                    <DiggingSpeed>0.6</DiggingSpeed>
                    <MiningYieldDigging>0.8</MiningYieldDigging>
                    <ConstructionSpeed>0.6</ConstructionSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Uranium -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Uranium"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <DiggingSpeed>1.3</DiggingSpeed>
                    <MiningYieldDigging>1.1</MiningYieldDigging>
                    <ConstructionSpeed>1.3</ConstructionSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
    <!-- Jade -->
    <Operation Class="PatchOperationAddModExtension">
        <xpath>Defs/ThingDef[defName="Jade"]</xpath>
        <value>
            <li Class="SurvivalTools.StuffPropsTool">
                <toolStatFactors>
                    <TreeFellingSpeed>0.9</TreeFellingSpeed>
                    <PlantHarvestingSpeed>0.9</PlantHarvestingSpeed>
                    <MiningYieldDigging>0.9</MiningYieldDigging>
                    <DiggingSpeed>1.1</DiggingSpeed>
                </toolStatFactors>
            </li>
        </value>
    </Operation>
</Patch>
</file>

<file path="Source/AI/JobDriver_HarvestTree.cs">
//Rimworld 1.6 / C# 7.3
// Source/AI/JobDriver_HarvestTree.cs
⋮----
namespace SurvivalTools
⋮----
// Harvests tree yield, then clears the HarvestPlant designation.
public class JobDriver_HarvestTree : JobDriver_PlantWork
⋮----
protected override void Init()
⋮----
base.Init();
⋮----
protected override Toil PlantWorkDoneToil()
⋮----
var t = new Toil();
⋮----
var plant = Plant; // use base property which is null-safe
⋮----
// Call PlantCollected in a guarded way — signature mismatches on some RW variants caused crashes previously.
// We catch exceptions and only log when debug logging is enabled to avoid noisy spam.
⋮----
plant.PlantCollected(actor, PlantDestructionMode.Cut);
⋮----
Log.ErrorOnce($"[SurvivalTools] PlantCollected threw in JobDriver_HarvestTree for {plant} : {innerEx}", 9832174); // leave error unchanged
// Fallback: don't crash; we can't reliably emulate PlantCollected across versions here.
⋮----
Log.ErrorOnce($"[SurvivalTools] Unexpected exception in HarvestTree PlantWorkDoneToil.initAction: {ex}", 9832175); // leave error unchanged
</file>

<file path="Source/AI/JobDriver_PlantWork.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/JobDriver_PlantWork.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Base driver for plant work (felling/harvesting trees).
/// Adds defensive null checks, unified stat gating, and diagnostic logging.
/// </summary>
public abstract class JobDriver_PlantWork : JobDriver
⋮----
protected const TargetIndex PlantInd = TargetIndex.A;
public override bool TryMakePreToilReservations(bool errorOnFailed)
⋮----
if (target.IsValid && !pawn.Reserve(target, job, 1, -1, null, errorOnFailed))
⋮----
pawn.ReserveAsManyAsPossible(job?.GetTargetQueue(TargetIndex.A), job, 1, -1, null);
⋮----
protected override IEnumerable<Toil> MakeNewToils()
⋮----
yield return Toils_JobTransforms.MoveCurrentTargetIntoQueue(TargetIndex.A);
var initExtractTargetFromQueue = Toils_JobTransforms.ClearDespawnedNullOrForbiddenQueuedTargets(
⋮----
Map.designationManager.DesignationOn(t, RequiredDesignation) != null)
⋮----
yield return Toils_JobTransforms.SucceedOnNoTargetInQueue(TargetIndex.A);
yield return Toils_JobTransforms.ExtractNextTargetFromQueue(TargetIndex.A);
var gotoThing = Toils_Goto.GotoThing(TargetIndex.A, PathEndMode.Touch)
.JumpIfDespawnedOrNullOrForbidden(TargetIndex.A, initExtractTargetFromQueue);
⋮----
gotoThing.FailOnThingMissingDesignation(TargetIndex.A, RequiredDesignation);
gotoThing.FailOn(() => Plant == null);
⋮----
var cut = new Toil
⋮----
if (actor == null || actor.DestroyedOrNull() || plant == null || plant.Destroyed)
⋮----
// ✅ Unified stat gating
⋮----
StatGatingHelper.ShouldBlockJobForStat(ST_StatDefOf.TreeFellingSpeed, settings, actor))
⋮----
// Degrade tools and grant XP
SurvivalToolUtility.TryDegradeTool(actor, ST_StatDefOf.TreeFellingSpeed);
⋮----
float statValue = actor.GetStatValue(ST_StatDefOf.TreeFellingSpeed, true);
// Unified diagnostics
⋮----
// Trace best tool factor
var bestTool = actor.GetBestSurvivalTool(ST_StatDefOf.TreeFellingSpeed);
⋮----
if (!float.IsFinite(statValue) || statValue < 0f)
⋮----
float growth = Mathf.Clamp01(plant.Growth);
float workThisTick = statValue * Mathf.Lerp(3.3f, 1f, growth); // Mature plants need less extra effort
if (!float.IsFinite(workThisTick)) workThisTick = 0f;
workDone = Mathf.Clamp(workDone + workThisTick, 0f, float.MaxValue / 4f);
⋮----
if (!float.IsFinite(harvestWork) || harvestWork <= 0f) harvestWork = 1f;
⋮----
// Yield (safe)
⋮----
&& Rand.Value > actor.GetStatValue(StatDefOf.PlantHarvestYield, true))
⋮----
MoteMaker.ThrowText((actor.DrawPos + plant.DrawPos) * 0.5f, Map, "TextMote_HarvestFailed".Translate(), 3.65f);
⋮----
int yieldCount = plant.YieldNow();
⋮----
var product = ThingMaker.MakeThing(harvestedDef);
product.stackCount = Mathf.Max(1, yieldCount);
⋮----
product.SetForbidden(true, true);
GenPlace.TryPlaceThing(product, actor.Position, Map, ThingPlaceMode.Near);
⋮----
cut.FailOnDespawnedNullOrForbidden(TargetIndex.A);
⋮----
cut.FailOnThingMissingDesignation(TargetIndex.A, RequiredDesignation);
cut.FailOnCannotTouch(TargetIndex.A, PathEndMode.Touch);
cut.WithProgressBar(TargetIndex.A, () =>
⋮----
if (!float.IsFinite(total) || total <= 0f) total = 1f;
return Mathf.Clamp01(workDone / total);
⋮----
cut.PlaySustainerOrSound(() => Plant?.def?.plant?.soundHarvesting);
⋮----
yield return Toils_Jump.Jump(initExtractTargetFromQueue);
⋮----
public override void ExposeData()
⋮----
base.ExposeData();
Scribe_Values.Look(ref workDone, "workDone", 0f);
⋮----
protected virtual void Init() { }
⋮----
/// Subclasses should finalize the operation (destroy plant, call PlantCollected, etc.).
⋮----
protected virtual Toil PlantWorkDoneToil() => null;
</file>

<file path="Source/Assign/AssignmentSearch.cs">
// RimWorld 1.6 / C# 7.3
// Source/Assign/AssignmentSearch.cs
//
// Phase 6: Pre-work auto-equip without ping-pong
// - Searches for better tools before starting work
// - Respects carry limits by difficulty
// - Implements hysteresis to prevent re-upgrading
// - LINQ-free, pooled buffers for performance
⋮----
public static class AssignmentSearch
⋮----
// Controls where to place queued acquisition jobs
⋮----
Append, // Add to back of the queue (AI/WorkGiver paths)
Front   // Push to front of the queue (player-ordered rescue path)
⋮----
// Pooled collections to avoid allocations
⋮----
// Hysteresis tracking: pawnID -> (lastUpgradeTick, lastEquippedDefName)
⋮----
// Anti-recursion: pawnID -> processing flag
⋮----
private const float HysteresisExtraGainPct = 0.05f; // +5% for re-upgrade
⋮----
private const int FocusTicksWindow = 600; // 10 seconds: prefer current work stat, avoid thrash
// Cooldown for repeatedly failing candidates (forbidden, unreachable, reserved by others)
// Key: ThingIDNumber -> nextAllowedTick
⋮----
private const int CandidateCooldownTicks = 600; // 10 seconds (at 60 TPS)
// Short-lived focus window to avoid cross-stat thrashing
// pawnID -> (untilTick, statDefName)
⋮----
// Recently acquired protection: pawnID -> (untilTick, lastAcquiredThingID)
⋮----
/// <summary>
/// Public helper for other systems (e.g., inventory auto-trim) to respect the
/// recent-acquisition protection window and avoid immediately dropping the
/// tool we just targeted/acquired.
/// Accepts a physical thing (real tool or tool-stuff stack). If a virtual
/// SurvivalTool wrapper is passed, we resolve its backing physical thing
/// before comparing IDs.
/// </summary>
public static bool IsRecentlyAcquired(Pawn pawn, Thing toolOrStack)
⋮----
if (!_recentAcquisitions.TryGetValue(pawn.thingIDNumber, out var acq) || now >= acq.untilTick)
⋮----
// Direct match
⋮----
// If we got a SurvivalTool (real or virtual), try to resolve to a backing physical thing
⋮----
var back = SurvivalToolUtility.BackingThing(st, pawn);
⋮----
catch { /* best-effort */ }
⋮----
public Thing tool;
⋮----
public ToolLocation location;
⋮----
/// Returns true if we queued an equip/haul job; original job should be retried afterward.
⋮----
// Backward-compatible overload (public API): defaults to Append priority
public static bool TryUpgradeFor(Pawn pawn, StatDef workStat, float minGainPct, float radius, int pathCostBudget)
⋮----
// New overload with explicit queue priority control
public static bool TryUpgradeFor(Pawn pawn, StatDef workStat, float minGainPct, float radius, int pathCostBudget, QueuePriority priority)
⋮----
// New overload including caller context for diagnostics
public static bool TryUpgradeFor(Pawn pawn, StatDef workStat, float minGainPct, float radius, int pathCostBudget, QueuePriority priority, string caller)
⋮----
// Log with cooldown via ST_Logging to avoid spam
⋮----
private static bool TryUpgradeForInternal(Pawn pawn, StatDef workStat, float minGainPct, float radius, int pathCostBudget, QueuePriority priority, string caller)
⋮----
// Early-out blacklist
⋮----
// If we recently focused a different work stat, skip to avoid tool thrashing
⋮----
// Anti-recursion check
⋮----
if (_processingPawns.TryGetValue(pawnID, out bool processing) && processing)
⋮----
// Get current score and tool
var currentTool = ToolScoring.GetBestTool(pawn, workStat, out float currentScore);
⋮----
// If a drop or acquisition is already being performed as the CURRENT job, defer any new work this pass
// Note: we intentionally IGNORE queued items here because queued ordered jobs do not auto-start.
⋮----
return true; // signal that we're handling tool management
⋮----
// Find best candidate
⋮----
// Apply hysteresis AFTER selecting a concrete candidate so we can use its gain and def
⋮----
// Queue the job to acquire/equip the tool
⋮----
// Update hysteresis only when we actually enqueued an acquisition
_hysteresisData[pawn.thingIDNumber] = new HysteresisData
⋮----
// Set a short focus window on this stat to prevent other stats from thrashing
⋮----
// Notify score cache
ScoreCache.NotifyInventoryChanged(pawn);
⋮----
ScoreCache.NotifyToolChanged(candidate.tool);
⋮----
// We queued a drop and deferred acquisition; report handled but don't update hysteresis yet
⋮----
// Set a short focus window to prioritize this stat; this avoids cross-stat thrashing.
⋮----
// Deduped debug path to prevent spam
⋮----
private static void TrySetFocusForGating(Pawn pawn, StatDef workStat, float currentScore)
⋮----
float baseline = SurvivalToolUtility.GetNoToolBaseline(workStat);
⋮----
private static void SetFocus(Pawn pawn, StatDef workStat)
⋮----
_statFocus[pawn.thingIDNumber] = new FocusData
⋮----
private static bool IsBlockedByFocus(int pawnID, string statDefName)
⋮----
if (string.IsNullOrEmpty(statDefName)) return false;
if (!_statFocus.TryGetValue(pawnID, out var focus)) return false;
⋮----
// Block if another stat is currently focused
return !string.Equals(focus.statDefName, statDefName);
⋮----
// DIAGNOSTIC LOGGING ------------------------------------------------
private static void LogCurrentJobState(Pawn pawn, string tag)
⋮----
var curTarget = cur != null ? (cur.targetA.HasThing ? cur.targetA.Thing.LabelShort : (cur.targetA.Cell.IsValid ? cur.targetA.Cell.ToString() : "(n/a)")) : "(n/a)";
LogDebug($"[SurvivalTools.Assignment][{tag}] curJob={curDef} target={curTarget} interruptible={pawn.jobs.IsCurrentJobPlayerInterruptible()} queueCount={pawn.jobs.jobQueue?.Count ?? 0}", $"Assign.JobState.{pawn.ThingID}|{tag}");
⋮----
private static void LogJobQueue(Pawn pawn, string tag)
⋮----
int shown = Math.Min(count, maxEntries);
⋮----
sb.Append($"[SurvivalTools.Assignment][{tag}] jobQueue count={count} :: ");
⋮----
target = j.targetA.Cell.ToString();
⋮----
if (i > 0) sb.Append(" | ");
sb.Append('[').Append(i).Append("] ").Append(def).Append(" -> ").Append(target);
⋮----
if (count > shown) sb.Append($" | … +{count - shown} more");
LogDebug(sb.ToString(), key);
⋮----
/// Enhanced validation for tool state before acquisition.
/// Checks for real-time issues that could cause job failures.
⋮----
private static bool ValidateToolStateForAcquisition(Pawn pawn, Thing tool)
⋮----
// Check if tool still exists and is not destroyed
⋮----
// Check if tool is on same map
⋮----
// Check if tool is held by another pawn (not stockpiles/ground)
// Allow tools in stockpiles, on ground, or in our own inventory/equipment
⋮----
// Check if tool is equipped by another pawn
⋮----
// Check if pawn can reserve and reach the tool (legacy approach)
if (!pawn.CanReserveAndReach(tool, PathEndMode.OnCell, pawn.NormalMaxDanger()))
⋮----
// Check if tool is forbidden
if (tool.IsForbidden(pawn))
⋮----
/// Enhanced validation for tool state before dropping.
/// Ensures the tool is actually carried by the pawn and can be dropped.
⋮----
private static bool ValidateToolStateForDrop(Pawn pawn, Thing tool)
⋮----
// Check if tool is on same map (allow null for carried items)
⋮----
// Check if tool is actually carried by this pawn
⋮----
// Check if pawn is incapacitated (can't drop if downed)
⋮----
// QUEUE DEDUP/CONSUMPTION -------------------------------------------
private static Thing GetBackingThing(Pawn pawn, Thing tool)
⋮----
var back = SurvivalToolUtility.BackingThing(asTool, pawn);
⋮----
private static bool TargetsSameTool(Pawn pawn, Thing a, Thing b)
⋮----
// Fallback: same def (last resort)
⋮----
private static bool TryStartQueuedToolJobFor(Pawn pawn, Thing tool, params JobDef[] jobDefs)
⋮----
if (pawn.jobs.curJob != null) return false; // only start when idle
⋮----
// Take a snapshot of relevant queued jobs to avoid collection mutation surprises
⋮----
Thing targetThing = null;
⋮----
matches.Add(j);
⋮----
// Try the first match
⋮----
var cloned = JobUtils.CloneJobForQueue(jobToClone);
⋮----
try { started = pawn.jobs.TryTakeOrderedJob(cloned); }
⋮----
// Purge any queued duplicates for safety
⋮----
private static bool HasQueuedAcquisitionFor(Pawn pawn, Thing tool)
⋮----
private static void RemoveQueuedToolJobsFor(Pawn pawn, Thing tool, params JobDef[] jobDefs)
⋮----
if (queueList != null) queueList.RemoveAt(i);
⋮----
private static bool CanPawnUpgrade(Pawn pawn)
⋮----
if (!pawn.Awake())
⋮----
// Check essential capacities
⋮----
if (!pawn.health.capacities.CapableOf(PawnCapacityDefOf.Manipulation))
⋮----
if (!pawn.health.capacities.CapableOf(PawnCapacityDefOf.Moving))
⋮----
private static bool IsInHysteresis(int pawnID, int currentTick, string currentDefName, float minGainPct)
⋮----
if (!_hysteresisData.TryGetValue(pawnID, out var data))
⋮----
// Still in hysteresis period - require extra gain to re-upgrade
⋮----
// Same tool, need extra gain
⋮----
private static ToolCandidate FindBestCandidate(Pawn pawn, StatDef workStat, float currentScore, float minGainPct, float radius, int pathCostBudget)
⋮----
var bestCandidate = new ToolCandidate();
⋮----
// Search order: inventory → equipment → same cell → stockpiles → home area → nearby
⋮----
return bestCandidate; // Already in inventory, best case
⋮----
return bestCandidate; // On belt/pack, very good
⋮----
return bestCandidate; // Same cell, excellent
⋮----
private static void SearchInventory(Pawn pawn, StatDef workStat, float currentScore, float minGainPct, bool needsGatingRescue, ref ToolCandidate bestCandidate)
⋮----
_inventoryBuffer.Clear();
⋮----
_inventoryBuffer.Add(thing);
⋮----
private static void SearchEquipment(Pawn pawn, StatDef workStat, float currentScore, float minGainPct, bool needsGatingRescue, ref ToolCandidate bestCandidate)
⋮----
_candidateBuffer.Clear();
⋮----
_candidateBuffer.Add(thing);
⋮----
private static void SearchSameCell(Pawn pawn, StatDef workStat, float currentScore, float minGainPct, bool needsGatingRescue, ref ToolCandidate bestCandidate)
⋮----
var thingsAtCell = pawn.Map.thingGrid.ThingsAt(cell);
⋮----
// Skip forbidden items up front to avoid wasted evaluation
if (thing != null && thing != pawn && !thing.IsForbidden(pawn) && IsValidTool(thing, workStat))
⋮----
private static void SearchStockpiles(Pawn pawn, StatDef workStat, float currentScore, float minGainPct, bool needsGatingRescue, float radius, int pathCostBudget, ref ToolCandidate bestCandidate)
⋮----
_stockpileBuffer.Clear();
⋮----
if (thing != null && !thing.IsForbidden(pawn) && IsValidTool(thing, workStat) &&
⋮----
_stockpileBuffer.Add(thing);
⋮----
private static void SearchHomeArea(Pawn pawn, StatDef workStat, float currentScore, float minGainPct, bool needsGatingRescue, float radius, int pathCostBudget, ref ToolCandidate bestCandidate)
⋮----
// Search tools in home area
⋮----
var thingsOfDef = listerThings.ThingsOfDef(toolDef);
⋮----
if (thing != null && !thing.IsForbidden(pawn) && homeArea[thing.Position] &&
⋮----
private static void SearchNearby(Pawn pawn, StatDef workStat, float currentScore, float minGainPct, bool needsGatingRescue, float radius, int pathCostBudget, ref ToolCandidate bestCandidate)
⋮----
if (thing != null && !thing.IsForbidden(pawn) && IsWithinRadius(pawn.Position, thing.Position, radius) &&
⋮----
private static void EvaluateCandidates(List<Thing> candidates, Pawn pawn, StatDef workStat, float currentScore,
⋮----
var score = ToolScoring.Score(tool, pawn, workStat);
var gainPct = (score - currentScore) / Math.Max(currentScore, 0.001f); if (ShouldConsiderTool(score, currentScore, gainPct, minGainPct, needsGatingRescue))
⋮----
(Math.Abs(score - bestCandidate.score) < 0.001f && location < bestCandidate.location))
⋮----
bestCandidate = new ToolCandidate
⋮----
private static void EvaluateCandidatesWithPathCost(List<Thing> candidates, Pawn pawn, StatDef workStat, float currentScore,
⋮----
(Math.Abs(score - bestCandidate.score) < 0.001f && pathCost < bestCandidate.pathCost))
⋮----
private static bool ShouldConsiderTool(float toolScore, float currentScore, float gainPct, float minGainPct, bool needsGatingRescue)
⋮----
// For gating rescue, any improvement is good
⋮----
// Normal case: require minimum gain percentage
⋮----
private static bool QueueAcquisitionJob(Pawn pawn, ToolCandidate candidate, StatDef requestedStat, QueuePriority priority, out bool acquisitionEnqueued)
⋮----
// If an equivalent queued acquisition job exists and pawn is idle, start it instead of creating a new one
⋮----
// Purge any other duplicates for the same target
⋮----
// IMPORTANT: For Append (AI/opportunistic) path, do NOT enqueue while pawn is busy.
// Ordered job queue doesn't auto-run; we'll retry later when pawn is idle.
⋮----
// If a drop/acquisition is already pending in the queue, do not enqueue acquisition this pass
⋮----
// handled this pass by deferring; no acquisition enqueued
⋮----
// ENHANCED VALIDATION: Real-time tool state check before any job creation
⋮----
// Check carry limits BEFORE creating jobs and try to make room
⋮----
// Try to drop worst tool first - this must complete before acquisition
Thing worstTool = null;
⋮----
// If carry-limit is effectively 1, protect the best tool for the requested stat to avoid ping-pong
⋮----
if (HasToolbelt(pawn)) carryLimit = Math.Max(carryLimit, 3);
⋮----
// Validate worst tool before trying to drop it
⋮----
// For Append path while busy, skip queuing drop and retry later when idle
⋮----
// Queue drop job ONLY – acquisition will be re-attempted on next tick/job pass
⋮----
// Defer acquisition until after drop completes to avoid queue ordering issues
⋮----
Job job = null;
⋮----
// Already in inventory, just equip
job = JobMaker.MakeJob(JobDefOf.Equip, candidate.tool);
⋮----
// Pick up and equip
⋮----
// Haul to inventory first
job = JobMaker.MakeJob(JobDefOf.TakeInventory, candidate.tool);
⋮----
// ENHANCED VALIDATION: Use JobUtils to validate job before queuing
if (!JobUtils.IsJobStillValid(job, pawn))
⋮----
// SAFETY: Clone job for queue to prevent reference issues
var clonedJob = JobUtils.CloneJobForQueue(job);
// Make this behave like a player-forced ordered job so it starts immediately when idle
⋮----
// ENHANCED VALIDATION: Double-check tool state right before reservation
⋮----
// Reserve using the cloned job instance that will actually run
if (!pawn.Reserve(candidate.tool, clonedJob, 1, -1, null, true))
⋮----
// If pawn is idle, start immediately to avoid queue starvation
⋮----
bool taken = pawn.jobs.TryTakeOrderedJob(clonedJob);
⋮----
// Remove any duplicate queued acquisition jobs for this target
⋮----
// Protect the just-acquired tool from being dropped immediately
⋮----
_recentAcquisitions[pawn.thingIDNumber] = new RecentAcqData { untilTick = nowTick + FocusTicksWindow, thingID = candidate.tool.thingIDNumber };
⋮----
// If failed to start now, fall back to enqueue with priority
⋮----
// Enqueue according to requested priority to avoid preempting AI-selected jobs
⋮----
// Avoid enqueueing duplicates
⋮----
// For Append and idle=false case we should never reach here due to early return.
// Still avoid enqueueing duplicates in case of future changes
⋮----
// Protect the just-enqueued acquisition target as "recently acquired" to avoid immediate drop
⋮----
_recentAcquisitions[pawn.thingIDNumber] = new RecentAcqData { untilTick = nowTick2 + FocusTicksWindow, thingID = candidate.tool.thingIDNumber };
⋮----
// Clean up reservation on failure
⋮----
// FALLBACK: Try direct tool swapping if job queuing fails
⋮----
private static bool CanCarryAdditionalTool(Pawn pawn)
⋮----
carryLimit = Math.Max(carryLimit, 3); // Toolbelt exception
⋮----
private static int GetCarryLimit(SurvivalToolsSettings settings)
⋮----
return 1; // Nightmare
⋮----
return 2; // Hardcore
return 3; // Normal
⋮----
private static bool HasToolbelt(Pawn pawn)
⋮----
// Stub: returns false unless specific apparel tag/comp detected
// TODO: Implement toolbelt detection when available
⋮----
private static int CountCarriedTools(Pawn pawn)
⋮----
// Count inventory tools
⋮----
// Count equipped tools
⋮----
private static bool TryDropWorstTool(Pawn pawn)
⋮----
Thing worstTool = FindWorstCarriedTool(pawn);
⋮----
/// Queue a job to drop/store a specific tool.
/// Enhanced with comprehensive validation and proper job cloning.
⋮----
private static bool QueueDropJob(Pawn pawn, Thing toolToDrop)
⋮----
// ENHANCED VALIDATION: Use new validation method
⋮----
// If an equivalent queued drop job exists and pawn is idle, start it instead of creating a new one
⋮----
// Purge any other duplicates for this target
⋮----
// Check what type of container the tool is in to determine drop method
⋮----
// Prefer legacy custom drop flow for correctness with unspawned inventory items.
Job dropJob = null;
⋮----
// Equipped tools use vanilla DropEquipment which handles equipment trackers correctly
dropJob = JobMaker.MakeJob(JobDefOf.DropEquipment, toolToDrop);
⋮----
// Inventory-held tools should use our legacy driver that safely removes from ThingOwner
dropJob = JobMaker.MakeJob(ST_JobDefOf.DropSurvivalTool, toolToDrop);
⋮----
// If neither, try a gentle haul to nearest stockpile only when the thing is spawned
⋮----
var targetCell = stockpile.Cells.FirstOrDefault();
if (targetCell.IsValid && targetCell.InBounds(pawn.Map))
⋮----
dropJob = JobMaker.MakeJob(JobDefOf.HaulToCell, toolToDrop, targetCell);
⋮----
if (!JobUtils.IsJobStillValid(dropJob, pawn))
⋮----
// Reservation is not required for DropSurvivalTool/DropEquipment; HaulToCell handles its own when applicable.
⋮----
var clonedJob = JobUtils.CloneJobForQueue(dropJob);
⋮----
// If pawn is idle, start immediately
⋮----
Log.Message($"[SurvivalTools.Assignment] Started {clonedJob.def.defName} immediately for {pawn.LabelShort} to drop {toolToDrop.LabelShort}");
// Remove any duplicate queued drop jobs for this target
⋮----
// Otherwise queue drop job with higher priority (it should happen first)
// Avoid adding duplicates
⋮----
private static Thing FindWorstCarriedTool(Pawn pawn)
⋮----
if (_recentAcquisitions.TryGetValue(pawn.thingIDNumber, out var acq) && now < acq.untilTick)
⋮----
// Check inventory tools
⋮----
if (protectedThingId == thing.thingIDNumber) continue; // don't drop just-acquired
⋮----
// Check equipped tools
⋮----
// Avoid dropping the tool that is best for the requested focus stat when carry-limit is 1
private static Thing FindWorstCarriedToolRespectingFocus(Pawn pawn, StatDef focusStat)
⋮----
Thing bestForFocus = null;
⋮----
bestForFocus = ToolScoring.GetBestTool(pawn, focusStat, out float _);
⋮----
// Protect best-for-focus tool from being selected as worst
⋮----
private static Zone_Stockpile FindNearestStockpileFor(Pawn pawn, Thing thing)
⋮----
Zone_Stockpile nearest = null;
⋮----
float dist = pawn.Position.DistanceTo(stockpile.Cells.FirstOrDefault());
⋮----
private static bool IsValidTool(Thing thing, StatDef workStat)
⋮----
// Accept real tools immediately.
⋮----
// For virtual tool-stuff (e.g., cloth/wood/leather), only accept if it actually
// improves the requested workStat according to ToolStatResolver.
⋮----
float factor = ToolStatResolver.GetToolStatFactor(thing.def, thing.Stuff, workStat);
⋮----
private static bool IsSurvivalTool(Thing thing)
⋮----
private static bool CanPawnReserveAndReach(Pawn pawn, Thing thing)
⋮----
if (!pawn.CanReserveAndReach(thing, PathEndMode.Touch, Danger.None))
⋮----
private static bool IsWithinRadius(IntVec3 center, IntVec3 target, float radius)
⋮----
return center.DistanceTo(target) <= radius;
⋮----
private static int GetPathCost(Pawn pawn, Thing thing)
⋮----
// Simple approximation: distance * average movement cost
float distance = pawn.Position.DistanceTo(thing.Position);
// Estimate movement cost - most terrain is walkable at moderate cost
int estimatedMoveCost = 13; // Default movement cost for most terrain
⋮----
// QUICK FILTERS ------------------------------------------------------
private static bool ShouldSkipCandidate(Pawn pawn, Thing tool)
⋮----
// Cooldown check
⋮----
if (_candidateCooldownTicks.TryGetValue(tool.thingIDNumber, out int until) && now < until)
⋮----
// Forbidden fast-path
if (pawn != null && tool.IsForbidden(pawn))
⋮----
private static void SetCandidateCooldown(Thing tool)
⋮----
private static bool HasPendingDropJob(Pawn pawn)
⋮----
// Consider current job
⋮----
private static bool HasPendingAcquisitionJob(Pawn pawn)
⋮----
// HYSTERESIS ---------------------------------------------------------
private static bool IsInHysteresis(int pawnID, int currentTick, string candidateDefName, float candidateGainPct, float minGainPct)
⋮----
// If we are trying to equip the same def again within the window,
// require an extra gain to avoid thrashing.
if (!string.IsNullOrEmpty(candidateDefName) && candidateDefName == data.lastEquippedDefName)
⋮----
private static float GetOverallToolScore(Pawn pawn, Thing tool)
⋮----
// Simple heuristic: average score across common work stats
⋮----
totalScore += ToolScoring.Score(tool, pawn, stat);
⋮----
private static List<ThingDef> GetRelevantToolDefs(StatDef workStat)
⋮----
// Return tool defs that could provide this work stat
⋮----
// Only consider real tool defs; skip generic tool-stuff resources here to avoid false positives.
⋮----
// Quick check if this tool type could provide the stat
var dummyTool = new SurvivalTool();
⋮----
var factor = SurvivalToolUtility.GetToolProvidedFactor(dummyTool, workStat);
if (factor > SurvivalToolUtility.GetNoToolBaseline(workStat) + GatingEpsilon)
⋮----
result.Add(toolDef);
⋮----
/// Alternative approach: Direct tool swapping without job queuing.
/// Used as fallback when job-based approach fails.
⋮----
private static bool TryDirectToolSwap(Pawn pawn, ToolCandidate candidate)
⋮----
Log.Warning($"[SurvivalTools.Assignment] Attempting DIRECT tool swap for {pawn.LabelShort} with {candidate.tool.LabelShort}");
⋮----
// Validate tool state once more
⋮----
Log.Warning($"[SurvivalTools.Assignment] Direct swap validation failed for {candidate.tool.LabelShort}");
⋮----
// Handle carry limits by dropping worst tool first
⋮----
Log.Warning($"[SurvivalTools.Assignment] Direct drop of worst tool: {worstTool.LabelShort}");
⋮----
Log.Warning($"[SurvivalTools.Assignment] Direct drop failed for {worstTool.LabelShort}");
⋮----
Log.Warning($"[SurvivalTools.Assignment] Cannot make room for new tool");
⋮----
// Try direct tool acquisition based on location
⋮----
// Already in inventory, try to equip directly
⋮----
// Already equipped, no action needed
⋮----
Log.Warning($"[SurvivalTools.Assignment] Tool {candidate.tool.LabelShort} already equipped");
⋮----
// Pick up directly from ground
⋮----
// Try to haul to inventory directly
⋮----
Log.Message($"[SurvivalTools.Assignment] DIRECT tool swap succeeded for {pawn.LabelShort} with {candidate.tool.LabelShort}");
// Update hysteresis
⋮----
Log.Warning($"[SurvivalTools.Assignment] DIRECT tool swap failed for {pawn.LabelShort} with {candidate.tool.LabelShort}");
⋮----
Log.Error($"[SurvivalTools.Assignment] Exception in direct tool swap: {ex}");
⋮----
private static bool TryDirectDropTool(Pawn pawn, Thing tool)
⋮----
// Drop from equipment
⋮----
Log.Message($"[SurvivalTools.Assignment] Directly dropped equipment: {tool.LabelShort}");
⋮----
// Drop from inventory
⋮----
Log.Message($"[SurvivalTools.Assignment] Directly dropped from inventory: {tool.LabelShort}");
⋮----
Log.Error($"[SurvivalTools.Assignment] Exception in direct drop: {ex}");
⋮----
private static bool TryDirectEquipFromInventory(Pawn pawn, Thing tool)
⋮----
// Try to equip directly from inventory
⋮----
Log.Message($"[SurvivalTools.Assignment] Directly equipped from inventory: {tool.LabelShort}");
⋮----
Log.Error($"[SurvivalTools.Assignment] Exception in direct equip from inventory: {ex}");
⋮----
private static bool TryDirectPickupAndEquip(Pawn pawn, Thing tool)
⋮----
// Try to pick up and equip directly
if (tool.Map == pawn.Map && pawn.CanReach(tool, PathEndMode.Touch, Danger.None))
⋮----
// Try to transfer to inventory first, then equip
⋮----
Log.Message($"[SurvivalTools.Assignment] Directly picked up to inventory: {tool.LabelShort}");
⋮----
Log.Error($"[SurvivalTools.Assignment] Exception in direct pickup: {ex}");
⋮----
private static bool TryDirectHaulToInventory(Pawn pawn, Thing tool)
⋮----
// For distant tools, we might not be able to do direct manipulation
// This is a limitation of the direct approach
Log.Warning($"[SurvivalTools.Assignment] Direct haul not supported for distant tool {tool.LabelShort}");
⋮----
Log.Error($"[SurvivalTools.Assignment] Exception in direct haul: {ex}");
</file>

<file path="Source/Helpers/CollectionExtensions.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/CollectionExtensions.cs
// LEGACY CODE: KEEP.
//
// Centralized extension methods for collections and common data patterns.
// These reduce boilerplate across SurvivalTools and keep code maintainable.
// Includes helpers for StatModifier lookups, List/HashSet/Dictionary utilities,
// and string/sequence filters.
⋮----
public static class CollectionExtensions
⋮----
// Deduplication guard for stat lookup debug logs
⋮----
/// <summary>
/// Get the stat factor from a list of StatModifiers, returning 1.0 if not found.
/// Includes optional cooldowned debug logging to help trace mismatches.
/// </summary>
public static float GetStatFactorFromList(this IEnumerable<StatModifier> modifiers, StatDef stat)
⋮----
/// <summary>Check if modifiers contain an entry for a specific stat.</summary>
public static bool HasModifierFor(this IEnumerable<StatModifier> modifiers, StatDef stat)
⋮----
/// <summary>Get all unique StatDefs that are modified by this collection.</summary>
public static IEnumerable<StatDef> GetModifiedStats(this IEnumerable<StatModifier> modifiers)
⋮----
return modifiers?.Where(m => m.stat != null).Select(m => m.stat).Distinct() ?? Enumerable.Empty<StatDef>();
⋮----
/// Filter modifiers to only include improvements (factor above no-tool baseline).
/// Penalties and neutral factors are excluded.
⋮----
public static IEnumerable<StatModifier> OnlyImprovements(this IEnumerable<StatModifier> modifiers)
⋮----
/// Baseline factor for a stat when no tools are equipped.
/// Reads from StatPart_SurvivalTool if present.
⋮----
private static float GetNoToolBaseline(StatDef stat) => SurvivalToolUtility.GetNoToolBaseline(stat);
⋮----
/// <summary>Check if a HashSet overlaps with another collection.</summary>
public static bool Overlaps<T>(this HashSet<T> set, IEnumerable<T> other)
⋮----
return other != null && other.Any(set.Contains);
⋮----
/// <summary>Add multiple items to a HashSet at once.</summary>
public static void AddRange<T>(this HashSet<T> set, IEnumerable<T> items)
⋮----
foreach (var item in items) set.Add(item);
⋮----
/// <summary>Get a random element from a list, or default if empty.</summary>
public static T GetRandomOrDefault<T>(this IList<T> list)
⋮----
return list[Rand.Range(0, list.Count)];
⋮----
/// <summary>Remove all null entries from a list in place.</summary>
public static void RemoveNulls<T>(this IList<T> list) where T : class
⋮----
if (list[i] == null) list.RemoveAt(i);
⋮----
/// <summary>Check if a collection is null or empty.</summary>
public static bool IsNullOrEmpty<T>(this ICollection<T> collection)
⋮----
/// Get the maximum element by selector, or default if empty.
/// Safe for nullable selector results.
⋮----
public static T MaxByOrDefault<T, TKey>(this IEnumerable<T> source, Func<T, TKey> selector)
where TKey : IComparable<TKey>
⋮----
if (!hasValue || (key != null && key.CompareTo(maxKey) > 0))
⋮----
/// Get a value from dictionary or add+return a generated default.
⋮----
public static TValue GetOrAdd<TKey, TValue>(this Dictionary<TKey, TValue> dict, TKey key, Func<TValue> valueFactory)
⋮----
if (!dict.TryGetValue(key, out var value))
⋮----
/// <summary>Increment a counter in a dictionary, creating it if absent.</summary>
public static void IncrementCount<TKey>(this Dictionary<TKey, int> dict, TKey key, int increment = 1)
⋮----
if (dict.TryGetValue(key, out var count)) dict[key] = count + increment;
⋮----
/// <summary>Join non-null, non-empty strings with a separator.</summary>
public static string JoinNonEmpty(this IEnumerable<string> strings, string separator = ", ")
⋮----
return string.Join(separator, strings.Where(s => !string.IsNullOrEmpty(s)));
⋮----
/// <summary>Truncate a string with ellipsis if it exceeds maxLength.</summary>
public static string TruncateWithEllipsis(this string str, int maxLength)
⋮----
if (string.IsNullOrEmpty(str) || maxLength <= 0) return string.Empty;
⋮----
if (maxLength <= ellipsis.Length) return ellipsis.Substring(0, maxLength);
return str.Substring(0, maxLength - ellipsis.Length) + ellipsis;
⋮----
/// <summary>Filter sequence to only items of T (non-null).</summary>
public static IEnumerable<T> OfTypeNotNull<T>(this IEnumerable<object> source) where T : class
⋮----
return source?.OfType<T>().Where(item => item != null) ?? Enumerable.Empty<T>();
⋮----
/// <summary>Apply a filter predicate only if condition is true.</summary>
public static IEnumerable<T> WhereIf<T>(this IEnumerable<T> source, bool condition, Func<T, bool> predicate)
⋮----
/// Take items while predicate holds, but include the first failing item.
/// Useful for inclusive ranges.
⋮----
public static IEnumerable<T> TakeWhileInclusive<T>(this IEnumerable<T> source, Func<T, bool> predicate)
</file>

<file path="Source/Helpers/ST_Logging.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ST_Logging.cs
// The central logging utility for SurvivalTools.
// Provides debug logging toggles, deduplication, cooldowns,
// buffered aggregation, and specialized loggers for key systems. This should be used EVERYWHERE logging is needed.
⋮----
namespace SurvivalTools
⋮----
internal static class ST_Logging
⋮----
internal static bool IsCompatLogging()
⋮----
internal static void InvalidateDebugLoggingCache() => _debugLoggingCache = null;
// Enable dedup only in DevMode and when at least one toggle is active
⋮----
// Compact key: "pawnId|jobDef|statDef"
⋮----
private const int TOOLGATE_SUPPRESS_TICKS = 250; // suppress identical entries within this window
private const int TOOLGATE_REPORT_TICKS = 2500; // periodic flush threshold for reporting
/// <summary>
/// Log a ToolGate event with deduplication. Emits the first event immediately (unless debug off), then
/// suppresses repeated identical events for TOOLGATE_SUPPRESS_TICKS. When suppressed events exist and the
/// cooldown expires, emits a summary line indicating how many events were suppressed.
/// If DebugMode is enabled in settings, suppression is bypassed and all events are logged.
/// </summary>
internal static void LogToolGateEvent(Pawn pawn, JobDef jobDef, StatDef statDef, string reason)
⋮----
// jobDef may be null (we'll include a placeholder in messages). pawn and statDef are required.
⋮----
// If debug logging is globally disabled, don't do any heavy work
⋮----
// Still allow a minimal non-debug message in release runs (rare)
⋮----
// Developer override: if debug logging flag is true, bypass suppression
⋮----
try { Log.Message($"[SurvivalTools.ToolGate] {pawn.LabelShort} denied {jobDef.defName} ({statDef.defName}) - {reason}"); } catch { }
⋮----
LogBucket bucket;
if (!_toolGateBuckets.TryGetValue(key, out bucket))
⋮----
// First occurrence: log immediately and record tick
try { Log.Message($"[SurvivalTools.ToolGate] {pawn.LabelShort} denied {jobName} ({statDef.defName}) - {reason}"); } catch { }
⋮----
// If within suppression window, increment counter and return
⋮----
// Suppression window expired: if we suppressed events, emit a summary, then log the current event
⋮----
Log.Message($"[SurvivalTools.ToolGate] {pawn.LabelShort} denied {jobName} ({statDef.defName}) — suppressed {bucket.suppressedCount} similar events.");
⋮----
// Log the current event and update lastTick
⋮----
/// Called periodically (e.g., in ST_LogRunner.GameComponentUpdate) to flush stale buckets
/// and emit summary messages for suppressed counts that haven't been reported yet.
⋮----
internal static void TickToolGateBuckets()
⋮----
toReport.Add(k);
⋮----
// Stale bucket: purge
⋮----
if (!_toolGateBuckets.TryGetValue(k, out var b)) continue;
⋮----
// Key format: pawnId|jobDef|statDef
var parts = k.Split('|');
⋮----
try { Log.Message($"[SurvivalTools.ToolGate] {pawnId} denied {job} ({stat}) — suppressed {b.suppressedCount} similar events."); } catch { }
⋮----
_toolGateBuckets.Remove(k);
⋮----
public static void LogStatPartSummary(Pawn pawn, StatDef stat, JobDef job, string toolLabel, float factor, string context = null)
⋮----
public static void DumpStatDiag(Pawn pawn, StatDef stat, string jobContext = null, bool includeBestTool = true)
⋮----
float raw = pawn.GetStatValue(stat, applyPostProcess: false);
float post = pawn.GetStatValue(stat, applyPostProcess: true);
⋮----
sb.AppendLine($"[SurvivalTools.StatDiag] pawn={pawn.LabelShort} job={jobLabel} stat={statName}");
sb.AppendLine($"  base={stat.defaultBaseValue:F3}, raw={raw:F3}, post={post:F3}");
⋮----
sb.AppendLine($"  parts ({stat.parts.Count}):");
⋮----
sb.AppendLine($"   [{i}] {stat.parts[i].GetType().FullName}");
⋮----
var bestTool = pawn.GetBestSurvivalTool(stat);
⋮----
sb.AppendLine($"  bestTool={bestTool.LabelCapNoCount} factor={factor}");
⋮----
sb.AppendLine("  bestTool=(none)");
⋮----
LogDebug(sb.ToString(), key, respectCooldown: true);
⋮----
internal static bool ShouldLog(string logKey, bool respectCooldown = true)
⋮----
if (!respectCooldown || string.IsNullOrEmpty(logKey)) return true;
⋮----
if (_lastLoggedTick.TryGetValue(logKey, out last) && now - last < LOG_COOLDOWN_TICKS)
⋮----
internal static bool ShouldLogWithCooldown(string logKey) => ShouldLog(logKey, true);
⋮----
internal static bool ShouldLogJobForPawn(Pawn pawn, JobDef jobDef)
⋮----
if (!_loggedJobsPerPawn.TryGetValue(pawn, out set))
⋮----
if (set.Contains(jobDef)) return false;
set.Add(jobDef);
⋮----
private static void CleanupJobLoggingCache(Pawn pawn)
⋮----
if (_loggedJobsPerPawn.TryGetValue(pawn, out set) && !set.Contains(pawn.CurJob.def))
set.Clear();
⋮----
private sealed class BufferedEntry
⋮----
public LogLevel level;
⋮----
private static void EnqueueBuffered(string formatted, LogLevel level)
⋮----
if (string.IsNullOrEmpty(formatted))
⋮----
BufferedEntry entry;
if (_buffer.TryGetValue(formatted, out entry))
⋮----
_buffer[formatted] = new BufferedEntry
⋮----
private static void FlushOldest_NoLock()
⋮----
_buffer.Remove(oldestKey);
⋮----
internal static void TickBuffered()
⋮----
ready.Add(kv.Key);
⋮----
_buffer.Remove(key);
⋮----
private static void Emit(string text, LogLevel level)
⋮----
case LogLevel.Warning: Log.Warning(text); break;
case LogLevel.Error: Log.Error(text); break;
default: Log.Message(text); break;
⋮----
internal static void LogDebug(string message, string logKey = null, bool respectCooldown = true)
⋮----
internal static void LogCompat(string message, string logKey = null, bool respectCooldown = true)
⋮----
internal static void LogCompatMessage(string message, string logKey = null, bool respectCooldown = true)
⋮----
internal static void LogInfo(string message) => Emit(message, LogLevel.Message);
internal static void LogWarning(string message) => Emit(message, LogLevel.Warning);
internal static void LogError(string message) => Emit(message, LogLevel.Error);
⋮----
/// Raw debug logger for special-case systems (ToolResolver). Bypasses buffering,
/// deduplication and cooldown but remains gated behind the debug-settings flag.
/// Use only where callers must always see unthrottled debug output when DevMode+debug
/// logging is enabled (e.g. automatic tool resolution at startup).
⋮----
internal static void LogRawDebug(string message)
⋮----
/// Decision-level logging: deduped and cooldown-aware. Intended for scoring/validation
/// and patch decision explanations.
⋮----
internal static void LogDecision(string key, string message)
⋮----
if (string.IsNullOrEmpty(key))
⋮----
/// Summarized debug message for AI flows (single-line summary per pawn/job).
/// Respects cooldown keyed by pawn+job to avoid per-tool spam.
⋮----
internal static void LogDebugSummary(Pawn pawn, JobDef job, Thing chosenTool)
⋮----
/// Summarized stat debug for evaluation chains. Emits one line per pawn+stat key.
⋮----
internal static void LogStatDebug(Pawn pawn, StatDef stat, float factor)
⋮----
/// Emits an info-level message but only once per supplied key (cooldown semantics).
/// Useful for alerts and UI change logs that should not spam every tick.
⋮----
internal static void LogInfoOnce(string message, string key)
⋮----
internal static void LogCompatWarning(string message) =>
⋮----
internal static void LogCompatError(string message) =>
⋮----
internal static void ExtensionLogger()
⋮----
Emit($"    - {m.stat.defName}: {m.value.ToStringPercent()}", LogLevel.Message);
⋮----
var tags = string.Join(", ", ext.defaultSurvivalToolAssignmentTags);
⋮----
public sealed class ST_LogRunner : GameComponent
⋮----
public override void GameComponentUpdate()
⋮----
ST_Logging.TickBuffered();
ST_Logging.TickToolGateBuckets();
</file>

<file path="Source/Helpers/StatFilters.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/StatFilters.cs
// Todo: Evaluate if this file should be kept, refactored, or removed.
// It contains various stat-related utilities, but some may be redundant or unused.
⋮----
/// <summary>
/// Helper methods for filtering, analyzing, and categorizing StatDefs.
/// Centralized from SurvivalToolUtility and various stat-related logic.
///
/// Future ideas:
/// - Allow players to tweak which stats are optional/required via mod settings.
/// - Replace hardcoded priority scores with a DefModExtension or settings map.
/// - Add category split for "TreeFelling" vs "Mining" so they're displayed separately.
/// </summary>
public static class StatFilters
⋮----
/// Check if a stat is considered "optional" and shouldn't block jobs in hardcore mode.
/// Optional stats provide bonuses but aren't strictly required.
⋮----
/// Note: ButcheryFleshEfficiency is optional, but ButcheryFleshSpeed is NOT.
⋮----
public static bool IsOptionalStat(StatDef stat)
⋮----
/// Check if a stat should block jobs when missing tools in hardcore mode.
⋮----
public static bool ShouldBlockJobForMissingStat(StatDef stat)
⋮----
/// Get stats that are relevant for tool-based work and have available tools in the game.
⋮----
public static List<StatDef> GetAvailableToolStats()
⋮----
/// Filter a list of stats to only include those that have available tools in the current game.
⋮----
public static List<StatDef> FilterStatsWithAvailableTools(IEnumerable<StatDef> stats)
⋮----
foreach (var stat in stats.Where(s => s != null))
⋮----
availableStats.Add(stat);
⋮----
/// Check if there are any tools available in the game that improve the specified stat.
⋮----
public static bool HasAvailableToolsForStat(StatDef stat)
⋮----
// Real tools
foreach (var toolDef in DefDatabase<ThingDef>.AllDefs.Where(d => d.IsSurvivalTool()))
⋮----
// Tool-stuff (materials like Bioferrite, Obsidian, etc.)
foreach (var stuffDef in DefDatabase<ThingDef>.AllDefs.Where(d => d.IsToolStuff()))
⋮----
/// Group stats by their functional category (mining, farming, etc.).
⋮----
/// Future idea: break "Mining" and "TreeFelling" into separate groups for UI clarity.
⋮----
public static Dictionary<string, List<StatDef>> GroupStatsByCategory(IEnumerable<StatDef> stats)
⋮----
if (groups.ContainsKey(category))
groups[category].Add(stat);
⋮----
groups["Other"].Add(stat);
⋮----
/// Get a human-readable category name for a stat.
⋮----
public static string CategorizeStat(StatDef stat)
⋮----
public static bool IsValidSurvivalToolStat(StatDef stat)
⋮----
public static List<StatDef> GetAllSurvivalToolStats()
⋮----
.Where(IsValidSurvivalToolStat)
.ToList();
⋮----
public static bool ContainsSurvivalToolStats(IEnumerable<StatDef> stats)
⋮----
public static List<StatDef> FilterToSurvivalToolStats(IEnumerable<StatDef> stats)
⋮----
return stats?.Where(IsValidSurvivalToolStat).ToList() ?? new List<StatDef>();
⋮----
/// Get a priority score for a stat (higher = more important).
⋮----
/// Future idea: externalize these values into mod settings or DefModExtensions
/// so players/modders can rebalance priorities without code edits.
⋮----
public static int GetStatPriority(StatDef stat)
⋮----
public static List<StatDef> SortByPriority(IEnumerable<StatDef> stats)
⋮----
return stats?.OrderByDescending(GetStatPriority).ToList() ?? new List<StatDef>();
</file>

<file path="Source/Helpers/ToolStatResolver.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ToolStatResolver.cs
// Phase 2: Centralized tool stat resolver with hardened cataloging and caching.
// Replaces scattered stat inference logic with a single source of truth. Refactor code, KEEP.
⋮----
/// <summary>
/// Phase 2: Centralized tool stat resolver with hardened cataloging and caching.
/// Replaces scattered stat inference logic with a single source of truth.
/// </summary>
public static class ToolStatResolver
⋮----
// Cache per (toolDef, stuffDef, stat) factors for O(1) lookups
⋮----
// Work stats registry for intersection detection
⋮----
/// Get the set of registered work stats (lazy initialized)
⋮----
// Add work speed global if available
⋮----
_registeredWorkStats.Add(ST_StatDefOf.WorkSpeedGlobal);
⋮----
// Tool quirks registry with deterministic ordering
⋮----
// Resolver version stamp - increments on catalog/quirk changes for cache invalidation
⋮----
/// Tool quirk definition with deterministic ordering
⋮----
/// Tool stat information for caching and display
⋮----
public class ToolStatInfo
⋮----
public string Source { get; set; } // "Explicit", "StatBases", "NameHint", "Default"
⋮----
public string QuirkSummary { get; set; } // Applied quirk modifications (built once)
// Pre-allocated lightweight tags list for quirk tracking
⋮----
/// Current resolver version stamp. Increments when catalog or quirks change.
/// Used for cache invalidation to prevent stale data.
///
/// Integration note: Future ScoreCache systems should include this version
/// in cache keys alongside (pawn, tool, difficultySeed) to ensure scores
/// are invalidated when tool stat resolution changes.
⋮----
/// Register a tool quirk with predicate and action (INTERNAL USE ONLY).
/// Quirks are processed in registration order for deterministic behavior.
⋮----
/// <param name="predicate">Test if this quirk applies to a tool def</param>
/// <param name="action">Apply quirk modifications</param>
internal static void RegisterQuirk(Func<ThingDef, bool> predicate, Action<ToolQuirkApplier> action)
⋮----
_toolQuirks.Add(new ToolQuirk
⋮----
// Bump version to invalidate dependent caches
⋮----
/// Initialize the resolver with registered work stats
⋮----
public static void Initialize()
⋮----
// Build set of registered work stats for intersection detection (lazy init)
// _registeredWorkStats will be initialized on first access
⋮----
// Bump version on (re)build to invalidate dependent caches
⋮----
/// Get tool stat factor using hardened hierarchy:
/// 1. Explicit tool tags/properties
/// 2. Intersect statBases with registered work stats
/// 3. Name/verb hints fallback
/// 4. Safe defaults
⋮----
public static float GetToolStatFactor(ThingDef toolDef, ThingDef stuffDef, StatDef stat)
⋮----
if (_factorCache.TryGetValue(cacheKey, out float cachedFactor))
⋮----
// Clamp: material beats "no tool" baseline on Normal
⋮----
/// Get detailed tool stat information for SpecialDisplayStats
⋮----
public static ToolStatInfo GetToolStatInfo(ThingDef toolDef, ThingDef stuffDef, StatDef stat)
⋮----
if (_toolStatCache.TryGetValue(cacheKey, out var cached))
⋮----
// Trigger factor calculation which populates cache
⋮----
return _toolStatCache.TryGetValue(cacheKey, out var info) ? info : CreateDefaultInfo(toolDef, stuffDef, stat);
⋮----
/// Resolve tool stat info using the hierarchy
⋮----
private static ToolStatInfo ResolveToolStatInfo(ThingDef toolDef, ThingDef stuffDef, StatDef stat)
⋮----
ToolStatInfo info;
// 1. Explicit tool tags/properties (highest priority)
⋮----
info = new ToolStatInfo
⋮----
// 2. Intersect statBases with registered work stats
⋮----
// 3. Name/verb hints fallback
⋮----
// 4. Safe default
⋮----
// Apply tool quirks after inference but before clamping
⋮----
/// Apply registered tool quirks to the tool stat info
⋮----
private static void ApplyToolQuirks(ToolStatInfo info)
⋮----
var applier = new ToolQuirkApplier(info);
⋮----
if (quirk.Predicate(info.ToolDef))
⋮----
quirk.Action(applier);
⋮----
Log.Warning($"[SurvivalTools] Tool quirk failed for {info.ToolDef.defName}: {e.Message}");
⋮----
// Build quirk summary once after all quirks are applied
info.QuirkSummary = info.QuirkTags.Count > 0 ? string.Join(", ", info.QuirkTags) : null;
⋮----
/// Try to get explicit factor from SurvivalToolProperties or StuffPropsTool
⋮----
private static float? TryGetExplicitFactor(ThingDef toolDef, ThingDef stuffDef, StatDef stat)
⋮----
// Check tool's SurvivalToolProperties first (highest priority)
⋮----
// Check if tool naturally affects this stat through tool properties or name hints
⋮----
// Check stuff's StuffPropsTool - only apply if tool naturally affects this stat
⋮----
// Apply stuff factor as multiplier to tool's natural capability
⋮----
// Check stuff's SurvivalToolProperties (for cloth/materials)
⋮----
/// Check if a tool naturally affects a stat (through tool properties or name hints)
⋮----
private static bool DoesToolNaturallyAffectStat(ThingDef toolDef, StatDef stat)
⋮----
// Check tool's explicit properties
⋮----
// Check statBases
⋮----
// Check name hints
⋮----
/// Get the tool's natural factor for a stat (before stuff multipliers)
⋮----
private static float? GetToolNaturalFactor(ThingDef toolDef, StatDef stat)
⋮----
/// Try to get factor from statBases intersection with registered work stats
⋮----
private static float? TryGetStatBasesFactor(ThingDef toolDef, ThingDef stuffDef, StatDef stat)
⋮----
if (!RegisteredWorkStats.Contains(stat))
⋮----
// Check tool's statBases
⋮----
// Check stuff's statBases (if applicable)
⋮----
/// Try to get factor from name/verb hints (fallback)
⋮----
private static float? TryGetNameHintFactor(ThingDef toolDef, StatDef stat)
⋮----
if (string.IsNullOrEmpty(toolDef.label))
⋮----
string label = toolDef.label.ToLowerInvariant();
⋮----
// Mining tools
⋮----
if (label.Contains("pickaxe") || label.Contains("pick") || label.Contains("mattock"))
⋮----
// Tree felling
⋮----
if (label.Contains("axe") || label.Contains("hatchet"))
⋮----
// Plant work
⋮----
if (label.Contains("sickle") || label.Contains("scythe"))
⋮----
if (label.Contains("hoe") || label.Contains("cultivator"))
⋮----
// Construction/maintenance
⋮----
if (label.Contains("hammer") || label.Contains("mallet"))
⋮----
// Deconstruction
⋮----
if (label.Contains("wrench") || label.Contains("crowbar") || label.Contains("prybar"))
⋮----
// Butchery
⋮----
if (label.Contains("knife") || label.Contains("blade"))
⋮----
/// Get tech level multiplier for name hint fallbacks
⋮----
private static float GetTechLevelMultiplier(TechLevel techLevel)
⋮----
/// Get the "no tool" baseline factor
⋮----
private static float GetNoToolBaseline()
⋮----
/// Create default info when no other resolution works.
/// Tools that don't explicitly affect a stat should be neutral (1.0f), not penalized.
/// The "no tool baseline" only applies when there's literally no tool equipped.
⋮----
private static ToolStatInfo CreateDefaultInfo(ThingDef toolDef, ThingDef stuffDef, StatDef stat)
⋮----
// Default to the no-tool baseline so unrelated items do not appear
// to improve penalized stats (e.g., silver vs DiggingSpeed).
return new ToolStatInfo
⋮----
/// Clear caches (for debug/reload scenarios)
⋮----
public static void ClearCaches()
⋮----
_factorCache.Clear();
_toolStatCache.Clear();
⋮----
/// Clear all registered quirks (for debug/reload scenarios)
⋮----
public static void ClearQuirks()
⋮----
_toolQuirks.Clear();
⋮----
/// Get all cached tool stat infos for debugging
⋮----
public static IEnumerable<ToolStatInfo> GetAllCachedInfos()
⋮----
/// Get number of registered quirks for debugging
⋮----
public static int GetQuirkCount()
⋮----
/// Get filtered tool candidates (real tools + virtual textiles/wood).
/// Excludes buildings/turrets/mortars that were incorrectly evaluated as tools.
/// Used for debug dumps and future Phase 3 scoring enumeration.
⋮----
/// Includes:
/// - Real tools: equipment, weapons, anything with tools/CompEquippable
/// - Virtual materials: textiles/leather/wood that can become virtual tools
⋮----
/// Excludes:
/// - Buildings: turrets, mortars, workbenches, etc.
/// - Non-tool items: food, apparel, etc.
⋮----
public static IEnumerable<ThingDef> GetToolCandidates()
⋮----
// Exclude buildings (turrets, mortars, foam sprayers, etc.)
⋮----
// Include real tools if ANY condition is true
⋮----
def.HasComp(typeof(CompEquippable)) ||
⋮----
// Include virtual-only resources (textiles, wood)
// These can be crafted into virtual tools via SurvivalToolUtility
⋮----
bool isVirtualCandidate = def.stuffProps.categories.Contains(StuffCategoryDefOf.Fabric) ||
def.stuffProps.categories.Contains(StuffCategoryDefOf.Leathery) ||
def.stuffProps.categories.Contains(StuffCategoryDefOf.Woody);
⋮----
// -------------------------------------------------------------------------
// Kill List (Phase 3 Preparation):
// - Replace scattered tool stat inference across multiple files:
//   - SurvivalToolUtility.GetStatFactor()
//   - ToolUtility.GetStatFactors()
//   - StatWorker_* overrides
//   - Duplicated stat calculations in various classes
// - Consolidate all tool stat queries through ToolStatResolver
// - Remove obsolete helper methods once all callers updated
// - Use GetToolCandidates() for all tool enumeration instead of raw DefDatabase queries
// - Ensure all scoring systems use filtered candidates (excludes buildings/turrets)
</file>

<file path="Source/ModExtensions/SurvivalToolProperties.cs">
//Rimworld 1.6 / C# 7.3
// Source/ModExtensions/SurvivalToolProperties.cs
⋮----
namespace SurvivalTools
⋮----
public class SurvivalToolProperties : DefModExtension
⋮----
public static readonly SurvivalToolProperties defaultValues = new SurvivalToolProperties();
// Base stat factors a tool contributes (e.g., TreeFellingSpeed, DiggingSpeed)
// Initialize to avoid null checks everywhere.
⋮----
// Power multipliers applied to base stats based on material power factor
// Used to make better materials (devilstrand, hyperweave) more effective
⋮----
// Tags used by default survival tool assignments (untranslated keys/ids)
⋮----
// Multiplier for wear rate (1 = normal)
⋮----
/// <summary>
/// Convenience: get SurvivalToolProperties from a ThingDef (or defaultValues if none).
/// </summary>
public static SurvivalToolProperties For(ThingDef def)
⋮----
/// Check if this tool has any work stat factors defined.
⋮----
/// Check if this tool has any assignment tags defined.
⋮----
/// Get the modifier for a specific stat, or null if not found.
⋮----
public StatModifier GetStatModifier(StatDef stat)
⋮----
/// Get the factor value for a specific stat (1.0 if not found).
⋮----
public float GetStatFactor(StatDef stat)
⋮----
/// Check if this tool has a specific assignment tag.
⋮----
public bool HasAssignmentTag(string tag)
⋮----
return !string.IsNullOrEmpty(tag) && defaultSurvivalToolAssignmentTags?.Contains(tag) == true;
</file>

<file path="Source/ModExtensions/WorkGiverExtension.cs">
//RimWorld 1.6 / C# 7.3
// Source/ModExtensions/WorkGiverExtension.cs
⋮----
namespace SurvivalTools
⋮----
public class WorkGiverExtension : DefModExtension
⋮----
public static readonly WorkGiverExtension defaultValues = new WorkGiverExtension();
// Stats a pawn must meet to perform this WorkGiver. Keep non-null for easy consumption.
⋮----
/// <summary>
/// Convenience: get the extension for a WorkGiver def, or defaultValues if absent.
/// </summary>
public static WorkGiverExtension For(WorkGiverDef def)
⋮----
/// Check if this work giver has any required stats defined.
⋮----
/// Check if a specific stat is required by this work giver.
⋮----
public bool RequiresStat(StatDef stat)
⋮----
/// Get all required stats as a read-only enumerable.
⋮----
public IEnumerable<StatDef> GetRequiredStats()
</file>

<file path="Source/SpecialThingFilterWorker_NonSmeltableTools.cs">
// RimWorld 1.6 / C# 7.3
// Source/SpecialThingFilterWorker_NonSmeltableTools.cs
// Stockpile filter that matches SurvivalTools which cannot be smelted.
// Legacy but keep this code. Might be useful for custom filters.
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Stockpile filter that matches SurvivalTools which cannot be smelted.
/// </summary>
public class SpecialThingFilterWorker_NonSmeltableTools : SpecialThingFilterWorker
⋮----
public override bool Matches(Thing t)
⋮----
public override bool CanEverMatch(ThingDef def)
⋮----
if (!def.IsSurvivalTool()) return false;
⋮----
public override bool AlwaysMatches(ThingDef def)
⋮----
private static bool IsInSurvivalToolCategory(ThingDef def)
⋮----
if (def?.thingCategories.NullOrEmpty() != false) return false;
⋮----
// Walk up the category hierarchy to check if it's under SurvivalTools
ThingCategoryDef cat = thingCat;
</file>

<file path="Source/Stats/StatWorker_EstimatedLifespan.cs">
//RimWorld 1.6 / C# 7.3
// Source/Stats/StatWorker_EstimatedLifespan.cs
⋮----
namespace SurvivalTools
⋮----
public class StatWorker_EstimatedLifespan : StatWorker
⋮----
// Once per hour of continuous work, or ~40 mins with hardcore enabled.
⋮----
Mathf.RoundToInt(GenDate.TicksPerHour * (SurvivalToolUtility.IsHardcoreModeEnabled ? 0.67f : 1f));
⋮----
public override bool ShouldShowFor(StatRequest req)
⋮----
// Only show for buildables that are survival tools, and when degradation is on.
⋮----
if (bdef == null || !bdef.IsSurvivalTool()) return false;
⋮----
public override float GetValueUnfinalized(StatRequest req, bool applyPostProcess = true)
⋮----
public override string GetExplanationUnfinalized(StatRequest req, ToStringNumberSense numberSense)
⋮----
return $"{"StatsReport_BaseValue".Translate()}: {GetBaseEstimatedLifespan(tool, bdef).ToString("F1")}";
⋮----
private float GetBaseEstimatedLifespan(SurvivalTool tool, BuildableDef def)
⋮----
// For def (no specific instance)
⋮----
var props = SurvivalToolProperties.For(thingDef);
var maxHP = def.GetStatValueAbstract(StatDefOf.MaxHitPoints);
⋮----
return GenDate.TicksToDays(Mathf.RoundToInt((BaseWearInterval * maxHP) / wear));
⋮----
// For specific instance (stuff + HP)
var stuffProps = StuffPropsTool.For(tool.Stuff);
var tProps = SurvivalToolProperties.For(tool.def);
⋮----
return GenDate.TicksToDays(Mathf.RoundToInt((BaseWearInterval * tool.MaxHitPoints) / wearFactor));
⋮----
public override void FinalizeValue(StatRequest req, ref float val, bool applyPostProcess)
⋮----
base.FinalizeValue(req, ref val, applyPostProcess);
⋮----
public override string GetExplanationFinalizePart(StatRequest req, ToStringNumberSense numberSense, float finalVal)
⋮----
var sb = new StringBuilder();
sb.AppendLine($"{"Settings_ToolDegradationRate".Translate()}: {(1f / factor).ToStringByStyle(ToStringStyle.FloatTwo, ToStringNumberSense.Factor)}");
sb.AppendLine();
sb.AppendLine(base.GetExplanationFinalizePart(req, numberSense, finalVal));
return sb.ToString();
</file>

<file path="Source/WorkSpeedGlobalConfigWindow.cs">
// RimWorld 1.6 / C# 7.3
// Source/WorkSpeedGlobalConfigWindow.cs
// This is Legacy code and we want to get rid of this file and it's functionality.
// TODO: Remove this file and all references to it. This includes removing the menu option to open this window,
// as well as any related settings or configurations.
// we have to be careful as eventually we will still want to gate crafting/production jobs,
// but we want to do it in a more automatic way without user configuration.
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Window for configuring which WorkSpeedGlobal jobs should be gated by survival tools
/// </summary>
public class WorkSpeedGlobalConfigWindow : Window
⋮----
private SurvivalToolsSettings settings;
private Vector2 scrollPosition;
⋮----
// Code-side exclusion list (never shown in the UI)
⋮----
// Example: add defNames here that should never show in the list
// "CookMealFine",
// "CookMealLavish",
⋮----
public override Vector2 InitialSize => new Vector2(700f, 550f); // Increased width for better text fit
⋮----
private void InitializeWorkSpeedJobs()
⋮----
// Get all work givers that use WorkSpeedGlobal, filter excluded and non-gate-eligible
workSpeedJobs = WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs()
.Where(j => !excludedJobs.Contains(j.defName) && SurvivalToolUtility.ShouldGateByDefault(j))
.ToList();
// Initialize any missing job configurations to true (gated by default)
⋮----
if (!settings.workSpeedGlobalJobGating.ContainsKey(job.defName))
⋮----
settings.workSpeedGlobalJobGating[job.defName] = true; // Default to gated
⋮----
public override void DoWindowContents(Rect inRect)
⋮----
// Title
⋮----
var titleRect = new Rect(inRect.x, inRect.y, inRect.width, 30f);
Widgets.Label(titleRect, "WorkSpeedGlobal_Title".Translate());
⋮----
// Description
var descRect = new Rect(inRect.x, titleRect.yMax + 5f, inRect.width, 50f);
Widgets.Label(descRect, "WorkSpeedGlobal_Description".Translate());
// Reserve space for bottom buttons (plus padding and close button)
⋮----
const float bottomPadding = 50f; // Extra space for RimWorld's close button
⋮----
// Pinned Header area
⋮----
var headerRect = new Rect(inRect.x, descRect.yMax + 10f, inRect.width, headerHeight);
// Draw pinned header background
GUI.color = new Color(0.1f, 0.1f, 0.1f, 0.9f);
Widgets.DrawBoxSolid(headerRect, GUI.color);
GUI.color = new Color(0.6f, 0.6f, 0.6f, 1f);
Widgets.DrawBox(headerRect, 1);
// Header content with proper column alignment
⋮----
// Calculate dynamic column widths based on content
⋮----
// Calculate max job name width
float maxJobNameWidth = Text.CalcSize("WorkSpeedGlobal_JobTypeHeader".Translate()).x + 20f; // Header text plus padding
⋮----
var jobName = !string.IsNullOrEmpty(workSpeedJobs[i].label) ? workSpeedJobs[i].label.CapitalizeFirst() : workSpeedJobs[i].defName;
float w = Text.CalcSize(jobName).x + 10f;
⋮----
// Calculate Gated column width (centered checkbox)
float gatedColumnWidth = Mathf.Max(Text.CalcSize("WorkSpeedGlobal_GatedHeader".Translate()).x + 10f, 60f); // Minimum 60f for checkbox space
⋮----
// Job Type header
var jobHeaderRect = new Rect(headerRect.x + 5f, headerRect.y, maxJobNameWidth, headerRect.height);
⋮----
Widgets.Label(jobHeaderRect, "WorkSpeedGlobal_JobTypeHeader".Translate());
// Gated header - centered
var gatedHeaderRect = new Rect(jobHeaderRect.xMax + 10f, headerRect.y, gatedColumnWidth, headerRect.height);
Widgets.Label(gatedHeaderRect, "WorkSpeedGlobal_GatedHeader".Translate());
// Description header
var descHeaderRect = new Rect(gatedHeaderRect.xMax + 10f, headerRect.y, headerRect.width - gatedHeaderRect.xMax - 15f, headerRect.height);
Widgets.Label(descHeaderRect, "WorkSpeedGlobal_DescriptionHeader".Translate());
⋮----
// Draw vertical separators in header
⋮----
GUI.color = new Color(0.6f, 0.6f, 0.6f, 0.8f);
GUI.DrawTexture(new Rect(headerSep1X - 0.5f, headerRect.y, 1f, headerRect.height), BaseContent.WhiteTex);
GUI.DrawTexture(new Rect(headerSep2X - 0.5f, headerRect.y, 1f, headerRect.height), BaseContent.WhiteTex);
⋮----
// Content area for scrollable job list (below pinned header, above buttons)
var contentRect = new Rect(inRect.x, headerRect.yMax, inRect.width, inRect.height - headerRect.yMax - totalBottomSpace);
⋮----
Widgets.Label(contentRect, "WorkSpeedGlobal_NoJobsFound".Translate());
⋮----
// Calculate content height for scrolling
float contentHeight = workSpeedJobs.Count * 30f + 20f; // Extra padding
// Ensure the inner view rect height is at least the visible content area to prevent clipping the bottom buttons
var viewRect = new Rect(0, 0, contentRect.width - 20f, Mathf.Max(contentRect.height, contentHeight));
Widgets.BeginScrollView(contentRect, ref scrollPosition, viewRect);
⋮----
// Job entries (no header here since it's pinned above)
⋮----
var rowRect = new Rect(0, curY, viewRect.width, 25f);
// Alternate row colors
⋮----
GUI.color = new Color(0.1f, 0.1f, 0.1f, 0.3f);
Widgets.DrawBoxSolid(rowRect, GUI.color);
⋮----
// Job name
var nameRect = new Rect(rowRect.x + 5f, rowRect.y, maxJobNameWidth, rowRect.height);
var jobName = !string.IsNullOrEmpty(job.label) ? job.label.CapitalizeFirst() : job.defName;
Widgets.Label(nameRect, jobName);
// Gated checkbox - centered in column
var checkColumnRect = new Rect(nameRect.xMax + 10f, rowRect.y, gatedColumnWidth, rowRect.height);
var checkRect = new Rect(checkColumnRect.x + (checkColumnRect.width - 20f) / 2f, rowRect.y + (rowRect.height - 20f) / 2f, 20f, 20f);
bool isGated = settings.workSpeedGlobalJobGating.GetValueOrDefault(job.defName, true);
⋮----
Widgets.Checkbox(checkRect.position, ref newGated);
⋮----
// Immediately persist changes so other windows can see the update
settings.Write();
⋮----
var descriptionRect = new Rect(checkColumnRect.xMax + 10f, rowRect.y, rowRect.width - checkColumnRect.xMax - 15f, rowRect.height);
⋮----
Widgets.Label(descriptionRect, description);
⋮----
// Draw vertical separators
float sep1X = nameRect.xMax + 5f; // After job name
float sep2X = checkColumnRect.xMax + 5f; // After checkbox column
GUI.color = new Color(0.6f, 0.6f, 0.6f, 0.4f);
GUI.DrawTexture(new Rect(sep1X - 0.5f, rowRect.y, 1f, rowRect.height), BaseContent.WhiteTex);
GUI.DrawTexture(new Rect(sep2X - 0.5f, rowRect.y, 1f, rowRect.height), BaseContent.WhiteTex);
⋮----
Widgets.EndScrollView();
// Bottom buttons positioned relative to content area end
⋮----
var buttonRect = new Rect(inRect.x, buttonY, 120f, 30f);
if (Widgets.ButtonText(buttonRect, "WorkSpeedGlobal_EnableAll".Translate()))
⋮----
if (Widgets.ButtonText(buttonRect, "WorkSpeedGlobal_DisableAll".Translate()))
⋮----
if (Widgets.ButtonText(buttonRect, "WorkSpeedGlobal_ResetDefaults".Translate()))
⋮----
// Debug-only trace button
if (Prefs.DevMode && Widgets.ButtonText(buttonRect, "WorkSpeedGlobal_TraceWorkGivers".Translate()))
⋮----
private string GetJobDescription(WorkGiverDef job, bool isGated)
⋮----
if (isGated) return "WorkSpeedGlobal_JobStatus_Gated".Translate();
return "WorkSpeedGlobal_JobStatus_Ungated".Translate();
⋮----
private bool GetDefaultGatingForJob(WorkGiverDef job)
⋮----
// Default gating logic - gate production jobs, don't gate basic jobs
string name = job.defName.ToLower();
string label = !string.IsNullOrEmpty(job.label) ? job.label.ToLower() : "";
// Don't gate basic survival activities including manipulation
⋮----
// Manipulation and medical jobs that should never be gated
⋮----
if (name.Contains(k) || label.Contains(k)) return false;
⋮----
// Gate production activities
⋮----
if (name.Contains(k) || label.Contains(k)) return true;
⋮----
// Default to gated for ambiguous cases
⋮----
// -------- Trace helpers --------
private static IEnumerable<StatDef> ResolveRequiredStatsFor(WorkGiverDef job)
⋮----
// We will try to ask WorkSpeedGlobalHelper for the stats it found when it
// discovered these jobs. Different implementations may expose different method names.
// We attempt a few common/likely signatures to keep this window decoupled.
// If nothing is available, we fall back to WorkSpeedGlobal.
Type helperType = typeof(WorkSpeedGlobalHelper);
// Candidate method names returning IEnumerable<StatDef> for either WorkGiverDef or Type
⋮----
// one-parameter (WorkGiverDef) candidates
⋮----
// one-parameter (Type) candidates
⋮----
// 1) try WorkGiverDef parameter
⋮----
MethodInfo m = helperType.GetMethod(
⋮----
object r = m.Invoke(null, new object[] { job });
⋮----
// 2) try Type (giverClass) parameter
⋮----
object r = m.Invoke(null, new object[] { job.giverClass });
⋮----
// Fallback: the entire list was computed off WorkSpeedGlobal usage,
// so at minimum we can report that stat explicitly.
⋮----
private static string StatNames(IEnumerable<StatDef> stats)
⋮----
if (s != null) names.Add(s.defName);
⋮----
return string.Join(", ", names.ToArray());
⋮----
private void DumpWorkSpeedGlobalInfo()
⋮----
string desktop = Environment.GetFolderPath(Environment.SpecialFolder.Desktop);
string filePath = Path.Combine(desktop, "WorkSpeedGlobalJobsTrace.txt");
using (var writer = new StreamWriter(filePath, false))
⋮----
writer.WriteLine("WorkSpeedGlobal Jobs Trace");
writer.WriteLine("==========================");
writer.WriteLine();
⋮----
writer.WriteLine("Excluded Jobs (never shown):");
foreach (var ex in excludedJobs) writer.WriteLine("  - " + ex);
⋮----
bool gated = settings.workSpeedGlobalJobGating.GetValueOrDefault(job.defName, true);
writer.WriteLine("DefName: " + job.defName);
writer.WriteLine("Label: " + (job.label ?? "(no label)"));
writer.WriteLine("WorkType: " + (job.workType != null ? job.workType.defName : "(none)"));
writer.WriteLine("GiverClass: " + (job.giverClass != null ? job.giverClass.FullName : "(null)"));
writer.WriteLine("Currently Gated: " + gated);
// Optional: list recipe stats/skills for DoBill givers
if (typeof(WorkGiver_DoBill).IsAssignableFrom(job.giverClass))
⋮----
.Where(r => r.workSpeedStat != null) // only those affected by speed
.Select(r => $"{r.defName} (Stat={r.workSpeedStat.defName}, Skill={(r.workSkill != null ? r.workSkill.defName : "none")})")
⋮----
writer.WriteLine("Recipes (with workSpeedStat/workSkill):");
⋮----
writer.WriteLine("  - " + rec);
⋮----
writer.WriteLine(new string('-', 40));
⋮----
Messages.Message("WorkSpeedGlobal job trace written to desktop.", MessageTypeDefOf.TaskCompletion, false);
</file>

<file path="1.6/Defs/ThingDefs/Tools.xml">
<Defs>
    <ThingDef Name="SurvivalToolBasic" ParentName="BaseSurvivalTool" Abstract="True">
        <techLevel>Neolithic</techLevel>
        <statBases>
            <WorkToMake>1800</WorkToMake>
        </statBases>
        <stuffCategories>
            <li>Woody</li>
            <li>Stony</li>
            <li>Metallic</li>
        </stuffCategories>
        <smeltable>true</smeltable>
        <recipeMaker>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <comps>
            <li>
                <compClass>CompQuality</compClass>
            </li>
        </comps>
    </ThingDef>
    <!-- =================================================== -->
    <!-- PRIMITIVE TIER TOOLS (Stonecutting Research)       -->
    <!-- Basic tools for early colony survival              -->
    <!-- =================================================== -->
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Axe</defName>
        <label>axe</label>
        <description>A fundamental forestry tool designed for efficient tree felling. Its weighted head delivers powerful cutting strikes, making it indispensable for colonists working with wood. The balance and leverage make it far superior to improvised cutting methods. Also serves as a reliable melee weapon when survival demands it.</description>
        <costStuffCount>40</costStuffCount>
        <statBases>
            <Mass>2.5</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Axe</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <TreeFellingSpeed>1.5</TreeFellingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>PlantWorker</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Poke</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <!-- 83% of the club's DPS with the main tool -->
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>15.1</power>
                <cooldownTime>2.6</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Pickaxe</defName>
        <label>pickaxe</label>
        <description>An essential mining implement featuring a heavy, pointed head mounted on a sturdy handle. Specifically engineered to break through solid rock and extract valuable materials efficiently. The concentrated force and leverage it provides are crucial for productive mining operations. Can double as an improvised weapon when circumstances require it.</description>
        <costStuffCount>40</costStuffCount>
        <statBases>
            <Mass>2.5</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Pickaxe</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <DiggingSpeed>1.5</DiggingSpeed>
                    <MiningYieldDigging>1.2</MiningYieldDigging>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Miner</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Poke</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                </capacities>
                <power>15.1</power>
                <cooldownTime>2.6</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Hammer</defName>
        <label>hammer</label>
        <description>The cornerstone tool of any construction project. This versatile hammer provides the precision and force needed for driving fasteners, shaping materials, and assembling structures. Essential for colonists engaged in building and maintenance work. Its balanced design ensures effective strikes while minimizing fatigue during extended construction tasks.</description>
        <costStuffCount>30</costStuffCount>
        <statBases>
            <Mass>0.5</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Hammer</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ConstructionSpeed>1.5</ConstructionSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>11.6</power>
                <cooldownTime>2</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Sickle</defName>
        <label>sickle</label>
        <description>A specialized agricultural tool featuring a curved cutting blade perfectly designed for harvesting crops and cutting plant matter. The ergonomic design allows for efficient, repetitive cutting motions while reducing strain on the user. Essential for productive farming operations and plant maintenance tasks.</description>
        <costStuffCount>30</costStuffCount>
        <statBases>
            <Mass>0.5</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Sickle</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <PlantHarvestingSpeed>1.5</PlantHarvestingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>PlantWorker</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>11.6</power>
                <cooldownTime>2</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Hoe</defName>
        <label>hoe</label>
        <description>A fundamental agricultural implement engineered for soil preparation and seed planting. The pointed design efficiently breaks through earth and creates optimal planting conditions. Indispensable for establishing productive farming operations and maintaining crop yields. Its sturdy construction ensures reliable performance season after season.</description>
        <costStuffCount>30</costStuffCount>
        <statBases>
            <Mass>1.0</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Hoe</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <SowingSpeed>1</SowingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>PlantWorker</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>8</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>10</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Wrench</defName>
        <label>wrench</label>
        <description>A precision mechanical tool engineered for gripping, turning, and manipulating fasteners and mechanical components. Critical for maintenance operations, machinery repair, and construction projects requiring exact adjustments. The adjustable jaw design accommodates various sizes while providing optimal leverage and control.</description>
        <costStuffCount>35</costStuffCount>
        <statBases>
            <Mass>1.2</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Wrench</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <MaintenanceSpeed>1</MaintenanceSpeed>
                    <DeconstructionSpeed>1</DeconstructionSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>12</power>
                <cooldownTime>2.2</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Machining</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>4</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_PrimitiveLever</defName>
        <label>pry bar</label>
        <description>A primitive but effective leverage tool crafted from durable materials. Essential for dismantling structures, prying apart materials, and performing basic mechanical operations. Represents the ingenuity of early civilizations in developing practical solutions for construction and deconstruction tasks without advanced technology.</description>
        <costStuffCount>25</costStuffCount>
        <statBases>
            <Mass>1.8</Mass>
        </statBases>
        <techLevel>Neolithic</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/PryBar</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <MaintenanceSpeed>0.6</MaintenanceSpeed>
                    <DeconstructionSpeed>0.8</DeconstructionSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>8</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>tip</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                </capacities>
                <power>10</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_Abacus</defName>
        <label>abacus</label>
        <description>An ancient calculating instrument featuring movable beads arranged on rods for performing arithmetic operations. Essential for organizing research data, managing complex calculations, and maintaining accurate records in societies without advanced computational devices. Represents the foundation of mathematical thinking and data organization.</description>
        <costStuffCount>20</costStuffCount>
        <stuffCategories>
            <li>Woody</li>
            <li>Stony</li>
        </stuffCategories>
        <statBases>
            <Mass>0.8</Mass>
            <WorkToMake>1800</WorkToMake>
        </statBases>
        <techLevel>Neolithic</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Abacus</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ResearchSpeed>0.7</ResearchSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Researcher</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>frame</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>6</power>
                <cooldownTime>2.5</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>2</Crafting>
            </skillRequirements>
        </recipeMaker>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <comps>
            <li>
                <compClass>CompQuality</compClass>
            </li>
        </comps>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Microscope</defName>
        <label>microscope</label>
        <description>A precision optical instrument that magnifies small objects and specimens for detailed examination. Essential for advanced research, biological studies, and scientific analysis.</description>
        <costStuffCount>50</costStuffCount>
        <statBases>
            <Mass>2.5</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Microscope</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ResearchSpeed>1.4</ResearchSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Researcher</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>base</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>8</power>
                <cooldownTime>3</cooldownTime>
            </li>
            <li>
                <label>lens assembly</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                </capacities>
                <power>6</power>
                <cooldownTime>2.8</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Machining</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>6</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <!-- Regular Steel Tools -->
    <!-- =================================================== -->
    <!-- INDUSTRIAL TIER TOOLS (Smithing Research)          -->
    <!-- Advanced steel tools for established colonies      -->
    <!-- =================================================== -->
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_SteelKnife</defName>
        <label>steel knife</label>
        <description>A precision-forged steel knife with superior edge retention and durability. The high-carbon steel blade maintains its sharpness through extensive use, making it ideal for demanding butchery and medical work. The ergonomic handle provides excellent control for delicate operations.</description>
        <costStuffCount>30</costStuffCount>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>0.4</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/SteelKnife</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ButcheryFleshSpeed>1.2</ButcheryFleshSpeed>
                    <ButcheryFleshEfficiency>1.1</ButcheryFleshEfficiency>
                    <MedicalOperationSpeed>1.1</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>1.05</MedicalSurgerySuccessChance>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Butcher</li>
                    <li>Medical</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>8</power>
                <cooldownTime>1.7</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                    <li>Stab</li>
                </capacities>
                <power>14</power>
                <cooldownTime>1.5</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Smithing</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>3</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_CrosscutSaw</defName>
        <label>crosscut saw</label>
        <description>A precision industrial saw designed for efficient lumber processing and construction work. The specially designed teeth and reinforced steel construction allow for clean, accurate cuts through various materials. Essential for large-scale construction projects and advanced woodworking operations.</description>
        <costStuffCount>45</costStuffCount>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <costList>
            <ComponentIndustrial>1</ComponentIndustrial>
        </costList>
        <statBases>
            <Mass>1.5</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/CrosscutSaw</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ConstructionSpeed>1.2</ConstructionSpeed>
                    <DeconstructionSpeed>1.3</DeconstructionSpeed>
                    <TreeFellingSpeed>1.1</TreeFellingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                    <li>PlantWorker</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>10</power>
                <cooldownTime>2.5</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>13</power>
                <cooldownTime>2.8</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Smithing</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>4</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <!-- Advanced Industrial Tools -->
    <!-- =================================================== -->
    <!-- PRECISION TIER TOOLS (Machining Research)          -->
    <!-- High-tech precision tools for advanced operations  -->
    <!-- =================================================== -->
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_CarbidePick</defName>
        <label>carbide pickaxe</label>
        <description>An advanced mining implement featuring carbide-tipped edges that maintain their sharpness through the most demanding excavation work. The precision-engineered head cuts through rock more efficiently than standard tools, while the reinforced construction ensures exceptional durability in harsh mining conditions.</description>
        <costStuffCount>50</costStuffCount>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>3.0</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/CarbidePick</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <DiggingSpeed>1.3</DiggingSpeed>
                    <MiningYieldDigging>1.2</MiningYieldDigging>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Miner</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>0.7</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Poke</li>
                </capacities>
                <power>11</power>
                <cooldownTime>2.1</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                </capacities>
                <power>17</power>
                <cooldownTime>2.7</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Machining</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>6</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_PrecisionScalpel</defName>
        <label>precision scalpel</label>
        <description>An ultra-sharp surgical instrument crafted from the finest steel alloys. The carefully balanced blade maintains its edge through repeated sterilization and use, while the ergonomic handle ensures precise control during delicate medical procedures. Standard equipment in advanced medical facilities.</description>
        <costStuffCount>25</costStuffCount>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>0.2</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/PrecisionScalpel</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <MedicalOperationSpeed>1.4</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>1.15</MedicalSurgerySuccessChance>
                    <MedicalTendQuality>1.1</MedicalTendQuality>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Medical</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>0.8</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>6</power>
                <cooldownTime>1.2</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                    <li>Stab</li>
                </capacities>
                <power>12</power>
                <cooldownTime>1.0</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Machining</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>8</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_PowerDrill</defName>
        <label>power drill</label>
        <description>A mechanized drilling tool powered by an internal motor, capable of boring through tough materials with precision and speed. The variable-speed motor and interchangeable bits make it invaluable for construction and mechanical work. Requires periodic maintenance to keep the motor running smoothly.</description>
        <costStuffCount>75</costStuffCount>
        <costList>
            <ComponentIndustrial>2</ComponentIndustrial>
        </costList>
        <statBases>
            <Mass>2.5</Mass>
        </statBases>
        <techLevel>Industrial</techLevel>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/PowerDrill</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ConstructionSpeed>1.3</ConstructionSpeed>
                    <MaintenanceSpeed>1.4</MaintenanceSpeed>
                    <DiggingSpeed>1.2</DiggingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                    <li>Miner</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>0.9</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>body</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>12</power>
                <cooldownTime>2.0</cooldownTime>
            </li>
            <li>
                <label>drill bit</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                </capacities>
                <power>15</power>
                <cooldownTime>1.8</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Machining</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Machining</soundWorking>
            <recipeUsers>
                <li>FabricationBench</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>7</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedComponent</unfinishedThingDef>
        </recipeMaker>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
    </ThingDef>
    <!-- =================================================== -->
    <!-- SPACER TIER TOOLS (Advanced Fabrication Research)  -->
    <!-- Glitterworld technology for ultimate efficiency    -->
    <!-- =================================================== -->
    <!-- Glitterworld Multitool -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_Multitool</defName>
        <label>glitterworld multitool</label>
        <description>A high-tech universal tool commonly used by domestic mechanoids in glitterworld societies. This advanced device can seamlessly adapt to any task - construction, mining, forestry, maintenance, and deconstruction - making it the ultimate all-in-one survival tool. Though designed for mechanoids, it's perfectly usable by humanoids due to physiological similarities.</description>
        <statBases>
            <MarketValue>800</MarketValue>
            <Flammability>0.7</Flammability>
            <Mass>1.8</Mass>
            <!-- Equivalent to excellent quality -->
            <ToolEffectivenessFactor>1.2</ToolEffectivenessFactor>
        </statBases>
        <equippedAngleOffset>-20</equippedAngleOffset>
        <techLevel>Ultra</techLevel>
        <thingCategories>
            <li>SurvivalToolsSpacer</li>
        </thingCategories>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/GlitterworldMultitool</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <!-- Forestry & Plant Work -->
                    <TreeFellingSpeed>1.3</TreeFellingSpeed>
                    <PlantHarvestingSpeed>1.3</PlantHarvestingSpeed>
                    <SowingSpeed>1.3</SowingSpeed>
                    <!-- Mining & Excavation -->
                    <DiggingSpeed>1.3</DiggingSpeed>
                    <MiningYieldDigging>1.1</MiningYieldDigging>
                    <!-- Construction & Building -->
                    <ConstructionSpeed>1.3</ConstructionSpeed>
                    <!-- Maintenance & Repair -->
                    <MaintenanceSpeed>1.4</MaintenanceSpeed>
                    <DeconstructionSpeed>1.3</DeconstructionSpeed>
                    <!-- Research & Analysis -->
                    <ResearchSpeed>1.5</ResearchSpeed>
                    <!-- Extended stats (only if other mods provide tools for these) -->
                    <CleaningSpeed>1.4</CleaningSpeed>
                    <MedicalOperationSpeed>1.3</MedicalOperationSpeed>
                    <MedicalSurgerySuccessChance>1.1</MedicalSurgerySuccessChance>
                    <ButcheryFleshSpeed>1.3</ButcheryFleshSpeed>
                    <ButcheryFleshEfficiency>1.1</ButcheryFleshEfficiency>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                    <li>Miner</li>
                    <li>PlantWorker</li>
                    <li>Researcher</li>
                    <!-- Extended tags (only if other mods provide tools for these) -->
                    <li>Cleaner</li>
                    <li>Medical</li>
                    <li>Butcher</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>0.15</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Poke</li>
                </capacities>
                <power>9</power>
                <cooldownTime>2</cooldownTime>
            </li>
            <li>
                <label>head</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Stab</li>
                    <li>Cut</li>
                    <li>Blunt</li>
                </capacities>
                <power>14</power>
                <cooldownTime>2</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <!-- Missing Primitive Tools -->
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_Knife</defName>
        <label>knife</label>
        <description>A versatile cutting implement with a sharp blade essential for precise work. Perfect for butchery operations, medical procedures, and general cutting tasks. The balanced design allows for controlled, accurate cuts while the keen edge ensures clean work. An indispensable tool for any serious colonist.</description>
        <costStuffCount>25</costStuffCount>
        <stuffCategories>
            <li>Stony</li>
        </stuffCategories>
        <statBases>
            <Mass>0.3</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/Knife</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ButcheryFleshSpeed>1</ButcheryFleshSpeed>
                    <ButcheryFleshEfficiency>1</ButcheryFleshEfficiency>
                    <MedicalOperationSpeed>1</MedicalOperationSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Butcher</li>
                    <li>Medical</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>7</power>
                <cooldownTime>1.8</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                    <li>Stab</li>
                </capacities>
                <power>12</power>
                <cooldownTime>1.6</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>1</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_HandSaw</defName>
        <label>hand saw</label>
        <description>A traditional woodworking tool featuring a metal blade with precisely cut teeth designed for manual lumber processing. Essential for construction projects requiring custom-cut timber and detailed woodwork. The steady rhythm of hand-sawing may take longer than power tools, but provides excellent control and precision.</description>
        <costStuffCount>35</costStuffCount>
        <statBases>
            <Mass>1.0</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/HandSaw</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <ConstructionSpeed>1</ConstructionSpeed>
                    <DeconstructionSpeed>1</DeconstructionSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>Constructor</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>8</power>
                <cooldownTime>2.2</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>10</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="SurvivalToolBasic">
        <defName>SurvivalTools_BoneSickle</defName>
        <label>bone sickle</label>
        <description>A primitive harvesting tool crafted from carved bone with a sharpened edge. While not as durable as metal variants, this traditional implement serves admirably for crop harvesting and plant cutting. The curved design follows ancient patterns proven effective across countless generations of agricultural work.</description>
        <costStuffCount>20</costStuffCount>
        <stuffCategories>
            <li>Stony</li>
            <li>Woody</li>
        </stuffCategories>
        <statBases>
            <Mass>0.4</Mass>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/BoneSickle</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <PlantHarvestingSpeed>0.8</PlantHarvestingSpeed>
                </baseWorkStatFactors>
                <defaultSurvivalToolAssignmentTags>
                    <li>PlantWorker</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>1.3</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>handle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>6</power>
                <cooldownTime>2.1</cooldownTime>
            </li>
            <li>
                <label>blade</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Cut</li>
                </capacities>
                <power>8</power>
                <cooldownTime>2.3</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>1</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                </disallowedThingDefs>
            </defaultIngredientFilter>
            <unfinishedThingDef>UnfinishedWeapon</unfinishedThingDef>
        </recipeMaker>
    </ThingDef>
    <!-- =================================================== -->
    <!-- CLEANING TOOLS                                      -->
    <!-- Basic cleaning implements for colony maintenance    -->
    <!-- =================================================== -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_PileOfRags</defName>
        <label>pile of rags</label>
        <description>A collection of cloth pieces bundled together for cleaning purposes. These simple rags are effective for basic cleaning tasks, though they wear out more quickly than proper cleaning tools. Essential for maintaining colony hygiene and cleanliness.</description>
        <techLevel>Neolithic</techLevel>
        <costStuffCount>5</costStuffCount>
        <stuffCategories>
            <li>Fabric</li>
        </stuffCategories>
        <statBases>
            <WorkToMake>600</WorkToMake>
            <MaxHitPoints>50</MaxHitPoints>
            <Mass>0.5</Mass>
            <DeteriorationRate>4</DeteriorationRate>
            <Beauty>-3</Beauty>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/PileOfRags</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <recipeMaker>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Tailor</effectWorking>
            <soundWorking>Recipe_Tailor</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>HandTailoringBench</li>
                <li>ElectricTailoringBench</li>
            </recipeUsers>
            <skillRequirements>
                <Crafting>1</Crafting>
            </skillRequirements>
            <unfinishedThingDef>UnfinishedApparel</unfinishedThingDef>
        </recipeMaker>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <CleaningSpeed>0.75</CleaningSpeed>
                </baseWorkStatFactors>
                <stuffPowerMultiplier>
                    <CleaningSpeed>1.0</CleaningSpeed>
                </stuffPowerMultiplier>
                <defaultSurvivalToolAssignmentTags>
                    <li>Cleaner</li>
                </defaultSurvivalToolAssignmentTags>
                <toolWearFactor>1.5</toolWearFactor>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>bundle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>0.25</power>
                <cooldownTime>3.0</cooldownTime>
            </li>
        </tools>
        <comps>
            <li>
                <compClass>CompQuality</compClass>
            </li>
        </comps>
    </ThingDef>
    <!-- =================================================== -->
    <!-- MULTIPURPOSE GENERAL WORK TOOLS (WorkSpeedGlobal)   -->
    <!-- Re-added after revert                               -->
    <!-- =================================================== -->
    <!-- Tribal Tier -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_MultipurposeStoneTool</defName>
        <label>multipurpose stone tool</label>
        <description>A rugged, versatile stone implement shaped to cover many general tasks. While primitive, it grants a modest improvement to overall work speed.</description>
        <techLevel>Neolithic</techLevel>
        <costStuffCount>35</costStuffCount>
        <stuffCategories>
            <li>Stony</li>
            <li>Woody</li>
        </stuffCategories>
        <statBases>
            <Mass>1.2</Mass>
            <MaxHitPoints>120</MaxHitPoints>
            <WorkToMake>1400</WorkToMake>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/MultipurposeStoneTool</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.00</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>1.10</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>body</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>1</power>
                <cooldownTime>2.5</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>FueledSmithy</li>
                <li>ElectricSmithy</li>
            </recipeUsers>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <skillRequirements>
                <Crafting>1</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                    <li>Steel</li>
                    <li>Plasteel</li>
                    <li>Uranium</li>
                    <li MayRequire="Anomaly">Bioferrite</li>
                    <!-- Tune later, This should only be basic stone -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
    </ThingDef>
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_CarvedBoneImplements</defName>
        <label>carved bone implements</label>
        <description>A collection of carefully carved bone implements bundled together for multi-purpose use. Fragile, but shaped for efficiency, giving a noticeable boost to general work speed.</description>
        <techLevel>Neolithic</techLevel>
        <costStuffCount>30</costStuffCount>
        <stuffCategories>
            <li>Woody</li>
        </stuffCategories>
        <statBases>
            <Mass>0.9</Mass>
            <MaxHitPoints>90</MaxHitPoints>
            <WorkToMake>1500</WorkToMake>
            <Flammability>0.7</Flammability>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/CarvedBoneImplements</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.05</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>1.00</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>bundle</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>1</power>
                <cooldownTime>2.5</cooldownTime>
            </li>
        </tools>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>CraftingSpot</li>
                <li>FueledSmithy</li>
                <li>ElectricSmithy</li>
            </recipeUsers>
            <researchPrerequisite>Stonecutting</researchPrerequisite>
            <skillRequirements>
                <Crafting>1</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                    <li>Steel</li>
                    <li>Plasteel</li>
                    <li>Uranium</li>
                    <li MayRequire="Anomaly">Bioferrite</li>
                    <!-- Tune later, This should only be basic stone -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
    </ThingDef>
    <!-- Medieval Tier -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_ArtisansToolkit</defName>
        <label>artisan's toolkit</label>
        <description>A curated collection of quality medieval-era implements for crafting, shaping, and assembly. Improves overall work throughput across many tasks.</description>
        <techLevel>Medieval</techLevel>
        <costStuffCount>45</costStuffCount>
        <stuffCategories>
            <li>Metallic</li>
            <li>Woody</li>
        </stuffCategories>
        <statBases>
            <Mass>2.0</Mass>
            <MaxHitPoints>160</MaxHitPoints>
            <WorkToMake>2200</WorkToMake>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/ArtisansToolkit</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.10</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.90</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>FueledSmithy</li>
                <li>ElectricSmithy</li>
            </recipeUsers>
            <researchPrerequisite>Smithing</researchPrerequisite>
            <skillRequirements>
                <Crafting>4</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Silver</li>
                    <li>Gold</li>
                    <li>Plasteel</li>
                    <li MayRequire="Anomaly">Bioferrite</li>
                    <!-- Tune later -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
        <tools>
            <li>
                <label>implements</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>2</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_WoodworkersKit</defName>
        <label>woodworker's kit</label>
        <description>A specialized assortment of saws, chisels, planes and gauges optimized for timber shaping and joinery. Its organization and quality grant a strong boost to general work speed.</description>
        <techLevel>Medieval</techLevel>
        <costStuffCount>55</costStuffCount>
        <stuffCategories>
            <li>Woody</li>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>2.2</Mass>
            <MaxHitPoints>170</MaxHitPoints>
            <WorkToMake>2400</WorkToMake>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/WoodworkersKit</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories>
            <li>SurvivalToolsNeolithic</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.15</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.80</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Smith</soundWorking>
            <recipeUsers>
                <li>FueledSmithy</li>
                <li>ElectricSmithy</li>
            </recipeUsers>
            <researchPrerequisite>Smithing</researchPrerequisite>
            <skillRequirements>
                <Crafting>5</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <li>Plasteel</li>
                    <li MayRequire="Anomaly">Bioferrite</li>
                    <!-- Tune later -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
        <tools>
            <li>
                <label>kit frame</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>2</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <!-- Industrial Tier -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_MechanicsToolkit</defName>
        <label>mechanic's toolkit</label>
        <description>An organized industrial-era toolkit containing precision wrenches, gauges, torque implements and fast-retrieval storage. Greatly improves overall task flow and coordination in general work.</description>
        <techLevel>Industrial</techLevel>
        <costStuffCount>60</costStuffCount>
        <costList>
            <ComponentIndustrial>2</ComponentIndustrial>
        </costList>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>2.4</Mass>
            <MaxHitPoints>200</MaxHitPoints>
            <WorkToMake>3000</WorkToMake>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/MechanicsToolkit</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.22</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.65</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Machining</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FueledSmithy</li>
            </recipeUsers>
            <researchPrerequisite>Machining</researchPrerequisite>
            <skillRequirements>
                <Crafting>6</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <!-- Tune later -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
        <tools>
            <li>
                <label>case</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>3</power>
                <cooldownTime>2.6</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_WorkshopHammerDrill</defName>
        <label>workshop hammer drill</label>
        <description>A heavy-duty powered hammer drill with interchangeable percussion and rotary modules. Its integrated clamping and alignment system accelerates virtually any mechanical or construction task.</description>
        <techLevel>Industrial</techLevel>
        <costStuffCount>70</costStuffCount>
        <costList>
            <ComponentIndustrial>2</ComponentIndustrial>
        </costList>
        <stuffCategories>
            <li>Metallic</li>
        </stuffCategories>
        <statBases>
            <Mass>3.2</Mass>
            <MaxHitPoints>220</MaxHitPoints>
            <WorkToMake>3600</WorkToMake>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/WorkshopHammerDrill</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories Inherit="false">
            <li>SurvivalToolsIndustrial</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.30</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.50</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <recipeMaker>
            <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Machining</soundWorking>
            <recipeUsers>
                <li>ElectricSmithy</li>
                <li>FabricationBench</li>
            </recipeUsers>
            <researchPrerequisite>Machining</researchPrerequisite>
            <skillRequirements>
                <Crafting>7</Crafting>
            </skillRequirements>
            <defaultIngredientFilter>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedThingDefs>
                    <!-- Tune later -->
                </disallowedThingDefs>
            </defaultIngredientFilter>
        </recipeMaker>
        <tools>
            <li>
                <label>housing</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>4</power>
                <cooldownTime>2.6</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <!-- Spacer / Glitterworld Tier / EXPENSIVE TO MAKE if Makeable -->
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_NanofabricatorInterface</defName>
        <label>nanofabricator interface</label>
        <description>A sleek control and augmentation module that synchronizes the user's motions with adaptive nano-assembly routines. Dramatically improves general task execution efficiency.</description>
        <techLevel>Ultra</techLevel>
        <costList>
            <ComponentSpacer>1</ComponentSpacer>
            <Gold>1</Gold>
            <Plasteel>25</Plasteel>
            <Silver>50</Silver>
            <Uranium>1</Uranium>
            <Steel>10</Steel>
        </costList>
        <statBases>
            <Mass>1.0</Mass>
            <MaxHitPoints>240</MaxHitPoints>
            <WorkToMake>5000</WorkToMake>
            <MarketValue>900</MarketValue>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/NanofabricatorInterface</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories Inherit="false">
            <li>SurvivalToolsSpacer</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.45</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.30</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <li>Generalist</li>
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <recipeMaker>
            <workSpeedStat>WorkSpeedGlobal</workSpeedStat>
            <workSkill>Crafting</workSkill>
            <effectWorking>Smith</effectWorking>
            <soundWorking>Recipe_Machining</soundWorking>
            <recipeUsers>
                <li>FabricationBench</li>
            </recipeUsers>
            <researchPrerequisite>Fabrication</researchPrerequisite>
            <skillRequirements>
                <Crafting>15</Crafting>
            </skillRequirements>
        </recipeMaker>
        <tools>
            <li>
                <label>interface shell</label>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>5</power>
                <cooldownTime>2.4</cooldownTime>
            </li>
        </tools>
    </ThingDef>
    <ThingDef ParentName="BaseSurvivalTool">
        <defName>SurvivalTools_OmniToolGauntlet</defName>
        <label>omni-tool gauntlet</label>
        <description>A cutting-edge modular gauntlet embedding field projectors, micro-fabricators and force-aligned manipulators. Provides an unparalleled increase to general work speed through predictive optimization.</description>
        <techLevel>Ultra</techLevel>
        <statBases>
            <MarketValue>1400</MarketValue>
            <Flammability>0.5</Flammability>
            <Mass>1.1</Mass>
            <MaxHitPoints>260</MaxHitPoints>
        </statBases>
        <graphicData>
            <texPath>Things/Item/Equipment/Tool/OmniToolGauntlet</texPath>
            <graphicClass>Graphic_Single</graphicClass>
        </graphicData>
        <thingCategories>
            <li>SurvivalToolsSpacer</li>
        </thingCategories>
        <modExtensions>
            <li Class="SurvivalTools.SurvivalToolProperties">
                <baseWorkStatFactors>
                    <WorkSpeedGlobal>1.60</WorkSpeedGlobal>
                </baseWorkStatFactors>
                <toolWearFactor>0.10</toolWearFactor>
                <defaultSurvivalToolAssignmentTags>
                    <!--<li>Generalist</li>-->
                </defaultSurvivalToolAssignmentTags>
            </li>
        </modExtensions>
        <tools>
            <li>
                <label>emitter housing</label>
                <capacities>
                    <li>Poke</li>
                </capacities>
                <power>8</power>
                <cooldownTime>2.2</cooldownTime>
            </li>
            <li>
                <label>manipulator array</label>
                <labelUsedInLogging>false</labelUsedInLogging>
                <capacities>
                    <li>Blunt</li>
                </capacities>
                <power>11</power>
                <cooldownTime>2.0</cooldownTime>
            </li>
        </tools>
    </ThingDef>
</Defs>
</file>

<file path="Source/AI/JobDriver_FellTree.cs">
// Rimworld 1.6 / C# 7.3
// Source/AI/JobDriver_FellTree.cs
⋮----
namespace SurvivalTools
⋮----
public class JobDriver_FellTree : JobDriver_PlantWork
⋮----
protected override void Init()
⋮----
base.Init();
// Defensive read of Plant
⋮----
if (plant != null && plant.def?.plant?.harvestedThingDef != null && plant.CanYieldNow())
⋮----
protected override Toil PlantWorkDoneToil()
⋮----
// Simple, instant-done toil that destroys the targeted thing (plant)
private Toil DestroyThing(TargetIndex ind)
⋮----
var toil = new Toil();
⋮----
// Prefer the driver job (stable) rather than actor.CurJob which may change
⋮----
// Ensure it's still a plant (extra safety)
⋮----
thing.Destroy(DestroyMode.Vanish);
⋮----
// If it's not a Plant but still exists, be conservative and avoid destroying unexpected things.
⋮----
$"[SurvivalTools] FellTree toil expected a Plant but found {thing.GetType().Name}: {thing} — skipping destroy.",
⋮----
// Critical exception — keep semantics but route through centralized logger
</file>

<file path="Source/AI/WorkGiver_FellTrees.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/WorkGiver_FellTrees.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// WorkGiver for tree felling / harvesting when designated.
/// - Defensive null checks
/// - Avoids duplicate targets
/// - Chooses correct job (HarvestTreeDesignated / FellTreeDesignated)
/// </summary>
public class WorkGiver_FellTrees : WorkGiver_Scanner
⋮----
public override Danger MaxPathDanger(Pawn pawn) => Danger.Deadly;
⋮----
public override IEnumerable<Thing> PotentialWorkThingsGlobal(Pawn pawn)
⋮----
if (seen.Add(thing))
⋮----
public override Job JobOnThing(Pawn pawn, Thing t, bool forced = false)
⋮----
if (t.IsForbidden(pawn) || t.IsBurning()) return null;
if (!pawn.CanReserveAndReach(t, PathEndMode.Touch, pawn.NormalMaxDanger()))
⋮----
return new Job(ST_JobDefOf.HarvestTreeDesignated, t);
⋮----
return new Job(ST_JobDefOf.FellTreeDesignated, t);
</file>

<file path="Source/Assign/PreWork_AutoEquip.cs">
// RimWorld 1.6 / C# 7.3
// Source/Assign/PreWork_AutoEquip.cs
//
// Phase 6: Pre-work auto-equip integration
// - Harmony prefix for Pawn_JobTracker.TryTakeOrderedJob
// - Provides seamless tool upgrading before work begins
// - Settings-driven behavior with performance safeguards
⋮----
public static class PreWork_AutoEquip
⋮----
private static readonly FieldInfo PawnField = AccessTools.Field(typeof(Pawn_JobTracker), "pawn");
// Track pending WorkGiver tool checks between prefix and postfix
⋮----
// (removed unused _patchApplied flag)
/// <summary>
/// Static constructor to verify patch application
/// </summary>
⋮----
Log.Warning("[SurvivalTools.PreWork] PreWork_AutoEquip static constructor called - class is being loaded");
⋮----
Log.Error($"[SurvivalTools.PreWork] Static constructor failed: {ex}");
⋮----
/// Harmony prefix for Pawn_JobTracker.TryTakeOrderedJob.
/// Checks if job requires tools and attempts auto-equip if beneficial.
⋮----
public static bool TryTakeOrderedJob_Prefix(Pawn_JobTracker __instance, Job job, ref bool __result)
⋮----
// IMMEDIATE LOGGING - This should ALWAYS show up to verify patch is working
⋮----
// Early-out checks
⋮----
return true; // Continue with original
var pawn = (Pawn)PawnField.GetValue(__instance);
⋮----
// VALIDATION: Use JobUtils to validate job before processing
if (!JobUtils.IsJobStillValid(job, pawn))
⋮----
// IMMEDIATE LOGGING for ALL ordered jobs to see what's happening
⋮----
// Only process colonists
if (!pawn.IsColonist || !pawn.Awake())
⋮----
// ANTI-CONFLICT: Skip tool management jobs to avoid loops
if (JobUtils.IsToolManagementJob(job))
⋮----
// Check if this job requires tools
⋮----
return true; // No relevant work stat, continue normally
⋮----
// Skip if assignment disabled
⋮----
// SAFETY: Don't interfere if pawn is already doing something critical
⋮----
// SAFETY: Don't interfere with job queue manipulation during job execution
⋮----
// Try to upgrade tool for this work
⋮----
// Tool upgrade was queued. Requeue the original job at the front so it will retry after equip.
⋮----
if (job != null && JobUtils.IsJobStillValid(job, pawn))
⋮----
var cloned = JobUtils.CloneJobForQueue(job);
⋮----
Log.Error($"[SurvivalTools.PreWork] Exception while re-queuing original job {job?.def?.defName}: {ex}");
⋮----
// Block now; job will be retried from queue after tool job(s)
⋮----
// No upgrade needed/possible, continue with original job
⋮----
return true; // Always continue on error to avoid breaking gameplay
⋮----
/// Alternative patch for StartJob - another common job creation path
/// NOTE: StartJob returns void, so we cannot block it or return a result
⋮----
public static bool StartJob_Prefix(Pawn_JobTracker __instance, Job newJob)
⋮----
// EARLY FILTER: Only log and process colonists to reduce spam
⋮----
// Check if this job requires tools FIRST to reduce logging spam
⋮----
return true; // No tool needed, exit quietly
// NOW log since this is a tool-requiring job
⋮----
// Try to upgrade tool for this work using FRONT priority (rescue style)
⋮----
// Requeue the original job at the front, then SKIP starting it now.
⋮----
if (newJob != null && JobUtils.IsJobStillValid(newJob, pawn))
⋮----
var cloned = JobUtils.CloneJobForQueue(newJob);
⋮----
return false; // Skip StartJob now; equip job(s) will run first
⋮----
return true; // Continue when no upgrade queued
⋮----
/// Patch WorkGiver_Scanner.JobOnThing - this catches work assignments before they become jobs
⋮----
public static bool WorkGiver_JobOnThing_Prefix(WorkGiver_Scanner __instance, Pawn pawn, Thing t)
⋮----
// EARLY FILTER: Colonists only, avoid noise
⋮----
// Determine relevant stat for this work type; store for postfix to act on
⋮----
// If the pawn cannot perform this work type OR it's not active for this pawn, and this isn't a forced job, skip rescue entirely
⋮----
if (!isForced && (pawn.WorkTypeIsDisabled(workTypeDef) || (ws != null && !ws.WorkIsActive(workTypeDef))))
⋮----
StatDef relevantStat = null;
⋮----
public static void WorkGiver_JobOnThing_Postfix(WorkGiver_Scanner __instance, Pawn pawn, Thing t, ref Job __result)
⋮----
// Nothing to do if no job was produced
⋮----
_wgPendingStat.Remove(pawn.thingIDNumber);
⋮----
// Only for colonists with pending stat from prefix
⋮----
if (!_wgPendingStat.TryGetValue(pawn.thingIDNumber, out var relevantStat) || relevantStat == null)
⋮----
// Avoid loops: don't intervene for tool management jobs
if (JobUtils.IsToolManagementJob(__result))
⋮----
// Determine thresholds (reuse defaults similar to TryUpgradeForWork)
⋮----
// Opportunistically queue an upgrade but DO NOT block WorkGiver jobs
// Blocking here can cause the selected AI job to disappear. Let it proceed.
bool upgraded = AssignmentSearch.TryUpgradeFor(pawn, relevantStat, minGainPct, searchRadius, pathCostBudget, AssignmentSearch.QueuePriority.Front, $"WorkGiver.JobOnThing({__instance?.def?.defName})");
⋮----
Log.Warning($"[SurvivalTools.PreWork] WorkGiver: queued tool upgrade for {pawn.LabelShort} (job={__result?.def?.defName}), not blocking");
⋮----
// Cleanup per-call state
if (pawn != null) _wgPendingStat.Remove(pawn.thingIDNumber);
⋮----
/// Determine the primary work stat for a job, if any.
⋮----
private static StatDef GetRelevantWorkStat(Job job)
⋮----
// Map common job types to their primary work stats
⋮----
// SAFETY: Skip complex jobs that shouldn't be interrupted by tool assignment
⋮----
jobDef.defName.Contains("Bill") ||
jobDef.defName.Contains("Craft") ||
jobDef.defName.Contains("Cook"))
⋮----
return null; // Don't interfere with crafting/cooking jobs
⋮----
// Tree cutting/harvesting
⋮----
// Plant harvesting
⋮----
// Mining
⋮----
// Construction
⋮----
// Deconstruction
⋮----
return StatDefOf.ConstructionSpeed; // Same tools as construction
⋮----
// Smoothing (if enabled)
⋮----
return null; // No relevant work stat found
⋮----
/// Try to upgrade pawn's tool for the given work stat.
/// Returns true if upgrade was queued (original job should be blocked).
⋮----
private static bool TryUpgradeForWork(Pawn pawn, StatDef workStat, Job originalJob, SurvivalToolsSettings settings, AssignmentSearch.QueuePriority priority)
⋮----
// Get assignment parameters from settings (with defaults)
⋮----
// Check if gating would block this job (simplified check using current tool score)
⋮----
// Gating rescue mode: any improvement is acceptable
minGainPct = 0.001f; // Minimal threshold for any improvement
⋮----
// Normal assignment mode: require meaningful gain
// Use configured minimum gain percentage
⋮----
// Gating would block but rescue is disabled
⋮----
// Delegate to AssignmentSearch
⋮----
bool result = AssignmentSearch.TryUpgradeFor(pawn, workStat, minGainPct, searchRadius, pathCostBudget, priority, caller);
⋮----
/// Get minimum gain percentage from settings with difficulty scaling.
⋮----
private static float GetMinGainPct(SurvivalToolsSettings settings)
⋮----
return 0.1f; // Default 10%
// Use configured value with difficulty scaling
⋮----
// Scale by difficulty
⋮----
return baseGainPct * 1.5f; // Nightmare: higher threshold
⋮----
return baseGainPct * 1.25f; // Hardcore: moderate increase
return baseGainPct; // Normal: as configured
⋮----
/// Get search radius from settings with difficulty scaling.
⋮----
private static float GetSearchRadius(SurvivalToolsSettings settings)
⋮----
return 25f; // Default radius
⋮----
return baseRadius * 0.5f; // Nightmare: half radius
⋮----
return baseRadius * 0.75f; // Hardcore: reduced radius
return baseRadius; // Normal: full radius
⋮----
/// Get path cost budget from settings with difficulty scaling.
⋮----
private static int GetPathCostBudget(SurvivalToolsSettings settings)
⋮----
return 500; // Default budget
⋮----
return baseBudget / 2; // Nightmare: half budget
⋮----
return (baseBudget * 3) / 4; // Hardcore: 75% budget
return baseBudget; // Normal: full budget
⋮----
/// Get rescue on gate setting.
⋮----
private static bool GetAssignRescueOnGate(SurvivalToolsSettings settings)
⋮----
return true; // Default enabled
⋮----
/// Get assignment enabled setting.
⋮----
private static bool GetEnableAssignments(SurvivalToolsSettings settings)
⋮----
/// Check if a pawn would likely be gated for this work stat.
/// Simplified check based on current tool availability.
⋮----
private static bool IsLikelyGated(Pawn pawn, StatDef workStat)
⋮----
// Get current best tool and score
var currentTool = ToolScoring.GetBestTool(pawn, workStat, out float currentScore);
float baseline = SurvivalToolUtility.GetNoToolBaseline(workStat);
// If current score is at or below baseline, likely gated
</file>

<file path="Source/DebugTools/DebugAction_DumpStatus.cs">
// RimWorld 1.6 / C# 7.3
// Source/DebugTools/DebugAction_DumpStatus.cs
⋮----
namespace SurvivalTools
⋮----
internal static class ST_DebugActions
⋮----
private static void DumpStatus()
⋮----
var sb = new StringBuilder(4096);
sb.AppendLine("[SurvivalTools] Status dump");
sb.AppendLine("----------------------------");
try { sb.AppendLine($"Settings: hardcore={(SurvivalTools.Settings?.hardcoreMode == true)} extraHardcore={(SurvivalTools.Settings?.extraHardcoreMode == true)}"); } catch { }
⋮----
sb.AppendLine($"Resolver version: {Helpers.ToolStatResolver.Version}");
var cacheStats = Helpers.ScoreCache.GetCacheStats();
sb.AppendLine($"Score cache: {cacheStats.entryCount} entries, {cacheStats.hits} hits, {cacheStats.misses} misses (v{cacheStats.resolverVersion})");
⋮----
try { sb.AppendLine($"Filtered tool candidates: {Helpers.ToolStatResolver.GetToolCandidates().Count()}"); } catch { }
try { sb.AppendLine($"WorkSpeedGlobal jobs discovered: {Helpers.WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs().Count()}"); } catch { }
try { sb.AppendLine("Active mods carrying ST hooks:"); sb.AppendLine(CompatLine()); } catch { }
sb.AppendLine();
sb.AppendLine("Tip: use this after loading a save and mining a tile to verify wear/penalties.");
var path = ST_FileIO.WriteUtf8Atomic($"ST_Status_{System.DateTime.Now:yyyyMMdd_HHmmss}.txt", sb.ToString());
try { Messages.Message("Survival Tools: wrote " + path, MessageTypeDefOf.TaskCompletion); } catch { }
⋮----
private static void DumpResolverComparison()
⋮----
var sb = new StringBuilder(8192);
sb.AppendLine("[SurvivalTools] Resolver Comparison (Phase 2)");
sb.AppendLine("============================================");
⋮----
// Resolver state summary
⋮----
sb.AppendLine($"Registered quirks: {Helpers.ToolStatResolver.GetQuirkCount()}");
⋮----
// Get sample of filtered tool candidates
var sampleTools = Helpers.ToolStatResolver.GetToolCandidates()
.Where(t => !string.IsNullOrEmpty(t.label))
.Take(20)
.ToList();
⋮----
}.Where(s => s != null).ToList();
sb.AppendLine($"Comparing {sampleTools.Count} filtered tool candidates across {sampleStats.Count} stats:");
⋮----
sb.AppendLine($"Tool: {tool.defName} ({tool.label})");
sb.AppendLine($"  Source: {tool.modContentPack?.Name ?? "Core"}");
sb.AppendLine($"  Tech Level: {tool.techLevel}");
⋮----
var info = Helpers.ToolStatResolver.GetToolStatInfo(tool, null, stat);
string quirkInfo = !string.IsNullOrEmpty(info.QuirkSummary)
⋮----
sb.AppendLine($"  {stat.defName}: {info.Factor:F3} (Source: {info.Source}, Clamped: {info.IsClamped}{quirkInfo})");
⋮----
// Cache and quirk stats
var cacheInfo = Helpers.ToolStatResolver.GetAllCachedInfos().ToList();
var quirkedInfos = cacheInfo.Where(info => !string.IsNullOrEmpty(info.QuirkSummary)).ToList();
sb.AppendLine($"Cached entries: {cacheInfo.Count}");
sb.AppendLine($"Entries with quirks applied: {quirkedInfos.Count}");
if (quirkedInfos.Any())
⋮----
sb.AppendLine("Sample quirk applications (max 5):");
foreach (var info in quirkedInfos.Take(5))
⋮----
sb.AppendLine($"  {info.ToolDef.defName} + {info.Stat.defName}: {info.QuirkSummary}");
⋮----
sb.AppendLine($"Error during resolver comparison: {ex}");
⋮----
var path = ST_FileIO.WriteUtf8Atomic($"ST_ResolverComparison_{System.DateTime.Now:yyyyMMdd_HHmmss}.txt", sb.ToString());
try { Messages.Message("Survival Tools: wrote resolver comparison to " + path, MessageTypeDefOf.TaskCompletion); } catch { }
⋮----
private static void TestToolQuirkSystem()
⋮----
Messages.Message("Debug actions require dev mode enabled", MessageTypeDefOf.RejectInput);
⋮----
// Clear existing quirks for clean test
Helpers.ToolStatResolver.ClearQuirks();
// Register a test quirk: axes get 10% bonus to tree felling
Compat.CompatAPI.RegisterToolQuirk(
toolDef => toolDef.label?.ToLowerInvariant().Contains("axe") == true,
⋮----
applier.MultiplyFactor(1.1f, "axe bonus");
⋮----
// Register another test quirk: steel tools get small construction bonus
⋮----
if (applier.StuffLabelContains("steel") && applier.Stat == StatDefOf.ConstructionSpeed)
⋮----
applier.AddBonus(0.05f, "steel construction");
⋮----
var sb = new StringBuilder(2048);
sb.AppendLine("[SurvivalTools] Quirk System Test Results");
sb.AppendLine("========================================");
sb.AppendLine($"Test executed at: {DateTime.Now:yyyy-MM-dd HH:mm:ss}");
⋮----
// Test the quirks by checking some tools
var testAxe = DefDatabase<ThingDef>.AllDefs.FirstOrDefault(t => t.label?.ToLowerInvariant().Contains("axe") == true);
⋮----
var info = Helpers.ToolStatResolver.GetToolStatInfo(testAxe, ThingDefOf.Steel, ST_StatDefOf.TreeFellingSpeed);
sb.AppendLine($"Test axe ({testAxe.defName}): {info.Factor:F3} (quirks: {info.QuirkSummary ?? "none"})");
⋮----
var testHammer = DefDatabase<ThingDef>.AllDefs.FirstOrDefault(t => t.label?.ToLowerInvariant().Contains("hammer") == true);
⋮----
var info = Helpers.ToolStatResolver.GetToolStatInfo(testHammer, ThingDefOf.Steel, StatDefOf.ConstructionSpeed);
sb.AppendLine($"Test hammer ({testHammer.defName}): {info.Factor:F3} (quirks: {info.QuirkSummary ?? "none"})");
⋮----
ST_FileIO.WriteUtf8Atomic(fileName, sb.ToString());
Messages.Message($"Tool quirk system test completed - results saved to Desktop/{fileName}", MessageTypeDefOf.TaskCompletion);
⋮----
Log.Error($"[SurvivalTools] Quirk system test failed: {ex}");
Messages.Message("Tool quirk system test failed - check log for errors", MessageTypeDefOf.RejectInput);
⋮----
private static void BenchmarkScoring()
⋮----
// Find first humanlike pawn on current map
⋮----
Messages.Message("No current map found for benchmark", MessageTypeDefOf.RejectInput);
⋮----
var pawn = map.mapPawns.FreeColonists.FirstOrDefault();
⋮----
Messages.Message("No colonist found on current map for benchmark", MessageTypeDefOf.RejectInput);
⋮----
// Find first tool they hold (or skip gracefully)
var tool = pawn.GetAllUsableSurvivalTools().FirstOrDefault();
⋮----
Messages.Message($"Pawn {pawn.Name?.ToStringShort ?? "Unknown"} has no tools for benchmark - giving them a steel knife", MessageTypeDefOf.CautionInput);
// Create a basic tool for testing
var knife = DefDatabase<ThingDef>.GetNamed("MeleeWeapon_Knife", false);
⋮----
tool = ThingMaker.MakeThing(knife, ThingDefOf.Steel);
pawn.inventory.innerContainer.TryAdd(tool);
⋮----
Messages.Message("Could not create test tool for benchmark", MessageTypeDefOf.RejectInput);
⋮----
Messages.Message("MiningSpeed stat not found for benchmark", MessageTypeDefOf.RejectInput);
⋮----
// Pre-warm cache
Scoring.ToolScoring.Score(tool, pawn, workStat);
⋮----
sb.AppendLine("[SurvivalTools] Scoring Benchmark Results");
sb.AppendLine("======================================");
⋮----
sb.AppendLine($"Pawn: {pawn.Name?.ToStringShort ?? "Unknown"} ({pawn.def.defName})");
sb.AppendLine($"Tool: {tool.def.defName} (stuff: {tool.Stuff?.defName ?? "none"})");
sb.AppendLine($"Work stat: {workStat.defName}");
⋮----
// Get baseline GC and cache stats
var initialCacheStats = Helpers.ScoreCache.GetCacheStats();
int initialGen0 = GC.CollectionCount(0);
int initialGen1 = GC.CollectionCount(1);
int initialGen2 = GC.CollectionCount(2);
// Benchmark 10,000 calls
⋮----
var stopwatch = System.Diagnostics.Stopwatch.StartNew();
⋮----
totalScore += Scoring.ToolScoring.Score(tool, pawn, workStat);
⋮----
stopwatch.Stop();
// Get final GC and cache stats
var finalCacheStats = Helpers.ScoreCache.GetCacheStats();
int finalGen0 = GC.CollectionCount(0);
int finalGen1 = GC.CollectionCount(1);
int finalGen2 = GC.CollectionCount(2);
// Calculate results
⋮----
// Report results
sb.AppendLine("Benchmark Results:");
sb.AppendLine($"  Iterations: {iterations:N0}");
sb.AppendLine($"  Total time: {stopwatch.Elapsed.TotalMilliseconds:F2} ms");
sb.AppendLine($"  Time per call: {msPerCall:F6} ms");
sb.AppendLine($"  Calls per second: {callsPerSecond:F0}");
sb.AppendLine($"  Average score: {avgScorePerCall:F6}");
⋮----
sb.AppendLine("Memory/GC Impact:");
sb.AppendLine($"  Gen 0 collections: {gcGen0}");
sb.AppendLine($"  Gen 1 collections: {gcGen1}");
sb.AppendLine($"  Gen 2 collections: {gcGen2}");
sb.AppendLine($"  Total GC events: {gcGen0 + gcGen1 + gcGen2}");
⋮----
sb.AppendLine("Cache Performance:");
sb.AppendLine($"  Initial cache entries: {initialCacheStats.entryCount}");
sb.AppendLine($"  Final cache entries: {finalCacheStats.entryCount}");
sb.AppendLine($"  Cache hits gained: {finalCacheStats.hits - initialCacheStats.hits}");
sb.AppendLine($"  Cache misses gained: {finalCacheStats.misses - initialCacheStats.misses}");
⋮----
sb.AppendLine("✓ ZERO GC COLLECTIONS - Benchmark passed!");
⋮----
var path = ST_FileIO.WriteUtf8Atomic(fileName, sb.ToString());
Messages.Message($"Scoring benchmark completed: {callsPerSecond:F0} calls/sec, {gcGen0 + gcGen1 + gcGen2} GC events - results saved to {path}", MessageTypeDefOf.TaskCompletion);
⋮----
Log.Error($"[SurvivalTools] Scoring benchmark failed: {ex}");
Messages.Message("Scoring benchmark failed - check log for errors", MessageTypeDefOf.RejectInput);
⋮----
private static void CompareStatPartVsToolScoring()
⋮----
// Find selected pawn
⋮----
Messages.Message("No pawn selected for StatPart comparison", MessageTypeDefOf.RejectInput);
⋮----
// Use MiningSpeed for comparison
⋮----
Messages.Message("No mining/digging stat available for comparison", MessageTypeDefOf.RejectInput);
⋮----
var sb = new StringBuilder(1024);
sb.AppendLine("[SurvivalTools] StatPart vs ToolScoring Comparison");
sb.AppendLine("================================================");
⋮----
sb.AppendLine($"Pawn: {selectedPawn.Name?.ToStringShort ?? "Unknown"} ({selectedPawn.def.defName})");
sb.AppendLine($"Test stat: {testStat.defName} ({testStat.label})");
⋮----
// Get StatPart-modified value via dry run
⋮----
var req = StatRequest.For(selectedPawn);
statPart.TransformValue(req, ref statPartValue);
// Get ToolScoring expectation
var bestTool = Scoring.ToolScoring.GetBestTool(selectedPawn, testStat, out float toolScore);
⋮----
expectedFactor = Helpers.ToolStatResolver.GetToolStatFactor(bestTool.def, bestTool.Stuff, testStat);
⋮----
// No tool case
⋮----
sb.AppendLine("Comparison Results:");
sb.AppendLine($"  Base stat value: {baseValue:F3}");
sb.AppendLine($"  StatPart result: {statPartValue:F3}");
sb.AppendLine($"  ToolScoring expected: {toolScoringValue:F3}");
sb.AppendLine($"  Values match: {Math.Abs(statPartValue - toolScoringValue) < 0.001f}");
sb.AppendLine($"  Difference: {Math.Abs(statPartValue - toolScoringValue):F6}");
⋮----
sb.AppendLine($"Effective tool: {bestTool.LabelCap}");
sb.AppendLine($"Tool score: {toolScore:F3}");
sb.AppendLine($"Tool factor: {expectedFactor:F3}");
⋮----
sb.AppendLine("No effective tool found");
sb.AppendLine($"Penalty factor: {expectedFactor:F3}");
⋮----
Messages.Message($"StatPart comparison completed - results saved to {path}", MessageTypeDefOf.TaskCompletion);
⋮----
Log.Error($"[SurvivalTools] StatPart comparison failed: {ex}");
Messages.Message("StatPart comparison failed - check log for errors", MessageTypeDefOf.RejectInput);
⋮----
private static void TestGating()
⋮----
var selected = Find.Selector.SelectedPawns.FirstOrDefault();
⋮----
Messages.Message("No pawn selected", MessageTypeDefOf.RejectInput);
⋮----
sb.AppendLine($"[SurvivalTools] Tool Gating Test for {selected.LabelCap}");
sb.AppendLine("=======================================================");
sb.AppendLine($"Test time: {DateTime.Now:yyyy-MM-dd HH:mm:ss}");
⋮----
sb.AppendLine($"Settings: hardcore={settings?.hardcoreMode == true}, extraHardcore={settings?.extraHardcoreMode == true}, showGatingAlert={settings?.showGatingAlert == true}");
⋮----
// Show pawn's current tools
sb.AppendLine("Pawn Tool Inventory:");
var allTools = selected.GetAllUsableSurvivalTools().ToList();
⋮----
// Clear tool stat resolver cache for accurate results
Helpers.ToolStatResolver.ClearCaches();
if (allTools.Any())
⋮----
// Get quality if available
if (tool.TryGetQuality(out QualityCategory quality))
⋮----
// Get condition
⋮----
sb.AppendLine($"  {location} {tool.LabelCap}{stuffInfo}{qualityInfo}{conditionInfo}");
// Show tool stats for key work types
⋮----
.Where(s => s != null).ToList();
⋮----
var info = Helpers.ToolStatResolver.GetToolStatInfo(tool.def, tool.Stuff, stat);
if (Math.Abs(info.Factor - 1f) > 0.001f) // Only show if meaningfully different from 1.0
⋮----
sb.AppendLine($"    - {stat.defName}: {info.Factor:F3}x (Source: {info.Source})");
// Debug: Show why this factor was applied
⋮----
sb.AppendLine($"      -> Explicit mod extension or tool properties");
⋮----
sb.AppendLine($"      -> Found in tool's statBases");
⋮----
sb.AppendLine($"      -> Name hint: '{tool.def.label}' matched pattern");
⋮----
sb.AppendLine($"      -> Default fallback (should be 1.0x)");
⋮----
sb.AppendLine("  No survival tools found in inventory or equipped");
⋮----
// Test representative WorkGivers with null guards (exact same pattern as live)
⋮----
DefDatabase<WorkGiverDef>.GetNamedSilentFail("Mine"),
DefDatabase<WorkGiverDef>.GetNamedSilentFail("ConstructDeliverResourcesToBlueprints"),
DefDatabase<WorkGiverDef>.GetNamedSilentFail("ConstructFinishFrames"),
DefDatabase<WorkGiverDef>.GetNamedSilentFail("CutPlants"),
DefDatabase<WorkGiverDef>.GetNamedSilentFail("PlantsCut"),
DefDatabase<WorkGiverDef>.GetNamedSilentFail("PlantHarvest"),
DefDatabase<WorkGiverDef>.GetNamedSilentFail("GrowerHarvest"),
DefDatabase<WorkGiverDef>.GetNamedSilentFail("SmithWeapons"),
DefDatabase<WorkGiverDef>.GetNamedSilentFail("Smith"),
DefDatabase<WorkGiverDef>.GetNamedSilentFail("Repair")
}.Where(wg => wg != null).ToArray();
sb.AppendLine($"Testing {testWorkGivers.Length} representative WorkGivers:");
⋮----
sb.AppendLine("WorkGiver\t\t\tResult\tTranslated Reason");
sb.AppendLine("--------\t\t\t------\t-----------------");
⋮----
// Use exact JobGate.ShouldBlock call matching live logic
bool blocked = Gating.JobGate.ShouldBlock(selected, wg, null, false, out var reasonKey, out var a1, out var a2);
⋮----
string reason = blocked ? reasonKey.Translate(a1, a2).ToString() : "No blocking";
string wgName = (wg.label ?? wg.defName).PadRight(24);
sb.AppendLine($"{wgName}\t{result}\t{reason}");
⋮----
sb.AppendLine("Notes:");
sb.AppendLine("- This uses exact JobGate.ShouldBlock() logic matching live behavior");
sb.AppendLine("- JobDef-specific gating tested during actual job creation (WorkGiver → Job)");
sb.AppendLine("- 'forced=false' simulates normal work assignment (not player-forced)");
sb.AppendLine($"- Current mode: {(settings?.hardcoreMode == true ? "Hardcore" : settings?.extraHardcoreMode == true ? "Nightmare" : "Normal")}");
⋮----
Messages.Message($"Tool gating test completed - results saved to {path}", MessageTypeDefOf.TaskCompletion);
⋮----
Log.Error($"[SurvivalTools] Gating test failed: {ex}");
Messages.Message("Gating test failed - check log for errors", MessageTypeDefOf.RejectInput);
⋮----
private static string CompatLine()
⋮----
try { return string.Join(", ", Helpers.WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs().Select(wg => wg.defName)); } catch { return "(n/a)"; }
</file>

<file path="Source/GameComponent_SurvivalToolsValidation.cs">
// RimWorld 1.6 / C# 7.3
// Source/GameComponent_SurvivalToolsValidation.cs
// Game component to trigger job validation after loading a game
// - Ensures all survival tools have up-to-date stat factors
// - Legacy code, Keep functionality.
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Game component that triggers job validation when a save is loaded
/// </summary>
public class GameComponent_SurvivalToolsValidation : GameComponent
⋮----
public override void FinalizeInit()
⋮----
// Trigger validation after game initialization with proper timing
⋮----
// Ensure any leftover deterministic counters from previous sessions/maps are cleared.
try { SurvivalToolUtility.ClearAllCounters(); } catch { }
// Immediate stat refresh - don't queue it, do it now before anything else
⋮----
// Then queue delayed validation to ensure jobs are checked after everything is settled
LongEventHandler.QueueLongEvent(() =>
⋮----
// Schedule validation for 3 seconds after load to ensure everything is settled
var ticksToWait = 180; // 3 seconds at 60 TPS
⋮----
// Schedule the ToolFactorCache activation at the same time so computed
// factors are cached only after the world is stable. This prevents
// early caching during PostLoadInit which has caused CTDs in the past.
SurvivalToolUtility.ToolFactorCache.ScheduleActivation(scheduledValidationTick);
⋮----
public override void GameComponentTick()
⋮----
// Execute delayed validation when the time comes
// Allow the ToolFactorCache to flip into Initialized when the scheduled tick arrives
SurvivalToolUtility.ToolFactorCache.CheckActivation();
⋮----
SurvivalToolValidation.ValidateExistingJobs("delayed validation after game load");
⋮----
public override void ExposeData()
⋮----
// Don't save hasValidatedThisSession - we want it to reset each time we load
base.ExposeData();
⋮----
/// Refresh stat factors for all existing survival tools on the map.
/// This fixes tools that were created with old stat calculation logic.
⋮----
private void RefreshAllToolStats()
⋮----
foreach (var thing in map.listerThings.ThingsInGroup(ThingRequestGroup.HaulableEver))
⋮----
// Force immediate stat factor initialization by accessing WorkStatFactors
// This triggers the lazy initialization we just added
var _ = tool.WorkStatFactors.ToList(); // Force evaluation
⋮----
// If this tool is held by a pawn, mark them for stat cache refresh
⋮----
refreshedPawns.Add(inventory.pawn);
⋮----
refreshedPawns.Add(equipment.pawn);
⋮----
// Force stat cache refresh for all pawns with refreshed tools
⋮----
pawn.workSettings.Notify_UseWorkPrioritiesChanged();
⋮----
// Force full stat recalculation
pawn.Notify_DisabledWorkTypesChanged();
</file>

<file path="Source/Harmony/Patch_EquipmentUtility_CanEquip_PacifistTools.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// Legacy code: KEEP
// Core feature. Allows pacifists to equip Survival Tools that are marked as IsWeapon.
// Also adds float menu options for drafted and undrafted pacifists to equip or take to inventory.
// evaluate for integration into refactor.
⋮----
/// <summary>
/// Part 1: Let pacifists equip Survival Tools that happen to be IsWeapon.
/// We do NOT change IsWeapon or other vanilla blocks (forbidden, biocode, etc.).
/// </summary>
⋮----
public static class Patch_EquipmentUtility_CanEquip_PacifistTools
⋮----
// Patch all overloads named CanEquip that look like: bool CanEquip(Thing, Pawn, out string, bool, ...)
static IEnumerable<MethodBase> TargetMethods()
⋮----
return AccessTools.GetDeclaredMethods(typeof(EquipmentUtility))
.Where(m => m.Name == "CanEquip" && m.ReturnType == typeof(bool))
.Where(m =>
⋮----
var p = m.GetParameters();
⋮----
&& typeof(Thing).IsAssignableFrom(p[0].ParameterType)
⋮----
&& p[2].ParameterType == typeof(string).MakeByRefType()
⋮----
// Postfix uses generic object parameters because we patch multiple overloads.
static void Postfix(ref bool __result, object __0, object __1)
⋮----
// Fast exits
⋮----
// Only care for things that vanilla considers weapons
⋮----
// Only affect pacifists (WorkTags.Violent disabled)
⋮----
if (!pawn.WorkTagIsDisabled(WorkTags.Violent)) return;
⋮----
// Unexpected pawn state â€” be conservative
⋮----
// Only our survival tools (via mod extension)
var ext = SurvivalToolProperties.For(def);
⋮----
// Respect normal vanilla restrictions
if (thing.IsForbidden(pawn)) return;
⋮----
// Passed all checks â€” allow equip for pacifist
⋮----
// Royalty-safe biocode check.
private static bool IsBiocodedForDifferentPawn(Thing t, Pawn pawn)
⋮----
// If something odd happens with a modded comp, be conservative
⋮----
// --------------------------------------------------------------------
// Part 2: Float menu providers (1.6 pipeline) for UNDRAFTED and DRAFTED
⋮----
/// <summary>Shared logic for both providers.</summary>
public abstract class FloatMenuOptionProvider_PacifistEquipToolsBase : FloatMenuOptionProvider
⋮----
// In 1.6 these are abstract and PROTECTED on the base class.
⋮----
protected override bool Multiselect => true; // allow multi-select contexts
⋮----
public override bool Applies(FloatMenuContext context)
⋮----
// At least one humanlike pacifist in this drafted state
return context.ValidSelectedPawns.Any(p =>
⋮----
p.WorkTagIsDisabled(WorkTags.Violent) &&
⋮----
public override bool TargetThingValid(Thing t, FloatMenuContext context)
⋮----
public override IEnumerable<FloatMenuOption> GetOptionsFor(Thing t, FloatMenuContext context)
⋮----
Pawn pawn = context.ValidSelectedPawns.FirstOrDefault(p =>
⋮----
p.CanReach(t, PathEndMode.ClosestTouch, Danger.Deadly) &&
p.CanReserve(t) &&
!t.IsForbidden(p));
⋮----
// --- Equip option ---
⋮----
string label = "Equip".Translate(t.LabelShort);
Action act = () =>
⋮----
if (pawn.DestroyedOrNull() || t.DestroyedOrNull()) return;
var job = JobMaker.MakeJob(JobDefOf.Equip, t);
⋮----
pawn.jobs.TryTakeOrderedJob(job, JobTag.Misc);
⋮----
yield return FloatMenuUtility.DecoratePrioritizedTask(
new FloatMenuOption(label, act, MenuOptionPriority.High, null, t),
⋮----
// --- Take to inventory option (let pacifists carry without equipping) ---
⋮----
// Prefer existing translation key if present; fallback to a simple composite string
⋮----
invLabel = "TakeToInventory".Translate(t.LabelShort);
⋮----
invLabel = "Take to inventory".TranslateSimple() + ": " + t.LabelShort;
⋮----
Action actInv = () =>
⋮----
var job = JobMaker.MakeJob(JobDefOf.TakeInventory, t);
⋮----
new FloatMenuOption(invLabel, actInv, MenuOptionPriority.Default, null, t),
⋮----
/// <summary>Provider shown while pawns are UNDRAFTED.</summary>
public sealed class FloatMenuOptionProvider_PacifistEquipTools_Undrafted
: FloatMenuOptionProvider_PacifistEquipToolsBase
⋮----
/// <summary>Provider shown while pawns are DRAFTED.</summary>
public sealed class FloatMenuOptionProvider_PacifistEquipTools_Drafted
</file>

<file path="Source/Harmony/Patch_ToolInvalidation.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_ToolInvalidation.cs
// Legacy Invalidation Patches for Tool Stat Cache.
// Ensures that when tools are damaged, destroyed, created, or moved,
// any cached tool stat entries are invalidated so they will be recomputed on next use.
// Is this still needed with the new centralized ToolStatResolver and its hardened caching?
// Possibly yes, as a safety net to ensure no stale entries linger.
⋮----
public static class Patch_ToolInvalidation
⋮----
var harmony = new Harmony("com.jellypowered.survivaltools.invalidation");
// Patch Thing.TakeDamage(DamageInfo)
var takeDamage = AccessTools.Method(typeof(Thing), "TakeDamage", new Type[] { typeof(DamageInfo) });
⋮----
harmony.Patch(takeDamage, postfix: new HarmonyMethod(typeof(Patch_ToolInvalidation).GetMethod(nameof(Postfix_Thing_TakeDamage), System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static)));
// Patch Thing.Destroy(DestroyMode)
var destroy = AccessTools.Method(typeof(Thing), "Destroy", new Type[] { typeof(DestroyMode) });
⋮----
harmony.Patch(destroy, postfix: new HarmonyMethod(typeof(Patch_ToolInvalidation).GetMethod(nameof(Postfix_Thing_Destroy), System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static)));
// Patch ThingMaker.MakeThing(ThingDef, ThingDef)
var makeThing = AccessTools.Method(typeof(ThingMaker), "MakeThing", new Type[] { typeof(ThingDef), typeof(ThingDef) });
⋮----
harmony.Patch(makeThing, postfix: new HarmonyMethod(typeof(Patch_ToolInvalidation).GetMethod(nameof(Postfix_ThingMaker_MakeThing), System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static)));
// Patch Pawn_EquipmentTracker add/remove methods if present
var eqType = AccessTools.TypeByName("Pawn_EquipmentTracker");
⋮----
var add = AccessTools.Method(eqType, "AddEquipment");
⋮----
harmony.Patch(add, postfix: new HarmonyMethod(typeof(Patch_ToolInvalidation).GetMethod(nameof(Postfix_Equipment_Changed), System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static)));
var remove = AccessTools.Method(eqType, "RemoveEquipment");
⋮----
harmony.Patch(remove, postfix: new HarmonyMethod(typeof(Patch_ToolInvalidation).GetMethod(nameof(Postfix_Equipment_Changed), System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Static)));
⋮----
// best-effort
⋮----
// Postfix for Thing.TakeDamage
private static void Postfix_Thing_TakeDamage(Thing __instance, DamageInfo dinfo)
⋮----
// Only log if this thing is a SurvivalTool or a tool-stuff (has SurvivalToolProperties)
⋮----
var mapName = __instance.Map != null ? __instance.Map.ToString() : "(none)";
⋮----
// If the thing was destroyed or fell to 0 HP, invalidate related cache entries
⋮----
SurvivalToolUtility.ToolFactorCache.InvalidateForThing(__instance);
try { SurvivalToolUtility.ClearCountersForThing(__instance); } catch { }
⋮----
// Postfix for Thing.Destroy
private static void Postfix_Thing_Destroy(Thing __instance, DestroyMode mode)
⋮----
// Skip logging for virtual tools created by UI (they have no map and no parent holder)
⋮----
// If the thing was held by a pawn (equipment or inventory), include holder info
⋮----
Pawn holderPawn = null;
⋮----
// If a pawn holder exists and the pawn is allowed to use survival tools
// (i.e., not blacklisted), append holder info. Otherwise fallback to standard log.
⋮----
if (PawnToolValidator.CanUseSurvivalTools(holderPawn))
⋮----
catch { /* best-effort: if validator throws, don't include holder info */ }
⋮----
// Postfix for ThingMaker.MakeThing
private static void Postfix_ThingMaker_MakeThing(Thing __result)
⋮----
// Don't log creation of virtual tools (they'll be destroyed shortly for UI display)
// Virtual tools have no map and no parent holder initially
⋮----
// If a new tool or tool-stuff was created by crafting, invalidate its key so
// any cached entries will be recomputed on first use (safe and conservative).
if (__result.def != null && (__result.def.IsSurvivalTool() || __result.def.IsToolStuff()))
⋮----
SurvivalToolUtility.ToolFactorCache.InvalidateForThing(__result);
try { SurvivalToolUtility.ClearCountersForThing(__result); } catch { }
⋮----
// Generic postfix used for equipment add/remove patches
private static void Postfix_Equipment_Changed(ThingWithComps equipment)
⋮----
// Debug log to help verify that the reflection-based equipment patches are attached and firing.
⋮----
// Only log equipment changes for survival tools / tool-stuffs
⋮----
LogDecision($"Equipment_Changed_{equipment.GetHashCode()}", $"[SurvivalTools.Debug] Equipment changed: {equipment.def?.defName ?? "null"} on pawn {pawnLabel}");
⋮----
SurvivalToolUtility.ToolFactorCache.InvalidateForThing(equipment);
try { SurvivalToolUtility.ClearCountersForThing(equipment); } catch { }
</file>

<file path="Source/Helpers/ConditionalRegistration.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/ConditionalRegistration.cs
// Needed for conditional registration/deregistration of features
// (currently only tree felling) based on settings and compat checks.
// KEEP but update to match refactored code base if needed.
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Handles conditional registration/deregistration of SurvivalTools features
/// (currently only tree felling) based on settings and compat checks.
///
/// ðŸ”® Future: This can be expanded into a general-purpose feature toggle system.
///    Example: gating medical tool usage, research tool requirements, etc.,
///    with helpers to both disable and re-enable features at runtime instead of
///    only removing WorkGivers.
/// </summary>
public static class ConditionalRegistration
⋮----
public static void ApplyTreeFellingConditionals()
⋮----
ST_Logging.LogInfo($"[SurvivalTools] Applying tree felling conditionals: enabled={enabled}");
⋮----
private static void DisableTreeFellingFeatures()
⋮----
SafetyUtils.SafeExecute(() =>
⋮----
var fellTreesWG = DefDatabase<WorkGiverDef>.GetNamed("ST_FellTrees", errorOnFail: false);
⋮----
ST_Logging.LogInfo("[SurvivalTools] Disabled ST_FellTrees WorkGiver due to setting.");
⋮----
public static void ResetConditionals()
⋮----
public static bool IsTreeFellingEnabled()
⋮----
if (SeparateTreeChoppingHelpers.IsSeparateTreeChoppingActive() &&
SeparateTreeChoppingHelpers.HasTreeFellingConflict())
</file>

<file path="Source/Helpers/JobDefToWorkGiverDefHelper.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/JobDefToWorkGiverDefHelper.cs
// TODO: Is this duplicate of other functionality in our mod?
// evaluate and consolidate if so.
⋮----
/// <summary>
/// Helper to map a JobDef to its associated WorkGiverDef.
/// Used in tool gating / stat checks when we need to trace
/// from the active job back to the workgiver logic that created it.
/// </summary>
public static class JobDefToWorkGiverDefHelper
⋮----
/// Explicit mappings (JobDef â†’ WorkGiverDef) for jobs where the link
/// is not obvious or where defName patterns are unreliable.
///
/// ðŸ”® Future: could be externalized to XML defs or settings for easier patching
/// by other mods (instead of hardcoding here).
⋮----
// Tree / plant harvesting
⋮----
// Mining
⋮----
// Construction (explicit)
{ "BuildRoof", "BuildRoofs" },   // vanilla 1.6
{ "RoofJob", "BuildRoofs" },     // legacy / some mods
// Hauling
⋮----
// Cleaning
⋮----
// Butchery
⋮----
// Research
⋮----
{ "FieldResearch", "Research" } // RR: extra job type
⋮----
/// Finds the WorkGiverDef that produces the given JobDef, if any.
⋮----
/// Order of resolution:
///  1. Check explicit hardcoded mapping table.
///  2. Special-case fallbacks (construction, RR jobs, plants, etc).
///  3. Heuristic: match job defName against WorkGiver defName or label.
⋮----
/// Returns null if nothing reasonable can be found.
⋮----
public static WorkGiverDef GetWorkGiverDefForJob(JobDef jobDef)
⋮----
// Step 1: explicit mapping
if (ExplicitJobToWorkGiverMap.TryGetValue(jobDef.defName, out string wgDefName))
⋮----
// Emit one cooldown-protected log when roofing mapping is used so we can verify resolution
⋮----
return DefDatabase<WorkGiverDef>.GetNamedSilentFail(wgDefName);
⋮----
// Step 2: special-case fallbacks
var defName = jobDef.defName.ToLower();
// ðŸ”¨ Construction (catch-all: build, construct, roof, floor, blueprints, frames)
if (defName.Contains("construct") || defName.Contains("build") ||
defName.Contains("roof") || defName.Contains("floor") ||
defName.Contains("blueprint") || defName.Contains("frame"))
⋮----
return DefDatabase<WorkGiverDef>.GetNamedSilentFail("ConstructGeneral")
?? DefDatabase<WorkGiverDef>.GetNamedSilentFail("BuildRoofs")
?? DefDatabase<WorkGiverDef>.GetNamedSilentFail("ConstructDeliverResources");
⋮----
// ðŸ“– Research Reinvented â€“ fieldwork jobs
if (defName.Contains("fieldresearch") || defName.Contains("survey"))
return DefDatabase<WorkGiverDef>.GetNamedSilentFail("Research");
// ðŸŒ± Plant work (catch-all: sow, harvest, cut)
if (defName.Contains("sow"))
return DefDatabase<WorkGiverDef>.GetNamedSilentFail("GrowerSow");
if (defName.Contains("harvest"))
return DefDatabase<WorkGiverDef>.GetNamedSilentFail("GrowerHarvest");
if (defName.Contains("cutplant"))
return DefDatabase<WorkGiverDef>.GetNamedSilentFail("PlantsCut");
// Step 3: heuristic fallback (best effort)
⋮----
.FirstOrDefault(wg =>
⋮----
(wg.defName.ToLower().Contains(defName) ||
(!string.IsNullOrEmpty(wg.label) && wg.label.ToLower().Contains(defName))));
</file>

<file path="Source/Helpers/StatGatingHelper.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/StatGatingHelper.cs
// Legacy Code: But needs kept. Used by multiple other files.
// TODO: Evaluate if this can be merged into StatPart_SurvivalTool or SurvivalToolUtility.
⋮----
/// <summary>
/// Centralized logic for stat gating and WorkGiver → stat mapping.
/// Replaces scattered versions in SurvivalToolUtility, Validation, and Scanner patches.
/// </summary>
public static class StatGatingHelper
⋮----
/// Determines whether a stat should block a job for the given pawn under current settings.
/// Integrates with Research Reinvented (RR) so research jobs behave like before.
⋮----
// Unified gating rules (vanilla + RR intent)
public static bool ShouldBlockJobForStat(StatDef stat, SurvivalToolsSettings settings, Pawn pawn = null)
⋮----
// Never hard-block CleaningSpeed or WorkSpeedGlobal here - these are handled
// by StatPart_SurvivalTool as a penalty-based fallback and should not abort jobs.
⋮----
// Core work stats (mining, construction, etc.) always gate in hardcore.
if (StatFilters.ShouldBlockJobForMissingStat(stat))
⋮----
bool result = pawn == null || !pawn.HasSurvivalToolFor(stat);
// Debug logging for deconstruction decisions
⋮----
ST_Logging.LogDebug(msg, $"StatGate_Deconstruct_{pawnId}");
⋮----
// Optional families — only hard-gate if explicitly enabled or in extra-hardcore.
⋮----
return (xhc || settings.requireCleaningTools) && (pawn == null || !pawn.HasSurvivalToolFor(stat));
⋮----
return (xhc || settings.requireButcheryTools) && (pawn == null || !pawn.HasSurvivalToolFor(stat));
⋮----
return (xhc || settings.requireMedicalTools) && (pawn == null || !pawn.HasSurvivalToolFor(stat));
// Research is **not** hard-blocked in normal hardcore — job may run but progress=~0 via StatPart.
⋮----
return xhc && (pawn == null || !pawn.HasSurvivalToolFor(stat));
// Extra-hardcore custom rules (RR or future packs)
if (xhc && settings.IsStatRequiredInExtraHardcore(stat))
⋮----
ST_Logging.LogDebug(msg, $"StatGate_Deconstruct_XHC_{pawnId}");
⋮----
/// Detect required stats for a WorkGiver by extension or defName patterns.
/// Covers vanilla WorkGivers that lack WorkGiverExtension.
⋮----
public static List<StatDef> GetStatsForWorkGiver(WorkGiverDef wgDef)
⋮----
// 1) Explicit extension wins
⋮----
if (fromExtension != null && fromExtension.Any())
return fromExtension.Where(s => s != null && s.RequiresSurvivalTool()).ToList();
// 2) Heuristics by defName
⋮----
// Research
if (name.Contains("research"))
stats.Add(ST_StatDefOf.ResearchSpeed);
// Cleaning
if (name.Contains("clean"))
stats.Add(ST_StatDefOf.CleaningSpeed);
// Roofing is construction
// (RimWorld vanilla def is "BuildRoofs"; other mods may include "roof" in name)
if (name == "buildroofs" || name.Contains("roof"))
stats.Add(StatDefOf.ConstructionSpeed);
// Construction vs maintenance vs deconstruction
// Build / construct / frames / blueprints => ConstructionSpeed
if (name.Contains("construct") || name.Contains("build") || name.Contains("frame") || name.Contains("blueprint"))
⋮----
// Repair / maintain => MaintenanceSpeed
if (name.Contains("repair") || name.Contains("maintain") || name.Contains("maintenance"))
stats.Add(ST_StatDefOf.MaintenanceSpeed);
// Deconstruct / remove / uninstall => DeconstructionSpeed
if (name.Contains("deconstruct") || name.Contains("remove") || name.Contains("uninstall"))
stats.Add(ST_StatDefOf.DeconstructionSpeed);
// Trees & plants
if (name.Contains("felltree") || name.Contains("chopwood") || name.Contains("cutwood"))
stats.Add(ST_StatDefOf.TreeFellingSpeed);
if (name.Contains("harvest") || name.Contains("plantscut"))
stats.Add(ST_StatDefOf.PlantHarvestingSpeed);
if (name.Contains("grow") || name.Contains("sow") || name.Contains("plant"))
stats.Add(ST_StatDefOf.SowingSpeed);
// Mining
if (name.Contains("mine") || name.Contains("drill"))
⋮----
stats.Add(ST_StatDefOf.DiggingSpeed);
stats.Add(ST_StatDefOf.MiningYieldDigging);
⋮----
// Butchery
if (name.Contains("butcher") || name.Contains("slaughter"))
⋮----
stats.Add(ST_StatDefOf.ButcheryFleshSpeed);
stats.Add(ST_StatDefOf.ButcheryFleshEfficiency);
⋮----
// Keep only real survival-tool stats, unique
return stats.Where(s => s != null && s.RequiresSurvivalTool()).Distinct().ToList();
⋮----
/// Centralized BuildRoof gating helper.
/// Returns true if the pawn should be blocked from BuildRoof jobs under current settings.
/// Produces a small logKey suitable for ShouldLogWithCooldown when needed.
⋮----
public static bool ShouldBlockBuildRoof(Pawn pawn, out string logKey, IntVec3? cell = null)
⋮----
if (settings == null || settings.extraHardcoreMode != true) return false; // only hard-block in extra-hardcore
// Respect general pawn/tool capability (mechs, prisoners, etc.)
if (!PawnToolValidator.CanUseSurvivalTools(pawn)) return false;
// ConstructionSpeed is the canonical stat for roofing
⋮----
// Build a compact log key: include pawn id and optional cell coordinates
⋮----
/*
    📌 NOTE FOR FUTURE ME:
    Mining yield (ST_StatDefOf.MiningYieldDigging) should generally be treated as *optional*.
    Pawns without tools should still be able to mine, they’ll just be less efficient.
    If you want to enforce this cleanly, update StatFilters.cs like so:
        public static bool IsOptionalStat(StatDef stat)
        {
            if (stat == null) return true;
            // Research, cleaning, medical, and mining yield are optional
            return stat == ST_StatDefOf.ResearchSpeed ||
                   stat == ST_StatDefOf.CleaningSpeed ||
                   stat == ST_StatDefOf.MedicalOperationSpeed ||
                   stat == ST_StatDefOf.MedicalSurgerySuccessChance ||
                   stat == ST_StatDefOf.ButcheryFleshEfficiency ||
                   stat == ST_StatDefOf.MiningYieldDigging; // 👈 new optional stat
        }
    That way mining *speed* stays mandatory (hardcore tool gating), but *yield* just becomes a bonus.
*/
</file>

<file path="Source/Helpers/SurvivalToolValidation.cs">
// RimWorld 1.6 / C# 7.3
// Source/Helpers/SurvivalToolValidation.cs
⋮----
/// <summary>
/// Utility class for validating existing jobs when settings change
/// </summary>
public static class SurvivalToolValidation
⋮----
/// Manual test method to trigger job validation for debugging
⋮----
public static void TestValidation()
⋮----
/*
    FUTURE ME NOTE:
    Pawns sometimes start loading with an `Ingest` job that still tries to use CleaningSpeed 
    (e.g., eating while also flagged for cleaning). Job validation normally ignores Ingest 
    since it has no WorkGiverDef, so these slip through.
    This helper can be called in JobValidation.ValidateExistingJobs() after the normal loop.
    It cancels Ingest jobs that wrongly require CleaningSpeed but the pawn has no tool 
    (or when hardcore gating is enabled).
*/
/*private static void CancelBadIngestJobs(Map map)
        {
            if (map == null) return;
            foreach (var pawn in map.mapPawns.FreeColonistsSpawned)
            {
                var job = pawn.CurJob;
                if (job != null && job.def == JobDefOf.Ingest)
                {
                    // Check if gating is active AND pawn lacks cleaning tools
                    var s = SurvivalTools.Settings;
                    bool enforce = SurvivalToolUtility.IsHardcoreModeEnabled || (s != null && s.extraHardcoreMode);
                    if (enforce && StatGatingHelper.ShouldBlockJobForStat(ST_StatDefOf.CleaningSpeed, s, pawn))
                    {
                        pawn.jobs.EndCurrentJob(JobCondition.InterruptForced, true);
                        if (ST_Logging.IsDebugLoggingEnabled)
                            LogDebug($"[SurvivalTools.JobValidation] Cancelled bad Ingest job for {pawn.LabelShort} (required CleaningSpeed, no tool).", $"JobValidation_Cancel_{pawn.ThingID}");
                    }
                }
            }
        }*/
⋮----
/// Last-ditch safety net: cancels obviously invalid jobs that sometimes slip through
/// normal validation (e.g., Ingest with CleaningSpeed requirement).
/// Called once after game load, or manually if needed.
⋮----
private static void CancelBadJobs(Map map)
⋮----
// Snapshot pawns to avoid "collection modified" exceptions when ending jobs
var pawns = map.mapPawns.FreeColonistsSpawned.ToList();
⋮----
// Special case: Ingest job that wrongly uses CleaningSpeed
⋮----
StatGatingHelper.ShouldBlockJobForStat(ST_StatDefOf.CleaningSpeed, s, pawn))
⋮----
// End the job - Phase 6 PreWork_AutoEquip handles preventing restart
pawn.jobs.EndCurrentJob(JobCondition.InterruptForced, true);
// LEGACY REMOVED: Patch_Pawn_JobTracker_ExtraHardcore reflection code deleted
// Phase 6 JobGate system handles job blocking without needing per-pawn guards
// Use centralized debug logging with cooldown to avoid per-pawn spam
⋮----
// 📝 Future me: add other edge-case checks here if new jobs show up.
⋮----
/// Validates all existing jobs across all pawns when settings change.
/// Cancels jobs that require tools the pawns don't have in hardcore mode.
⋮----
public static void ValidateExistingJobs(string reason)
⋮----
.Where(p => p.CanUseSurvivalTools()).ToList();
⋮----
// Map JobDef to WorkGiverDef for gating logic
var workGiverDef = JobDefToWorkGiverDefHelper.GetWorkGiverDefForJob(currentJob.def);
⋮----
// Only gate jobs that are eligible and enabled in settings
if (!SurvivalToolUtility.ShouldGateByDefault(workGiverDef))
⋮----
// Respect settings toggle for WorkSpeedGlobal jobs
if (settings.workSpeedGlobalJobGating != null && settings.workSpeedGlobalJobGating.TryGetValue(workGiverDef.defName, out bool gated) && !gated)
⋮----
var requiredStats = SurvivalToolUtility.RelevantStatsFor(null, currentJob.def);
if (requiredStats.NullOrEmpty())
⋮----
LogDebug($"[SurvivalTools.JobValidation] Required stats for {currentJob.def.defName}: {string.Join(", ", requiredStats.Select(s => s.defName))}", $"JobValidation_Stats_{currentJob.def.defName}");
⋮----
// ✅ Unified gating logic via StatGatingHelper
bool shouldBlock = StatGatingHelper.ShouldBlockJobForStat(stat, settings, pawn);
LogDebug($"[SurvivalTools.JobValidation] Stat {stat.defName}: shouldBlock={shouldBlock}, hasTool={pawn.HasSurvivalToolFor(stat)}", $"JobValidation_Stat_{pawn.ThingID}_{currentJob.def.defName}_{stat.defName}");
⋮----
pawn.jobs.EndCurrentJob(JobCondition.Incompletable, startNewJob: true, canReturnToPool: true);
⋮----
Messages.Message(
⋮----
//CancelBadIngestJobs(map);
CancelBadJobs(map); // Catch all bad jobs blocker on load *FUTURE ME*
</file>

<file path="Source/SurvivalToolForcedHandler.cs">
// RimWorld 1.6 / C# 7.3
// Source/SurvivalToolForcedHandler.cs
// Legacy code: is this used by our new refactored tool management system?
// If not, we should remove it to reduce complexity and maintenance burden
// or integrate its functionality into the new system.
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Tracks tools the player has explicitly "forced" a pawn to keep.
/// </summary>
public class SurvivalToolForcedHandler : IExposable
⋮----
// We deliberately store Thing references; RimWorld's cross-ref resolver will rebind them on load.
⋮----
public void ExposeData()
⋮----
Scribe_Collections.Look(ref forcedTools, "forcedTools", LookMode.Reference);
⋮----
// Prune stale entries (null/destroyed) that can appear in old saves or when items were removed.
⋮----
forcedTools.RemoveAt(i);
⋮----
public bool IsForced(Thing tool)
⋮----
// If a destroyed thing remains, quietly remove it and treat as not forced.
⋮----
return forcedTools != null && forcedTools.Contains(tool);
⋮----
public bool AllowedToAutomaticallyDrop(Thing tool) => !IsForced(tool);
⋮----
public void SetForced(Thing tool, bool forced)
⋮----
if (!tool.Destroyed && !forcedTools.Contains(tool))
forcedTools.Add(tool);
⋮----
forcedTools.Remove(tool);
⋮----
public void Reset() => forcedTools?.Clear();
⋮----
// Expose the backing list for existing code that expects a mutable list.
</file>

<file path="Source/ToolAssignments/Dialog_ManageSurvivalToolAssignments.cs">
//RimWorld 1.6 / C# 7.3
// Source/ToolAssignments/Dialog_ManageSurvivalToolAssignments.cs
// Legacy code, we want to phase this out. Everything should be handled automatically by AssignmentSearch.cs
⋮----
namespace SurvivalTools
⋮----
public class Dialog_ManageSurvivalToolAssignments : Window
⋮----
private static ThingFilter survivalToolGlobalFilter;
private SurvivalToolAssignment selSurvivalToolAssignmentInt;
⋮----
survivalToolGlobalFilter = new ThingFilter();
survivalToolGlobalFilter.SetAllow(ST_ThingCategoryDefOf.SurvivalTools, true);
⋮----
private void EnsureSelectedHasName()
⋮----
if (selSurvivalToolAssignmentInt != null && selSurvivalToolAssignmentInt.label.NullOrEmpty())
⋮----
// Make sure we assign a string (TaggedString.ToString() -> string) so the conditional operator
// elsewhere also has a string result and we don't mix TaggedString/string types.
selSurvivalToolAssignmentInt.label = "Unnamed".Translate().ToString();
⋮----
public override Vector2 InitialSize => new Vector2(700f, 700f);
public override void DoWindowContents(Rect inRect)
⋮----
var rectSelect = new Rect(x, 0f, TopButtonWidth, TopButtonHeight);
⋮----
if (Widgets.ButtonText(rectSelect, "SelectSurvivalToolAssignment".Translate()))
⋮----
Messages.Message("NoSurvivalToolDatabase".Translate(), MessageTypeDefOf.RejectInput);
⋮----
opts.Add(new FloatMenuOption(local.label, () => SelectedSurvivalToolAssignment = local));
⋮----
Find.WindowStack.Add(new FloatMenu(opts));
⋮----
var rectNew = new Rect(x, 0f, TopButtonWidth, TopButtonHeight);
⋮----
if (Widgets.ButtonText(rectNew, "NewSurvivalToolAssignment".Translate(), active: true, doMouseoverSound: false, drawBackground: true))
⋮----
var created = db.MakeNewSurvivalToolAssignment();
⋮----
var rectDelete = new Rect(x, 0f, TopButtonWidth, TopButtonHeight);
if (Widgets.ButtonText(rectDelete, "DeleteSurvivalToolAssignment".Translate(), active: true, doMouseoverSound: false, drawBackground: true))
⋮----
opts.Add(new FloatMenuOption(local.label, () =>
⋮----
var rep = db.TryDelete(local);
⋮----
Messages.Message(rep.Reason, MessageTypeDefOf.RejectInput, historical: false);
⋮----
var mainRect = new Rect(0f, TopAreaHeight, inRect.width, inRect.height - TopAreaHeight - CloseButSize.y).ContractedBy(10f);
⋮----
Widgets.Label(mainRect, "NoSurvivalToolAssignmentSelected".Translate());
⋮----
GUI.BeginGroup(mainRect);
// Name field
var nameRect = new Rect(0f, 0f, 300f, 30f);
Widgets.Label(new Rect(nameRect.x, nameRect.y, 70f, nameRect.height), "Name".Translate() + ":");
var nameEditRect = new Rect(nameRect.x + 75f, nameRect.y, nameRect.width - 75f, nameRect.height);
// Only update the label if the text actually changed to avoid constant writes.
var newName = Widgets.TextField(nameEditRect, nameBuffer ?? string.Empty, 64);
⋮----
// Ensure both branches of the ?: are the same type (string) to avoid C# 7.3 conditional typing issues.
SelectedSurvivalToolAssignment.label = nameBuffer.NullOrEmpty()
? "Unnamed".Translate().ToString()
⋮----
// Filter config
var filterRect = new Rect(0f, TopAreaHeight, 300f, mainRect.height - 45f - 10f);
⋮----
// Use UIState rather than Vector2
ThingFilterUI.DoThingFilterConfigWindow(filterRect, filterUiState, filter, parentFilter, openMask);
GUI.EndGroup();
⋮----
public override void PreClose()
⋮----
base.PreClose();
</file>

<file path="Source/ToolAssignments/PawnColumnWorker_SurvivalToolAssignment.cs">
// Rimworld 1.6 / C# 7.3
// Source/ToolAssignments/PawnColumnWorker_SurvivalToolAssignment.cs
// Legacy code: needs review and evaluation for deletion.
⋮----
namespace SurvivalTools
⋮----
public sealed class PawnColumnWorker_SurvivalToolAssignment : PawnColumnWorker
⋮----
public override void DoHeader(Rect rect, PawnTable table)
⋮----
base.DoHeader(rect, table);
var manageRect = new Rect(rect.x, rect.y + (rect.height - 65f), Mathf.Min(rect.width, 360f), 32f);
if (Widgets.ButtonText(manageRect, "ManageSurvivalToolAssignments".Translate()))
⋮----
Find.WindowStack.Add(new Dialog_ManageSurvivalToolAssignments(null));
⋮----
public override void DoCell(Rect rect, Pawn pawn, PawnTable table)
⋮----
int leftWidth = Mathf.FloorToInt((rect.width - 4f) * 0.71428573f);
int rightWidth = Mathf.FloorToInt((rect.width - 4f) * 0.2857143f);
⋮----
// Selection dropdown
var ddRect = new Rect(curX, rect.y + 2f, leftWidth, rect.height - 4f);
⋮----
var buttonLabel = (tracker.CurrentSurvivalToolAssignment?.label ?? "Unnamed").Truncate(ddRect.width);
Widgets.Dropdown(
⋮----
// Clear forced tools button (if any)
⋮----
var clearRect = new Rect(curX, rect.y + 2f, rightWidth, rect.height - 4f);
if (Widgets.ButtonText(clearRect, "ClearForcedApparel".Translate()))
⋮----
tracker.forcedHandler.Reset();
⋮----
TooltipHandler.TipRegion(clearRect, new TipSignal(() =>
⋮----
var text = "ForcedSurvivalTools".Translate() + ":\n";
⋮----
}, pawn.GetHashCode() * 128));
⋮----
// Edit current assignment
var editRect = new Rect(curX, rect.y + 2f, rightWidth, rect.height - 4f);
if (Widgets.ButtonText(editRect, "AssignTabEdit".Translate()))
⋮----
Find.WindowStack.Add(new Dialog_ManageSurvivalToolAssignments(tracker.CurrentSurvivalToolAssignment));
⋮----
private IEnumerable<Widgets.DropdownMenuElement<SurvivalToolAssignment>> Button_GenerateMenu(Pawn pawn)
⋮----
option = new FloatMenuOption(local.label, () =>
⋮----
public override int GetMinWidth(PawnTable table) =>
Mathf.Max(base.GetMinWidth(table), Mathf.CeilToInt(194f));
public override int GetOptimalWidth(PawnTable table) =>
Mathf.Clamp(Mathf.CeilToInt(251f), GetMinWidth(table), GetMaxWidth(table));
public override int GetMinHeaderHeight(PawnTable table) =>
Mathf.Max(base.GetMinHeaderHeight(table), PawnColumnWorker_Outfit.TopAreaHeight);
public override int Compare(Pawn a, Pawn b) =>
GetValueToCompare(a).CompareTo(GetValueToCompare(b));
private int GetValueToCompare(Pawn pawn)
</file>

<file path="Source/ToolAssignments/SurvivalToolAssignment.cs">
// Rimworld 1.6 / C# 7.3
// Source/ToolAssignments/SurvivalToolAssignment.cs
// Legacy code: needs review and evaluation for deletion without breaking saves.
⋮----
namespace SurvivalTools
⋮----
public class SurvivalToolAssignment : IExposable, ILoadReferenceable
⋮----
public ThingFilter filter = new ThingFilter();
⋮----
this.label = string.IsNullOrEmpty(label) ? "Unnamed" : label;
if (filter == null) filter = new ThingFilter();
⋮----
public void ExposeData()
⋮----
Scribe_Values.Look(ref uniqueId, "uniqueId", 0);
Scribe_Values.Look(ref label, "label", "Unnamed");
Scribe_Deep.Look(ref filter, "filter");
⋮----
if (string.IsNullOrEmpty(label)) label = "Unnamed";
⋮----
// ILoadReferenceable: keep a stable reference key independent of label changes
public string GetUniqueLoadID() => $"SurvivalToolAssignment_{uniqueId}";
public override string ToString() => $"{label} (ID: {uniqueId})";
// QoL helpers (non-breaking)
public string LabelCap => (label ?? "Unnamed").CapitalizeFirst();
public bool Allows(Thing t) => filter != null && t != null && filter.Allows(t);
public void Rename(string newLabel) => label = string.IsNullOrEmpty(newLabel) ? "Unnamed" : newLabel.Trim();
</file>

<file path="Source/ToolUtility.cs">
// RimWorld 1.6 / C# 7.3
// Source/ToolUtility.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Defines the types of survival tools available.
/// </summary>
⋮----
/// Utility methods for survival tool identification, selection, and job-to-tool mapping.
⋮----
public static class ToolUtility
⋮----
// Tool type to stat mappings (lazy initialized to avoid early DefOf access)
⋮----
private static StatDef[] Stats_Saw => _stats_Saw ?? (_stats_Saw = new[] { ST_StatDefOf.DeconstructionSpeed }); // optional alias for deconstruction
private static IEnumerable<StatDef> StatsForKind(STToolKind kind)
⋮----
private static STToolKind KindForStats(IEnumerable<StatDef> stats)
⋮----
var set = new HashSet<StatDef>(stats.Where(s => s != null));
if (set.Overlaps(Stats_Pick)) return STToolKind.Pick;
if (set.Overlaps(Stats_Axe)) return STToolKind.Axe;
if (set.Overlaps(Stats_Sickle)) return STToolKind.Sickle;
if (set.Overlaps(Stats_Hoe)) return STToolKind.Hoe;
if (set.Overlaps(Stats_Hammer)) return STToolKind.Hammer;
if (set.Overlaps(Stats_Wrench)) return STToolKind.Wrench;
if (set.Overlaps(Stats_Cleaning)) return STToolKind.Cleaning;
if (set.Overlaps(Stats_Medical)) return STToolKind.Medical;
if (set.Overlaps(Stats_Research)) return STToolKind.Research;
if (set.Overlaps(Stats_Knife)) return STToolKind.Knife;
if (set.Overlaps(Stats_Saw)) return STToolKind.Saw;
⋮----
/// Public wrapper to determine the STToolKind implied by a set of StatDefs.
/// Used by other modules that only have stat lists available.
⋮----
public static STToolKind ToolKindForStats(IEnumerable<StatDef> stats)
⋮----
private static bool Overlaps(this HashSet<StatDef> a, IEnumerable<StatDef> b) =>
b != null && b.Any(a.Contains);
⋮----
/// Determines whether a Thing should be treated as a virtual survival tool.
/// Virtual tools are non-SurvivalTool Things (usually stuff/material stacks) that
/// provide survival tool work stats via SurvivalToolProperties or statBases.
/// Unlike real SurvivalTool instances they are transient wrappers at runtime.
⋮----
public static bool IsVirtualTool(Thing t)
⋮----
// Already an actual SurvivalTool instance (includes VirtualSurvivalTool subclass) => not virtual by this predicate.
if (t is SurvivalTool) return t is VirtualTool; // Only treat the dedicated wrapper subclass as virtual.
⋮----
// Must NOT be minified buildings, corpses, pawns, plants, filth, chunks, apparel, weapons, ingestibles etc.
// Fast negative filters to avoid misclassification in hauling / reservation systems.
// Fast negatives; avoid reflection or expensive checks. Exclude ingestibles (raw food, meals), apparel, weapons, corpses, plants, filth.
⋮----
// If def is explicitly a SurvivalTool (thingClass assignable) it's not a virtual tool.
if (typeof(SurvivalTool).IsAssignableFrom(def.thingClass)) return false;
// Require mod extension or statBases with survival tool stats.
⋮----
bool hasExtFactors = ext?.baseWorkStatFactors != null && ext.baseWorkStatFactors.Any(m => m?.stat != null && m.value != 0f);
// Also consider statBases providing survival tool stats directly (e.g., WorkSpeedGlobal tool-stuff patches)
⋮----
// Heuristic: if stat requires a survival tool or is one of known survival tool stats.
if (sb.stat.defName.StartsWith("ST_")) { hasRelevantStatBase = true; break; }
⋮----
// Material / stuff items: prefer IsToolStuff extension when available to narrow.
if (def.IsToolStuff()) return true;
// Fallback: ensure it's a small haulable resource (category Item) to avoid buildings.
⋮----
/// Attempt to wrap a qualifying Thing as a VirtualTool; returns null if not virtual.
/// Centralized to avoid scattered FromThing calls and repeated predicate logic.
⋮----
public static VirtualTool TryWrapVirtual(Thing thing)
⋮----
return VirtualTool.FromThing(thing);
⋮----
/// Determine tool kind by defName/label and, for tool-stuff, by its SurvivalToolProperties stats.
⋮----
public static STToolKind ToolKindOf(Thing t)
⋮----
// Tool-stuff: infer kind from provided stats
if (t.def.IsToolStuff())
⋮----
var stats = props.baseWorkStatFactors.Where(m => m?.stat != null).Select(m => m.stat).ToList();
⋮----
// Specifics before generics (avoid "pickaxe" -> axe)
if (s.Contains("pickaxe") || s.Contains("pick")) return STToolKind.Pick;
if (s.Contains("sickle")) return STToolKind.Sickle;
if (s.Contains("hammer") || s.Contains("mallet")) return STToolKind.Hammer;
if (s.Contains("wrench") || s.Contains("prybar") || s.Contains("primitivelever")) return STToolKind.Wrench;
if (s.Contains("hatchet")) return STToolKind.Axe;
if (s.Contains("axe")) return STToolKind.Axe;
if (s.Contains("hoe")) return STToolKind.Hoe;
if (s.Contains("saw")) return STToolKind.Saw;
if (s.Contains("knife")) return STToolKind.Knife;
// Research
if (s.Contains("microscope") || s.Contains("telescope") || s.Contains("sextant") ||
s.Contains("calculator") || s.Contains("computer") || s.Contains("analyzer") ||
s.Contains("scanner") || s.Contains("spectrometer") || s.Contains("datapad") ||
s.Contains("tablet") || s.Contains("laptop")) return STToolKind.Research;
// Medical
if (s.Contains("scalpel") || s.Contains("forceps") || s.Contains("stethoscope") ||
s.Contains("syringe") || s.Contains("surgical") || s.Contains("medkit")) return STToolKind.Medical;
// Cleaning via properties on any ThingWithComps
⋮----
bool hasClean = props2.baseWorkStatFactors.Any(m => m?.stat == ST_StatDefOf.CleaningSpeed);
bool hasMed = props2.baseWorkStatFactors.Any(m => m?.stat == ST_StatDefOf.MedicalOperationSpeed || m?.stat == ST_StatDefOf.MedicalSurgerySuccessChance);
if (hasMed) return STToolKind.Medical;  // fix: medical should not fall through to cleaning
⋮----
// Traditional cleaning names
if (s.Contains("broom") || s.Contains("mop") || s.Contains("rags") ||
s.Contains("sponge") || s.Contains("towel")) return STToolKind.Cleaning;
// Known fabrics we patch as tool-stuff for cleaning/research/medical
⋮----
/// True if this Thing is a survival tool (real tool, tool-stuff, or recognized by name).
⋮----
public static bool IsSurvivalTool(Thing t)
⋮----
// Prefer comp detection (keeps compatibility without hard deps on the actual comp type)
if (t is ThingWithComps twc && twc.AllComps.Any(c => c.GetType().Name.Contains("CompSurvivalTool")))
⋮----
/// Expected tool kind for a job. Prefers stat-based mapping, falls back to name heuristics.
⋮----
public static STToolKind ExpectedToolFor(Pawn pawn, Job job)
⋮----
// 1) Stat-based mapping (more reliable & mod-friendly)
var stats = SurvivalToolUtility.StatsForJob(job.def, pawn);
⋮----
// 2) Heuristic fallback (names/driver)
⋮----
string s = (jn + "|" + driver + "|" + curDrv).ToLowerInvariant();
if (s.Contains("mine") || s.Contains("drill")) return STToolKind.Pick;
if (s.Contains("construct") || s.Contains("frame") || s.Contains("smooth") ||
s.Contains("buildroof") || s.Contains("removeroof") || s.Contains("build") ||
s.Contains("deliver") || s.Contains("install")) return STToolKind.Hammer;
if (s.Contains("repair") || s.Contains("maintain") || s.Contains("maintenance") ||
s.Contains("fixbroken") || s.Contains("tendmachine") || s.Contains("fix")) return STToolKind.Wrench;
if (s.Contains("uninstall") || s.Contains("deconstruct") || s.Contains("teardown")) return STToolKind.Wrench;
if (s.Contains("plantcut") || s.Contains("cutplant") || s.Contains("chop") || s.Contains("prune")) return STToolKind.Sickle;
if (s.Contains("sow") || s.Contains("plantsow") || s.Contains("plantgrow")) return STToolKind.Hoe;
if (s.Contains("harvest")) return STToolKind.Sickle;
if (s.Contains("clean") || s.Contains("sweep") || s.Contains("mop")) return STToolKind.Cleaning;
if (s.Contains("medical") || s.Contains("surgery") || s.Contains("operate") ||
s.Contains("tend") || s.Contains("doctor")) return STToolKind.Medical;
if (s.Contains("research") || s.Contains("study") || s.Contains("analyze")) return STToolKind.Research;
⋮----
/// Select the most appropriate inventory item for the pawn's current job.
/// Prefers items (tools or tool-stuff) that actually provide the expected stat(s).
⋮----
public static Thing TryGetActiveTool(Pawn pawn)
⋮----
var wantedStats = StatsForKind(expectedKind).ToList();
// Pass A: tool-stuff (materials) with matching stats
⋮----
if (!item.def.IsToolStuff()) continue;
⋮----
if (props.baseWorkStatFactors.Any(m => m?.stat != null && wantedStats.Contains(m.stat)))
⋮----
// Pass B: real tools that have the required stats
⋮----
if (st.WorkStatFactors.Any(m => m?.stat != null && wantedStats.Contains(m.stat)))
⋮----
// Pass C: exact kind name heuristic
⋮----
// Pass D: soft fallbacks between related kinds (respect hardcore limits)
</file>

<file path="1.6/Defs/Stats/Stats_Pawn_WorkGeneral.xml">
<Defs>
    <!-- Tool Carrying Capacity -->
    <StatDef>
        <defName>SurvivalToolCarryCapacity</defName>
        <label>tool carrying capacity</label>
        <description>Determines the maximum number of tools this colonist can effectively carry and manage in their personal inventory. Higher capacity allows for greater versatility and preparedness, enabling colonists to handle multiple types of work without constantly returning to storage. Tool belts and similar equipment can increase this limit beyond the base value.</description>
        <category>PawnWork</category>
        <displayPriorityInCategory>100</displayPriorityInCategory>
        <defaultBaseValue>2</defaultBaseValue>
        <minValue>0</minValue>
        <showOnAnimals>false</showOnAnimals>
        <showOnMechanoids>false</showOnMechanoids>
    </StatDef>
    <!-- Mining-related -->
    <StatDef>
        <defName>DiggingSpeed</defName>
        <label>digging speed</label>
        <description>Measures how quickly this colonist can excavate walls, break through rock formations, and extract materials from solid stone. Critical for mining operations, tunnel construction, and accessing buried resources. Without proper tools (pickaxes), this task becomes extremely difficult or impossible in hardcore modes.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Mining</skill>
                <baseValue>0.04</baseValue>
                <bonusPerLevel>0.12</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.5</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <scenarioRandomizable>true</scenarioRandomizable>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
        <postProcessCurve>
            <points>
                <li>(0, 0)</li>
                <li>(0.00001, 0.10)</li>
                <li>(0.04, 0.10)</li>
                <li>(0.10, 0.10)</li>
                <li>(99999, 99999)</li>
            </points>
        </postProcessCurve>
    </StatDef>
    <StatDef>
        <defName>MiningYieldDigging</defName>
        <label>mining yield (digging)</label>
        <description>Determines what percentage of available mineral resources this colonist successfully extracts when mining walls and rock formations. Higher yields mean less waste and more efficient resource gathering. Quality mining tools significantly improve extraction efficiency. This stat only affects wall mining operations and doesn't influence rock chunk production from other sources.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <maxValue>1</maxValue>
        <toStringStyle>PercentZero</toStringStyle>
        <skillNeedFactors>
            <li Class="SkillNeed_Direct">
                <skill>Mining</skill>
                <valuesPerLevel>
                    <li>0.6</li>
                    <li>0.7</li>
                    <li>0.8</li>
                    <li>0.85</li>
                    <li>0.9</li>
                    <li>0.925</li>
                    <li>0.95</li>
                    <li>0.975</li>
                    <li>1</li>
                    <li>1.01</li>
                    <li>1.02</li>
                    <li>1.03</li>
                    <li>1.04</li>
                    <li>1.05</li>
                    <li>1.06</li>
                    <li>1.07</li>
                    <li>1.08</li>
                    <li>1.09</li>
                    <li>1.10</li>
                    <li>1.12</li>
                    <li>1.13</li>
                </valuesPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.2</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <!-- Plant-related -->
    <StatDef>
        <defName>PlantHarvestingSpeed</defName>
        <label>plant harvesting speed</label>
        <description>Determines how efficiently this colonist can gather crops, berries, and other harvestable plant materials. Proper harvesting tools like sickles dramatically improve both speed and yield, ensuring maximum food production from available plants. Essential for maintaining sustainable food supplies and managing large agricultural operations.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <neverDisabled>true</neverDisabled>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Plants</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <StatDef>
        <defName>SowingSpeed</defName>
        <label>sowing speed</label>
        <description>Measures the efficiency with which this colonist can plant seeds and establish new crops. Specialized planting tools like hoes ensure proper soil preparation and optimal seed placement, leading to better germination rates and crop establishment. Critical for expanding agricultural operations and food security.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <neverDisabled>true</neverDisabled>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Plants</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <StatDef>
        <defName>TreeFellingSpeed</defName>
        <label>tree felling speed</label>
        <description>Determines how quickly this colonist can cut down trees and process large woody vegetation. Axes and similar cutting tools are absolutely essential for efficient forestry operations. Without proper tools, tree felling becomes extremely slow or impossible in hardcore modes, making this stat critical for wood production and land clearing.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <neverDisabled>true</neverDisabled>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Plants</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <!-- Maintenance and repair-related -->
    <StatDef>
        <defName>MaintenanceSpeed</defName>
        <label>maintenance speed</label>
        <description>Measures how efficiently this colonist can repair, maintain, and service buildings, equipment, and mechanical devices. Proper maintenance tools like wrenches and repair kits are essential for keeping colony infrastructure in optimal condition. Regular maintenance prevents costly breakdowns and extends equipment lifespan significantly.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Construction</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.5</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <StatDef>
        <defName>DeconstructionSpeed</defName>
        <label>deconstruction speed</label>
        <description>Determines how rapidly this colonist can safely dismantle structures, equipment, and buildings to recover valuable materials. Proper deconstruction tools ensure maximum material recovery while minimizing waste and preventing accidental damage. Essential for resource management and colony reorganization efforts.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Construction</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <!-- Research-related -->
    <StatDef>
        <defName>ResearchSpeed</defName>
        <label>research speed</label>
        <description>The speed at which this person conducts research and experiments.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Intellectual</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>0.8</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>1</weight>
                <max>1</max>
            </li>
            <li>
                <capacity>Consciousness</capacity>
                <weight>1</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <!-- Cleaning-related -->
    <StatDef>
        <defName>CleaningSpeed</defName>
        <label>cleaning speed</label>
        <description>The speed at which this person cleans filth and debris. Anyone can clean, but it's much faster with proper tools.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Moving</capacity>
                <weight>0.5</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <!-- Medical-related -->
    <StatDef>
        <defName>MedicalOperationSpeed</defName>
        <label>medical operation speed</label>
        <description>The speed at which this person performs medical operations and surgery.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Medicine</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.8</weight>
                <max>1</max>
            </li>
            <li>
                <capacity>Consciousness</capacity>
                <weight>0.5</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <StatDef>
        <defName>MedicalSurgerySuccessChance</defName>
        <label>medical surgery success chance</label>
        <description>The likelihood that this person's medical operations will succeed without complications.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <maxValue>2</maxValue>
        <toStringStyle>PercentZero</toStringStyle>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Medicine</skill>
                <baseValue>0.5</baseValue>
                <bonusPerLevel>0.075</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.8</weight>
                <max>1</max>
            </li>
            <li>
                <capacity>Consciousness</capacity>
                <weight>0.8</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <!-- Butchery-related -->
    <StatDef>
        <defName>ButcheryFleshSpeed</defName>
        <label>butchery speed</label>
        <description>The speed at which this person butchers animals and processes meat.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <statFactors>
            <li>WorkSpeedGlobal</li>
        </statFactors>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Cooking</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.115</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <StatDef>
        <defName>ButcheryFleshEfficiency</defName>
        <label>butchery efficiency</label>
        <description>The amount of meat and other products this person can extract from animal carcasses.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <maxValue>2</maxValue>
        <toStringStyle>PercentZero</toStringStyle>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Cooking</skill>
                <baseValue>0.5</baseValue>
                <bonusPerLevel>0.075</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>0.8</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.5</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
    <!-- General Work Speed (for crafting, etc.) -->
    <StatDef>
        <defName>WorkSpeedGlobal</defName>
        <label>general work speed</label>
        <description>The general speed at which this person works at crafting, cooking, and other production tasks. Proper tools can significantly improve efficiency for various types of work that don't have specialized speed stats.</description>
        <category>PawnWork</category>
        <defaultBaseValue>1</defaultBaseValue>
        <minValue>0</minValue>
        <toStringStyle>PercentZero</toStringStyle>
        <neverDisabled>true</neverDisabled>
        <skillNeedFactors>
            <li Class="SkillNeed_BaseBonus">
                <skill>Crafting</skill>
                <baseValue>0.08</baseValue>
                <bonusPerLevel>0.085</bonusPerLevel>
            </li>
        </skillNeedFactors>
        <capacityFactors>
            <li>
                <capacity>Manipulation</capacity>
                <weight>1</weight>
            </li>
            <li>
                <capacity>Sight</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
            <li>
                <capacity>Consciousness</capacity>
                <weight>0.3</weight>
                <max>1</max>
            </li>
        </capacityFactors>
        <parts>
            <li Class="SurvivalTools.Stats.StatPart_SurvivalTools" />
        </parts>
    </StatDef>
</Defs>
</file>

<file path="Source/AI/JobDriver_DropSurvivalTool.cs">
// Rimworld 1.6 / C# 7.3
// Source/AI/JobDriver_DropSurvivalTool.cs
⋮----
namespace SurvivalTools
⋮----
public class JobDriver_DropSurvivalTool : JobDriver
⋮----
public override bool TryMakePreToilReservations(bool errorOnFailed) => true;
protected override IEnumerable<Toil> MakeNewToils()
⋮----
this.FailOnDestroyedOrNull(TargetIndex.A);
yield return Toils_General.Wait(DurationTicks, TargetIndex.None);
yield return Toils_General.DoAtomic(() =>
⋮----
var backing = SurvivalToolUtility.BackingThing(toolAsSurvival, pawn) ?? ToolToDrop;
⋮----
// Prefer exact reference match, fallback to def match
Thing inventoryInstance = null;
⋮----
inventoryInstance = inv.FirstOrDefault(t => t == backing);
⋮----
inventoryInstance = inv.FirstOrDefault(t => t.def == backing.def && t.stackCount > 0);
⋮----
inventoryInstance = inv.FirstOrDefault(t => t == ToolToDrop || t.def == ToolToDrop.def);
⋮----
// If the found stack has more than 1, split off 1. Otherwise operate on the instance directly.
Thing toDrop = inventoryInstance.stackCount > 1
? inventoryInstance.SplitOff(1)
⋮----
// Try dropping via the ThingOwner API
Thing droppedTool = null;
⋮----
dropOk = inv.TryDrop(toDrop, pawn.Position, pawn.Map, ThingPlaceMode.Near, out droppedTool);
⋮----
// Fallback: attempt to place on the map directly
⋮----
placed = GenPlace.TryPlaceThing(toDrop, pawn.Position, pawn.Map, ThingPlaceMode.Near);
⋮----
// Attempt to restore split-off items safely
⋮----
var sameStack = inv.FirstOrDefault(t => t.def == toDrop.def && t.stackCount < t.def.stackLimit);
⋮----
int moveAmount = Math.Min(freeSpace, toDrop.stackCount);
⋮----
try { toDrop.Destroy(); } catch { }
⋮----
try { inv.TryAdd(toDrop); }
catch { try { toDrop.Destroy(); } catch { } }
⋮----
// Clear forced-handler references
⋮----
// Try to find storage cell and enqueue haul job if appropriate
⋮----
var haulJob = JobMaker.MakeJob(JobDefOf.HaulToCell, droppedTool, storageCell);
⋮----
pawn.jobs.jobQueue.EnqueueFirst(haulJob);
⋮----
private bool TryFindStorageForTool(Thing tool, out IntVec3 storageCell)
⋮----
if (StoreUtility.TryFindBestBetterStoreCellFor(tool, pawn, map, StoreUtility.CurrentStoragePriorityOf(tool), faction, out storageCell))
⋮----
if (StoreUtility.TryFindBestBetterStoreCellFor(tool, pawn, map, StoragePriority.Unstored, faction, out storageCell))
⋮----
if (!stockpile.settings.AllowedToAccept(tool)) continue;
var validCell = stockpile.cells.FirstOrDefault(cell =>
StoreUtility.IsValidStorageFor(cell, map, tool) &&
pawn.CanReserveAndReach(cell, PathEndMode.OnCell, Danger.Deadly));
</file>

<file path="Source/Harmony/Patch_ThingFilter_SetFromPreset.cs">
// Rimworld 1.6 / C# 7.3
// Source/Harmony/Patch_ThingFilter_SetFromPreset.cs
// Legacy Keep - Patch to enable SurvivalTools category in Default stockpile preset.
// Core feature. Do not remove.
⋮----
/// <summary>
/// Ensures that SurvivalTools category is enabled by default
/// in the "Default stockpile" preset.
///
/// Does NOT affect player-edited stockpiles or other presets.
/// </summary>
⋮----
public static class Patch_ThingFilter_SetFromPreset
⋮----
public static void Postfix(ThingFilter __instance, StorageSettingsPreset preset)
⋮----
// Defensive guards
⋮----
// Enable SurvivalTools in Default stockpile preset
__instance.SetAllow(cat, true);
</file>

<file path="Source/StaticConstructorClass.cs">
// RimWorld 1.6 / C# 7.3
// Source/StaticConstructorClass.cs
⋮----
namespace SurvivalTools
⋮----
public static class StaticConstructorClass
⋮----
Log.Message("[SurvivalTools] Starting static constructor initialization...");
// 1) MapGen / content constraints
⋮----
// 2) Mod compat shims
⋮----
// 3) Data integrity / components
⋮----
// 4) Auto-detect and enhance tools
⋮----
// 5) Warm settings cache (optional/perf)
SurvivalTools.InitializeSettings();
// 6) Apply conditional feature registration
ConditionalRegistration.ApplyTreeFellingConditionals();
// 7) Initialize gating system with WorkGiver → StatDef mappings
⋮----
// 8) Schedule delayed job validation (after game fully loads)
LongEventHandler.QueueLongEvent(ValidateExistingJobsOnModLoad, "SurvivalTools: Validating existing jobs...", false, null);
⋮----
Log.Message("[SurvivalTools] Static constructor initialization completed successfully");
⋮----
Log.Error($"[SurvivalTools] Error during static constructor initialization: {ex}");
⋮----
private static void ConfigureAncientRuinsTools()
⋮----
// fixedParams is a struct; copy-modify-assign
⋮----
Log.Message("[SurvivalTools] Configured ancient ruins tools to neolithic category");
⋮----
private static void AddSurvivalToolTrackersToHumanlikes()
⋮----
foreach (var tDef in DefDatabase<ThingDef>.AllDefs.Where(t => t?.race?.Humanlike == true))
⋮----
// Avoid duplicates if another mod or reload path already injected it.
if (!tDef.comps.Any(c => c?.compClass == typeof(Pawn_SurvivalToolAssignmentTracker)))
⋮----
tDef.comps.Add(new CompProperties(typeof(Pawn_SurvivalToolAssignmentTracker)));
⋮----
Log.Message($"[SurvivalTools] Added SurvivalToolAssignmentTracker to {addedCount} humanlike defs");
⋮----
private static void ResolveMendAndRecycleRecipes()
⋮----
// Only recipes that look like ours and are not the vanilla worker
var relevant = DefDatabase<RecipeDef>.AllDefs.Where(r =>
⋮----
r.workerClass != typeof(RecipeWorker)).ToList();
⋮----
// Require at least one real SurvivalTool to be a valid ingredient
⋮----
.Any(td => td?.thingClass == typeof(SurvivalTool) && recipe.IsIngredient(td));
⋮----
Log.Message($"[SurvivalTools] Processed {processed} Mend&Recycle recipes, cleared {cleared} without valid ingredients");
⋮----
private static void ResolveSmeltingRecipeUsers()
⋮----
foreach (var benchDef in DefDatabase<ThingDef>.AllDefs.Where(t => t?.IsWorkTable == true))
⋮----
// Add our tool recipes when the weapon equivalents are present; avoid duplicates.
if (benchDef.recipes.Contains(ST_RecipeDefOf.SmeltWeapon) &&
!benchDef.recipes.Contains(ST_RecipeDefOf.SmeltSurvivalTool))
⋮----
benchDef.recipes.Add(ST_RecipeDefOf.SmeltSurvivalTool);
⋮----
if (benchDef.recipes.Contains(ST_RecipeDefOf.DestroyWeapon) &&
!benchDef.recipes.Contains(ST_RecipeDefOf.DestroySurvivalTool))
⋮----
benchDef.recipes.Add(ST_RecipeDefOf.DestroySurvivalTool);
⋮----
Log.Message($"[SurvivalTools] Processed {benchesProcessed} work benches: added {smeltAdded} smelt recipes, {destroyAdded} destroy recipes");
⋮----
private static void CheckStuffForStuffPropsTool()
⋮----
var sb = new StringBuilder();
sb.AppendLine("[SurvivalTools] Checking all stuff for StuffPropsTool modExtension...");
sb.AppendLine();
var hasProps = new StringBuilder("Has props:\n");
var noProps = new StringBuilder("Doesn't have props:\n");
⋮----
sb.AppendLine($"Summary: {hasPropsCount} stuff defs have StuffPropsTool, {noPropsCount} do not");
⋮----
sb.Append(hasProps);
⋮----
sb.Append(noProps);
⋮----
Log.Message(sb.ToString());
⋮----
private static HashSet<StuffCategoryDef> GetSurvivalToolStuffCategories()
⋮----
foreach (var tool in DefDatabase<ThingDef>.AllDefsListForReading.Where(t => t?.IsSurvivalTool() == true))
⋮----
if (cat != null) toolCats.Add(cat);
⋮----
private static (int hasPropsCount, int noPropsCount) AnalyzeStuffDefs(
⋮----
foreach (var stuff in DefDatabase<ThingDef>.AllDefsListForReading.Where(t => t?.IsStuff == true))
⋮----
// Consider only stuff used by any ST tool
bool relevant = categories.Any(cat => cat != null && toolCats.Contains(cat));
⋮----
hasProps.AppendLine(line);
⋮----
noProps.AppendLine(line);
⋮----
private static void InitializeJobGatingMappings()
⋮----
// Register core vanilla WorkGivers with their required stats
// This populates the registry for JobGate.ShouldBlock() lookups
// Mining/digging work
⋮----
RegisterWorkGiverForStat("MineQuarry", ST_StatDefOf.DiggingSpeed); // mod compat
// Tree cutting
⋮----
// Plant work
⋮----
// Construction
⋮----
// Repair/maintenance
⋮----
// Deconstruction
⋮----
Log.Message("[SurvivalTools] Initialized job gating mappings for core WorkGivers");
⋮----
private static void RegisterWorkGiverForStat(string workGiverDefName, StatDef stat)
⋮----
var workGiver = DefDatabase<WorkGiverDef>.GetNamedSilentFail(workGiverDefName);
⋮----
Compat.CompatAPI.RegisterWorkGiverRequirement(workGiver, stat);
⋮----
Log.Warning($"[SurvivalTools] Failed to register {workGiverDefName} for stat {stat?.defName ?? "null"} - workGiver: {workGiver != null}, stat: {stat != null}");
⋮----
private static void ValidateExistingJobsOnModLoad()
⋮----
// Only validate if we're in hardcore mode and the game is actually running
⋮----
Helpers.SurvivalToolValidation.ValidateExistingJobs("mod loaded with existing save");
</file>

<file path="Source/Alerts/Alert_ColonistNeedsSurvivalTool.cs">
// RimWorld 1.6 / C# 7.3
// Alert_ColonistNeedsSurvivalTool.cs
//
// Rewritten for clarity:
// - Grouped by stat (Construction, Medical, Plants, etc.)
// - Collapses medical stats into "Medical"
// - Shows pawns per stat with overflow ("…and (X) others")
// - Upgrade suggestions shown once per stat (if enabled)
// - Excludes Glitterworld Multitool from suggestions
// - Cached culprits, minimal LINQ, safe fallbacks
// - RR tag preserved
⋮----
using System.Linq; // retained for limited use; heavy hot-path LINQ replaced below
⋮----
namespace SurvivalTools
⋮----
public class Alert_ColonistNeedsSurvivalTool : Alert
⋮----
private static readonly StatDef Stat_WorkSpeedGlobal =
DefDatabase<StatDef>.GetNamedSilentFail("WorkSpeedGlobal") ??
DefDatabase<StatDef>.GetNamedSilentFail("GlobalWorkSpeed");
⋮----
if (!PawnToolValidator.CanUseSurvivalTools(p)) continue;
if (IsWorkingToolless(p)) list.Add(p);
⋮----
private static bool IsWorkingToolless(Pawn pawn)
⋮----
? pawn.AssignedToolRelevantWorkGiversStatDefsForAlerts()
: pawn.AssignedToolRelevantWorkGiversStatDefs();
⋮----
if (!settings.hardcoreMode && StatFilters.IsOptionalStat(stat)) continue;
if (!SurvivalToolUtility.ToolsExistForStat(stat)) continue;
⋮----
private static bool HasToolImprovingStat(Pawn pawn, StatDef stat)
⋮----
var enumerable = pawn.GetAllUsableSurvivalTools();
⋮----
// Materialize once to list for indexed loop (GetAllUsableSurvivalTools returns IEnumerable)
var tools = enumerable as IList<Thing> ?? enumerable.ToList();
// Reuse unified helper: wrap single stat in temp list to avoid alloc reuse across calls
// For perf, avoid constructing list each iteration; simple direct factor comparison instead.
float baseline = SurvivalToolUtility.GetNoToolBaseline(stat);
⋮----
SurvivalTool st = thing as SurvivalTool;
if (st == null && thing.def != null && thing.def.IsToolStuff()) st = VirtualTool.FromThing(thing);
⋮----
float factor = SurvivalToolUtility.GetToolProvidedFactor(st, stat);
⋮----
public override TaggedString GetExplanation()
⋮----
if (culprits.NullOrEmpty()) return TaggedString.Empty;
⋮----
var sb = new StringBuilder(256);
sb.AppendLine("ColonistNeedsSurvivalToolDesc".Translate());
// Group missing stats -> pawns
⋮----
var givers = pawn.AssignedToolRelevantWorkGivers();
⋮----
if (!statToPawns.TryGetValue(label, out var list))
⋮----
list.Add(pawn);
⋮----
var tools = SurvivalToolDiscovery.GetToolsForStat(stat)
.Where(t => t != null)
// Exclude Glitterworld Multitool by defName OR by label
.Where(t => !t.defName.Contains("Glitterworld", StringComparison.OrdinalIgnoreCase)
&& !t.label.ToLower().Contains("glitterworld"))
.Where(ResearchUnlocks.IsToolResearchUnlocked)
.Select(t => t.label)
.Distinct()
.Take(3)
.ToList();
if (tools.Any())
⋮----
// ALSO include the global work-speed stat if applicable — it isn't tied to a specific WorkGiver
⋮----
if (!statToPawns.TryGetValue(globalLabel, out var list))
⋮----
if (!list.Contains(pawn)) list.Add(pawn);
⋮----
var tools = SurvivalToolDiscovery.GetToolsForStat(Stat_WorkSpeedGlobal)
⋮----
// Exclude Glitterworld Multitool
⋮----
statToSuggestions[globalLabel] = statToSuggestions.ContainsKey(globalLabel)
? statToSuggestions[globalLabel].Union(tools).Distinct().Take(3).ToList()
⋮----
// Write grouped output
foreach (var kv in statToPawns.OrderBy(kv => kv.Key))
⋮----
var pawns = kv.Value.Distinct().ToList();
⋮----
sb.AppendLine();
sb.Append($"{statLabel}: ");
var pawnNames = pawns.Take(MaxPawnsToShow).Select(p => p.LabelShort).ToList();
sb.Append(string.Join(", ", pawnNames));
⋮----
sb.Append($" and ({pawns.Count - MaxPawnsToShow}) others");
if (settings.showUpgradeSuggestions && statToSuggestions.TryGetValue(statLabel, out var suggs))
⋮----
sb.Append("  (" + string.Join(", ", suggs) + ")");
⋮----
return sb.ToString().TrimEnd();
⋮----
public override string GetLabel()
⋮----
bool hasRRNeeds = culprits.Any(p =>
p.AssignedToolRelevantWorkGivers()?.Any(g =>
⋮----
? "ColonistNeedsSurvivalTool".Translate(count)
: "ColonistsNeedSurvivalTool".Translate(count))
+ " (" + "Compat_ReinventedResearchAlert".Translate() + ")";
⋮----
: "ColonistsNeedSurvivalTool".Translate(count));
⋮----
public override AlertReport GetReport()
⋮----
? AlertReport.CulpritsAre(culprits)
⋮----
private static bool ShouldShowAlertForStat(Pawn pawn, StatDef stat, SurvivalToolsSettings settings)
⋮----
if (StatFilters.IsOptionalStat(stat)) return false;
float baseEfficiency = Math.Max(1f, stat.defaultBaseValue);
float current = Math.Max(0f, pawn.GetStatValue(stat));
⋮----
float threshold = Math.Max(0.01f, settings.noToolStatFactorNormal);
⋮----
/// <summary>
/// Normalizes certain stats to shared labels (e.g. all medical stats -> "Medical")
/// </summary>
private static string NormalizeStatLabel(StatDef stat)
⋮----
return stat.label.CapitalizeFirst();
⋮----
internal static class ResearchUnlocks
⋮----
public static bool IsToolResearchUnlocked(ThingDef toolDef)
⋮----
if (rp.NullOrEmpty()) return true;
</file>

<file path="Source/Alerts/Alert_SurvivalToolNeedsReplacing.cs">
// RimWorld 1.6 / C# 7.3
// Source/Alerts/Alert_SurvivalToolNeedsReplacing.cs
//
// QoL: shows damaged tool % remaining and suggests researched replacements.
⋮----
using System.Linq; // retained for non-hot path grouping in explanation only
⋮----
namespace SurvivalTools
⋮----
public class Alert_SurvivalToolNeedsReplacing : Alert
⋮----
// Threshold expressed as remaining HP fraction (0..1). Tools at or below this
// HP fraction will trigger the replacing alert. Using HP% is clearer for players
// than the internal "lifespan" estimate which combined multiple factors.
⋮----
if (!PawnToolValidator.CanUseSurvivalTools(p)) continue;
⋮----
private static bool HasDamagedTools(Pawn pawn)
⋮----
var toolsEnum = pawn.GetAllUsableSurvivalTools();
⋮----
SurvivalTool st = t as SurvivalTool;
if (st == null && t?.def != null && t.def.IsToolStuff()) st = VirtualTool.FromThing(t);
⋮----
private static bool IsToolBelowThreshold(SurvivalTool tool)
⋮----
// Use direct HP fraction for thresholding. This is more intuitive and stable
// than combining lifespan estimates with HP.
⋮----
hpFrac = Math.Max(0f, Math.Min(1f, hpFrac));
⋮----
private static ThingWithComps ResolveThingWithComps(SurvivalTool tool)
⋮----
// Prefer an explicit SourceThing for virtual wrappers (most accurate for inventory stacks)
⋮----
var backingThing = SurvivalToolUtility.BackingThing(tool);
⋮----
private static string FormatToolLifespan(SurvivalTool tool)
⋮----
// Display the actual HP / MaxHP and a human-friendly percentage (HP%). This
// replaces the previous "lifespan" presentation so players see the concrete
// condition of the item.
⋮----
public override TaggedString GetExplanation()
⋮----
var culprits = WorkersDamagedTools.ToList();
⋮----
// Build concise grouped explanation like:
// (2) 30% - Hammer, Axe
var sb = new StringBuilder();
sb.AppendLine("SurvivalToolNeedsReplacingDesc".Translate());
// Map from tool summary -> list of pawns
⋮----
var failing = p.GetAllUsableSurvivalTools()
⋮----
.Where(IsToolBelowThreshold)
.ToList();
⋮----
if (!groups.ContainsKey(summary)) groups[summary] = new List<string>();
groups[summary].Add(p.LabelShort);
⋮----
// Render up to 3 lines ordered by number of affected pawns
foreach (var kv in groups.OrderByDescending(kv => kv.Value.Count).Take(3))
⋮----
var toolNames = kv.Key; // already contains percent info
var pawnList = kv.Value.Distinct().Take(3);
sb.AppendLine($"({kv.Value.Count}) {toolNames} - {string.Join(", ", pawnList)}");
⋮----
int remaining = groups.Values.Sum(list => list.Count) - groups.Values.Take(3).Sum(list => list.Count);
⋮----
sb.AppendLine("...and " + remaining + " more");
return sb.ToString();
⋮----
public override string GetLabel() => "SurvivalToolsNeedReplacing".Translate();
public override AlertReport GetReport()
⋮----
return culprits.Count == 0 ? AlertReport.Inactive : AlertReport.CulpritsAre(culprits);
</file>

<file path="Source/Harmony/Patch_MassUtility.cs">
//Rimworld 1.6 / C# 7.3
// Source/Harmony/Patch_MassUtility.cs
// Legacy Code: KEEP, but likely needs integration into our refactor.
⋮----
public static class Patch_MassUtility
⋮----
public static class CountToPickUpUntilOverEncumbered_Postfix
⋮----
public static void Postfix(ref int __result, Pawn pawn, Thing thing)
⋮----
bool isSurvivalThing = thing is SurvivalTool || thing.def.IsToolStuff();
⋮----
// For tool-stuff stacks, treat the entire stack as a single "tool unit"
int additionalToolUnits = thing.def.IsToolStuff() ? 1 : 1; // picking up any survival tool normally counts as 1
// (if you wanted to count multiple individual items for stackable tools, change above accordingly)
// If picking up the additionalToolUnits would exceed carry limit, disallow picking up any
if (!pawn.CanCarryAnyMoreSurvivalTools(additionalToolUnits))
⋮----
public static class WillBeOverEncumberedAfterPickingUp_Postfix
⋮----
public static void Postfix(ref bool __result, Pawn pawn, Thing thing, int count)
⋮----
// For tool-stuff stacks, treat the pickup as one additional tool unit (stack counts as single virtual tool).
int additionalToolUnits = thing.def.IsToolStuff() ? 1 : count;
</file>

<file path="Source/Harmony/Patch_Mineable_Notify_TookMiningDamage.cs">
// Rimworld 1.6 / C# 7.3
// Source/Harmony/Patch_Mineable_Notify_TookMiningDamage.cs
// Legacy Code: KEEP, but likely needs integration into our refactor.
⋮----
public static class Patch_Mineable_Notify_TookMiningDamage
⋮----
private static readonly FieldInfo FI_MiningYield =
AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.MiningYield));
private static readonly FieldInfo FI_DiggingYield =
AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.MiningYieldDigging));
public static IEnumerable<CodeInstruction> Transpiler(IEnumerable<CodeInstruction> instructions)
⋮----
// No IL to work with — nothing to emit
⋮----
// If fields can’t be resolved, pass through original IL unchanged
⋮----
var repl = new CodeInstruction(OpCodes.Ldsfld, FI_DiggingYield)
⋮----
private static bool IsSameField(object operand, FieldInfo target)
</file>

<file path="Source/Harmony/Patch_RoofUtility_CanHandleBlockingThing.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_RoofUtility_CanHandleBlockingThing.cs
// Legacy code: Needs refactoring to use centralized tool stat resolver/gating systems.
//
// Purpose:
//   Prevents pawns from handling roof-blocking trees unless they meet tree-felling requirements.
//   Integrates SurvivalTools' gating so pawns without the right tools cannot bypass roofs.
⋮----
// Notes:
//   - Early-outs preserve vanilla logic (only intervene if vanilla allowed it).
//   - Debug logging throttled with ShouldLogWithCooldown to prevent spam.
//   - Safe null guards for worker/blocker to avoid rare NREs.
//   - Adds JobFailReason (hardcoded) so players get an in-game message instead of silent blocking.
⋮----
public static class Patch_RoofUtility_CanHandleBlockingThing
⋮----
public static void Postfix(ref bool __result, Thing blocker, Pawn worker)
⋮----
// --- Early exits ---
if (!__result) return;                          // vanilla already disallowed
if (worker == null) return;                     // no pawn available
if (blocker?.def?.plant?.IsTree != true) return; // only care about trees
// --- SurvivalTools gating ---
if (!worker.CanFellTrees())
⋮----
// Avoid spam: many roof cells may query the same blocker repeatedly
⋮----
// Add an in-game job fail reason (non-translated, clear to player)
JobFailReason.Is("Missing tree-felling tool");
__result = false; // deny if no tree-felling tools
</file>

<file path="Source/Harmony/Patch_SymbolResolver_AncientRuins_Resolve.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_SymbolResolver_AncientRuins_Resolve.cs
//
// Ensures Survival Tools can spawn inside ancient ruins.
// Fix: moved from Prefix → Postfix so tools are placed AFTER
// vanilla pushes the "emptyRoom" symbol, otherwise they get wiped.
// Legacy code: Keep. Required for generating tools in ancient ruins.
⋮----
public static class Patch_SymbolResolver_AncientRuins_Resolve
⋮----
// Favor cheaper stuff somewhat, but never zero weight.
private static readonly SimpleCurve StuffMarketValueRemainderToCommonalityCurve = new SimpleCurve
⋮----
new CurvePoint(0f,   SurvivalToolUtility.MapGenToolMaxStuffMarketValue * 0.1f),
new CurvePoint(SurvivalToolUtility.MapGenToolMaxStuffMarketValue,
⋮----
// Cache reflection once; fallback if unavailable.
⋮----
AccessTools.Method(typeof(QualityUtility), "GenerateFromGaussian");
⋮----
public static void Postfix(ResolveParams rp)
⋮----
things = setMaker.Generate();
⋮----
// Non-fatal generation error — route through ST_Logging to respect dev gating
⋮----
if (ST_Logging.ShouldLogWithCooldown(key))
ST_Logging.LogWarning($"[SurvivalTools] AncientRuins tool set generation failed: {e}");
⋮----
// --- Quality ---
⋮----
QualityCategory qc;
⋮----
object res = MI_GenerateFromGaussian.Invoke(
⋮----
qc = res is QualityCategory q ? q : QualityUtility.GenerateQualityRandomEqualChance();
⋮----
qc = QualityUtility.GenerateQualityRandomEqualChance();
⋮----
qComp.SetQuality(qc, ArtGenerationContext.Outsider);
⋮----
// --- Stuff (if applicable and not already assigned) ---
⋮----
var allowedEnum = GenStuff.AllowedStuffsFor(thing.def);
var allowed = allowedEnum != null ? allowedEnum.ToList() : null;
⋮----
var valid = allowed.Where(t =>
⋮----
).ToList();
⋮----
var chosen = valid.RandomElementByWeight(tdef =>
⋮----
float remainder = Mathf.Max(0f, maxMV - tdef.BaseMarketValue);
float baseW = StuffMarketValueRemainderToCommonalityCurve.Evaluate(remainder);
float common = Mathf.Max(0.0001f, tdef.stuffProps?.commonality ?? 1f);
return Mathf.Max(0.0001f, baseW * common);
⋮----
thing.SetStuffDirect(chosen);
⋮----
// --- HitPoints ---
⋮----
int hp = Mathf.RoundToInt(thing.MaxHitPoints *
⋮----
thing.HitPoints = Mathf.Clamp(hp, 1, thing.MaxHitPoints);
⋮----
// --- Enqueue spawn AFTER emptyRoom ---
var rpForThing = rp; // struct copy
⋮----
BaseGen.symbolStack.Push("thing", rpForThing);
⋮----
// Individual spawn errors are noisy in bulk — gate via ST_Logging
⋮----
ST_Logging.LogWarning($"[SurvivalTools] Skipped ancient-ruins tool '{thing?.def?.defName ?? "null"}' due to error: {e}");
</file>

<file path="Source/Harmony/Patch_ThingDef_SpecialDisplayStats.cs">
// Rimworld 1.6 / C# 7.3
// Source/Harmony/Patch_ThingDef_SpecialDisplayStats.cs
// Shows tool-related stat factors in the info card for SurvivalTool defs and tool-stuff.
// Also shows aggregated base factors for ThingDefs that have them (via SurvivalToolProperties or ToolResolver).
// Legacy code, KEEP.
⋮----
public static class Patch_ThingDef_SpecialDisplayStats
⋮----
public static void Postfix(ThingDef __instance, ref IEnumerable<StatDrawEntry> __result, StatRequest req)
⋮----
// always work against a real list we control
⋮----
// Build a quick de-dupe set (label + value) to avoid duplicate rows
⋮----
existing.Add((e.LabelCap?.ToString() ?? "") + "|" + (e.ValueString ?? ""));
⋮----
// Aggregated stat factors for the def (covers SurvivalTool defs, enhanced weapon defs, and tool-stuff defs)
⋮----
// Actual SurvivalTool / VirtualTool instance overrides (instance factors already include effectiveness, quality, stuff multipliers)
⋮----
var instFactors = actualTool.WorkStatFactors?.Where(m => m != null && m.stat != null).ToList();
⋮----
// Remove any previously added entries for the same stats to prevent duplicate display rows showing base+instance
var instStatDefs = new HashSet<StatDef>(instFactors.Select(m => m.stat));
list.RemoveAll(entry => entry.category == ST_StatCategoryDefOf.SurvivalTool &&
entry?.LabelCap != null && instStatDefs.Any(sd => entry.LabelCap.ToString().IndexOf(sd.label, System.StringComparison.OrdinalIgnoreCase) >= 0));
existing.RemoveWhere(key => instStatDefs.Any(sd => key.IndexOf(sd.label, System.StringComparison.OrdinalIgnoreCase) >= 0));
⋮----
/// <summary>
/// Collects all survival tool related stat factors declared on a ThingDef either through
/// SurvivalToolProperties.baseWorkStatFactors or statBases (which may have been injected by ToolResolver).
/// Dedupe by StatDef keeping the maximum value. Returns an empty list if none found.
/// </summary>
private static List<StatModifier> AggregateDefToolFactors(ThingDef def)
⋮----
// Extension factors (baseWorkStatFactors)
⋮----
result.Add(new StatModifier { stat = m.stat, value = m.value });
⋮----
// statBases (injected primary/secondary stats from ToolResolver or original defs)
⋮----
// Stuff-based definitions (tool-stuff) don't expose material multipliers here; those apply at instance level.
// If it's stuff and has StuffPropsTool multipliers only (no ext), we still surface base factors so players see potential.*
⋮----
// Show only positive (>1) multipliers as factors; treat them as base factors to inform players.
⋮----
// Dedupe by stat keep max
⋮----
if (!dedup.TryGetValue(m.stat, out var cur) || m.value > cur)
⋮----
result = dedup.Select(kv => new StatModifier { stat = kv.Key, value = kv.Value }).ToList();
⋮----
catch { /* swallow for safety */ }
⋮----
private static void AddStatDrawEntries(
⋮----
// Only show stats that provide meaningful bonuses (> 100%).
// Penalties (< 100%) are intentionally hidden to reduce clutter in info cards.
⋮----
var value = modifier.value.ToStringByStyle(ToStringStyle.PercentZero, ToStringNumberSense.Factor);
⋮----
if (existing.Contains(key))
⋮----
var report = $"When survival tools (or tool-stuff) apply, {modifier.stat.label.ToLower()} is multiplied by {modifier.value.ToStringPercent()}.";
list.Add(new StatDrawEntry(
⋮----
existing.Add(key);
</file>

<file path="Source/Harmony/Patch_Toils_Haul_TakeToInventory.cs">
//RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_Toils_Haul_TakeToInventory.cs
// Legacy Code: Is supposed to be handled by JobGiver_PickUpSurvivalTool,
// is this integrated into our refactored job giver now? If so, consider removing this patch.
// Keep for now, may still be useful for edge cases or future features.
⋮----
public static class Patch_Toils_Haul_TakeToInventory
⋮----
public static void Postfix(Toil __result, TargetIndex ind)
⋮----
if (__result == null) return; // defensive
⋮----
// Run vanilla behavior first, but never trust it to be non-null
⋮----
// If vanilla throws, we don’t want our patch to swallow it silently.
⋮----
// Must be a valid pawn able to use tools
if (actor == null || !PawnToolValidator.CanUseSurvivalTools(actor)) return;
⋮----
// Only react to player-forced pickups
⋮----
// Resolve the actual target
LocalTargetInfo lti;
try { lti = job.GetTarget(ind); }
⋮----
// Index out of range or mutated job — play it safe.
⋮----
// Only SurvivalTool items or tool-stuffs count
bool isSurvivalTool = ToolClassification.IsSurvivalTool(thing);
bool isToolStuff = thing.def != null && thing.def.IsToolStuff();
⋮----
// Verify it ended up in inventory after vanilla’s operation
⋮----
// We only mark the exact Thing reference if it’s now in inventory.
// (Avoid guessing among similar stacks to prevent marking the wrong item.)
if (!inv.Contains(thing)) return;
⋮----
fh.SetForced(thing, true);
</file>

<file path="Source/Harmony/Patch_WorkGiver_GrowerSow_JobOnCell.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_WorkGiver_GrowerSow_JobOnCell.cs
// Legacy patch to block vanilla tree cutting when tree-felling tools are required.
// TODO: evaluate removal after full tool integration is complete.
⋮----
public static class Patch_WorkGiver_GrowerSow_JobOnCell
⋮----
public static void Postfix(ref Job __result, Pawn pawn)
⋮----
// Use centralized tree-felling gate
if (pawn != null && pawn.CanFellTrees())
⋮----
__result = new Job(ST_JobDefOf.FellTree, job.targetA);
⋮----
// Block vanilla cut if requirements aren't met
</file>

<file path="Source/Harmony/Patch_WorkGiver_PlantsCut_JobOnThing.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_WorkGiver_PlantsCut_JobOnThing.cs
// Legacy Code: Patch to block WorkGiver_PlantsCut from assigning CutPlant jobs on trees, so that specialized felling logic can be used instead.
// Retain for compatibility with existing saves and to avoid regressions.
⋮----
public static class Patch_WorkGiver_PlantsCut_JobOnThing
⋮----
public static void Postfix(ref Job __result, Thing t, Pawn pawn)
⋮----
// Defensive: bail fast if nothing to do or the call has already decided "no job".
⋮----
// Only interfere with the PlantsCut-produced CutPlant job, and only for trees.
// (Avoids touching other job types or non-plant targets.)
⋮----
// Block PlantsCut on trees; specialized felling logic will handle them instead.
⋮----
// Cooldowned debug log to avoid spam.
⋮----
// Keyed by pawn + thing def to keep noise down while still being informative.
</file>

<file path="Source/Harmony/Patch_WorkGiver_Scanner_ToolGate.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_WorkGiver_Scanner_ToolGate.cs
//
// LEGACY SYSTEM: This file exists from the original codebase.
// It has been DISABLED and replaced by the refactored gating system.
// Kept for compatibility and to avoid breaking references.
⋮----
public static class Patch_WorkGiver_Scanner_ToolGate
⋮----
public static bool Prefix_HasJobOnThing(WorkGiver_Scanner __instance, Pawn pawn, Thing t, bool forced, ref bool __result)
⋮----
// LEGACY STUB: Always allow - new system handles gating
⋮----
public static bool Prefix_HasJobOnCell(WorkGiver_Scanner __instance, Pawn pawn, IntVec3 c, bool forced, ref bool __result)
</file>

<file path="Source/ToolAssignments/Pawn_SurvivalToolAssignmentTracker.cs">
// Rimworld 1.6 / C# 7.3
// Source/ToolAssignments/Pawn_SurvivalToolAssignmentTracker.cs
// Legacy code: Will be phased out as we use AssignmentSearch.cs instead.
// Needs review and evaluation. A safe way to delete it without breaking users saves is needed.
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// Per-pawn component that stores the current survival tool assignment,
/// forced tool state, and optimization cooldown bookkeeping.
/// </summary>
public class Pawn_SurvivalToolAssignmentTracker : ThingComp
⋮----
private SurvivalToolAssignment _currentAssignment;
public SurvivalToolForcedHandler forcedHandler;
private int _lastOptimizedTick = -99999;   // last time we "optimized"
private int _customOptimizeInterval = -1;  // next-interval override (randomized window), -1 = use default
⋮----
/// Current survival tool assignment for this pawn.
/// Lazily falls back to the database default if unset or invalid.
⋮----
/// Whether the optimizer should run again now.
/// Uses a longer interval when AutoTool is enabled (we opportunistically pick up tools anyway),
/// and a shorter interval when AutoTool is disabled (we rely on periodic optimization more).
⋮----
// ~24 in-game hours with AutoTool, ~1 hour otherwise
⋮----
// Use subtraction to avoid wrap-related edge cases
⋮----
/// Marks optimization as completed and (optionally) schedules the next window.
⋮----
public void Optimized(int minTicks = -1, int maxTicks = -1)
⋮----
_customOptimizeInterval = Rand.Range(minTicks, maxTicks);
⋮----
_customOptimizeInterval = -1; // revert to default cadence
⋮----
public override void Initialize(CompProperties props)
⋮----
base.Initialize(props);
// Ensure forced handler always exists
⋮----
forcedHandler = new SurvivalToolForcedHandler();
⋮----
public override void PostExposeData()
⋮----
base.PostExposeData();
Scribe_References.Look(ref _currentAssignment, "currentAssignment");
Scribe_Deep.Look(ref forcedHandler, "forcedHandler");
Scribe_Values.Look(ref _lastOptimizedTick, "lastOptimizedTick", -99999);
Scribe_Values.Look(ref _customOptimizeInterval, "customOptimizeInterval", -1);
⋮----
// Defensive: never leave this null after load
⋮----
// Validate the saved assignment still exists in the db; if not, fall back to default on next access
⋮----
if (db == null || db.AllSurvivalToolAssignments == null || !db.AllSurvivalToolAssignments.Contains(_currentAssignment))
⋮----
_currentAssignment = null; // lazy default on next get
</file>

<file path="Source/ToolAssignments/SurvivalToolAssignmentDatabase.cs">
//Rimworld 1.6 / C# 7.3
// Source/ToolAssignments/SurvivalToolAssignmentDatabase.cs
// Legacy code: needs review and evaluation for deletion without breaking saves.
⋮----
namespace SurvivalTools
⋮----
public class SurvivalToolAssignmentDatabase : GameComponent
⋮----
public override void FinalizeInit()
⋮----
public override void ExposeData()
⋮----
Scribe_Values.Look(ref initialized, "initialized", false);
Scribe_Collections.Look(ref survivalToolAssignments, "survivalToolAssignments", LookMode.Deep);
⋮----
// Defensive: ensure filters/labels exist on all entries
⋮----
if (assignment.filter == null) assignment.filter = new ThingFilter();
if (assignment.label.NullOrEmpty()) assignment.label = "Unnamed";
⋮----
public SurvivalToolAssignment DefaultSurvivalToolAssignment() =>
survivalToolAssignments.SafeCount() == 0 ? MakeNewSurvivalToolAssignment() : survivalToolAssignments.SafeElementAt(0) ?? MakeNewSurvivalToolAssignment();
public AcceptanceReport TryDelete(SurvivalToolAssignment toolAssignment)
⋮----
// Block deletion if ANY alive pawn (on maps, caravans, temp maps, transport pods) is using it
⋮----
if (!SafetyUtils.IsValidPawn(pawn)) continue;
⋮----
return new AcceptanceReport("SurvivalToolAssignmentInUse".Translate(pawn));
⋮----
// Clear references on all pawns (alive or dead) so saves don’t keep dangling refs
⋮----
survivalToolAssignments.Remove(toolAssignment);
⋮----
public SurvivalToolAssignment MakeNewSurvivalToolAssignment()
⋮----
int uniqueId = survivalToolAssignments.Any() ? survivalToolAssignments.Max(a => a.uniqueId) + 1 : 1;
var toolAssignment = new SurvivalToolAssignment(uniqueId, $"{"SurvivalToolAssignment".Translate()} {uniqueId}");
toolAssignment.filter.SetAllow(ST_ThingCategoryDefOf.SurvivalTools, true);
survivalToolAssignments.Add(toolAssignment);
⋮----
private void GenerateStartingSurvivalToolAssignments()
⋮----
// --- Default "General Worker" (first entry) ---
⋮----
staGeneral.filter.SetDisallowAll();
// Include EVERYTHING that has SurvivalToolProperties (real tools + tool-stuffs)
// Previously this only included defs with baseWorkStatFactors; also include defs
// that declare defaultSurvivalToolAssignmentTags so they appear in starting sets.
⋮----
bool hasAssignmentTags = props.defaultSurvivalToolAssignmentTags != null && props.defaultSurvivalToolAssignmentTags.Any();
⋮----
staGeneral.filter.SetAllow(tDef, true);
⋮----
// --- “Anything” ---
⋮----
staAnything.label = "OutfitAnything".Translate();
staAnything.filter.SetDisallowAll();
// Allow all survival-tool defs + tool-stuffs (anything with SurvivalToolProperties)
// Also include defs that only specify assignment tags.
⋮----
staAnything.filter.SetAllow(tDef, true);
⋮----
// --- Category assignments (only if tools exist for that tag) ---
⋮----
bool hasToolsForTag = DefDatabase<ThingDef>.AllDefs.Any(tDef =>
⋮----
assignment.label = labelKey.Translate();
assignment.filter.SetDisallowAll();
⋮----
// Assign tools to created tag sets
⋮----
if (createdAssignments.TryGetValue(tag, out var assignment))
assignment.filter.SetAllow(tDef, true);
⋮----
staNothing.label = "FoodRestrictionNothing".Translate();
staNothing.filter.SetDisallowAll();
</file>

<file path="Source/ToolResolver.cs">
// RimWorld 1.6 / C# 7.3
// Source/ToolResolver.cs
// Legacy Code: Do we need to integrate this logic into the main mod?
// or can we remove it entirely?
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// A system for automatically adding relevant stats to tools that don't already have them.
/// This ensures compatibility with modded tools by intelligently detecting tool types
/// and applying appropriate stats based on their names and tech levels.
/// </summary>
public static class ToolResolver
⋮----
/// Defines tool type detection rules with name patterns and corresponding stats
⋮----
new ToolDetectionRule
⋮----
// Sickles also get reduced butchering capability (0.5x) since they're blades
⋮----
ExcludePatterns = new[] { "sledgehammer", "persona" }, // Sledgehammers might be mining tools
⋮----
/// Automatically resolves and enhances all tools in the game with appropriate stats.
/// This method should be called during static constructor initialization.
⋮----
public static void ResolveAllTools()
⋮----
// Always log via raw debug logger so messages appear unthrottled in DevMode when debug logging enabled.
⋮----
// Process all ThingDefs for tool enhancement (weapons and items)
foreach (ThingDef thingDef in DefDatabase<ThingDef>.AllDefs.Where(t => t != null &&
⋮----
enhancementLog.Add(logEntry);
⋮----
// Summary logging
⋮----
// Keep warning-level direct emit for noteworthy no-op completion
⋮----
/// Attempts to enhance a weapon ThingDef with appropriate tool stats
⋮----
private static bool TryEnhanceTool(ThingDef thingDef, out string logEntry)
⋮----
// Use original label; perform case-insensitive comparisons via IndexOf
⋮----
// Check each detection rule
⋮----
// Check if label matches any pattern
bool matches = rule.NamePatterns.Any(pattern =>
!string.IsNullOrEmpty(pattern) &&
label.IndexOf(pattern, StringComparison.OrdinalIgnoreCase) >= 0);
⋮----
// Check if it should be excluded
bool excluded = rule.ExcludePatterns.Any(pattern =>
⋮----
logEntry = $"Excluded {rule.Description.ToLower()}: {thingDef.defName} ({thingDef.label}) from {modSource}";
⋮----
// Check if it already has the required stats (in statBases or mod extensions)
bool needsEnhancement = rule.RequiredStats.Any(stat => !HasExistingStat(thingDef, stat));
⋮----
logEntry = $"Already enhanced {rule.Description.ToLower()}: {thingDef.defName} ({thingDef.label}) from {modSource}";
⋮----
// Skip if this is already a SurvivalTools item (don't modify our own tools)
⋮----
// Enhance the tool
⋮----
logEntry = $"Enhanced {rule.Description.ToLower()}: {thingDef.defName} ({thingDef.label}) from {modSource}";
⋮----
/// Enhances a ThingDef with tool stats based on the detection rule
⋮----
private static void EnhanceTool(ThingDef thingDef, ToolDetectionRule rule, STToolKind toolKind)
⋮----
// Initialize statBases if needed
⋮----
// Add primary stats
⋮----
// Only add if not already present
if (!thingDef.statBases.Any(sb => sb.stat == requiredStat))
⋮----
thingDef.statBases.Add(new StatModifier
⋮----
// Add secondary stats (like reduced butchering for sickles)
⋮----
if (!thingDef.statBases.Any(sb => sb.stat == kvp.Key))
⋮----
value = kvp.Value * multiplier // Apply tech level scaling to secondary stats too
⋮----
// Add SurvivalToolProperties mod extension if not present
⋮----
/// Ensures a ThingDef has the SurvivalToolProperties mod extension
⋮----
private static void EnsureSurvivalToolExtension(ThingDef thingDef, STToolKind toolKind)
⋮----
// Check if it already has the extension
⋮----
// Initialize modExtensions if needed
⋮----
// Add basic SurvivalToolProperties extension
var toolProps = new SurvivalToolProperties();
// Set tool assignment tags based on tool kind
⋮----
toolProps.defaultSurvivalToolAssignmentTags = new List<string> { toolKind.ToString().ToLower() };
⋮----
thingDef.modExtensions.Add(toolProps);
⋮----
/// Gets the stat multiplier based on tech level
⋮----
private static float GetStatMultiplierForTechLevel(TechLevel techLevel)
⋮----
return 0.85f; // Default for unrecognized tech levels
⋮----
/// Checks if a ThingDef already has a specific stat (either in statBases or mod extensions)
⋮----
private static bool HasExistingStat(ThingDef thingDef, StatDef stat)
⋮----
// Check statBases
⋮----
// Check SurvivalToolProperties mod extension
⋮----
/// Checks if a ThingDef is from SurvivalTools (our own items)
⋮----
private static bool IsSurvivalToolsItem(ThingDef thingDef)
⋮----
// Check if defName starts with SurvivalTools_
⋮----
// Check if it has SurvivalToolProperties extension (strong indicator it's ours)
⋮----
/// Logs verification of all mod stats to ensure they're accounted for in detection rules
⋮----
private static void LogModStatsVerification()
⋮----
//ST_StatDefOf.SurvivalToolCarryCapacity,
⋮----
//ST_StatDefOf.ToolEstimatedLifespan,
//ST_StatDefOf.ToolEffectivenessFactor
⋮----
// Get all stats used in detection rules
⋮----
usedStats.Add(stat);
⋮----
usedStats.Add(kvp.Key);
⋮----
// Check for stats that aren't used in any detection rule
var unusedStats = allModStats.Where(stat => stat != null && !usedStats.Contains(stat)).ToList();
LogRawDebug($"[SurvivalTools] Stat coverage verification: {usedStats.Count}/{allModStats.Where(s => s != null).Count()} stats covered in detection rules");
if (unusedStats.Any())
⋮----
/// Gets the mod source name for a ThingDef
⋮----
private static string GetModSource(ThingDef thingDef)
⋮----
// Try to get the mod content pack from the def
ModContentPack modContentPack = thingDef.modContentPack;
⋮----
// Return a clean mod name
⋮----
if (string.IsNullOrEmpty(modName))
⋮----
return string.IsNullOrEmpty(modName) ? "Unknown Mod" : modName;
⋮----
// Fallback - try to determine from package ID if available
⋮----
if (!string.IsNullOrEmpty(packageId))
⋮----
if (packageId.IndexOf("core", StringComparison.OrdinalIgnoreCase) >= 0 ||
packageId.Equals("ludeon.rimworld", StringComparison.OrdinalIgnoreCase))
⋮----
/// Defines detection rules for a specific tool type
⋮----
private class ToolDetectionRule
</file>

<file path="Source/Compatibility/CompatAPI.cs">
// RimWorld 1.6 / C# 7.3
// Source/Compatibility/CompatAPI.cs
// Keep! Needed for compatibility integrations, registry, and public API.
//
// SurvivalTools Generic Compatibility API + Registry (single file)
⋮----
// - Public, mod-agnostic CompatAPI surface
// - Internal registry with pluggable modules (RR, Primitive Tools, Separate Tree Chopping)
// - Lightweight caching, null-safety, debug-only logging chatter
⋮----
// Pacifist equip handled centrally in Patch_EquipmentUtility_CanEquip_PacifistTools.cs
// ---------- Module Interface ----------
public interface ICompatibilityModule
⋮----
void Initialize();
List<StatDef> GetCompatibilityStats();
Dictionary<string, string> GetDebugInfo();
⋮----
// ---------- Primitive Tools ----------
internal sealed class PrimitiveToolsCompatibilityModule : ICompatibilityModule
⋮----
public bool IsModActive => PrimitiveToolsHelpers.IsPrimitiveToolsActive();
public void Initialize()
⋮----
Log.Message($"[SurvivalTools Compat] Primitive Tools detected ({PrimitiveToolsHelpers.GetPrimitiveToolDefs().Count} defs).");
⋮----
public List<StatDef> GetCompatibilityStats() => new List<StatDef>(); // none added by PT
public Dictionary<string, string> GetDebugInfo()
⋮----
["Active"] = IsModActive.ToString(),
["Tool Count"] = PrimitiveToolsHelpers.GetPrimitiveToolDefs().Count.ToString(),
["Optimize?"] = PrimitiveToolsHelpers.ShouldOptimizeForPrimitiveTools().ToString()
⋮----
var conflicts = PrimitiveToolsHelpers.CheckForConflicts();
info["Conflicts"] = conflicts.Count > 0 ? string.Join("; ", conflicts) : "None";
⋮----
// ---------- Separate Tree Chopping ----------
internal sealed class SeparateTreeChoppingCompatibilityModule : ICompatibilityModule
⋮----
public bool IsModActive => SeparateTreeChoppingHelpers.IsSeparateTreeChoppingActive();
⋮----
// If both are handling tree felling, auto-prefer STC (safer UX).
if (SeparateTreeChoppingHelpers.ShouldAutoDisableSTTreeFelling())
⋮----
Log.Message("[SurvivalTools Compat] Auto-resolving tree felling overlap for Separate Tree Chopping...");
⋮----
if (!SeparateTreeChoppingHelpers.ApplyRecommendedResolution())
Log.Warning("[SurvivalTools Compat] Failed to auto-resolve tree felling conflict.");
⋮----
public List<StatDef> GetCompatibilityStats() => new List<StatDef>(); // none added by STC
⋮----
var map = new Dictionary<string, string> { ["Active"] = IsModActive.ToString() };
⋮----
map["Has Tree Conflict"] = SeparateTreeChoppingHelpers.HasTreeFellingConflict().ToString();
map["Recommended Resolution"] = SeparateTreeChoppingHelpers.GetRecommendedResolution().ToString();
var conflicts = SeparateTreeChoppingHelpers.CheckForConflicts();
map["Conflicts"] = conflicts.Count > 0 ? string.Join("; ", conflicts) : "None";
⋮----
// ---------- Research Reinvented ----------
internal sealed class ResearchReinventedCompatibilityModule : ICompatibilityModule
⋮----
public void Initialize() => RRHelpers.Initialize();
public List<StatDef> GetCompatibilityStats() => CompatAPI.GetAllResearchStats();
public Dictionary<string, string> GetDebugInfo() => RRHelpers.GetReflectionStatus();
⋮----
// ---------- Registry ----------
⋮----
internal static class CompatibilityRegistry
⋮----
public static void Initialize()
⋮----
Log.Message("[SurvivalTools Compat] Initializing module registry…");
⋮----
RegisterModule(new ResearchReinventedCompatibilityModule());
RegisterModule(new PrimitiveToolsCompatibilityModule());
RegisterModule(new SeparateTreeChoppingCompatibilityModule());
// New compat modules
// Register new compatibility modules explicitly so they are discoverable and type-checked at compile time.
try { RegisterModule(new CommonSenseCompatibilityModule()); } catch { }
try { RegisterModule(new SmarterConstructionCompatibilityModule()); } catch { }
try { RegisterModule(new SmarterDeconstructionCompatibilityModule()); } catch { }
try { RegisterModule(new TDEnhancementPackCompatibilityModule()); } catch { }
foreach (var m in Modules.Where(m => m.IsModActive))
⋮----
Log.Message($"[SurvivalTools Compat] Init {m.ModName}…");
⋮----
m.Initialize();
⋮----
Log.Error($"[SurvivalTools Compat] Failed to init {m.ModName}: {e}");
⋮----
Log.Error($"[SurvivalTools Compat] Registry init failed: {e}");
⋮----
// Initialize the SurvivalToolRegistry (Phase 1)
SurvivalToolRegistry.Initialize();
// Initialize the ToolStatResolver (Phase 2)
Helpers.ToolStatResolver.Initialize();
⋮----
public static void RegisterModule(ICompatibilityModule module)
⋮----
if (Modules.Any(m => string.Equals(m.ModName, module.ModName, StringComparison.OrdinalIgnoreCase)))
⋮----
Log.Message($"[SurvivalTools Compat] {module.ModName} already registered, skipping.");
⋮----
Modules.Add(module);
⋮----
public static IEnumerable<ICompatibilityModule> GetActiveModules() =>
Modules.Where(m => m.IsModActive);
public static ICompatibilityModule GetModule(string modName) =>
Modules.FirstOrDefault(m => m.ModName.Equals(modName, StringComparison.OrdinalIgnoreCase));
public static List<StatDef> GetAllCompatibilityStats()
⋮----
try { all.AddRange(m.GetCompatibilityStats()); }
catch (Exception e) { Log.Warning($"[SurvivalTools Compat] Stats from {m.ModName} failed: {e.Message}"); }
⋮----
return all.Where(s => s != null).Distinct().ToList();
⋮----
public static void DumpCompatibilityStatus()
⋮----
Log.Message("[SurvivalTools Compat] === Compatibility Modules Status ===");
⋮----
Log.Message($"[SurvivalTools Compat] Module: {m.ModName}");
Log.Message($"[SurvivalTools Compat]   Active: {m.IsModActive}");
⋮----
var info = m.GetDebugInfo();
foreach (var kv in info) Log.Message($"[SurvivalTools Compat]   {kv.Key}: {kv.Value}");
var stats = m.GetCompatibilityStats();
var statNames = (stats ?? new List<StatDef>()).Select(s => s != null ? s.defName : "null").ToArray();
Log.Message($"[SurvivalTools Compat]   Stats: {string.Join(", ", statNames)}");
⋮----
catch (Exception e) { Log.Message($"[SurvivalTools Compat]   Error: {e.Message}"); }
⋮----
Log.Message(string.Empty);
⋮----
Log.Message("[SurvivalTools Compat] === End Compatibility Status ===");
⋮----
// ---------- Registry (Phase 1) ----------
internal static class SurvivalToolRegistry
⋮----
// O(1) lookups for WorkGiver/Job requirements
⋮----
// Callback support
⋮----
public static void RegisterWorkGiverRequirement(WorkGiverDef workGiver, StatDef stat)
⋮----
if (!_workGiverRequirements.ContainsKey(workGiver))
⋮----
if (!_workGiverRequirements[workGiver].Contains(stat))
_workGiverRequirements[workGiver].Add(stat);
⋮----
public static void RegisterJobRequirement(JobDef job, StatDef stat)
⋮----
if (!_jobRequirements.ContainsKey(job))
⋮----
if (!_jobRequirements[job].Contains(stat))
_jobRequirements[job].Add(stat);
⋮----
public static void RegisterStatAlias(StatDef stat, string alias)
⋮----
if (stat == null || string.IsNullOrEmpty(alias)) return;
if (!_statAliases.ContainsKey(stat))
⋮----
if (!_statAliases[stat].Contains(alias))
_statAliases[stat].Add(alias);
⋮----
public static void RegisterToolQuirk(string toolDefName, string quirkDescription)
⋮----
if (string.IsNullOrEmpty(toolDefName) || string.IsNullOrEmpty(quirkDescription)) return;
⋮----
public static void OnAfterDefsLoaded(Action callback)
⋮----
// Already initialized, run immediately
try { callback(); } catch (Exception e) { Log.Error($"[SurvivalTools Registry] Callback failed: {e}"); }
⋮----
_afterDefsLoadedCallbacks.Add(callback);
⋮----
// O(1) lookups
public static List<StatDef> GetWorkGiverRequirements(WorkGiverDef workGiver)
⋮----
return _workGiverRequirements.TryGetValue(workGiver, out var stats) ? stats : new List<StatDef>();
⋮----
public static List<StatDef> GetJobRequirements(JobDef job)
⋮----
return _jobRequirements.TryGetValue(job, out var stats) ? stats : new List<StatDef>();
⋮----
public static List<string> GetStatAliases(StatDef stat)
⋮----
return _statAliases.TryGetValue(stat, out var aliases) ? aliases : new List<string>();
⋮----
public static string GetToolQuirk(string toolDefName)
⋮----
return _toolQuirks.TryGetValue(toolDefName, out var quirk) ? quirk : null;
⋮----
// Array versions for JobGate (LINQ-free)
public static StatDef[] GetRequiredStatsFor(WorkGiverDef wg)
⋮----
return list.Count > 0 ? list.ToArray() : new StatDef[0];
⋮----
public static StatDef[] GetRequiredStatsFor(JobDef job)
⋮----
public static bool IsModActive(string packageId)
⋮----
if (string.IsNullOrEmpty(packageId)) return false;
return ModsConfig.ActiveModsInLoadOrder.Any(m =>
m.PackageId.Equals(packageId, StringComparison.OrdinalIgnoreCase));
⋮----
internal static void Initialize()
⋮----
// Run all deferred callbacks
⋮----
// No-op overloads for existing call sites (Phase 1 compatibility)
public static void RegisterWorkGiverRequirement(string workGiverDefName, string statDefName)
⋮----
var workGiver = DefDatabase<WorkGiverDef>.GetNamedSilentFail(workGiverDefName);
var stat = DefDatabase<StatDef>.GetNamedSilentFail(statDefName);
⋮----
public static void RegisterJobRequirement(string jobDefName, string statDefName)
⋮----
var job = DefDatabase<JobDef>.GetNamedSilentFail(jobDefName);
⋮----
public static void RegisterStatAlias(string statDefName, string alias)
⋮----
// ---------- Public API ----------
public static class CompatAPI
⋮----
// Registry entry points (Phase 1)
public static void RegisterWorkGiverRequirement(WorkGiverDef workGiver, StatDef stat) => SurvivalToolRegistry.RegisterWorkGiverRequirement(workGiver, stat);
public static void RegisterWorkGiverRequirement(string workGiverDefName, string statDefName) => SurvivalToolRegistry.RegisterWorkGiverRequirement(workGiverDefName, statDefName);
public static void RegisterJobRequirement(JobDef job, StatDef stat) => SurvivalToolRegistry.RegisterJobRequirement(job, stat);
public static void RegisterJobRequirement(string jobDefName, string statDefName) => SurvivalToolRegistry.RegisterJobRequirement(jobDefName, statDefName);
public static void RegisterStatAlias(StatDef stat, string alias) => SurvivalToolRegistry.RegisterStatAlias(stat, alias);
public static void RegisterStatAlias(string statDefName, string alias) => SurvivalToolRegistry.RegisterStatAlias(statDefName, alias);
/// <summary>
/// Register a tool quirk by defName match (legacy overload).
/// Forwarder to new quirk system.
/// </summary>
⋮----
// Forward to new system with exact defName match
⋮----
predicate: toolDef => string.Equals(toolDef.defName, toolDefName, StringComparison.OrdinalIgnoreCase),
action: applier => applier.AddDevNote(quirkDescription)
⋮----
public static void OnAfterDefsLoaded(Action callback) => SurvivalToolRegistry.OnAfterDefsLoaded(callback);
public static bool IsModActive(string packageId) => SurvivalToolRegistry.IsModActive(packageId);
// — Research Reinvented (kept for backward compatibility with your call sites) —
⋮----
// Cached stat defs to avoid recursion/expensive lookups
private static StatDef _cachedResearchSpeed;
private static StatDef _cachedFieldResearchSpeed;
public static StatDef GetResearchSpeedStat()
⋮----
?? DefDatabase<StatDef>.GetNamedSilentFail("ResearchSpeed"));
⋮----
public static StatDef GetFieldResearchSpeedStat()
⋮----
?? (_cachedFieldResearchSpeed = DefDatabase<StatDef>.GetNamedSilentFail("FieldResearchSpeedMultiplier")
?? DefDatabase<StatDef>.GetNamedSilentFail("RR_FieldResearchSpeed")
?? DefDatabase<StatDef>.GetNamedSilentFail("FieldResearchSpeed"));
⋮----
/// True if pawn has a survival tool (real or virtual) that provides research speed.
/// Works for both vanilla Research and RR’s Field Research.
⋮----
public static bool PawnHasResearchTools(Pawn pawn)
⋮----
if (researchStat != null && pawn.HasSurvivalToolFor(researchStat))
⋮----
if (fieldStat != null && pawn.HasSurvivalToolFor(fieldStat))
⋮----
public static bool IsRRWorkGiver(WorkGiverDef wg) => RRHelpers.IsRRWorkGiver(wg);
public static bool IsFieldResearchWorkGiver(WorkGiverDef wg) => RRHelpers.IsFieldResearchWorkGiver(wg);
// — Primitive Tools —
public static bool IsPrimitiveToolsActive => PrimitiveToolsHelpers.IsPrimitiveToolsActive();
public static bool PawnHasPrimitiveTools(Pawn pawn) => PrimitiveToolsHelpers.PawnHasPrimitiveTools(pawn);
public static List<Thing> GetPawnPrimitiveTools(Pawn pawn) => PrimitiveToolsHelpers.GetPawnPrimitiveTools(pawn);
public static bool ShouldOptimizeForPrimitiveTools() => PrimitiveToolsHelpers.ShouldOptimizeForPrimitiveTools();
// — Separate Tree Chopping —
public static bool IsSeparateTreeChoppingActive => SeparateTreeChoppingHelpers.IsSeparateTreeChoppingActive();
public static bool HasTreeFellingConflict() => SeparateTreeChoppingHelpers.HasTreeFellingConflict();
public static bool ApplyTreeFellingConflictResolution() => SeparateTreeChoppingHelpers.ApplyRecommendedResolution();
public static List<string> GetSeparateTreeChoppingRecommendations() => SeparateTreeChoppingHelpers.GetUserRecommendations();
// — Generic —
public static List<StatDef> GetAllCompatibilityStats() => CompatibilityRegistry.GetAllCompatibilityStats();
public static List<StatDef> GetAllResearchStats()
⋮----
if (r != null) list.Add(r);
if (f != null && !list.Contains(f)) list.Add(f);
⋮----
public static void DumpCompatibilityStatus() => CompatibilityRegistry.DumpCompatibilityStatus();
// Hot reload helper if you ever need to re-init on game load changes.
public static void ReinitializeRegistryForDebug()
⋮----
Log.Message("[SurvivalTools Compat] ReinitializeRegistryForDebug() called (dev only).");
⋮----
// Array getters for JobGate (Phase 5)
public static StatDef[] GetRequiredStatsFor(WorkGiverDef wg) => SurvivalToolRegistry.GetRequiredStatsFor(wg);
public static StatDef[] GetRequiredStatsFor(JobDef job) => SurvivalToolRegistry.GetRequiredStatsFor(job);
// Forwarders for compatibility (Phase 1 - add during refactor)
⋮----
/// Forwarder during refactor. Do not extend.
⋮----
public static List<StatDef> GetStatsForWorkGiver(WorkGiverDef workGiver)
⋮----
// Forward to existing StatGatingHelper during Phase 1
return StatGatingHelper.GetStatsForWorkGiver(workGiver);
⋮----
public static bool ShouldBlockJobForStat(StatDef stat, Pawn pawn = null)
⋮----
return settings != null && StatGatingHelper.ShouldBlockJobForStat(stat, settings, pawn);
⋮----
// Phase 2 forwarders for stat resolution
⋮----
public static float GetToolStatFactor(ThingDef toolDef, ThingDef stuffDef, StatDef stat)
⋮----
// Forward to new centralized resolver (Phase 2)
return Helpers.ToolStatResolver.GetToolStatFactor(toolDef, stuffDef, stat);
⋮----
public static ToolStatResolver.ToolStatInfo GetToolStatInfo(ThingDef toolDef, ThingDef stuffDef, StatDef stat)
⋮----
return Helpers.ToolStatResolver.GetToolStatInfo(toolDef, stuffDef, stat);
⋮----
/// Register a tool quirk with predicate and action.
/// Applied during stat resolution after inference but before clamping.
/// Quirks are processed in registration order.
⋮----
/// <param name="predicate">Test if this quirk applies to a tool def</param>
/// <param name="action">Apply quirk modifications</param>
public static void RegisterToolQuirk(Func<ThingDef, bool> predicate, Action<ToolQuirkApplier> action)
⋮----
Helpers.ToolStatResolver.RegisterQuirk(predicate, action);
⋮----
// -------------------------------------------------------------------------
// TEMPLATE for new compatibility modules
// Copy, rename, and fill in details when adding new mod integrations.
⋮----
/*
public class SomeOtherModCompatibilityModule : ICompatibilityModule
{
    public string ModName => "Some Other Mod";
    public bool IsModActive
    {
        get
        {
            // Example detection (by packageId or def presence)
            return ModsConfig.ActiveModsInLoadOrder.Any(m =>
                m.PackageId.Contains("author.somemod") ||
                m.Name.Contains("Some Other Mod"));
        }
    }
    public void Initialize()
    {
        if (IsModActive)
        {
            if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.IsCompatLogging())
                ST_Logging.LogInfo("[SurvivalTools Compat] SomeOtherMod detected and initialized.");
            // Perform setup or conflict resolution here
        }
    }
    public List<StatDef> GetCompatibilityStats()
    {
        // Return any StatDefs this mod introduces or uses
        return new List<StatDef>
        {
            // Example: DefDatabase<StatDef>.GetNamedSilentFail("SomeStat")
        };
    }
    public Dictionary<string, string> GetDebugInfo()
    {
        var info = new Dictionary<string, string>
        {
            ["Active"] = IsModActive.ToString(),
            ["Notes"] = "Fill in useful debug information here"
        };
        return info;
    }
}
*/
</file>

<file path="Source/Harmony/Patch_WorkGiver_MissingRequiredCapacity.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_WorkGiver_MissingRequiredCapacity.cs
// Legacy patch to gate work givers based on required tool stats.
// Replaced by integrated tool stat checks in WorkGiver_Scanner.CanWorkOnThing.
// Retained for compatibility with mods that patch or replace CanWorkOnThing.
// KEEP for now, may be useful for debugging or future features.
// Note: This patch runs after vanilla checks, so it only adds additional gating.
⋮----
public static class Patch_WorkGiver_MissingRequiredCapacity
⋮----
public static void Postfix(WorkGiver __instance, ref PawnCapacityDef __result, Pawn pawn)
⋮----
// If vanilla already blocked, or no pawn/def, leave it alone.
⋮----
// Only gate jobs that are eligible by default
if (!SurvivalToolUtility.ShouldGateByDefault(wgDef)) return;
// Nothing to gate on.
⋮----
// Use the overload with WorkGiverDef context (helps consistency + any logging).
if (!pawn.MeetsWorkGiverStatRequirements(required, wgDef))
⋮----
var missingStats = string.Join(", ",
required.Where(stat => stat != null)
.Where(stat => pawn.GetBestSurvivalTool(stat) == null)
.Select(stat => stat.defName));
</file>

<file path="Source/HarmonyPatches.cs">
// RimWorld 1.6 / C# 7.3
// Source/HarmonyPatches.cs
⋮----
internal static class HarmonyPatches
⋮----
private static readonly Type patchType = typeof(HarmonyPatches);
// One Harmony instance for all manual patches
⋮----
// Stat/Method lookups used in several transpilers (lazy initialized to avoid early DefOf access)
private static FieldInfo _constructionSpeed;
private static FieldInfo _maintenanceSpeedField;
private static FieldInfo _deconstructionSpeedField;
private static FieldInfo _sowingSpeedField;
private static FieldInfo _researchSpeedField;
private static MethodInfo _tryDegradeTool;
private static FieldInfo _pawnField;
private static FieldInfo _miningSpeedField;
private static FieldInfo _diggingSpeedField;
⋮----
AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.ConstructionSpeed)));
⋮----
AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.MaintenanceSpeed)));
⋮----
AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.DeconstructionSpeed)));
⋮----
AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.SowingSpeed)));
⋮----
AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.ResearchSpeed)));
⋮----
AccessTools.Method(typeof(SurvivalToolUtility), nameof(SurvivalToolUtility.TryDegradeTool),
⋮----
private static FieldInfo PawnField => _pawnField ?? (_pawnField = AccessTools.Field(typeof(JobDriver), nameof(JobDriver.pawn)));
private static FieldInfo MiningSpeedField => _miningSpeedField ?? (_miningSpeedField = AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.MiningSpeed)));
private static FieldInfo DiggingSpeedField => _diggingSpeedField ?? (_diggingSpeedField = AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.DiggingSpeed)));
⋮----
private static void TryPatch(string label, MethodBase original,
⋮----
H.Patch(original, prefix, postfix, transpiler, finalizer);
⋮----
// Find the anonymous state machine method that implements MakeNewToils
private static MethodInfo FindMakeNewToils(Type type)
⋮----
.GetNestedTypes(BindingFlags.Public | BindingFlags.NonPublic)
.SelectMany(AccessTools.GetDeclaredMethods)
.FirstOrDefault(m => m.ReturnType == typeof(void)
&& m.GetParameters().Length == 0
&& m.Name.Contains("MakeNewToils"));
⋮----
// (kept around for potential future use)
public static void TryDegradeTool_FromToil(Toil toil, StatDef stat)
⋮----
if (p != null) SurvivalToolUtility.TryDegradeTool(p, stat);
⋮----
// helpers (C# 7.3-friendly)
private static bool IsStloc(OpCode op)
⋮----
private static CodeInstruction LdForSt(CodeInstruction st)
⋮----
if (op == OpCodes.Stloc_0) return new CodeInstruction(OpCodes.Ldloc_0);
if (op == OpCodes.Stloc_1) return new CodeInstruction(OpCodes.Ldloc_1);
if (op == OpCodes.Stloc_2) return new CodeInstruction(OpCodes.Ldloc_2);
if (op == OpCodes.Stloc_3) return new CodeInstruction(OpCodes.Ldloc_3);
// stloc.s or stloc (short/long) – reuse the same operand
return new CodeInstruction(op == OpCodes.Stloc_S ? OpCodes.Ldloc_S : OpCodes.Ldloc, st.operand);
⋮----
// Attribute patches (if any)
H.PatchAll(Assembly.GetExecutingAssembly());
// IMMEDIATE VERIFICATION - Check if our PreWork patch was applied
⋮----
var targetMethod = typeof(Verse.AI.Pawn_JobTracker).GetMethod("TryTakeOrderedJob");
var patchInfo = HarmonyLib.Harmony.GetPatchInfo(targetMethod);
⋮----
var ourPatch = patchInfo.Prefixes.FirstOrDefault(p =>
⋮----
Log.Warning($"[SurvivalTools.Harmony] PreWork_AutoEquip patch SUCCESSFULLY applied with priority {ourPatch.priority}");
⋮----
Log.Error("[SurvivalTools.Harmony] PreWork_AutoEquip patch NOT FOUND after PatchAll!");
⋮----
Log.Warning($"[SurvivalTools.Harmony] TryTakeOrderedJob has {patchInfo.Prefixes.Count} total prefixes:");
⋮----
Log.Warning($"[SurvivalTools.Harmony] - {prefix.owner}: {prefix.PatchMethod.DeclaringType?.Name}.{prefix.PatchMethod.Name} (Priority: {prefix.priority})");
⋮----
Log.Error("[SurvivalTools.Harmony] No patches found on TryTakeOrderedJob at all!");
⋮----
Log.Error($"[SurvivalTools.Harmony] Failed to verify PreWork patch: {ex}");
⋮----
// -------- Vanilla --------
// Mining: reset pick hit uses DiggingSpeed instead of MiningSpeed + degrade on entry
⋮----
AccessTools.DeclaredMethod(typeof(JobDriver_Mine), "ResetTicksToPickHit"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_Mine_ResetTicksToPickHit)));
// Plants that obstruct construction zones
var postfixHandleBlocking = new HarmonyMethod(patchType, nameof(Postfix_HandleBlockingThingJob));
⋮----
AccessTools.Method(typeof(GenConstruct), nameof(GenConstruct.HandleBlockingThingJob)),
⋮----
AccessTools.Method(typeof(RoofUtility), nameof(RoofUtility.HandleBlockingThingJob)),
⋮----
// PlantWork MakeNewToils
⋮----
AccessTools.DeclaredMethod(typeof(JobDriver_PlantWork), "MakeNewToils"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_PlantWork_MakeNewToils)));
// ConstructFinishFrame MakeNewToils
⋮----
AccessTools.DeclaredMethod(typeof(JobDriver_ConstructFinishFrame), "MakeNewToils"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_ConstructFinishFrame_MakeNewToils)));
// Repair MakeNewToils
⋮----
AccessTools.DeclaredMethod(typeof(JobDriver_Repair), "MakeNewToils"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_Repair_MakeNewToils)));
// Deconstruct (tick)
⋮----
AccessTools.Method(typeof(JobDriver_Deconstruct), "TickActionInterval"),
prefix: new HarmonyMethod(patchType, nameof(Prefix_JobDriver_Deconstruct_TickActionInterval)));
// Plant Sowing
⋮----
AccessTools.DeclaredMethod(typeof(JobDriver_PlantSow), "MakeNewToils"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_PlantSow_MakeNewToils)));
// Research
var researchDriverType = GenTypes.GetTypeInAnyAssembly("RimWorld.JobDriver_Research");
⋮----
AccessTools.DeclaredMethod(researchDriverType, "MakeNewToils"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_Research_MakeNewToils)));
⋮----
// AffectRoof tick (nested iterator method)
⋮----
foreach (var t in typeof(JobDriver_AffectRoof).GetNestedTypes(BindingFlags.Public | BindingFlags.NonPublic))
foreach (var m in t.GetMethods(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.Static))
⋮----
var ps = m.GetParameters();
⋮----
m.Name.Contains("MakeNewToils"))
⋮----
transpiler: new HarmonyMethod(patchType, nameof(Transpile_AffectRoof_Tick))
⋮----
// -------- Fluffy Breakdowns --------
⋮----
var maintenanceDriver = GenTypes.GetTypeInAnyAssembly("Fluffy_Breakdowns.JobDriver_Maintenance");
if (maintenanceDriver != null && typeof(JobDriver).IsAssignableFrom(maintenanceDriver))
⋮----
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_Maintenance_MakeNewToils)));
⋮----
// -------- Quarry --------
⋮----
var quarryDriver = GenTypes.GetTypeInAnyAssembly("Quarry.JobDriver_MineQuarry");
if (quarryDriver != null && typeof(JobDriver).IsAssignableFrom(quarryDriver))
⋮----
AccessTools.Method(quarryDriver, "Mine"),
postfix: new HarmonyMethod(patchType, nameof(Postfix_JobDriver_MineQuarry_Mine)));
⋮----
AccessTools.Method(quarryDriver, "ResetTicksToPickHit"),
transpiler: new HarmonyMethod(patchType, nameof(Transpile_JobDriver_MineQuarry_ResetTicksToPickHit)));
⋮----
// -------- Turret Extensions --------
⋮----
var upgradeDriver = GenTypes.GetTypeInAnyAssembly("TurretExtensions.JobDriver_UpgradeTurret");
if (upgradeDriver != null && typeof(JobDriver).IsAssignableFrom(upgradeDriver))
⋮----
AccessTools.Method(upgradeDriver, "Upgrade"),
postfix: new HarmonyMethod(patchType, nameof(Postfix_JobDriver_UpgradeTurret_Upgrade)));
⋮----
// -------- Combat Extended --------
⋮----
var holdTracker = GenTypes.GetTypeInAnyAssembly("CombatExtended.Utility_HoldTracker");
⋮----
AccessTools.Method(holdTracker, "GetExcessThing"),
postfix: new HarmonyMethod(patchType, nameof(Postfix_CombatExtended_Utility_HoldTracker_GetExcessThing)));
⋮----
var compInventory = GenTypes.GetTypeInAnyAssembly("CombatExtended.CompInventory");
⋮----
// two overloads in CE 1.6: (Thing, ref int) and (ThingDef, ref int)
var mThing = AccessTools.GetDeclaredMethods(compInventory)
.FirstOrDefault(x => x.Name == "CanFitInInventory" && x.GetParameters().Length >= 1 && x.GetParameters()[0].ParameterType == typeof(Thing));
var mThingDef = AccessTools.GetDeclaredMethods(compInventory)
.FirstOrDefault(x => x.Name == "CanFitInInventory" && x.GetParameters().Length >= 1 && x.GetParameters()[0].ParameterType == typeof(ThingDef));
⋮----
mThing, postfix: new HarmonyMethod(patchType, nameof(Postfix_CombatExtended_CompInventory_CanFitInInventoryThing)));
⋮----
mThingDef, postfix: new HarmonyMethod(patchType, nameof(Postfix_CombatExtended_CompInventory_CanFitInInventoryThingDef)));
⋮----
// -------- Prison Labor --------
⋮----
var mineTweak = GenTypes.GetTypeInAnyAssembly("PrisonLabor.JobDriver_Mine_Tweak");
⋮----
AccessTools.Method(mineTweak, "ResetTicksToPickHit"),
⋮----
// NOTE: In 1.6 there is no FloatMenuMakerMap.AddHumanlikeOrders — we intentionally do NOT patch it.
⋮----
// ---------------- Vanilla postfixes/transpilers ----------------
public static void Postfix_HandleBlockingThingJob(ref Job __result, Pawn worker)
⋮----
// Redirect tree clearing to our FellTree job if the plant is a tree and pawn is allowed
⋮----
if (worker.CanFellTrees())
__result = new Job(ST_JobDefOf.FellTree, __result.targetA);
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_PlantWork_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
var list = instructions.ToList();
var plantHarvestingSpeed = AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.PlantHarvestingSpeed));
var vanillaPlantWorkSpeed = AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.PlantWorkSpeed));
⋮----
yield return ins;                                           // keep store
yield return new CodeInstruction(OpCodes.Ldloc_0);           // actor
yield return new CodeInstruction(OpCodes.Ldsfld, plantHarvestingSpeed);
ins = new CodeInstruction(OpCodes.Call, TryDegradeTool);    // TryDegradeTool(actor, PlantHarvestingSpeed)
⋮----
ins.operand = plantHarvestingSpeed;                          // replace PlantWorkSpeed -> PlantHarvestingSpeed
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_Mine_ResetTicksToPickHit(IEnumerable<CodeInstruction> instructions)
⋮----
// Inject once at method entry:
⋮----
// TryDegradeTool(this.pawn, ST_StatDefOf.DiggingSpeed);
yield return new CodeInstruction(OpCodes.Ldarg_0);                   // this
yield return new CodeInstruction(OpCodes.Ldfld, PawnField);          // this.pawn
yield return new CodeInstruction(OpCodes.Ldsfld, DiggingSpeedField); // ST_StatDefOf.DiggingSpeed
yield return new CodeInstruction(OpCodes.Call, TryDegradeTool);      // call
⋮----
// Replace MiningSpeed with DiggingSpeed
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_ConstructFinishFrame_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
yield return new CodeInstruction(OpCodes.Ldloc_0);
yield return new CodeInstruction(OpCodes.Ldsfld, ConstructionSpeed);
ins = new CodeInstruction(OpCodes.Call, TryDegradeTool);
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_Repair_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
public static void Prefix_JobDriver_Deconstruct_TickActionInterval(JobDriver_Deconstruct __instance)
⋮----
SurvivalToolUtility.TryDegradeTool(__instance.pawn, ST_StatDefOf.DeconstructionSpeed);
⋮----
public static IEnumerable<CodeInstruction> Transpile_AffectRoof_Tick(
⋮----
var code = instructions.ToList();
// The display class that holds the captured locals for the lambda
⋮----
.GetFields(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic)
.FirstOrDefault(f => f.FieldType == typeof(Toil));
⋮----
var toilActorField = AccessTools.Field(typeof(Toil), nameof(Toil.actor)); // Pawn
var constructionSpeed = AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.ConstructionSpeed));
// Inject at method start: TryDegradeTool(this.<toil>.actor, StatDefOf.ConstructionSpeed);
⋮----
yield return new CodeInstruction(OpCodes.Ldarg_0);                   // this (display class)
yield return new CodeInstruction(OpCodes.Ldfld, displayToilField);   // this.<toil>
yield return new CodeInstruction(OpCodes.Ldfld, toilActorField);     // this.<toil>.actor
yield return new CodeInstruction(OpCodes.Ldsfld, constructionSpeed); // StatDefOf.ConstructionSpeed
yield return new CodeInstruction(OpCodes.Call, TryDegradeTool);      // call TryDegradeTool
⋮----
// ---------- Modded JobDrivers ----------
public static IEnumerable<CodeInstruction> Transpile_JobDriver_Maintenance_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
yield return new CodeInstruction(OpCodes.Ldsfld, MaintenanceSpeedField);
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_PlantSow_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
yield return new CodeInstruction(OpCodes.Ldsfld, SowingSpeedField);
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_Research_MakeNewToils(IEnumerable<CodeInstruction> instructions)
⋮----
yield return new CodeInstruction(OpCodes.Ldsfld, ResearchSpeedField);
⋮----
public static IEnumerable<CodeInstruction> Transpile_JobDriver_MineQuarry_ResetTicksToPickHit(IEnumerable<CodeInstruction> instructions)
⋮----
var miningSpeed = AccessTools.Field(typeof(StatDefOf), nameof(StatDefOf.MiningSpeed));
var diggingSpeed = AccessTools.Field(typeof(ST_StatDefOf), nameof(ST_StatDefOf.DiggingSpeed));
⋮----
public static void Postfix_JobDriver_MineQuarry_Mine(JobDriver __instance, Toil __result)
⋮----
SurvivalToolUtility.TryDegradeTool(pawn, ST_StatDefOf.DiggingSpeed);
⋮----
__result.defaultDuration = (int)Mathf.Clamp(3000f / pawn.GetStatValue(ST_StatDefOf.DiggingSpeed), 500f, 10000f);
⋮----
public static void Postfix_JobDriver_UpgradeTurret_Upgrade(JobDriver __instance, Toil __result)
⋮----
SurvivalToolUtility.TryDegradeTool(pawn, StatDefOf.ConstructionSpeed);
⋮----
// ---------- Combat Extended hooks ----------
public static void Postfix_CombatExtended_Utility_HoldTracker_GetExcessThing(ref bool __result, Thing dropThing)
⋮----
public static void Postfix_CombatExtended_CompInventory_CanFitInInventoryThing(ThingComp __instance, ref bool __result, Thing thing, ref int count)
⋮----
if (__result && thing is SurvivalTool && __instance?.parent is Pawn pawn && !pawn.CanCarryAnyMoreSurvivalTools())
⋮----
public static void Postfix_CombatExtended_CompInventory_CanFitInInventoryThingDef(ThingComp __instance, ref bool __result, ThingDef thingDef, ref int count)
⋮----
if (__result && thingDef != null && typeof(SurvivalTool).IsAssignableFrom(thingDef.thingClass) && __instance?.parent is Pawn pawn && !pawn.CanCarryAnyMoreSurvivalTools())
</file>

<file path="Source/AI/JobGiver_OptimizeSurvivalTools.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/JobGiver_OptimizeSurvivalTools.cs
⋮----
namespace SurvivalTools
⋮----
/// <summary>
/// OBSOLETE: Phase 4-6 Legacy system. Replaced by AssignmentSearch.TryUpgradeFor and PreWork_AutoEquip.
/// Kept as stub for compatibility during refactor transition.
/// </summary>
⋮----
public class JobGiver_OptimizeSurvivalTools : ThinkNode_JobGiver
⋮----
protected override Job TryGiveJob(Pawn pawn)
⋮----
// Legacy optimization system gutted - Phase 6 PreWork_AutoEquip handles tool assignment
⋮----
if (!pawn.CanUseSurvivalTools()) return null;
// Forward to new Phase 6 assignment system
// AssignmentSearch.TryUpgradeFor handles the actual optimization logic now
⋮----
// Let Phase 6 handle assignment upgrades - no job needed from here
// PreWork_AutoEquip will handle tool acquisition as part of work flow
⋮----
// Defensive: if Phase 6 system fails, don't break the game
⋮----
/// OBSOLETE: Public API kept for compatibility. Use AssignmentSearch.TryUpgradeFor instead.
⋮----
public static Job TryOptimizeToolsFor(Pawn pawn)
⋮----
// Forward to Phase 6 assignment system
return null; // PreWork_AutoEquip handles this automatically now
</file>

<file path="Source/Harmony/Patch_Pawn_InventoryTracker.cs">
// Rimworld 1.6 / C# 7.3
// Source/Harmony/Patch_Pawn_InventoryTracker.cs
// Legacy Code but likely needs to be kept. Handles inventory unloading and idle tool trimming.
// Prevents unloading in-use tools, and respects forced+in-use during idle auto-trimming.
// Refactor with new tool tracking system, KEEP.
⋮----
public static class Patch_Pawn_InventoryTracker
⋮----
// ------------------------------
// Prevent unloading an "in-use" tool (real or virtual)
⋮----
public static class FirstUnloadableThing_Postfix
⋮----
public static void Postfix(Pawn_InventoryTracker __instance, ref ThingCount __result)
⋮----
// If the first unloadable item is an in-use tool (real or virtual), try to pick another item.
⋮----
(thing is SurvivalTool st && SurvivalToolUtility.IsToolInUse(st)) ||
(thing.def.IsToolStuff() && VirtualInUse(thing));
⋮----
// Find the first alternative item that is *not* an in-use SurvivalTool.
Thing alt = null;
⋮----
// Skip in-use real tools
⋮----
// Plain items (including tool-stuff stacks) are fine to unload
⋮----
__result = (alt != null) ? new ThingCount(alt, alt.stackCount) : default(ThingCount);
⋮----
private static bool VirtualInUse(Thing toolStuff)
⋮----
// Tool-stuff can be virtually wrapped; if that wrapper is "in use", treat this as in-use.
var v = VirtualTool.FromThing(toolStuff);
return v != null && SurvivalToolUtility.IsToolInUse(v);
⋮----
// Idle auto-trim of excess tools (respecting forced + in-use)
⋮----
public static class InventoryTracker_Tick_Patch
⋮----
public static IEnumerable<MethodBase> TargetMethods()
⋮----
// Cover both names used across versions.
var tick = AccessTools.Method(typeof(Pawn_InventoryTracker), "InventoryTrackerTick");
var tickRare = AccessTools.Method(typeof(Pawn_InventoryTracker), "InventoryTrackerTickRare");
⋮----
public static void Postfix(Pawn_InventoryTracker __instance)
⋮----
// Every ~1s real-time @60 TPS; skip while busy.
if (!pawn.IsHashIntervalTick(60) || pawn.jobs?.curJob != null) return;
⋮----
if (!pawn.CanUseSurvivalTools() || !pawn.CanRemoveExcessSurvivalTools()) return;
int heldCount = pawn.HeldSurvivalToolCount();
float cap = pawn.GetStatValue(ST_StatDefOf.SurvivalToolCarryCapacity);
⋮----
// Prefer dropping a held (real/virtual) SurvivalTool that is not forced and not in-use.
Thing toolToDrop = FindDroppableHeldTool(pawn);
⋮----
// Fallback: a plain tool-stuff stack from inventory if all tools are "in use".
⋮----
if (t != null && t.def.IsToolStuff())
⋮----
// Respect forced handler on the physical thing.
⋮----
// Respect recent-acquisition protection: avoid dropping just-acquired tool
if (toolToDrop != null && AssignmentSearch.IsRecentlyAcquired(pawn, PhysicalThingFor(toolToDrop, pawn)))
⋮----
// Final safety: re-check recent-acquisition protection before issuing the drop
if (AssignmentSearch.IsRecentlyAcquired(pawn, PhysicalThingFor(toolToDrop, pawn)))
⋮----
var dropJob = pawn.DequipAndTryStoreSurvivalTool(toolToDrop, enqueueCurrent: false);
⋮----
pawn.jobs.TryTakeOrderedJob(dropJob, JobTag.Misc);
⋮----
private static Thing FindDroppableHeldTool(Pawn pawn)
⋮----
// Scan the "held tools" projection (real tools + virtual tool-stuff).
var held = pawn.GetHeldSurvivalTools();
⋮----
var asTool = t as SurvivalTool; // includes VirtualTool
⋮----
if (!SurvivalToolUtility.IsToolInUse(asTool))
⋮----
// Shouldn't happen (projection returns tools or virtual tools),
// but if we ever get a plain thing here, allow it.
⋮----
private static bool IsForced(Pawn pawn, Thing physical)
⋮----
return tracker.forcedHandler.IsForced(physical);
⋮----
private static Thing PhysicalThingFor(Thing toolOrVirtual, Pawn pawn)
⋮----
return st != null ? SurvivalToolUtility.BackingThing(st, pawn) ?? toolOrVirtual : toolOrVirtual;
⋮----
// Clear forced flag when an item leaves inventory
⋮----
public static class Notify_ItemRemoved_Postfix
⋮----
public static void Postfix(Pawn_InventoryTracker __instance, Thing item)
⋮----
// Clear forced status for SurvivalTool or tool-stuff.
if (item is SurvivalTool || item.def.IsToolStuff())
⋮----
try { SurvivalToolUtility.ToolFactorCache.InvalidateForThing(item); } catch { }
try { SurvivalToolUtility.ClearCountersForThing(item); } catch { }
</file>

<file path="Source/SurvivalTool.cs">
// RimWorld 1.6 / C# 7.3
// Source/SurvivalTool.cs
// is this integrated with our refactor? Legacy code: needs review and evaluation.
//
// SurvivalTool
// - Caches work stat factors from: tool def (mod ext + statBases) and stuff def (mod ext)
// - Dedupe by stat (keep max value) for stable scoring
// - Hardcoded English inspect labels (intentional)
// - Null-safe and logging-friendly
⋮----
using System.Linq;           // Contains / Any / ToList
⋮----
namespace SurvivalTools
⋮----
public class SurvivalTool : ThingWithComps
⋮----
/// <summary>Persistent usage counter (used by degradation logic and other systems).</summary>
⋮----
/// <summary>Cached work stat factors sourced from def/stuff; rebuilt on spawn/load when needed.</summary>
⋮----
/// <summary>Exposes cached factors (with lazy initialization when cache is not built).</summary>
⋮----
public override void PostMake()
⋮----
base.PostMake();
⋮----
var list = WorkStatFactors.Select(m => $"{m.stat?.defName ?? "null"}={m.value:G}").ToArray();
LogDebug($"[SurvivalTools] {LabelCap} factors: {string.Join(", ", list)}", $"SurvivalTool_Factors_{this.GetHashCode()}");
⋮----
// swallow: debug-only
⋮----
// Prefer SpawnSetup(Map,bool) for 1.6 over PostSpawnSetup(bool)
public override void SpawnSetup(Map map, bool respawningAfterLoad)
⋮----
base.SpawnSetup(map, respawningAfterLoad);
⋮----
public override void ExposeData()
⋮----
base.ExposeData();
Scribe_Values.Look(ref workTicksDone, "workTicksDone", 0);
// Rebuild cache after load to avoid stale references
⋮----
/// <summary>
/// Force recalculation of work stat factors. Useful when mod settings change
/// or when existing tools need to be updated after mod updates.
/// </summary>
public void RefreshWorkStatFactors()
⋮----
// Next access to WorkStatFactors will trigger InitializeWorkStatFactors
⋮----
private void InitializeWorkStatFactors()
⋮----
// Use the centralized ToolFactorCache for fast, safe caching. The cache implements
// delayed activation so we avoid using it too early during PostLoad init which
// previously led to CTDs. Before activation the cache computes results on-the-fly
// without storing them. Once initialized, results are cached and re-used.
⋮----
// Request precomputed factors from the central cache. Pass this SurvivalTool
// so the cache can apply any instance-specific multipliers if necessary.
var computed = SurvivalToolUtility.ToolFactorCache.GetOrComputeToolFactors(def, Stuff, this);
⋮----
// Never throw during initialization; keep an empty list on failure.
⋮----
// Special-case: if this is a VirtualTool, its physical SourceThing
// may be in a pawn's inventory/equipment. Prefer that holder when present.
⋮----
// For virtual wrappers, the job will target the physical backing thing.
// Use a canonical comparison thing: the source physical thing for virtuals,
// otherwise the tool object itself.
Thing comparisonThing = (this is VirtualTool v && v.SourceThing != null) ? (Thing)v.SourceThing : (Thing)this;
⋮----
/// How many work-ticks of usage correspond to one HP of wear.
/// (estimated lifespan in days * ticks/day) / max HP
⋮----
float lifespanDays = this.GetStatValue(ST_StatDefOf.ToolEstimatedLifespan);
int hp = Math.Max(1, MaxHitPoints);
⋮----
return (int)Math.Floor(ticksPerHp);
⋮----
public override string GetInspectString()
⋮----
var sb = new StringBuilder();
// Held by
⋮----
sb.AppendLine($"Held by {holder.LabelShort}");
// In use
⋮----
sb.AppendLine("In use");
// Condition / lifespan
⋮----
sb.AppendLine($"Condition: {HitPoints}/{MaxHitPoints} ({(hpFrac * 100f):F0}%)");
sb.AppendLine($"Estimated lifespan: {lifespanDays:F1}d");
⋮----
// Append base inspect string (if any)
var baseStr = base.GetInspectString();
if (!baseStr.NullOrEmpty())
⋮----
if (sb.Length > 0) sb.AppendLine();
sb.Append(baseStr);
⋮----
return SanitizeInspectString(sb.ToString());
⋮----
private static string SanitizeInspectString(string s)
⋮----
if (string.IsNullOrEmpty(s)) return s;
s = s.Replace("\r\n", "\n").Replace('\r', '\n');
⋮----
.Split('\n')
.Select(line => line?.Trim())
.Where(line => !string.IsNullOrEmpty(line));
return string.Join("\n", lines).TrimEnd();
</file>

<file path="1.6/Languages/English/keyed/Keys.xml">
<LanguageData>
    <NoTool>No tool</NoTool>
    <ToolInUse>in use</ToolInUse>
    <!-- Settings -->
    <SurvivalToolsSettingsCategory>Survival Tools Reborn</SurvivalToolsSettingsCategory>
    <Settings_BasicSection>Basic Settings</Settings_BasicSection>
    <Settings_DebugSection>Debug Settings</Settings_DebugSection>
    <Settings_HardcoreMode>Hardcore mode</Settings_HardcoreMode>
    <Settings_HardcoreMode_Tooltip>Significantly increases difficulty by making tools essential for survival. Without proper tools, colonists become unable to perform most work tasks effectively. Tools also wear out 50% faster, requiring more frequent replacement and better tool management. Transforms the game into a true tool-dependent survival experience.</Settings_HardcoreMode_Tooltip>
    <Settings_ExtraHardcoreMode>Extra hardcore mode</Settings_ExtraHardcoreMode>
    <Settings_ExtraHardcoreMode_Tooltip>MAXIMUM DIFFICULTY: The ultimate survival challenge. When combined with hardcore mode, colonists become completely helpless without the right tools. Tasks that were merely inefficient (like cleaning by hand or improvised medical care) become impossible to attempt. Tools degrade 87.5% faster than normal, creating constant pressure for tool production and maintenance. Use the checkboxes below to control exactly which work types become tool-dependent. WARNING: Early game becomes extremely challenging - tool acquisition becomes critical for colony survival!</Settings_ExtraHardcoreMode_Tooltip>
    <Settings_RequireCleaningTools>Require cleaning tools</Settings_RequireCleaningTools>
    <Settings_RequireCleaningTools_Tooltip>Forces colonists to use proper cleaning tools (like brooms or mops) for all cleaning tasks. Without the right tools, they cannot clean floors, remove filth, or clear snow. Essential for maintaining colony hygiene in extreme difficulty modes.</Settings_RequireCleaningTools_Tooltip>
    <Settings_RequireButcheryTools>Require butchery tools</Settings_RequireButcheryTools>
    <Settings_RequireButcheryTools_Tooltip>Mandates proper cutting tools (like knives or cleavers) for all butchery and slaughter operations. Colonists cannot process meat or slaughter animals without appropriate bladed implements. Critical for food production chains in hardcore scenarios.</Settings_RequireButcheryTools_Tooltip>
    <Settings_RequireMedicalTools>Require medical tools</Settings_RequireMedicalTools>
    <Settings_RequireMedicalTools_Tooltip>Enforces the use of specialized medical instruments for surgical procedures and advanced medical care. Operations become impossible without proper surgical tools, making medical equipment acquisition vital for colony health and survival.</Settings_RequireMedicalTools_Tooltip>
    <Settings_ToolMapGen>Tools in ruined buildings</Settings_ToolMapGen>
    <Settings_ToolMapGen_Tooltip>Generates basic survival tools in ancient ruins and crashed structures during map generation. These weathered tools provide essential early-game resources but are typically low-quality. Invaluable for starting colonies in harsh difficulty modes where initial tool access is critical.</Settings_ToolMapGen_Tooltip>
    <Settings_ToolLimit>Tool carrying limit</Settings_ToolLimit>
    <Settings_ToolLimit_Tooltip>Restricts colonists to carrying a maximum of 2-3 tools in their inventory simultaneously (excluding caravan travel). Forces strategic tool management and specialization among colonists. Tool belts and similar gear can increase this limit. Adds realistic inventory constraints to tool usage.</Settings_ToolLimit_Tooltip>
    <Settings_ToolDegradationRate>Tool degradation rate</Settings_ToolDegradationRate>
    <Settings_ToolOptimization>Automatic tool optimization</Settings_ToolOptimization>
    <Settings_ToolOptimization_Tooltip>Enables intelligent tool management where colonists automatically select and carry the most effective tools for their assigned work. They'll upgrade to better tools and drop inferior ones as needed. Disable this if you prefer manual tool control or experience performance issues with modded materials.</Settings_ToolOptimization_Tooltip>
    <Settings_EnableTreeFelling>Enable Survival Tools tree felling system</Settings_EnableTreeFelling>
    <Settings_EnableTreeFelling_Tooltip>Controls whether Survival Tools manages tree cutting jobs with its specialized Fell Trees and Harvest Trees system. When enabled (default), colonists use ST's enhanced tree felling that requires appropriate tools and provides better efficiency. When disabled, trees are handled by the standard Plant Cut job or other mods like Separate Tree Chopping (Continued). Disable this if you prefer to use other tree-cutting mods without overlap.</Settings_EnableTreeFelling_Tooltip>
    <Settings_ShowUpgradeSuggestions>Show upgrade suggestions</Settings_ShowUpgradeSuggestions>
    <Settings_ShowUpgradeSuggestions_Tooltip>When enabled, the UI will show suggestions to upgrade currently equipped tools to better materials or higher-quality variants when available.</Settings_ShowUpgradeSuggestions_Tooltip>
    <Settings_PickupFromStorageOnly>Restrict tool pickup to storage areas</Settings_PickupFromStorageOnly>
    <Settings_PickupFromStorageOnly_Tooltip>When enabled, colonists will only acquire tools from designated storage zones, maintaining better organization and preventing them from grabbing tools from work areas. When disabled, they can pick up any accessible tool in the Home area (excluding forbidden or burning items), providing more flexibility but less control.</Settings_PickupFromStorageOnly_Tooltip>
    <Settings_AllowPacifistEquip>Allow pacifists to equip survival tools</Settings_AllowPacifistEquip>
    <Settings_AllowPacifistEquip_Tooltip>Permits pacifist colonists to equip survival tools that are classified as weapons (like axes, picks, or knives). While these tools have combat capabilities, they're essential for work tasks like tree felling, mining, or food preparation. When enabled, pacifists can use these tools for productive work while still refusing to engage in violence.</Settings_AllowPacifistEquip_Tooltip>
    <Settings_DebugLogging>Enable detailed debug logging</Settings_DebugLogging>
    <Settings_DebugLogging_Tooltip>Activates comprehensive logging of tool selection decisions, automatic pickup behavior, and job-tool matching logic. Essential for troubleshooting tool issues or understanding why colonists choose specific tools. Recommended only for mod development or when experiencing tool-related problems. May impact performance with extensive logging output.</Settings_DebugLogging_Tooltip>
    <Settings_CompatLogging>Enable compatibility debug logging</Settings_CompatLogging>
    <Settings_CompatLogging_Tooltip>Activates detailed logging for mod compatibility systems including Research Reinvented integration, stat detection, and WorkGiver wiring. Shows step-by-step compatibility setup and integration processes. Only shown when general debug logging is enabled. Useful for diagnosing issues with mod interactions.</Settings_CompatLogging_Tooltip>
    <Settings_AutoTool>Smart pre-work tool pickup</Settings_AutoTool>
    <Settings_AutoTool_Tooltip>Revolutionizes workflow efficiency by having colonists automatically acquire the optimal tool before starting any job. They'll intelligently swap tools, upgrade to better variants, and ensure they have the right equipment for maximum productivity. The cornerstone feature for seamless tool-based gameplay.</Settings_AutoTool_Tooltip>
    <!-- Cleaning penalty (replaces hard blocking) -->
    <Settings_EnableCleaningPenalties>Enable cleaning penalties (no blocking)</Settings_EnableCleaningPenalties>
    <Settings_EnableCleaningPenalties_Tooltip>When enabled, pawns without appropriate cleaning tools (brooms / mops etc.) suffer a severe Cleaning Speed penalty instead of being blocked from cleaning entirely. Penalty severity scales with Hardcore / Extra Hardcore modes. Disable to revert to vanilla-like behavior (no penalty). Recommended for balanced challenge without soft-locking colony hygiene.</Settings_EnableCleaningPenalties_Tooltip>
    <!-- Alert verbosity toggle -->
    <SurvivalTools_ShowDetailedToolListInAlert>Show detailed tool list in alert</SurvivalTools_ShowDetailedToolListInAlert>
    <SurvivalTools_ShowDetailedToolListInAlert_Tooltip>When enabled, the 'Colonist lacks essential tools' alert expands each pawn entry to list every missing or underpowered work stat along with the best tool (if any) they currently have. When disabled, a concise one-line summary per pawn is shown. Helpful for diagnostics; disable for a cleaner alert panel.</SurvivalTools_ShowDetailedToolListInAlert_Tooltip>
    <!-- Alerts -->
    <ColonistNeedsSurvivalTool>Colonist lacks essential tools</ColonistNeedsSurvivalTool>
    <ColonistsNeedSurvivalTool>Colonists lack essential tools</ColonistsNeedSurvivalTool>
    <ColonistNeedsSurvivalToolDesc>These colonists need proper tools for their assigned work but lack the necessary equipment. Their productivity is severely compromised.</ColonistNeedsSurvivalToolDesc>
    <ST_MissingToolsShort>Missing</ST_MissingToolsShort>
    <ST_NoActionableItems>No actionable items</ST_NoActionableItems>
    <WorkSpeedGlobalShort>Global</WorkSpeedGlobalShort>
    <SurvivalToolsNeedReplacing>Tools approaching failure</SurvivalToolsNeedReplacing>
    <SurvivalToolNeedsReplacingDesc>These colonists are using tools in critical condition that will break soon. Replace them immediately to avoid work disruption.</SurvivalToolNeedsReplacingDesc>
    <!-- Tool assignment management -->
    <ManageSurvivalToolAssignments>Manage tool assignments</ManageSurvivalToolAssignments>
    <SurvivalToolAssignment>Tool assignment</SurvivalToolAssignment>
    <SurvivalToolAssignmentConstructor>Constructor</SurvivalToolAssignmentConstructor>
    <SurvivalToolAssignmentMiner>Miner</SurvivalToolAssignmentMiner>
    <SurvivalToolAssignmentPlantWorker>Plant worker</SurvivalToolAssignmentPlantWorker>
    <SurvivalToolAssignmentResearcher>Researcher</SurvivalToolAssignmentResearcher>
    <SurvivalToolAssignmentCleaner>Cleaner</SurvivalToolAssignmentCleaner>
    <SurvivalToolAssignmentMedical>Medical</SurvivalToolAssignmentMedical>
    <SurvivalToolAssignmentButcher>Butcher</SurvivalToolAssignmentButcher>
    <SelectSurvivalToolAssignment>Select tool assignment...</SelectSurvivalToolAssignment>
    <NewSurvivalToolAssignment>New tool assignment</NewSurvivalToolAssignment>
    <DeleteSurvivalToolAssignment>Delete tool assignment...</DeleteSurvivalToolAssignment>
    <SurvivalToolAssignmentInUse>Tool assignment is in use by {0}</SurvivalToolAssignmentInUse>
    <NoSurvivalToolAssignmentSelected>No tool assignment selected</NoSurvivalToolAssignmentSelected>
    <ForcedSurvivalTools>Forced tools</ForcedSurvivalTools>
    <!-- Job Requirements Table -->
    <JobTable_JobTypes>Job Types</JobTable_JobTypes>
    <JobTable_JobType>Job Type</JobTable_JobType>
    <JobTable_NormalMode>Normal Mode</JobTable_NormalMode>
    <JobTable_HardcoreMode>Hardcore Mode</JobTable_HardcoreMode>
    <JobTable_Enhanced>Enhanced</JobTable_Enhanced>
    <JobTable_Required>Required</JobTable_Required>
    <JobTable_NoJobsFound>No tool-enhanced jobs found.</JobTable_NoJobsFound>
    <JobTable_SectionTitle>Job Tool Requirements by Mode</JobTable_SectionTitle>
    <JobTable_SectionTooltip>This table shows how different job types behave in each difficulty mode. 'Enhanced' means tools provide bonuses but aren't required. 'Required' means tools are necessary to perform the job. Use this to understand which tools your colonists will need based on your current settings.</JobTable_SectionTooltip>
    <!-- Job Table Headers -->
    <JobTable_Normal>Normal</JobTable_Normal>
    <JobTable_Hardcore>Hardcore</JobTable_Hardcore>
    <JobTable_ExtraHardcore>Extra Hardcore</JobTable_ExtraHardcore>
    <!-- Resizable Settings Window -->
    <Settings_EnhancedWindowDescription>Click the button below to open the enhanced, resizable settings window with all mod options.</Settings_EnhancedWindowDescription>
    <Settings_OpenEnhancedButton>Open Enhanced Settings</Settings_OpenEnhancedButton>
    <!-- Normal Mode explanatory texts -->
    <Settings_NormalModeSection>Normal Mode Work Speed Settings</Settings_NormalModeSection>
    <Settings_NormalMode_Explanation>Normal Mode Behavior:\n• Core work (mining, construction, farming, crafting) gets penalties without tools\n• Optional work (cleaning, research, medical) is unaffected\n• Hardcore mode applies penalties to ALL work types</Settings_NormalMode_Explanation>
    <Settings_EnableNormalModePenalties>Enable Normal Mode Penalties</Settings_EnableNormalModePenalties>
    <Settings_EnableNormalModePenalties_Tooltip>When enabled, pawns work slower at core tasks without proper tools in normal mode. When disabled, only hardcore mode applies penalties.</Settings_EnableNormalModePenalties_Tooltip>
    <Settings_NormalModeToolPenalty>Normal Mode Tool Penalty</Settings_NormalModeToolPenalty>
    <Settings_NormalModePenalties_HelperText>(Applies only to core work: mining, construction, farming, crafting. Optional work like cleaning is unaffected.)</Settings_NormalModePenalties_HelperText>
    <Settings_NormalModePenalties_Disabled>Normal mode penalties disabled - pawns work at full speed without tools except in hardcore mode.</Settings_NormalModePenalties_Disabled>
    <Settings_QualityToolScaling>Use quality-based tool scaling</Settings_QualityToolScaling>
    <Settings_QualityToolScaling_Tooltip>Awful tools are less effective, Legendary tools are stronger. Balances difficulty by making tool choice and quality matter in addition to material.</Settings_QualityToolScaling_Tooltip>
    <!-- Mod Compatibility -->
    <Compat_ResearchReinvented>Reinvented Research</Compat_ResearchReinvented>
    <Compat_FieldResearch>Field Research</Compat_FieldResearch>
    <Compat_ReinventedResearchAlert>Reinvented Research</Compat_ReinventedResearchAlert>
    <!-- WorkSpeedGlobal Configuration (Added) -->
    <!-- Added WorkSpeedGlobal translation keys -->
    <WorkSpeedGlobal_Title>General Work Speed Job Configuration</WorkSpeedGlobal_Title>
    <WorkSpeedGlobal_Description>Select which jobs that use the general work speed stat should be gated by survival tools. Ungated jobs ignore tool penalties when colonists lack proper tools.</WorkSpeedGlobal_Description>
    <WorkSpeedGlobal_JobTypeHeader>Job Type</WorkSpeedGlobal_JobTypeHeader>
    <WorkSpeedGlobal_GatedHeader>Gated</WorkSpeedGlobal_GatedHeader>
    <WorkSpeedGlobal_DescriptionHeader>Description</WorkSpeedGlobal_DescriptionHeader>
    <WorkSpeedGlobal_NoJobsFound>No general work speed jobs found.</WorkSpeedGlobal_NoJobsFound>
    <WorkSpeedGlobal_EnableAll>Enable All</WorkSpeedGlobal_EnableAll>
    <WorkSpeedGlobal_DisableAll>Disable All</WorkSpeedGlobal_DisableAll>
    <WorkSpeedGlobal_ResetDefaults>Reset to Defaults</WorkSpeedGlobal_ResetDefaults>
    <WorkSpeedGlobal_TraceWorkGivers>Trace WorkGivers</WorkSpeedGlobal_TraceWorkGivers>
    <WorkSpeedGlobal_JobStatus_Gated>Requires tools in hardcore modes</WorkSpeedGlobal_JobStatus_Gated>
    <WorkSpeedGlobal_JobStatus_Ungated>No tool penalties applied</WorkSpeedGlobal_JobStatus_Ungated>
    <WorkSpeedGlobal_OpenConfigButton>Configure General Work Speed Jobs</WorkSpeedGlobal_OpenConfigButton>
    <!-- Job Table Additional (Added) -->
    <JobTable_NoActiveMode>No active mode selected.</JobTable_NoActiveMode>
    <JobTable_GatedFormat>Gated ({0}/{1})</JobTable_GatedFormat>
    <JobTable_GatedExample>Gated (99/99)</JobTable_GatedExample>
    <JobTable_Status_Unknown>Unknown</JobTable_Status_Unknown>
    <JobTable_Blocked>Blocked</JobTable_Blocked>
    <!-- Denial / Slowdown Motes -->
    <SurvivalTools_Mote_Blocked>Blocked: Needs {0}</SurvivalTools_Mote_Blocked>
    <SurvivalTools_Mote_Slowed>Slowed (x{0})</SurvivalTools_Mote_Slowed>
    <SurvivalTools_Mote_NeedsAndSlowed>Needs {0}  Slowed (x{1})</SurvivalTools_Mote_NeedsAndSlowed>
    <!-- Denial Mote Setting -->
    <Settings_ShowDenialMotes>Show denial and slowdown motes</Settings_ShowDenialMotes>
    <Settings_ShowDenialMotes_Tooltip>When enabled, pawns will display floating text motes when a job is blocked for lacking required tools (Hardcore/Extra Hardcore) or when continuing at a severe slowdown (Normal mode penalties / fallback cases). Includes per-pawn+stat cooldown to prevent spam. Disable for a cleaner screen or if using another feedback mod.</Settings_ShowDenialMotes_Tooltip>
    <!-- StatPart Phase 4 Localization -->
    <ST_StatPart_Header>Survival Tools</ST_StatPart_Header>
    <ST_StatPart_NoToolPenalty>No appropriate tool: {0} baseline</ST_StatPart_NoToolPenalty>
    <ST_StatPart_ToolApplied>Using {0}: {1}</ST_StatPart_ToolApplied>
    <ST_StatPart_TopContrib>Top: {0} +{1}%</ST_StatPart_TopContrib>
</LanguageData>
</file>

<file path="Source/AI/AutoToolPickup_UtilityIntegrated.cs">
// RimWorld 1.6 / C# 7.3
// Source/AI/AutoToolPickup_UtilityIntegrated.cs
⋮----
/// <summary>
/// OBSOLETE: Phase 5-6 Legacy system. Replaced by PreWork_AutoEquip gating system.
/// Kept as stub for compatibility during refactor transition.
/// </summary>
⋮----
public static class Patch_JobGiver_Work_TryIssueJobPackage_AutoTool
⋮----
public static void Postfix(Pawn pawn, JobIssueParams jobParams, ref ThinkResult __result)
⋮----
// Legacy auto-tool pickup system gutted - Phase 6 PreWork_AutoEquip handles this
// No need to intercept JobGiver_Work anymore since PreWork_AutoEquip provides
// seamless tool acquisition as part of the job gate flow
// Phase 6 handles:
// - Tool requirement validation via JobGate
// - Automatic tool pickup via PreWork_AutoEquip
// - Hardcore mode gating via StatGatingHelper
// - Assignment policy enforcement
⋮----
/// OBSOLETE: Public API kept for compatibility. Use PreWork_AutoEquip system instead.
⋮----
public static bool ShouldAttemptAutoTool(Job job, Pawn pawn, out System.Collections.Generic.List<StatDef> requiredStats)
⋮----
// Legacy API - Phase 6 PreWork_AutoEquip handles tool requirements automatically
⋮----
public static bool PawnHasHelpfulTool(Pawn pawn, System.Collections.Generic.List<StatDef> stats)
⋮----
// Legacy API - Phase 6 handles tool validation internally
return true; // Assume Phase 6 system handles this
</file>

<file path="Source/Harmony/Patch_PawnRenderer.cs">
// RimWorld 1.6 / C# 7.3
// Source/Harmony/Patch_PawnRenderer.cs
// Legacy Code: Keep. Draws tools in-hand while working. (no animations yet)
//
// Purpose:
//   Ensures pawns visibly "use" survival tools while working by drawing the tool
//   in the same pass that vanilla uses for equipment/apparel extras.
//   This improves immersion, showing tools in-hand only when relevant.
⋮----
// What this patch does:
//   - Draws an in-use SurvivalTool (real or virtual) while a pawn is performing a work job.
//   - Skips portrait / invisible renders and invalid pawn states.
//   - Skips drafted pawns unless they're actually performing a work job (i.e., relevant stats exist).
//   - Avoids double-drawing if the same physical item is already shown as Primary.
//   - Uses a small JobDef â†’ required-stats cache to reduce allocations.
⋮----
// Future ideas (comments only, not implemented):
//   - Animated tools (e.g., swinging pick/axe, wrench turning, microscope oscillation).
//   - Per-job offsets/orientations so a hammer sits differently than a wrench.
//   - Sync lightweight animations to pawn tick or job progress for smooth motion.
⋮----
[HarmonyPriority(Priority.Last)] // draw last so our overlay isn't hidden by other mods
[StaticConstructorOnStartup]     // ensure our type gets initialized at load
public static class ShowWhileWorking_Draw_Postfix
⋮----
// Cache: JobDef -> required stats to avoid repeat lookups/allocations.
⋮----
// Optional: static ctor (no reload hook in 1.6 â€” we just start empty)
⋮----
_jobStatCache.Clear();
// If you later add a reload hook, clear the cache there as well.
⋮----
public static void Postfix(Pawn pawn, Vector3 drawPos, Rot4 facing, PawnRenderFlags flags)
⋮----
// Skip non-play renders / invisible / invalid pawns
⋮----
// Drafted behavior:
//  - We generally skip drafted pawns (vanilla shows weapons),
//  - but if they're actually doing a "work job" (i.e., stats are relevant),
//    we'll draw the tool. We enforce this indirectly because we only draw
//    when RelevantStatsFor() returns a non-empty set.
//    (So no special hard block here â€” the stat check below is the gate.)
// Decide which tool is in use (real or virtual) and what stats are required.
⋮----
// Prevent double-draw if the same physical thing is already being rendered as Primary.
⋮----
// Compare by backing thing for virtual wrappers so we don't draw a virtual wrapper
// when the actual spawned thing is already drawn as primary.
Thing backing = SurvivalToolUtility.BackingThing(toolThing as SurvivalTool, pawn);
⋮----
// Vanilla equipment distance factor (children hold closer).
⋮----
// If pawn is "aiming" per vanilla rules, draw with aiming helper; otherwise draw as carried.
⋮----
&& !flags.HasFlag(PawnRenderFlags.NeverAimWeapon)
⋮----
// Tint virtual tools by work-type (green medical, red butchery, etc.)
Color virtualTint = GetTintForVirtualTool(toolThing, requiredStats);
⋮----
// --- Aiming-style draw (reuses vanilla orientation logic) ---
Vector3 target = stanceBusy.focusTarg.HasThing
⋮----
: stanceBusy.focusTarg.Cell.ToVector3Shifted();
⋮----
Vector3 delta = target - pawn.DrawPos;
⋮----
aimAngle = delta.AngleFlat();
⋮----
drawPos += new Vector3(0f, 0f, 0.4f + eqOffset).RotatedBy(aimAngle) * distFactor;
⋮----
DrawVirtualTool(toolThing, drawPos, Quaternion.AngleAxis(aimAngle, Vector3.up), virtualTint);
// Animation hook (future):
//  - For â€œswingingâ€ tools, vary a small extra rotation (e.g., +/- 10Â°) with a sin wave
//    tied to pawn tick: float wobble = Mathf.Sin(Time.time * 6f) * 10f;
//  - Apply to 'aimAngle' before building the Quaternion.
⋮----
PawnRenderUtility.DrawEquipmentAiming(twc, drawPos, aimAngle);
⋮----
// --- Carried-style draw (when not aiming) ---
⋮----
//  - Subtle bobbing while working: offset drawPos.y or Z by a small sin wave.
//  - Slight rotation oscillation to suggest use.
⋮----
PawnRenderUtility.DrawCarriedWeapon(twc, drawPos, facing, distFactor);
⋮----
//  - For hammers/saws, consider small periodic rotation around local Z.
//  - Could keyframe based on job progress if available.
⋮----
// Draw a virtual tool with a tint (stat-driven)
private static void DrawVirtualTool(Thing toolThing, Vector3 drawPos, Quaternion rot, Color tint)
⋮----
? MaterialPool.MatFrom(tex, ShaderDatabase.Transparent, tint)
⋮----
Graphics.DrawMesh(
⋮----
Matrix4x4.TRS(drawPos, rot, new Vector3(scale, 1f, scale)),
⋮----
// Pick a tint based on which stats the tool contributes to.
private static Color GetTintForVirtualTool(Thing tool, List<StatDef> requiredStats)
⋮----
var defaultTint = new Color(1f, 1f, 1f, 0.6f);
⋮----
// light-weight membership checks (no LINQ allocs in the hot path)
⋮----
return new Color(0.4f, 1f, 0.4f, 0.75f);   // green
⋮----
return new Color(0.4f, 0.7f, 1f, 0.75f);   // blue
⋮----
return new Color(0.7f, 0.5f, 1f, 0.75f);   // purple
⋮----
return new Color(1f, 0.4f, 0.4f, 0.75f);   // red
⋮----
/// <summary>
/// Gets the active survival tool (real or virtual) for the pawn's current job,
/// and the required stats for that job. Uses a small cache keyed by JobDef.
/// Drafted pawns still pass through here; if RelevantStatsFor() returns empty,
/// we naturally refrain from drawing anything (so drafted idle = no tool drawn).
/// </summary>
private static (Thing tool, List<StatDef> requiredStats) GetActiveToolForJob(Pawn pawn, Job job)
⋮----
if (pawn == null || job == null || !PawnToolValidator.CanUseSurvivalTools(pawn))
⋮----
// Cache lookup
if (!_jobStatCache.TryGetValue(job.def, out var requiredStats))
⋮----
requiredStats = SurvivalToolUtility.RelevantStatsFor(job.workGiverDef, job) ?? new List<StatDef>();
⋮----
// If no relevant stats, nothing to draw (also filters out most drafted non-work jobs).
⋮----
// Debug logging (throttled)
⋮----
// Summarized per-pawn/job drawing info to avoid per-tool spam in the renderer
var bestForLog = pawn.GetBestSurvivalTool(requiredStats);
⋮----
// 1) Normal path: best survival tool (real or virtual) selected by our core logic.
var best = pawn.GetBestSurvivalTool(requiredStats);
⋮----
// Held-only best tool edge case: if unified logic returns null but we have exactly one
// held/equipped candidate that improves any required stat, use it rather than falling
// all the way through to ad-hoc scoring / virtual wrapping. This can happen briefly
// during cache warm-up or when expectedKind filtering raced against delayed stat init.
⋮----
var held = pawn.GetAllUsableSurvivalTools();
SurvivalTool singleImprover = null;
⋮----
SurvivalTool st = h as SurvivalTool;
if (st == null && h?.def != null && h.def.IsToolStuff()) st = VirtualTool.FromThing(h);
⋮----
if (SurvivalToolUtility.ToolImprovesAny(st, requiredStats))
⋮----
if (improverCount > 1) break; // no longer a single improver case
⋮----
catch { /* ignore fallback errors */ }
// 1b) Defensive fallback: if core selection returned null (possibly due to delayed cache
// initialization or stale factors), compute a one-off best candidate using the same
// factor computation used by the runtime cache so the drawn tool matches the job's
// effective stat contributor. This avoids showing the wrong tool (e.g., hammer when
// the pawn is actually using an axe-like virtual tool for tree felling).
⋮----
Thing bestThing = null;
var candidates = pawn.GetAllUsableSurvivalTools();
⋮----
// Determine def + stuff for the candidate (virtual wrappers supply def)
ThingDef toolDef = cand.def;
ThingDef stuffDef = null;
SurvivalTool asTool = cand as SurvivalTool;
⋮----
// Get base factors (may compute ad-hoc if cache not ready)
var factors = SurvivalToolUtility.ToolFactorCache.GetOrComputeToolFactors(toolDef, stuffDef, asTool);
⋮----
// Sum relevant stat values
⋮----
// Apply HP penalty for damaged physical tools
var backing = SurvivalToolUtility.BackingThing(asTool, pawn);
⋮----
catch { /* fallback silently if anything goes wrong during draw-time selection */ }
// 2) Fallback: wrap any relevant tool-stuff stack into a VirtualTool for display.
⋮----
if (thing?.def == null || !thing.def.IsToolStuff()) continue;
⋮----
if (mod?.stat != null && requiredStats.Contains(mod.stat))
return (VirtualTool.FromThing(thing), requiredStats);
</file>

<file path="Source/SurvivalToolUtility.cs">
// RimWorld 1.6 / C# 7.3
// Source/SurvivalToolUtility.cs
⋮----
namespace SurvivalTools
⋮----
public static class SurvivalToolUtility
⋮----
// These helpers unify previously duplicated logic spread across:
//  - (Removed) ToolScoring legacy class
//  - JobGiver_OptimizeSurvivalTools
//  - AutoToolPickup_UtilityIntegrated
//  - Alert classes & ad-hoc loops
// All new code should call these methods; legacy code will be migrated to them.
private const float ST_MultiStatBonusPerExtra = 0.10f; // 10% per extra matched stat
private const float ST_DistancePenaltyPerTile = 0.01f; // score penalty per tile (map searches)
⋮----
public static float GetNoToolBaseline(StatDef stat)
⋮----
try { return ToolFactorCache.GetOrComputeNoToolPenalty(stat); } catch { return 1f; }
⋮----
public static float GetToolProvidedFactor(SurvivalTool tool, StatDef stat)
⋮----
// If there is no tool instance or stat, return the baseline no-tool factor.
// This prevents non-tools (or null wrappers) from appearing to improve stats.
⋮----
// IMPORTANT: Returning 1f here incorrectly implied an improvement over the baseline
// no-tool penalty (e.g. 0.4 normal mode) even when the tool does NOT cover this stat.
// That caused any unrelated tool to appear to "improve" every penalized stat, blocking
// normal-mode proactive pickup (PawnHasHelpfulTool/ToolImprovesAny early-exited true).
// We now return the baseline penalty so absent modifiers yield zero delta in
// ScoreToolForStats and ToolImprovesAny.
⋮----
public static bool ToolImprovesAny(SurvivalTool tool, List<StatDef> stats)
⋮----
public static float ScoreToolForStats(SurvivalTool tool, Pawn pawn, List<StatDef> stats)
⋮----
// Quality weighting if enabled
⋮----
if (comp != null) total *= ToolQualityCurve.Evaluate((int)comp.Quality);
⋮----
// Condition weighting 50%..100%
⋮----
Thing backing = BackingThing(tool, pawn) ?? (tool as Thing);
⋮----
public static SurvivalTool FindBestToolCandidate(Pawn pawn, List<StatDef> requiredStats, bool searchMap, out Thing backingThing)
⋮----
SurvivalTool best = null; float bestScore = 0f;
// Held/equipped first
foreach (var thing in pawn.GetAllUsableSurvivalTools())
⋮----
SurvivalTool cand = thing as SurvivalTool;
if (cand == null && thing.def.IsToolStuff()) cand = VirtualTool.FromThing(thing);
⋮----
#pragma warning disable CS0618 // Phase 3: Legacy method still used internally
⋮----
var map = pawn.Map; var seen = new HashSet<int>(); if (backingThing != null) seen.Add(backingThing.thingIDNumber);
// Radial
foreach (var t in GenRadial.RadialDistinctThingsAround(pawn.Position, map, ST_RadialSearchRadius, true))
⋮----
if (t == null) continue; SurvivalTool cand = t as SurvivalTool;
if (cand == null && t.def.IsToolStuff()) cand = VirtualTool.FromThing(t);
⋮----
if (bt == null || seen.Contains(bt.thingIDNumber) || bt.IsForbidden(pawn) || !pawn.CanReserveAndReach(bt, PathEndMode.OnCell, pawn.NormalMaxDanger())) continue;
if (!ToolImprovesAny(cand, requiredStats)) continue; seen.Add(bt.thingIDNumber);
⋮----
float sc = ScoreToolForStats(cand, pawn, requiredStats) - ST_DistancePenaltyPerTile * bt.Position.DistanceTo(pawn.Position);
⋮----
// Storage + haulables passes
var haulables = map.listerThings.ThingsInGroup(ThingRequestGroup.HaulableEver);
⋮----
float dist = t.Position.DistanceTo(pawn.Position);
if (pass == 0 && (!t.IsInAnyStorage() || dist > ST_StorageSearchRadius)) continue;
if (pass == 1 && (t.IsInAnyStorage() || dist > ST_StorageSearchRadius)) continue;
⋮----
SurvivalTool cand = t as SurvivalTool; if (cand == null && t.def.IsToolStuff()) cand = VirtualTool.FromThing(t);
⋮----
/// <summary>
/// Deterministic counters for virtual-source wear. Keyed by SourceThing.thingIDNumber.
/// We use this to implement tick-based deterministic degradation for virtual tools
/// instead of probabilistic per-call damage. This prevents variance across runs
/// and makes debugging easier.
/// </summary>
⋮----
/// Safely removes any deterministic counters associated with the provided thing.
/// Call this when a backing thing is destroyed, dropped, or otherwise replaced so
/// counters don't accumulate for stale Thing ids across maps/saves.
⋮----
public static void ClearCountersForThing(Thing t)
⋮----
if (_virtualToolDegradeCounters.ContainsKey(key))
_virtualToolDegradeCounters.Remove(key);
⋮----
/// Remove all deterministic counters. Useful on map unload / game load to avoid
/// retaining stale thing ids across sessions.
⋮----
public static void ClearAllCounters()
⋮----
try { _virtualToolDegradeCounters.Clear(); } catch { }
⋮----
// Deduplication for debug logs in RelevantStatsFor
⋮----
public static readonly FloatRange MapGenToolHitPointsRange = new FloatRange(0.3f, 0.7f);
⋮----
// Quality multiplier curve for tools. This maps QualityCategory (as int) to an effectiveness multiplier.
// Values chosen to make quality meaningfully impact work speed without dominating base tool factors.
// Awful=0, Poor=1, Normal=2, Good=3, Excellent=4, Masterwork=5, Legendary=6
public static readonly SimpleCurve ToolQualityCurve = new SimpleCurve()
⋮----
new CurvePoint(0f, 0.6f), // Awful
new CurvePoint(1f, 0.8f), // Poor
new CurvePoint(2f, 1.0f), // Normal
new CurvePoint(3f, 1.1f), // Good
new CurvePoint(4f, 1.25f), // Excellent
new CurvePoint(5f, 1.4f), // Masterwork
new CurvePoint(6f, 1.6f)  // Legendary
⋮----
/// Centralized cache for computed work stat factors per (toolDef, stuffDef) pair.
/// This cache supports delayed activation: during the first ~3 seconds after a save
/// loads we avoid populating the cache to prevent CTDs caused by other systems
/// not being fully initialized. While not activated callers receive computed results
/// on-the-fly but nothing is persisted in the cache until activation.
///
/// Keys are lightweight strings "toolDef|stuffDef" to minimize allocations in hot paths.
⋮----
internal static class ToolFactorCache
⋮----
// Cache for computed no-tool penalty multipliers per statDefName
⋮----
private const int LOG_ONCE_KEY_TTL = 1; // placeholder to use existing keyed logging
⋮----
/// Schedule cache activation at the specified game tick. Call this from
/// the validation GameComponent when scheduling delayed init (3s after load).
⋮----
internal static void ScheduleActivation(int activationTick)
⋮----
/// Called each tick by GameComponent_SurvivalToolsValidation.GameComponentTick to
/// flip the Initialized flag when the scheduled activation tick is reached.
⋮----
internal static void CheckActivation()
⋮----
// Optionally log once when cache becomes active
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.ShouldLogWithCooldown("ToolFactorCache_Activated"))
⋮----
ST_Logging.LogDebug("[SurvivalTools] ToolFactorCache initialized and ready.", "ToolFactorCache_Activated");
⋮----
catch { /* best-effort */ }
⋮----
/// Compute or retrieve cached factors for the given tool definition + stuff.
/// If the cache isn't initialized yet we compute on-the-fly and do not store.
/// This method is defensive and avoids LINQ in hot paths.
⋮----
internal static List<StatModifier> GetOrComputeToolFactors(ThingDef toolDef, ThingDef stuff, SurvivalTool instance = null)
⋮----
// If not initialized, compute on the fly and do not cache.
⋮----
// Log computation once per key to aid diagnostics
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.ShouldLogWithCooldown($"ToolFactorComputed_{key}"))
ST_Logging.LogDebug($"[SurvivalTools] Computed factors (adhoc) for {key}: {FormatFactors(adHoc)}", $"ToolFactorComputed_{key}");
⋮----
// Try cached fast-path
if (_cache.TryGetValue(key, out var cached) && cached != null)
⋮----
// Miss: compute and populate cache
⋮----
// Defensive: ensure we always store a non-null list
⋮----
if (ST_Logging.IsDebugLoggingEnabled && ST_Logging.ShouldLogWithCooldown($"ToolFactorCached_{key}"))
ST_Logging.LogDebug($"[SurvivalTools] Cached factors for {key}: {FormatFactors(_cache[key])}", $"ToolFactorCached_{key}");
⋮----
/// Remove cached entries related to the provided thing (tool instance or stuff def).
/// Call this when a tool is crafted, destroyed, dropped, or when its HP reaches 0.
⋮----
internal static void InvalidateForThing(Thing thing)
⋮----
// If it's a SurvivalTool, clear its specific key(s). If it's a stuff def we need to
// clear any key that references that stuff (scan keys). Scanning is rare (on events)
// so it's acceptable to iterate the keys.
⋮----
_cache.Remove(k);
⋮----
// Stuff-level invalidation: remove any key that ends with |stuffDefName
⋮----
if (!string.IsNullOrEmpty(sd))
⋮----
if (kk.EndsWith("|" + sd))
_cache.Remove(kk);
⋮----
// When a thing (tool or stuff) changes, the no-tool penalty for affected stats may change
⋮----
_noToolPenaltyCache.Clear();
⋮----
/// Removes everything from the cache (map reset/load).
⋮----
internal static void ClearAll()
⋮----
_cache.Clear();
⋮----
/// Compute or retrieve the cached no-tool penalty multiplier for the provided stat.
/// This implements the tiered penalty logic described in settings: normal, hardcore (+25%), extraHardcore (+25%) stacking multiplicatively.
/// Always returns a non-zero value (never blocks jobs here).
⋮----
internal static float GetOrComputeNoToolPenalty(StatDef stat)
⋮----
if (Initialized && _noToolPenaltyCache.TryGetValue(key, out var cached))
⋮----
// Compute
float baseNormal = SurvivalTools.Settings?.noToolStatFactorNormal ?? 0.4f; // default fallback
// If stat is optional in normal mode, treat as 1
⋮----
// Normal mode penalties globally disabled
⋮----
// For WorkSpeedGlobal: if no gating jobs enabled, don't penalize
⋮----
var jobDef = DefDatabase<WorkGiverDef>.GetNamedSilentFail(kvp.Key);
if (jobDef != null && SurvivalToolUtility.ShouldGateByDefault(jobDef) && kvp.Value)
⋮----
// Start with normal base
⋮----
// Stack additional penalties additively on the remaining deficit so they feel multiplicative
// Penalty stacking formula:
// penalty = normal;
// if hardcore: penalty += 0.4f * (1f - penalty);
// if extraHardcore: penalty += 0.3f * (1f - penalty);
// This ensures each mode increases the penalty towards 1 by the specified share of the remaining gap.
⋮----
// Ensure never zero
⋮----
// -----------------------
// Internal helpers
⋮----
private static string MakeKey(ThingDef tool, ThingDef stuff)
⋮----
private static List<StatModifier> ComputeFactors(ThingDef toolDef, ThingDef stuff, SurvivalTool instance)
⋮----
// 1) From tool def mod extension
⋮----
result.Add(new StatModifier { stat = m.stat, value = m.value });
⋮----
// 2) From tool def statBases
⋮----
// 3) From stuff extension
⋮----
// StuffPropsTool multipliers are applied later when the instance exists.
⋮----
// We don't apply multipliers to virtual-only cached factors here; the
// SurvivalTool instance accessor may apply instance-specific multipliers
// when it wraps the cached base.
⋮----
// Dedupe by stat keeping the max value
⋮----
if (!dedup.TryGetValue(mm.stat, out var cur) || mm.value > cur)
⋮----
final.Add(new StatModifier { stat = kv.Key, value = kv.Value });
// If we have an instance and it has effectiveness multipliers, apply them
⋮----
// Base effectiveness value (can come from instance wear/HP or other mechanics)
float effectiveness = instance.GetStatValue(ST_StatDefOf.ToolEffectivenessFactor);
// Determine quality factor: if enabled in settings, read CompQuality on the backing thing
⋮----
QualityCategory qc = comp != null ? comp.Quality : QualityCategory.Normal;
qualityFactor = ToolQualityCurve.Evaluate((int)qc);
⋮----
catch { /* best-effort quality scaling */ }
⋮----
final[i] = new StatModifier { stat = final[i].stat, value = final[i].value * combinedMult };
⋮----
// Apply StuffPropsTool multipliers if applicable (material multipliers)
⋮----
float mult = sprops.toolStatFactors.GetStatFactorFromList(stat);
final[i] = new StatModifier { stat = stat, value = final[i].value * mult };
⋮----
private static string FormatFactors(List<StatModifier> list)
⋮----
if (sb.Length > 0) sb.Append(", ");
sb.Append(m.stat.defName).Append("=").Append(m.value.ToString("F2"));
⋮----
return sb.ToString();
⋮----
/// Returns true if the given WorkGiverDef is eligible for survival tool gating by default.
/// Uses keyword lists to filter jobs (never gate vs gate-eligible).
⋮----
public static bool ShouldGateByDefault(WorkGiverDef wgDef)
⋮----
var name = wgDef.defName.ToLower();
var label = !string.IsNullOrEmpty(wgDef.label) ? wgDef.label.ToLower() : "";
// Never gate keywords
⋮----
/*"repair", "buildroofs", "deconstruct", */ "deliver", "haul", "clean", "rescue", "tend", "handling", "feed", "cookfillhopper", "paint", "remove", "train", "childcarer"
⋮----
if (neverGateKeywords.Any(keyword => name.Contains(keyword) || label.Contains(keyword)))
⋮----
// Targeted debug log for deconstruct decisions
if (ST_Logging.IsDebugLoggingEnabled && (name.Contains("deconstruct") || label.Contains("deconstruct")))
⋮----
ST_Logging.LogDebug($"[SurvivalTools.ShouldGateByDefault] WorkGiver '{wgDef.defName}' labeled '{wgDef.label}' matched never-gate keywords -> NOT gate-eligible.", $"ShouldGate_Deconstruct_{wgDef.defName}");
⋮----
// Gate-eligible keywords
⋮----
if (gateKeywords.Any(keyword => name.Contains(keyword) || label.Contains(keyword)))
⋮----
ST_Logging.LogDebug($"[SurvivalTools.ShouldGateByDefault] WorkGiver '{wgDef.defName}' labeled '{wgDef.label}' matched gate keywords -> gate-eligible.", $"ShouldGate_Deconstruct_{wgDef.defName}");
⋮----
// Default: not gate-eligible
⋮----
// In SurvivalToolUtility.cs
public static Thing FindBestToolForStats(Pawn pawn, List<StatDef> stats)
⋮----
if (pawn == null || stats.NullOrEmpty())
⋮----
Thing bestTool = null;
⋮----
IEnumerable<Thing> candidates = pawn.GetAllUsableSurvivalTools();
⋮----
/// Return the physical backing <see cref="Thing"/> for a <see cref="SurvivalTool"/> (real or virtual).
/// For virtuals, prefers SourceThing if available, then pawn inventory, then closest reachable on pawn.Map, then any spawned.
⋮----
public static Thing BackingThing(SurvivalTool tool, Pawn pawn = null)
⋮----
// Real tool: it's already a Thing (exclude virtual wrappers here)
⋮----
// Virtual wrapper (tool-stuff)
⋮----
// 0) Direct SourceThing if available
⋮----
// 1) Pawn inventory (try exact match first, then by def)
⋮----
var exact = pawn.inventory.innerContainer.FirstOrDefault(t => ReferenceEquals(t, vtool.SourceThing));
⋮----
catch { /* safe fail */ }
var invThing = pawn.inventory.innerContainer.FirstOrDefault(t => t.def == vtool.SourceDef);
⋮----
// 2) Closest reachable on pawn's map
⋮----
!t.IsForbidden(pawn) &&
pawn.CanReserveAndReach(t, PathEndMode.OnCell, pawn.NormalMaxDanger());
var found = GenClosest.ClosestThingReachable(
⋮----
ThingRequest.ForDef(vtool.SourceDef),
⋮----
TraverseParms.For(pawn, Danger.Deadly, TraverseMode.ByPawn, false),
⋮----
// 3) Any spawned instance (fallback)
⋮----
var any = map.listerThings.ThingsOfDef(vtool.SourceDef).FirstOrDefault(t => t.Spawned);
⋮----
if (IsDebugLoggingEnabled && ShouldLogWithCooldown($"BackingThing_None_{vtool.GetHashCode()}"))
LogDebug($"[BackingThing] No backing Thing found for {vtool.LabelNoCount}", $"BackingThing_None_{vtool.GetHashCode()}");
⋮----
// Unknown subclass
⋮----
public static bool HasBackingThing(SurvivalTool tool, Pawn pawn = null) => BackingThing(tool, pawn) != null;
public static bool IsToolStuff(this ThingDef def) =>
⋮----
DefDatabase<StatDef>.AllDefsListForReading.Where(s => s.RequiresSurvivalTool()).ToList();
⋮----
DefDatabase<WorkGiverDef>.AllDefsListForReading.Where(w => w.HasModExtension<WorkGiverExtension>()).ToList();
⋮----
public static List<StatDef> RelevantStatsFor(WorkGiverDef wg, Job job)
⋮----
// Prefer job-level detection first (some mods inject workgivers that reuse a different
// WorkGiverDef for a job — we must honor the JobDef's semantics). If job-based
// detection yields stats, return them. Otherwise fall back to WorkGiver mod-extensions
// or heuristics.
// 1) Job-level detection
// Handle explicit common null-workgiver jobs first (defensive)
⋮----
// 2) WorkGiver mod extension
⋮----
if (fromWg != null && fromWg.Any())
return fromWg.Where(s => s != null).Distinct().ToList();
// Pattern matching for job def name (fallback)
⋮----
if (defName.Contains("clean") || defName.Contains("sweep") || defName.Contains("mop"))
stats.Add(ST_StatDefOf.CleaningSpeed);
if (defName.Contains("butcher") || defName.Contains("slaughter"))
stats.Add(ST_StatDefOf.ButcheryFleshSpeed);
if (defName.Contains("medical") || defName.Contains("surgery") || defName.Contains("operate"))
stats.Add(ST_StatDefOf.MedicalOperationSpeed);
if (defName.Contains("harvest") && defName.Contains("plant"))
stats.Add(ST_StatDefOf.PlantHarvestingSpeed);
if (defName.Contains("fell") && defName.Contains("tree"))
stats.Add(ST_StatDefOf.TreeFellingSpeed);
// Additional context-based detection for injected jobs:
// If job target is filth, cleaning is required
⋮----
// If job target is a corpse or butcherable, butchery is required
⋮----
// If job target is a medical bed or pawn needing tending, medical is required
⋮----
// Only return distinct, non-null stats
stats = stats.Where(s => s != null).Distinct().ToList();
⋮----
// Fallback to StatsForJob for other cases
⋮----
public static List<StatDef> RelevantStatsFor(WorkGiverDef wg, JobDef jobDef)
⋮----
// Prefer job-def specific mapping first (covers cases where a workgiver is re-used
// for an injected job). Only fall back to WorkGiverDef mod-extensions if the
// job-def mapping yields no stats.
⋮----
// Explicit mapping for cleaning job when workGiver may be null
⋮----
// Quick pattern: crafting/bill-like jobs -> WorkSpeedGlobal
⋮----
if (jobNameLower.Contains("dobill") || jobNameLower.Contains("do_bill") || jobNameLower.Contains("bill") || jobNameLower.Contains("craft") || jobNameLower.Contains("fabricate") || jobNameLower.Contains("produce") || jobNameLower.Contains("manufacture") || jobNameLower.Contains("smith") || jobNameLower.Contains("tailor") || jobNameLower.Contains("sculpt"))
⋮----
if (!loggedJobDefStatKeys.Contains(key))
⋮----
loggedJobDefStatKeys.Add(key);
⋮----
// Use class-level loggedJobDefStatKeys
⋮----
LogDebug($"[SurvivalTools] Using job fallback stats for WGD='{wg?.defName ?? "null"}' Job='{jobDef?.defName ?? "null"}': {string.Join(", ", fallback.Select(s => s.defName))}", key);
⋮----
public static List<StatDef> StatsForJob(Job job) => StatsForJob(job?.def);
private static bool IsToolRelevantJob(JobDef jobDef)
⋮----
var s = jobDef.defName.ToLowerInvariant();
return s.Contains("construct") || s.Contains("build") || s.Contains("frame") ||
s.Contains("smooth") || s.Contains("install") || s.Contains("roof") ||
s.Contains("repair") || s.Contains("uninstall") || s.Contains("deconstruct") ||
s.Contains("fell") || s.Contains("tree") || s.Contains("harvest") ||
s.Contains("sow") || s.Contains("plant") || s.Contains("grow") ||
s.Contains("research") || s.Contains("study") ||
s.Contains("clean") || s.Contains("sweep") || s.Contains("mop") ||
s.Contains("medical") || s.Contains("surgery") || s.Contains("operate") ||
s.Contains("butcher") || s.Contains("slaughter");
⋮----
public static List<StatDef> StatsForJob(JobDef jobDef) => StatsForJob(jobDef, null);
public static List<StatDef> StatsForJob(JobDef jobDef, Pawn pawn)
⋮----
// Quiet debug/info logs unless author attention is needed
⋮----
list.Add(ST_StatDefOf.DiggingSpeed);
⋮----
// Explicit mapping for vanilla Research job (precedes generic substring heuristic)
⋮----
list.Add(ST_StatDefOf.ResearchSpeed);
⋮----
list.Add(ST_StatDefOf.TreeFellingSpeed);
⋮----
list.Add(ST_StatDefOf.CleaningSpeed);
⋮----
// Crafting / bills / production tasks -> WorkSpeedGlobal
// Many mods and vanilla use 'DoBill' or 'bill' in job names for production; catch those.
if (s.Contains("dobill") || s.Contains("do_bill") || s.Contains("bill") || s.Contains("craft") || s.Contains("fabricate") || s.Contains("produce") || s.Contains("manufacture") || s.Contains("smith") || s.Contains("tailor") || s.Contains("art") || s.Contains("sculpt"))
⋮----
list.Add(ST_StatDefOf.WorkSpeedGlobal);
⋮----
// Cooking / food production -> WorkSpeedGlobal (catch cook/cookfillhopper)
if (s.Contains("cook") || s.Contains("cookfillhopper") || s.Contains("preparefood") || s.Contains("food"))
⋮----
list.Add(ST_StatDefOf.PlantHarvestingSpeed);
⋮----
if (s.Contains("felltree"))
⋮----
return list; // exclude false positive
if (s.Contains("construct") || s.Contains("build") || s.Contains("frame") ||
s.Contains("smooth") || s.Contains("install") || s.Contains("buildroof") ||
s.Contains("removeroof"))
⋮----
list.Add(StatDefOf.ConstructionSpeed);
⋮----
if (s.Contains("repair") || s.Contains("maintain") || s.Contains("maintenance") ||
s.Contains("fixbroken") || s.Contains("tendmachine") || s.Contains("fix"))
⋮----
list.Add(ST_StatDefOf.MaintenanceSpeed);
⋮----
if (s.Contains("uninstall") || s.Contains("deconstruct") || s.Contains("teardown"))
⋮----
list.Add(ST_StatDefOf.DeconstructionSpeed);
⋮----
// Salvage / dismantle synonyms -> DeconstructionSpeed
if (s.Contains("salvage") || s.Contains("dismantle") || s.Contains("scrap"))
⋮----
if (s.Contains("sow") || s.Contains("plantsow") || s.Contains("plantgrow"))
⋮----
list.Add(ST_StatDefOf.SowingSpeed);
⋮----
if (s.Contains("plant") || s.Contains("harvest") || s.Contains("cut"))
⋮----
if (s.Contains("research") || s.Contains("experiment") || s.Contains("study"))
⋮----
if (s.Contains("clean") || s.Contains("sweep") || s.Contains("mop"))
⋮----
if (s.Contains("medical") || s.Contains("surgery") || s.Contains("operate") || s.Contains("tend") ||
s.Contains("doctor") || (s.Contains("install") && s.Contains("bionic")))
⋮----
list.Add(ST_StatDefOf.MedicalOperationSpeed);
list.Add(ST_StatDefOf.MedicalSurgerySuccessChance);
⋮----
if (s.Contains("butcher") || s.Contains("slaughter") || s.Contains("skin") || s.Contains("carve"))
⋮----
list.Add(ST_StatDefOf.ButcheryFleshSpeed);
list.Add(ST_StatDefOf.ButcheryFleshEfficiency);
⋮----
// If this jobDef appears tool-relevant but we didn't match any known patterns,
// log once per jobDef to help mod authors diagnose unmapped jobs.
⋮----
if (!loggedJobStatKeys.Contains(key))
⋮----
loggedJobStatKeys.Add(key);
⋮----
public static bool RequiresSurvivalTool(this StatDef stat)
⋮----
if (stat?.parts.SafeAny() != true) return false;
⋮----
public static bool IsSurvivalTool(this BuildableDef def, out SurvivalToolProperties toolProps)
⋮----
return def.IsSurvivalTool();
⋮----
public static bool IsSurvivalTool(this BuildableDef def)
⋮----
// Actual SurvivalTool class?
if (typeof(SurvivalTool).IsAssignableFrom(tDef.thingClass))
⋮----
// Or "enhanced" item with our extension & factors
⋮----
// Also consider defs that provide relevant stats via statBases (eg WorkSpeedGlobal)
⋮----
return ext != null && ext != SurvivalToolProperties.defaultValues && (ext.baseWorkStatFactors.SafeAny() || hasStatBases);
⋮----
public static bool CanUseSurvivalTools(this Pawn pawn) =>
⋮----
public static bool IsUnderSurvivalToolCarryLimitFor(this int count, Pawn pawn) =>
!SurvivalTools.Settings.toolLimit || count < pawn.GetStatValue(ST_StatDefOf.SurvivalToolCarryCapacity);
public static IEnumerable<Thing> GetHeldSurvivalTools(this Pawn pawn)
⋮----
// Real tools
var normalTools = pawn.inventory.innerContainer.Where(t => t.def.IsSurvivalTool());
// Tool-stuffs => wrap into virtual tool objects (still Things)
⋮----
.Where(t => t.def.IsToolStuff())
.Select(t => (Thing)VirtualTool.FromThing(t))
.Where(vt => vt != null);
return normalTools.Concat(virtualTools);
⋮----
public static int HeldSurvivalToolCount(this Pawn pawn) =>
pawn.inventory?.innerContainer?.Count(t => t.def.IsSurvivalTool()) ?? 0;
public static bool CanCarryAnyMoreSurvivalTools(this Pawn pawn, int heldToolOffset = 0) =>
(pawn.RaceProps.Humanlike && (pawn.HeldSurvivalToolCount() + heldToolOffset).IsUnderSurvivalToolCarryLimitFor(pawn))
|| pawn.IsFormingCaravan() || pawn.IsCaravanMember();
public static IEnumerable<Thing> GetUsableHeldSurvivalTools(this Pawn pawn)
⋮----
// Historical behavior: we truncated the list to the pawn's carry limit so that
// excess tools (beyond limit) were ignored by optimizers and drawing logic.
// This caused a correctness bug: if the only matching/expected tool (e.g. an axe
// for TreeFellingSpeed) happened to be positioned beyond the truncated index range
// (e.g. third tool while carry limit stat allowed only two), best-tool selection
// and renderer passed over it, yielding null despite the pawn physically holding
// a valid improving tool. We now return the full set of held tools for selection
// purposes. Other systems that decide to drop excess tools still use the carry
// limit stat explicitly; they are unaffected by this change.
return pawn.GetHeldSurvivalTools();
⋮----
public static IEnumerable<Thing> GetAllUsableSurvivalTools(this Pawn pawn)
⋮----
var eqTools = pawn.equipment?.GetDirectlyHeldThings().Where(t => t.def.IsSurvivalTool()) ?? Enumerable.Empty<Thing>();
// Inventory tools (include all; no carry-limit truncation here).
// Wrap tool-stuff into virtual tools so downstream code can treat them uniformly.
⋮----
invRaw = pawn.inventory.innerContainer.InnerListForReading; // use underlying list for perf
⋮----
.Where(t => t != null && t.def != null && (t.def.IsSurvivalTool() || t.def.IsToolStuff()))
.Select(t => t.def.IsToolStuff() ? (Thing)VirtualTool.FromThing(t) : t)
.Where(t => t != null);
return eqTools.Concat(invTools);
⋮----
public static bool CanUseSurvivalTool(this Pawn pawn, ThingDef def)
⋮----
// Consider statBases as a valid source of tool stats (e.g., global work speed)
⋮----
// Check explicit baseWorkStatFactors
⋮----
// Fallback: check statBases on the def itself
⋮----
public static IEnumerable<SurvivalTool> BestSurvivalToolsFor(Pawn pawn) =>
SurvivalToolStats.Select(stat => pawn.GetBestSurvivalTool(stat)).Where(t => t != null);
⋮----
/// True if this tool is actively "used" by its holder for the current job's required stats.
/// Handles both real tools and virtual wrappers (tool-stuff).
⋮----
public static bool IsToolInUse(SurvivalTool tool)
⋮----
if (holder == null || !holder.CanUseSurvivalTools() || !holder.CanUseSurvivalTool(tool.def)) return false;
⋮----
if (req.NullOrEmpty()) return false;
var toolStats = tool.WorkStatFactors.Select(m => m.stat).ToList();
var relevant = req.Where(s => toolStats.Contains(s)).ToList();
if (relevant.NullOrEmpty()) return false;
// Compare the canonical backing Thing for equality so virtual wrappers match their
// underlying physical item. This avoids false negatives where VirtualTool
// instances are ephemeral and differ by reference.
Thing toolBacking = BackingThing(tool, holder);
⋮----
var best = holder.GetBestSurvivalTool(s);
⋮----
Thing bestBacking = BackingThing(best, holder);
⋮----
// Fallback: compare by reference to handle real SurvivalTool instances
⋮----
/// Compute final work stat factors for a real SurvivalTool (def + stuff + effectiveness).
⋮----
public static IEnumerable<StatModifier> CalculateWorkStatFactors(SurvivalTool tool)
⋮----
var tProps = SurvivalToolProperties.For(tool.def);
var sProps = StuffPropsTool.For(tool.Stuff);
float effectiveness = tool.GetStatValue(ST_StatDefOf.ToolEffectivenessFactor);
// Apply quality-based multiplier if enabled in settings. We read CompQuality from the physical tool.
⋮----
float qualityFactor = ToolQualityCurve.Evaluate((int)qc);
⋮----
yield return new StatModifier { stat = baseModifier.stat, value = finalFactor };
⋮----
// (kept for possible legacy callers; not used by the function above)
private static float CalculateFinalStatFactor(StatModifier baseModifier, float effectiveness, StuffPropsTool stuffProps)
⋮----
var m = stuffProps.toolStatFactors.FirstOrDefault(x => x?.stat == baseModifier.stat);
⋮----
private static float CalculateFinalStatFactor(StatModifier baseModifier, float effectiveness, StuffPropsTool stuffProps, SurvivalToolProperties toolProps, ThingDef stuff)
⋮----
// Stuff factors
⋮----
// Stuff power multiplier (if defined)
⋮----
var mult = toolProps.stuffPowerMultiplier.FirstOrDefault(x => x?.stat == baseModifier.stat);
⋮----
// Use an existing "power" stat as a proxy to scale
float stuffPower = stuff.GetStatValueAbstract(StatDefOf.StuffPower_Armor_Sharp);
⋮----
public static bool HasSurvivalTool(this Pawn pawn, ThingDef tool) =>
pawn.GetHeldSurvivalTools().Any(t => t.def == tool);
public static SurvivalTool GetBestSurvivalTool(this Pawn pawn, List<StatDef> stats)
⋮----
if (!pawn.CanUseSurvivalTools() || stats.NullOrEmpty()) return null;
var expectedKind = ToolUtility.ToolKindForStats(stats);
SurvivalTool best = null;
⋮----
// Wrap tool-stuff or virtualizable items
if (thing.def != null && thing.def.IsToolStuff())
cand = VirtualTool.FromThing(thing);
⋮----
cand = ToolUtility.TryWrapVirtual(thing);
⋮----
if (expectedKind != STToolKind.None && ToolUtility.ToolKindOf(thing) != expectedKind) continue;
⋮----
// Fallback: if expected kind filtering eliminated all candidates (best==null),
// re-run without expectedKind restriction so we still display/recognize an
// improving tool of a different kind (e.g. hammer improving ConstructionSpeed
// when axe is beyond prior carry-limit ordering).
⋮----
LogDebug($"[SurvivalTools.Debug] Fallback (multi-stat) re-scan without expectedKind for {pawn.LabelShort} (expected {expectedKind}) stats=[{string.Join(",", stats.Select(s => s.defName))}]", $"Fallback_Multi_{pawn?.ThingID}_{expectedKind}");
⋮----
public static float GetStatFactorFromList(this SurvivalTool tool, StatDef stat) =>
tool.WorkStatFactors.GetStatFactorFromList(stat);
⋮----
public static bool HasSurvivalToolFor(this Pawn pawn, StatDef stat)
⋮----
if (pawn == null || stat == null || !stat.RequiresSurvivalTool()) return false;
// Scan usable tools (inventory + worn + eq) once, check factor improvement.
var tools = pawn.GetAllUsableSurvivalTools();
⋮----
SurvivalTool st = thing as SurvivalTool;
if (st == null && thing.def != null && thing.def.IsToolStuff()) st = VirtualTool.FromThing(thing);
⋮----
/// Attempt to find a useful tool on the map/storage and enqueue a TakeInventory pickup job for the pawn.
/// Returns true if a pickup job was enqueued.
⋮----
public static bool TryEnqueuePickupForMissingTool(Pawn pawn, List<StatDef> requiredStats)
⋮----
if (!pawn.CanUseSurvivalTools()) return false;
// If pawn already has a helpful tool, nothing to do
if (pawn.GetAllUsableSurvivalTools().OfType<SurvivalTool>().Any(st => ToolImprovesAny(st, requiredStats)))
⋮----
SurvivalTool bestTool = null;
⋮----
// 1) Radial scan around pawn (fast, preferred)
⋮----
foreach (var thing in GenRadial.RadialDistinctThingsAround(pawn.Position, map, SearchRadius, true))
⋮----
SurvivalTool candidate = null;
⋮----
else if (thing.def != null && thing.def.IsToolStuff()) candidate = VirtualTool.FromThing(thing);
⋮----
if (seen.Contains(backing.thingIDNumber)) continue;
seen.Add(backing.thingIDNumber);
⋮----
if (backing.IsForbidden(pawn)) continue;
if (!pawn.CanReserveAndReach(backing, PathEndMode.OnCell, pawn.NormalMaxDanger())) continue;
⋮----
score -= 0.01f * backing.Position.DistanceTo(pawn.Position);
⋮----
// 2) Storage / haulable scans: storage-first, nearby, then wider fallback
var candidates = map.listerThings.ThingsInGroup(ThingRequestGroup.HaulableEver);
⋮----
// Storage items within StorageSearchRadius
⋮----
if (!item.IsInAnyStorage()) continue;
⋮----
if (item.Position.DistanceTo(pawn.Position) > StorageSearchRadius) continue;
⋮----
else if (item.def != null && item.def.IsToolStuff()) candidate = VirtualTool.FromThing(item);
⋮----
// Nearby haulable (within StorageSearchRadius)
⋮----
if (item.IsInAnyStorage()) continue;
⋮----
// Wider-area fallback
⋮----
if (item.Position.DistanceTo(pawn.Position) > FallbackSearchRadius) continue;
⋮----
var pickupJob = JobMaker.MakeJob(JobDefOf.TakeInventory, backingThing);
⋮----
pawn.jobs.jobQueue.EnqueueFirst(pickupJob);
⋮----
public static bool HasSurvivalToolFor(this Pawn pawn, StatDef stat, out SurvivalTool tool, out float statFactor)
⋮----
var tools = pawn.GetAllUsableSurvivalTools(); if (tools == null) return false;
SurvivalTool best = null; float bestFactor = baseline;
⋮----
public static SurvivalTool GetBestSurvivalTool(this Pawn pawn, StatDef stat)
⋮----
if (!pawn.CanUseSurvivalTools() || stat == null || !stat.RequiresSurvivalTool()) return null;
⋮----
// Unified baseline & scoring path using existing helpers so behavior matches multi-stat overload
⋮----
var expectedKind = ToolUtility.ToolKindForStats(new[] { stat });
SurvivalTool best = null; float bestDelta = 0f; // store delta above baseline not absolute factor
⋮----
SurvivalTool candidate = thing as SurvivalTool;
⋮----
// Wrap tool-stuff or other virtualizable items
⋮----
candidate = VirtualTool.FromThing(thing);
⋮----
candidate = ToolUtility.TryWrapVirtual(thing);
⋮----
// Fallback pass without expectedKind filtering if nothing selected.
⋮----
try { LessonAutoActivator.TeachOpportunity(ST_ConceptDefOf.UsingSurvivalTools, OpportunityType.Important); } catch { }
⋮----
public static string GetSurvivalToolOverrideReportText(SurvivalTool tool, StatDef stat)
⋮----
var b = new StringBuilder();
b.AppendLine(stat.description);
b.AppendLine();
b.AppendLine($"{tool.def.LabelCap}: {tool.def.GetModExtension<SurvivalToolProperties>().baseWorkStatFactors.GetStatFactorFromList(stat).ToStringByStyle(ToStringStyle.Integer, ToStringNumberSense.Factor)}");
⋮----
b.AppendLine($"{ST_StatDefOf.ToolEffectivenessFactor.LabelCap}: {tool.GetStatValue(ST_StatDefOf.ToolEffectivenessFactor).ToStringByStyle(ToStringStyle.Integer, ToStringNumberSense.Factor)}");
if (stuffPropsTool != null && stuffPropsTool.toolStatFactors.GetStatFactorFromList(stat) != 1f)
⋮----
b.AppendLine($"{"StatsReport_Material".Translate()} ({tool.Stuff.LabelCap}): {stuffPropsTool.toolStatFactors.GetStatFactorFromList(stat).ToStringByStyle(ToStringStyle.Integer, ToStringNumberSense.Factor)}");
⋮----
b.AppendLine($"{"StatsReport_FinalValue".Translate()}: {statFactorList.ToList().GetStatFactorFromList(stat).ToStringByStyle(ToStringStyle.Integer, ToStringNumberSense.Factor)}");
return b.ToString();
⋮----
public static void TryDegradeTool(Pawn pawn, StatDef stat)
⋮----
var tool = pawn.GetBestSurvivalTool(stat);
float toolFactor = tool != null ? tool.WorkStatFactors.ToList().GetStatFactorFromList(stat) : -1f;
⋮----
LessonAutoActivator.TeachOpportunity(ST_ConceptDefOf.SurvivalToolDegradation, OpportunityType.GoodToKnow);
⋮----
realTool.TakeDamage(new DamageInfo(DamageDefOf.Deterioration, 1));
⋮----
if (!_virtualToolDegradeCounters.TryGetValue(key, out var counter)) counter = 0;
⋮----
float lifespanDays = tool.GetStatValue(ST_StatDefOf.ToolEstimatedLifespan);
int hp = Math.Max(1, twc.MaxHitPoints);
int threshold = Math.Max(1, (int)Math.Floor((lifespanDays * GenDate.TicksPerDay) / hp));
⋮----
twc.TakeDamage(new DamageInfo(DamageDefOf.Deterioration, 1));
⋮----
int threshold = Math.Max(1, (int)Math.Floor(100f / Math.Max(0.001f, factor)));
⋮----
var one = backing.SplitOff(1);
one.Destroy(DestroyMode.Vanish);
⋮----
public static bool MeetsWorkGiverStatRequirements(this Pawn pawn, List<StatDef> requiredStats) =>
pawn.MeetsWorkGiverStatRequirements(requiredStats, null, null);
public static bool MeetsWorkGiverStatRequirements(this Pawn pawn, List<StatDef> requiredStats, WorkGiverDef workGiver = null, JobDef jobDef = null)
⋮----
if (requiredStats.NullOrEmpty()) return true;
⋮----
var toolStats = requiredStats.Where(st => st != null && st.RequiresSurvivalTool()).ToList();
if (toolStats.NullOrEmpty()) return true;
⋮----
// Unified gating check (uses StatGatingHelper)
if (StatGatingHelper.ShouldBlockJobForStat(stat, s, pawn))
⋮----
// Normal mode fallback — still reject if stat value is zero or less
⋮----
float v = pawn.GetStatValue(stat);
⋮----
public static bool CanFellTrees(this Pawn pawn)
⋮----
return pawn.MeetsWorkGiverStatRequirements(req);
⋮----
public static IEnumerable<WorkGiver> AssignedToolRelevantWorkGivers(this Pawn pawn)
⋮----
Log.ErrorOnce($"Tried to get tool-relevant work givers for {pawn} but has null workSettings", 11227);
⋮----
if (ext?.requiredStats?.Any(s => s.RequiresSurvivalTool()) == true)
⋮----
public static List<StatDef> AssignedToolRelevantWorkGiversStatDefs(this Pawn pawn)
⋮----
var all = pawn.AssignedToolRelevantWorkGivers()
.SelectMany(g => g.def.GetModExtension<WorkGiverExtension>().requiredStats)
.Where(s => s != null)
.Distinct()
.ToList();
// Consider WorkSpeedGlobal: if pawn has any assigned WorkGiver that maps to WorkSpeedGlobal
// and the per-job gating setting is enabled, include WorkSpeedGlobal in the relevant stats.
⋮----
foreach (var wg in WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs())
⋮----
// Check pawn has this workgiver (in normal order list) and gating enabled for that job
bool pawnHasWg = pawn.workSettings.WorkGiversInOrderNormal.Any(wgInst => wgInst?.def == wg);
if (pawnHasWg && settings.workSpeedGlobalJobGating.GetValueOrDefault(wg.defName, true))
⋮----
if (!all.Contains(ST_StatDefOf.WorkSpeedGlobal))
all.Add(ST_StatDefOf.WorkSpeedGlobal);
⋮----
catch { /* best-effort: do not break callers on error */ }
// Only those we can actually satisfy with tools available in this game
⋮----
/// For alerts: include research/cleaning/butchery/etc., but still ensure tools exist in this run.
⋮----
public static List<StatDef> AssignedToolRelevantWorkGiversStatDefsForAlerts(this Pawn pawn)
⋮----
return all.Where(ToolsExistForStat).ToList();
⋮----
public static bool NeedsSurvivalTool(this Pawn pawn, SurvivalTool tool)
⋮----
var relevant = pawn.AssignedToolRelevantWorkGiversStatDefs();
return tool.WorkStatFactors.Any(f => relevant.Contains(f.stat));
⋮----
public static bool BetterThanWorkingToollessFor(this SurvivalTool tool, StatDef stat)
⋮----
Log.ErrorOnce($"Tried to check if {tool} is better than working toolless for {stat} which has no StatPart_SurvivalTools", 8120196);
⋮----
float toolFactor = tool.WorkStatFactors.ToList().GetStatFactorFromList(stat);
float noToolPenalty = ToolFactorCache.GetOrComputeNoToolPenalty(stat);
⋮----
/// Get the factor from a modifier list or 1.0 if absent (neutral).
⋮----
public static float GetStatFactorFromList(this IEnumerable<StatModifier> modifiers, StatDef stat)
⋮----
var m = modifiers.FirstOrDefault(x => x.stat == stat);
⋮----
public static Job DequipAndTryStoreSurvivalTool(this Pawn pawn, Thing tool, bool enqueueCurrent = true)
⋮----
pawn.jobs.jobQueue.EnqueueFirst(pawn.CurJob);
// If we got a virtual wrapper, target the real thing for vanilla hauling/storage.
Thing realThing = tool;
⋮----
if (StoreUtility.TryFindBestBetterStoreCellFor(realThing, pawn, pawn.MapHeld, StoreUtility.CurrentStoragePriorityOf(realThing), pawn.Faction, out IntVec3 c))
⋮----
var haulJob = new Job(JobDefOf.HaulToCell, realThing, c) { count = 1 };
// Invalidate cache for the moved tool so any precomputed factors that depend on
// ownership/location/stuff are refreshed when needed.
try { ToolFactorCache.InvalidateForThing(realThing); } catch { }
pawn.jobs.jobQueue.EnqueueFirst(haulJob);
⋮----
// Drop job targets the physical thing.
return new Job(ST_JobDefOf.DropSurvivalTool, realThing);
⋮----
public static bool CanRemoveExcessSurvivalTools(this Pawn pawn) =>
!pawn.Drafted && !pawn.IsWashing() && !pawn.IsFormingCaravan() && !pawn.IsCaravanMember() &&
⋮----
!pawn.IsBurning() && !(pawn.carryTracker?.CarriedThing is SurvivalTool);
private static bool IsWashing(this Pawn pawn) =>
ModCompatibilityCheck.DubsBadHygiene && pawn.health.hediffSet.HasHediff(DefDatabase<HediffDef>.GetNamed("Washing"));
public static string GetStatCategoryDescription(StatDef stat)
⋮----
private static string GetJobContextDescription(WorkGiverDef workGiver, JobDef jobDef)
⋮----
/// True if at least one loaded thing provides the specified stat via SurvivalToolProperties.
⋮----
public static bool ToolsExistForStat(StatDef stat)
⋮----
// Check mod extension baseWorkStatFactors
⋮----
// Also check statBases on the def (for stats like WorkSpeedGlobal)
⋮----
/// Filters out stats that have no available tools in this run (prevents pointless alerts).
⋮----
public static List<StatDef> FilterStatsWithAvailableTools(IEnumerable<StatDef> stats) =>
stats?.Where(ToolsExistForStat).ToList() ?? new List<StatDef>();
</file>

<file path="Source/SurvivalToolsSettings.cs">
// Rimworld 1.6 / C# 7.3
// Source/SurvivalToolsSettings.cs
⋮----
namespace SurvivalTools
⋮----
public class SurvivalToolsSettings : ModSettings
⋮----
// UI Layout constants
⋮----
// Difficulty mode change event
⋮----
internal static void RaiseDifficultyChanged()
⋮----
// Logging toggles (only effective in DEBUG builds)
⋮----
// Normal mode penalty settings
⋮----
// Enable quality-based tool scaling (multiplies tool factors by quality curve)
⋮----
// Tree felling system toggle
⋮----
// Individual optional tool requirements
⋮----
// ResearchReinvented compatibility
⋮----
// QoL: upgrade suggestion toggle
⋮----
// Visual feedback: denial/slow motes toggle
public bool showDenialMotes = true; // When true, spawn text motes for blocked/slow tool-gated jobs
// Gating alert settings
public bool showGatingAlert = true; // Show alert when pawns are blocked by tool gating
// Gating enforcer settings
public bool enforceOnModeChange = true; // Cancel now-invalid jobs when difficulty changes
// Phase 6: Assignment system settings
public bool enableAssignments = true; // Enable pre-work auto-equip for better tools
public float assignMinGainPct = 0.1f; // Minimum gain percentage to trigger assignment (10%)
public float assignSearchRadius = 25f; // Maximum search radius for tool assignment
public int assignPathCostBudget = 500; // Maximum path cost budget for tool retrieval
public bool assignRescueOnGate = true; // Auto-assign any better tool when gated (rescue mode)
// Job gating
⋮----
// Cached availability of optional tool types
⋮----
public void InitializeOptionalToolCache()
⋮----
_hasCleaningToolsCache = SurvivalToolUtility.ToolsExistForStat(ST_StatDefOf.CleaningSpeed);
_hasButcheryToolsCache = SurvivalToolUtility.ToolsExistForStat(ST_StatDefOf.ButcheryFleshSpeed) ||
SurvivalToolUtility.ToolsExistForStat(ST_StatDefOf.ButcheryFleshEfficiency);
_hasMedicalToolsCache = SurvivalToolUtility.ToolsExistForStat(ST_StatDefOf.MedicalOperationSpeed) ||
SurvivalToolUtility.ToolsExistForStat(ST_StatDefOf.MedicalSurgerySuccessChance);
⋮----
public void ResetOptionalToolCache()
⋮----
public bool IsStatRequiredInExtraHardcore(StatDef stat)
⋮----
if (RRHelpers.Settings.IsRRCompatibilityEnabled && RRHelpers.Settings.IsRRStatRequiredInExtraHardcore(stat))
⋮----
public override void ExposeData()
⋮----
Scribe_Values.Look(ref hardcoreMode, nameof(hardcoreMode), false);
Scribe_Values.Look(ref toolMapGen, nameof(toolMapGen), true);
Scribe_Values.Look(ref toolLimit, nameof(toolLimit), true);
Scribe_Values.Look(ref toolDegradationFactor, nameof(toolDegradationFactor), 1f);
Scribe_Values.Look(ref toolOptimization, nameof(toolOptimization), true);
Scribe_Values.Look(ref debugLogging, nameof(debugLogging), false);
Scribe_Values.Look(ref compatLogging, nameof(compatLogging), false);
Scribe_Values.Look(ref pickupFromStorageOnly, nameof(pickupFromStorageOnly), false);
Scribe_Values.Look(ref allowPacifistEquip, nameof(allowPacifistEquip), true);
Scribe_Values.Look(ref autoTool, nameof(autoTool), true);
Scribe_Values.Look(ref enableSurvivalToolTreeFelling, nameof(enableSurvivalToolTreeFelling), true);
Scribe_Values.Look(ref extraHardcoreMode, nameof(extraHardcoreMode), false);
Scribe_Values.Look(ref requireCleaningTools, nameof(requireCleaningTools), true);
Scribe_Values.Look(ref requireButcheryTools, nameof(requireButcheryTools), true);
Scribe_Values.Look(ref requireMedicalTools, nameof(requireMedicalTools), true);
Scribe_Values.Look(ref noToolStatFactorNormal, nameof(noToolStatFactorNormal), 0.4f);
Scribe_Values.Look(ref useQualityToolScaling, nameof(useQualityToolScaling), true);
Scribe_Values.Look(ref enableNormalModePenalties, nameof(enableNormalModePenalties), true);
Scribe_Values.Look(ref enableRRCompatibility, nameof(enableRRCompatibility), true);
Scribe_Values.Look(ref rrResearchRequiredInExtraHardcore, nameof(rrResearchRequiredInExtraHardcore), false);
Scribe_Values.Look(ref rrFieldResearchRequiredInExtraHardcore, nameof(rrFieldResearchRequiredInExtraHardcore), false);
Scribe_Values.Look(ref showUpgradeSuggestions, nameof(showUpgradeSuggestions), true);
Scribe_Values.Look(ref showDenialMotes, nameof(showDenialMotes), true);
Scribe_Values.Look(ref showGatingAlert, nameof(showGatingAlert), true);
Scribe_Values.Look(ref enforceOnModeChange, nameof(enforceOnModeChange), true);
Scribe_Collections.Look(ref workSpeedGlobalJobGating, nameof(workSpeedGlobalJobGating), LookMode.Value, LookMode.Value);
⋮----
// Initialize showGatingAlert based on mode if not set (first run or reset)
⋮----
// Set default based on current mode - on for Hardcore/Nightmare, off for Normal
⋮----
showGatingAlert = false; // Default off in Normal mode
⋮----
base.ExposeData();
⋮----
private Vector2 mainScrollPosition; // Add scroll position for main window
public void DoSettingsWindowContents(Rect inRect)
⋮----
// Reserve space at the bottom for the pinned Enhanced Settings button so it's always visible
const float bottomReserved = 60f; // button height + padding
// Calculate content height for scrolling
⋮----
// Scroll area (exclude reserved bottom area)
var scrollRect = new Rect(inRect.x, inRect.y, inRect.width, Mathf.Max(0f, inRect.height - bottomReserved));
// Inner view rect: width accounts for vertical scrollbar, height is at least the visible scroll area
var viewRect = new Rect(0, 0, scrollRect.width - 20f, Mathf.Max(scrollRect.height, contentHeight));
Widgets.BeginScrollView(scrollRect, ref mainScrollPosition, viewRect);
var listing = new Listing_Standard();
listing.Begin(viewRect);
⋮----
listing.End();
Widgets.EndScrollView();
// Draw pinned Enhanced Settings button centered in the reserved bottom area
⋮----
var buttonArea = new Rect(inRect.x, inRect.yMax - bottomReserved, inRect.width, bottomReserved);
var buttonRect = new Rect(
⋮----
GUI.color = new Color(1f, 0.3f, 0.3f); // Red color
if (Widgets.ButtonText(buttonRect, "Settings_OpenEnhancedButton".Translate()))
⋮----
var existingWindow = Find.WindowStack.Windows.OfType<SurvivalToolsResizableSettingsWindow>().FirstOrDefault();
⋮----
Find.WindowStack.TryRemove(existingWindow);
⋮----
var window = new SurvivalToolsResizableSettingsWindow(this);
Find.WindowStack.Add(window);
⋮----
/// <summary>
/// Calculate the total height needed for the main settings window content
/// </summary>
private float CalculateMainWindowContentHeight()
⋮----
float height = 50f; // Base spacing
// Basic Settings Section
height += 35f; // Section header
height += 25f * 7; // Checkboxes (hardcore mode, tools in ruins, tool limit, etc.)
// Normal Mode Work Speed Settings
⋮----
height += 80f; // Description text area
height += 25f; // Enable penalties checkbox
height += 40f; // Penalty slider
height += 25f; // Tool degradation slider
// Enhanced Settings Button
height += 40f; // Button height + spacing
// Debug Settings
⋮----
height += 50f; // Debug content area
// Add much more padding to ensure all content is accessible
height += 300f; // Increased from 100f to 300f for better scrolling
⋮----
/// Draw all the settings content in the scrollable area
⋮----
public void DrawSettingsContent(Listing_Standard listing)
⋮----
// Basic Settings Section Header
⋮----
listing.Label("Settings_BasicSection".Translate());
⋮----
listing.Gap();
// Hardcore Mode section
GUI.color = new Color(1f, 0.2f, 0.2f);
⋮----
listing.CheckboxLabeled("Settings_HardcoreMode".Translate(), ref hardcoreMode, "Settings_HardcoreMode_Tooltip".Translate());
// Auto-disable Extra Hardcore Mode when Hardcore Mode is disabled
⋮----
// Detect mode changes and fire event + enforcer
⋮----
SurvivalToolsSettings.RaiseDifficultyChanged();
⋮----
var cancelled = Gating.GatingEnforcer.EnforceAllRunningJobs(true);
// Optional quiet enforcement - no messages by default
⋮----
Log.Warning($"[SurvivalTools] Gating enforcer failed on mode change: {ex.Message}");
⋮----
// Validate existing jobs when hardcore mode is enabled or changed
⋮----
SurvivalToolValidation.ValidateExistingJobs("Hardcore mode enabled");
⋮----
// General settings
listing.CheckboxLabeled("Settings_ToolMapGen".Translate(), ref toolMapGen, "Settings_ToolMapGen_Tooltip".Translate());
listing.CheckboxLabeled("Settings_ToolLimit".Translate(), ref toolLimit, "Settings_ToolLimit_Tooltip".Translate());
listing.CheckboxLabeled("Settings_AutoTool".Translate(), ref autoTool, "Settings_AutoTool_Tooltip".Translate());
listing.CheckboxLabeled("Settings_ToolOptimization".Translate(), ref toolOptimization, "Settings_ToolOptimization_Tooltip".Translate());
listing.CheckboxLabeled("Settings_EnableTreeFelling".Translate(), ref enableSurvivalToolTreeFelling, "Settings_EnableTreeFelling_Tooltip".Translate());
listing.CheckboxLabeled("Settings_PickupFromStorageOnly".Translate(), ref pickupFromStorageOnly, "Settings_PickupFromStorageOnly_Tooltip".Translate());
listing.CheckboxLabeled("Settings_AllowPacifistEquip".Translate(), ref allowPacifistEquip, "Settings_AllowPacifistEquip_Tooltip".Translate());
listing.CheckboxLabeled("Settings_ShowUpgradeSuggestions".Translate(), ref showUpgradeSuggestions, "Settings_ShowUpgradeSuggestions_Tooltip".Translate());
listing.CheckboxLabeled("Settings_ShowDenialMotes".Translate(), ref showDenialMotes, "Settings_ShowDenialMotes_Tooltip".Translate());
listing.CheckboxLabeled("Settings_ShowGatingAlert".Translate(), ref showGatingAlert, "Settings_ShowGatingAlert_Tooltip".Translate());
listing.CheckboxLabeled("Settings_EnforceOnModeChange".Translate(), ref enforceOnModeChange, "Settings_EnforceOnModeChange_Tooltip".Translate());
⋮----
// Normal Mode Penalty Settings
listing.GapLine();
⋮----
listing.Label("Settings_NormalModeSection".Translate());
⋮----
// Explanation section
GUI.color = new Color(0.8f, 0.9f, 1f); // Light blue background
⋮----
var explanationRect = listing.GetRect(60f);
Widgets.DrawBoxSolid(explanationRect, new Color(0.1f, 0.1f, 0.2f, 0.3f));
var textRect = explanationRect.ContractedBy(6f);
Widgets.Label(textRect, "Settings_NormalMode_Explanation".Translate());
⋮----
listing.Gap(4f);
// Enable/disable penalties entirely
listing.CheckboxLabeled("Settings_EnableNormalModePenalties".Translate(), ref enableNormalModePenalties,
"Settings_EnableNormalModePenalties_Tooltip".Translate());
// Penalty severity slider (only show when penalties are enabled)
⋮----
var penaltyLabel = "Settings_NormalModeToolPenalty".Translate();
⋮----
listing.Label($"{penaltyLabel}: {penaltyPercent:F0}% slower without tools");
noToolStatFactorNormal = 1f - (listing.Slider(1f - noToolStatFactorNormal, 0f, 0.8f));
noToolStatFactorNormal = Mathf.Clamp(Mathf.Round(noToolStatFactorNormal * 100f) / 100f, 0.2f, 1f);
// Helper text
⋮----
listing.Label("Settings_NormalModePenalties_HelperText".Translate());
⋮----
// Show what this means when disabled
⋮----
listing.Label("Settings_NormalModePenalties_Disabled".Translate());
⋮----
// Quality-based tool scaling toggle
listing.CheckboxLabeled("Settings_QualityToolScaling".Translate(), ref useQualityToolScaling, "Settings_QualityToolScaling_Tooltip".Translate());
// Degradation slider
var degrLabel = "Settings_ToolDegradationRate".Translate();
listing.Label(degrLabel + ": " + toolDegradationFactor.ToStringByStyle(ToStringStyle.FloatTwo, ToStringNumberSense.Factor));
toolDegradationFactor = listing.Slider(toolDegradationFactor, 0f, 2f);
toolDegradationFactor = Mathf.Clamp(Mathf.Round(toolDegradationFactor * 100f) / 100f, 0f, 2f);
⋮----
// Debug logging section (Dev mode only)
⋮----
listing.Label("Settings_DebugSection".Translate());
⋮----
listing.CheckboxLabeled("Settings_DebugLogging".Translate(), ref debugLogging, "Settings_DebugLogging_Tooltip".Translate());
⋮----
// Show compatibility logging option only when debug logging is enabled
⋮----
listing.CheckboxLabeled("Settings_CompatLogging".Translate(), ref compatLogging, "Settings_CompatLogging_Tooltip".Translate());
⋮----
listing.Gap(6f);
// Restore original styling (button is pinned below the scroll area)
⋮----
/// Draw button to open WorkSpeedGlobal job configuration window
⋮----
public void DrawWorkSpeedGlobalConfigButton(Listing_Standard listing)
⋮----
// Create button rect
⋮----
(listing.ColumnWidth - buttonWidth) / 2f, // Center horizontally
⋮----
// Draw blue WorkSpeedGlobal config button
GUI.color = new Color(0.3f, 0.5f, 1f); // Blue color
if (Widgets.ButtonText(buttonRect, "WorkSpeedGlobal_OpenConfigButton".Translate()))
⋮----
// Close any existing WorkSpeedGlobal window first
var existingWindow = Find.WindowStack.Windows.OfType<WorkSpeedGlobalConfigWindow>().FirstOrDefault();
⋮----
var window = new WorkSpeedGlobalConfigWindow(this);
⋮----
// Advance listing position manually since we drew outside of listing
listing.Gap(buttonHeight + 6f);
// Restore original styling
⋮----
/// Draws a display showing how different jobs behave in the current mode
⋮----
private void DrawJobStatusDisplay(Listing_Standard listing)
⋮----
// Header
⋮----
// Create a rect for the centered header with tooltip
var titleRect = listing.GetRect(Text.LineHeight + 4f);
var headerText = "JobTable_SectionTitle".Translate();
Widgets.Label(titleRect, headerText);
// Add tooltip to the header
if (Mouse.IsOver(titleRect))
TooltipHandler.TipRegion(titleRect, "JobTable_SectionTooltip".Translate());
⋮----
// Get all survival tool work givers and their stats
⋮----
listing.Label("JobTable_NoJobsFound".Translate());
⋮----
// Determine which mode(s) to show based on current settings
⋮----
// Calculate number of active columns and their widths
⋮----
listing.Label("JobTable_NoActiveMode".Translate());
⋮----
const float columnSpacing = 12f; // Increased spacing between columns
const float minColumnWidth = 200f; // Increased significantly to provide much more room for content
// Calculate dynamic job label width based on actual content
⋮----
Text.Font = GameFont.Medium; // Use same font as rendering
var jobLabelText = "JobTable_JobType".Translate();
var dynamicJobLabelWidth = Mathf.Max(Text.CalcSize(jobLabelText).x + 50f, 180f); // Increased padding and minimum significantly
// Check all job categories for max width needed
⋮----
dynamicJobLabelWidth = Mathf.Max(dynamicJobLabelWidth, Text.CalcSize(category.Name).x + 50f);
⋮----
// Also check the column headers to ensure they fit with more generous padding
var extraHardcoreHeaderWidth = Text.CalcSize("JobTable_ExtraHardcore".Translate()).x + 80f; // Increased padding significantly
var requiredTextWidth = Text.CalcSize("JobTable_Required".Translate()).x + 80f;
var gatedTextWidth = Text.CalcSize("JobTable_GatedExample".Translate()).x + 80f; // Account for worst case gated text with extra padding
var minNeededColumnWidth = Mathf.Max(extraHardcoreHeaderWidth, Mathf.Max(requiredTextWidth, gatedTextWidth));
Text.Font = measureFont; // Restore font
⋮----
// Ensure column width is sufficient for the text content - use the larger of calculated or needed width
var columnWidth = Mathf.Max(calculatedColumnWidth, Mathf.Max(minColumnWidth, minNeededColumnWidth));
// Calculate total table height for border
var tableHeight = (Text.LineHeight + 10f) + (Text.LineHeight * 1.5f * jobCategories.Count) + 8f; // Header + rows with bigger font spacing + padding
var tableBorderRect = listing.GetRect(tableHeight);
// Draw outer table border
var tableBorderColor = new Color(0.6f, 0.6f, 0.6f, 0.8f);
⋮----
// Draw border frame
⋮----
// Top border
GUI.DrawTexture(new Rect(tableBorderRect.x, tableBorderRect.y, tableBorderRect.width, borderThickness), BaseContent.WhiteTex);
// Bottom border
GUI.DrawTexture(new Rect(tableBorderRect.x, tableBorderRect.yMax - borderThickness, tableBorderRect.width, borderThickness), BaseContent.WhiteTex);
// Left border
GUI.DrawTexture(new Rect(tableBorderRect.x, tableBorderRect.y, borderThickness, tableBorderRect.height), BaseContent.WhiteTex);
// Right border
GUI.DrawTexture(new Rect(tableBorderRect.xMax - borderThickness, tableBorderRect.y, borderThickness, tableBorderRect.height), BaseContent.WhiteTex);
// Create inner content area (inside the border)
var innerTableRect = new Rect(tableBorderRect.x + borderThickness + 4f, tableBorderRect.y + borderThickness + 4f,
⋮----
// Column headers with enhanced styling - increased height for better fonts
var headerRect = new Rect(innerTableRect.x, innerTableRect.y, innerTableRect.width, Text.LineHeight + 8f); // Increased from +4f to +8f
// Draw header background
var headerBgColor = new Color(0.1f, 0.1f, 0.1f, 0.6f); // Dark background for header
⋮----
GUI.DrawTexture(headerRect, BaseContent.WhiteTex);
// Draw header bottom border
var borderRect = new Rect(headerRect.x, headerRect.yMax - 2f, headerRect.width, 2f);
var borderColor = new Color(0.6f, 0.6f, 0.6f, 0.8f);
⋮----
GUI.DrawTexture(borderRect, BaseContent.WhiteTex);
var currentX = headerRect.x + dynamicJobLabelWidth; // Offset for job labels
// Job Types label
var jobHeaderRect = new Rect(headerRect.x, headerRect.y + 2f, dynamicJobLabelWidth, headerRect.height - 4f);
⋮----
Text.Font = GameFont.Small; // Changed from Tiny to Small for better visibility
⋮----
Widgets.Label(jobHeaderRect, "JobTable_JobTypes".Translate());
⋮----
var normalRect = new Rect(currentX, headerRect.y + 2f, columnWidth, headerRect.height - 4f);
⋮----
Text.Font = GameFont.Small; // Ensure consistent font size
⋮----
Widgets.Label(normalRect, "JobTable_NormalMode".Translate());
⋮----
var hardcoreRect = new Rect(currentX, headerRect.y + 2f, columnWidth, headerRect.height - 4f);
⋮----
Widgets.Label(hardcoreRect, "JobTable_HardcoreMode".Translate());
⋮----
var extraHardcoreRect = new Rect(currentX, headerRect.y + 2f, columnWidth, headerRect.height - 4f);
⋮----
Widgets.Label(extraHardcoreRect, "JobTable_ExtraHardcore".Translate());
⋮----
// Draw job categories with alternating row colors inside the bordered table
var currentRowY = headerRect.yMax + 4f; // Start below the header
var rowHeight = Text.LineHeight * 1.5f; // Increased height for bigger fonts
⋮----
var rowRect = new Rect(innerTableRect.x, currentRowY, innerTableRect.width, rowHeight);
⋮----
// Restore saved color
⋮----
public void DrawJobCategoryRowInTable(Rect rowRect, JobCategory category, float jobLabelWidth, float columnWidth, float columnSpacing, bool showNormal, bool showHardcore, bool showExtraHardcore, int rowIndex)
⋮----
// Draw alternating row background
if (rowIndex % 2 == 1) // Every other row (1, 3, 5...)
⋮----
var bgColor = new Color(0.2f, 0.2f, 0.2f, 0.3f); // Subtle dark background
⋮----
GUI.DrawTexture(rowRect, BaseContent.WhiteTex);
⋮----
// Job category name (leftmost, bigger font for consistency)
⋮----
var jobLabelRect = new Rect(rowRect.x, rowRect.y, jobLabelWidth, rowRect.height);
⋮----
Widgets.Label(jobLabelRect, category.Name);
⋮----
// Draw vertical separator after job label
⋮----
GUI.color = new Color(0.6f, 0.6f, 0.6f, 0.6f);
GUI.DrawTexture(new Rect(sepX - 0.5f, rowRect.y, 1f, rowRect.height), BaseContent.WhiteTex);
⋮----
// Draw columns based on which modes are active
var currentX = rowRect.x + jobLabelWidth + columnSpacing; // Start after job label
// Set bigger font for column values
⋮----
var normalRect = new Rect(currentX, rowRect.y, columnWidth, rowRect.height);
⋮----
Widgets.Label(normalRect, GetModeStatusText(category, GameMode.Normal));
⋮----
// Draw vertical separator after normal mode column (if more columns follow)
⋮----
GUI.DrawTexture(new Rect(normalSepX - 0.5f, rowRect.y, 1f, rowRect.height), BaseContent.WhiteTex);
⋮----
var hardcoreRect = new Rect(currentX, rowRect.y, columnWidth, rowRect.height);
⋮----
Widgets.Label(hardcoreRect, GetModeStatusText(category, GameMode.Hardcore));
⋮----
// Draw vertical separator after hardcore mode column (if extra hardcore follows)
⋮----
GUI.DrawTexture(new Rect(hardcoreSepX - 0.5f, rowRect.y, 1f, rowRect.height), BaseContent.WhiteTex);
⋮----
var extraHardcoreRect = new Rect(currentX, rowRect.y, columnWidth, rowRect.height);
⋮----
Widgets.Label(extraHardcoreRect, GetModeStatusText(category, GameMode.ExtraHardcore));
⋮----
// Reset font and settings
⋮----
public List<JobCategory> GetJobCategories()
⋮----
// Get all WorkGivers with tool requirements
⋮----
.Where(wg => wg.HasModExtension<WorkGiverExtension>())
.ToList();
// Group by stat type to create logical categories
⋮----
if (!statGroups.ContainsKey(categoryName))
⋮----
if (!statGroups[categoryName].Contains(stat))
statGroups[categoryName].Add(stat);
⋮----
// Add compatibility stats from active mods
var compatStats = CompatAPI.GetAllCompatibilityStats();
⋮----
// Add WorkSpeedGlobal category if there are any configured jobs
if (WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs().Any())
⋮----
if (!statGroups[categoryName].Contains(workSpeedGlobalStat))
statGroups[categoryName].Add(workSpeedGlobalStat);
⋮----
// Create job categories
⋮----
categories.Add(new JobCategory
⋮----
return categories.OrderBy(c => c.Name).ToList();
⋮----
private string GetStatCategoryName(StatDef stat)
⋮----
// WorkSpeedGlobal stat handling
⋮----
// Research Reinvented compatibility
⋮----
return stat.LabelCap.ToString() ?? stat.defName;
⋮----
private bool IsOptionalJobCategory(string categoryName, List<StatDef> stats)
⋮----
// Cleaning and butchery are always optional (never required even in hardcore)
⋮----
// Medical is optional in extra hardcore mode based on settings
⋮----
// General Work Speed is configurable - some jobs are gated, some aren't
⋮----
// Research Reinvented categories - treat as core research work, not optional
⋮----
private string GetModeStatusText(JobCategory category, GameMode mode)
⋮----
return "JobTable_Enhanced".Translate(); // Tools provide bonuses but aren't required
⋮----
// Special handling for General Work Speed based on job gating
⋮----
var gatedJobs = WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs().Count(j => workSpeedGlobalJobGating.GetValueOrDefault(j.defName, true));
var totalJobs = WorkSpeedGlobalHelper.GetWorkSpeedGlobalJobs().Count();
if (gatedJobs == totalJobs) return "JobTable_Required".Translate();
if (gatedJobs == 0) return "JobTable_Enhanced".Translate();
return "JobTable_GatedFormat".Translate(gatedJobs, totalJobs);
⋮----
return "JobTable_Enhanced".Translate(); // Still optional in hardcore
return "JobTable_Required".Translate(); // Tools are required to do the job
⋮----
if (category.Name == "Cleaning" && !requireCleaningTools) return "JobTable_Enhanced".Translate();
if (category.Name == "Butchery" && !requireButcheryTools) return "JobTable_Enhanced".Translate();
if (category.Name == "Medical" && !requireMedicalTools) return "JobTable_Enhanced".Translate();
return "JobTable_Required".Translate(); // Tools are required based on settings
⋮----
return "JobTable_Status_Unknown".Translate();
⋮----
private Color GetModeColor(JobCategory category, GameMode mode)
⋮----
// Compare with localized equivalents
if (status == "JobTable_Enhanced".Translate()) return Color.green;
if (status == "JobTable_Required".Translate()) return Color.yellow;
if (status == "JobTable_Blocked".Translate()) return Color.red;
⋮----
public class JobCategory
⋮----
private void ResetAllToDefaults()
⋮----
// Extra hardcore settings
⋮----
public class SurvivalTools : Mod
⋮----
public static SurvivalToolsSettings Settings;
⋮----
public override string SettingsCategory() => "SurvivalToolsSettingsCategory".Translate();
public override void DoSettingsWindowContents(Rect inRect)
⋮----
// Ensure we have an instance (paranoia)
⋮----
// If your basic/enhanced UI needs the caches, prime them here
Settings.InitializeOptionalToolCache();
// Draw the real settings UI (the one with checkboxes + “Open Enhanced Settings” button)
Settings.DoSettingsWindowContents(inRect);
⋮----
/// Initialize settings cache (called from StaticConstructorClass)
⋮----
public static void InitializeSettings()
⋮----
/// Enhanced settings window with scrollable content and improved job table
⋮----
public class SurvivalToolsResizableSettingsWindow : Window
⋮----
private readonly SurvivalToolsSettings settings;
private Vector2 scrollPosition = Vector2.zero;
private Vector2 enhancedScrollPosition = Vector2.zero; // For job table scrolling
// Window size - fixed, no resizing
private readonly Vector2 windowSize = new Vector2(800f, 700f);
⋮----
// Window properties
⋮----
// Set window size and position
windowRect = new Rect(
⋮----
public override void PreClose()
⋮----
// Save settings when window closes
settings.Write();
// Apply conditional feature registration based on updated settings
ConditionalRegistration.ResetConditionals();
ConditionalRegistration.ApplyTreeFellingConditionals();
base.PreClose();
⋮----
public override void DoWindowContents(Rect inRect)
⋮----
// Content area (no title, starts at top)
var contentRect = new Rect(inRect.x, inRect.y, inRect.width, inRect.height);
// Calculate dynamic content height
⋮----
// Ensure the inner view rect height is at least the visible view height so bottom controls remain reachable
var viewRect = new Rect(0, 0, contentRect.width - 20f, Mathf.Max(contentRect.height, contentHeight));
Widgets.BeginScrollView(contentRect, ref scrollPosition, viewRect);
⋮----
// Draw all settings content
⋮----
private float CalculateDynamicContentHeight(float availableWidth)
⋮----
// Calculate content height for enhanced window (job table + extra hardcore only)
// This ensures content scales properly with window size
float baseHeight = 50f; // Base spacing (reduced since no title area)
// Extra hardcore settings (when enabled and applicable)
⋮----
baseHeight += 35f * 4; // Extra hardcore options
⋮----
// Job requirements table - this is the main content
float tableWidth = availableWidth - 40f; // Account for margins
⋮----
float rowHeight = 30f; // Increased for bigger fonts
float headerHeight = 60f; // Header + tooltip space
baseHeight += headerHeight + (jobCount * rowHeight) + 40f; // Table + padding
// Add extra space for the Close button at the bottom (RimWorld automatic close button)
baseHeight += 60f; // Space for close button + padding
return baseHeight + 100f; // Extra padding
⋮----
private void DrawDynamicSettingsContent(Listing_Standard listing, float availableWidth)
⋮----
// Pacifist Tool Equipping
⋮----
listing.CheckboxLabeled("Settings_AllowPacifistEquip".Translate(), ref settings.allowPacifistEquip, "Settings_AllowPacifistEquip_Tooltip".Translate());
⋮----
// Extra Hardcore Mode section (only shown if hardcore is enabled and optional tools exist)
⋮----
// Extra hardcore checkbox
GUI.color = new Color(1f, 0.1f, 0.1f); // Even more red than hardcore
⋮----
listing.CheckboxLabeled("Settings_ExtraHardcoreMode".Translate(), ref settings.extraHardcoreMode, "Settings_ExtraHardcoreMode_Tooltip".Translate());
// Auto-enable individual options when extra hardcore is first enabled
⋮----
Helpers.SurvivalToolValidation.ValidateExistingJobs("Extra hardcore mode enabled");
⋮----
// Detect extra hardcore mode changes and fire enforcer
⋮----
Log.Warning($"[SurvivalTools] Gating enforcer failed on extra hardcore mode change: {ex.Message}");
⋮----
// Individual optional tool requirement checkboxes (only if extra hardcore is enabled)
⋮----
// Indented individual options
⋮----
var cleaningRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(cleaningRect, "Settings_RequireCleaningTools".Translate(), ref settings.requireCleaningTools);
if (Mouse.IsOver(cleaningRect))
TooltipHandler.TipRegion(cleaningRect, "Settings_RequireCleaningTools_Tooltip".Translate());
⋮----
var butcheryRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(butcheryRect, "Settings_RequireButcheryTools".Translate(), ref settings.requireButcheryTools);
if (Mouse.IsOver(butcheryRect))
TooltipHandler.TipRegion(butcheryRect, "Settings_RequireButcheryTools_Tooltip".Translate());
⋮----
var medicalRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(medicalRect, "Settings_RequireMedicalTools".Translate(), ref settings.requireMedicalTools);
if (Mouse.IsOver(medicalRect))
TooltipHandler.TipRegion(medicalRect, "Settings_RequireMedicalTools_Tooltip".Translate());
⋮----
// ResearchReinvented compatibility settings (only show if RR is detected)
⋮----
listing.Label("Research Reinvented Compatibility");
var rrEnableRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(rrEnableRect, "Enable Research Reinvented compatibility", ref settings.enableRRCompatibility);
if (Mouse.IsOver(rrEnableRect))
TooltipHandler.TipRegion(rrEnableRect, "When enabled, integrates with Research Reinvented mod features and tool requirements.");
⋮----
var rrResearchRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(rrResearchRect, "Require research tools in Extra Hardcore", ref settings.rrResearchRequiredInExtraHardcore);
if (Mouse.IsOver(rrResearchRect))
TooltipHandler.TipRegion(rrResearchRect, "When enabled, pawns need research tools to perform research tasks in Extra Hardcore mode.");
var rrFieldResearchRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.CheckboxLabeled(rrFieldResearchRect, "Require field research tools in Extra Hardcore", ref settings.rrFieldResearchRequiredInExtraHardcore);
if (Mouse.IsOver(rrFieldResearchRect))
TooltipHandler.TipRegion(rrFieldResearchRect, "When enabled, pawns need field research tools to perform field research tasks in Extra Hardcore mode.");
⋮----
listing.Gap(12f);
⋮----
// WorkSpeedGlobal Job Configuration Button
settings.DrawWorkSpeedGlobalConfigButton(listing);
// Job Requirements Table - centered and properly sized for the window
⋮----
// Add some spacing after the job table to prevent Close button overlap
⋮----
/// Draw the job requirements table centered and properly sized for the enhanced window
⋮----
private void DrawCenteredJobTable(Listing_Standard listing, float availableWidth)
⋮----
// ---- Title ----
⋮----
Widgets.Label(titleRect, "JobTable_SectionTitle".Translate());
⋮----
// ---- Data ----
var jobCategories = settings.GetJobCategories();
⋮----
var noJobsRect = listing.GetRect(Text.LineHeight);
⋮----
Widgets.Label(noJobsRect, "JobTable_NoJobsFound".Translate());
⋮----
listing.Label("No active mode selected.");
⋮----
// ---- Measure widths (use the same font we render with) ----
⋮----
string jobLabelText = "JobTable_JobType".Translate();
string normalHeaderText = "JobTable_Normal".Translate();
string hardcoreHeaderText = "JobTable_Hardcore".Translate();
string extraHardcoreHeaderText = "JobTable_ExtraHardcore".Translate();
float jobLabelWidth = Mathf.Max(Text.CalcSize(jobLabelText).x + 30f, 140f);
⋮----
if (showNormal) columnWidth = Mathf.Max(columnWidth, Text.CalcSize(normalHeaderText).x + 40f);
if (showHardcore) columnWidth = Mathf.Max(columnWidth, Text.CalcSize(hardcoreHeaderText).x + 40f);
if (showExtraHardcore) columnWidth = Mathf.Max(columnWidth, Text.CalcSize(extraHardcoreHeaderText).x + 40f);
string reqText = "JobTable_Required".Translate();
string enhText = "JobTable_Enhanced".Translate();
⋮----
jobLabelWidth = Mathf.Max(jobLabelWidth, Text.CalcSize(cat.Name).x + 30f);
columnWidth = Mathf.Max(columnWidth, Text.CalcSize(reqText).x + 20f);
columnWidth = Mathf.Max(columnWidth, Text.CalcSize(enhText).x + 20f);
⋮----
// ---- Table geometry ----
⋮----
// Reserve space for the pinned header
float pinnedHeaderSpace = headerHeight + 6f; // Extra space for visual separation
// Calculate maximum content height for scrolling (available space minus header and padding)
float maxContentHeight = 300f; // Maximum height before scrolling
⋮----
// Reserve vertical space from the listing and center horizontally
Rect reserved = listing.GetRect(totalTableHeight);
float tableStartX = Mathf.Max(0f, (availableWidth - totalTableWidth) / 2f);
// Outer frame
Rect tableRect = new Rect(reserved.x + tableStartX, reserved.y, totalTableWidth, totalTableHeight);
GUI.color = new Color(0.1f, 0.1f, 0.1f, 0.3f);
GUI.DrawTexture(tableRect, BaseContent.WhiteTex);
GUI.color = new Color(0.6f, 0.6f, 0.6f, 0.8f);
Widgets.DrawBox(tableRect, 1);
⋮----
// ---- Pinned Header Area ----
Rect pinnedHeaderRect = new Rect(tableRect.x + pad, tableRect.y + pad, tableRect.width - pad * 2f, headerHeight);
// Header background - darker and more prominent
GUI.color = new Color(0.1f, 0.1f, 0.1f, 0.9f);
GUI.DrawTexture(pinnedHeaderRect, BaseContent.WhiteTex);
GUI.color = new Color(0.6f, 0.6f, 0.6f, 1f);
Widgets.DrawBox(pinnedHeaderRect, 1);
⋮----
// ---- Pinned Header Content ----
// Job Type header cell
Rect jobHeaderRect = new Rect(pinnedHeaderRect.x, pinnedHeaderRect.y, jobLabelWidth, pinnedHeaderRect.height);
⋮----
Widgets.Label(new Rect(jobHeaderRect.x + 4f, jobHeaderRect.y + 2f, jobHeaderRect.width - 8f, jobHeaderRect.height - 4f),
"JobTable_JobType".Translate());
⋮----
// Vertical separators for pinned header
⋮----
GUI.DrawTexture(new Rect(firstSepX - 0.5f, sepTop, 1f, sepHeight), BaseContent.WhiteTex);
⋮----
// Mode headers in pinned area
⋮----
Rect normalRect = new Rect(currentX, pinnedHeaderRect.y + 2f, columnWidth, pinnedHeaderRect.height - 4f);
GUI.color = new Color(0.5f, 1f, 0.5f);
⋮----
Widgets.Label(normalRect, normalHeaderText);
⋮----
GUI.DrawTexture(new Rect(sepX - 0.5f, sepTop, 1f, sepHeight), BaseContent.WhiteTex);
⋮----
Rect hardcoreRect = new Rect(currentX, pinnedHeaderRect.y + 2f, columnWidth, pinnedHeaderRect.height - 4f);
GUI.color = new Color(1f, 1f, 0.5f);
⋮----
Widgets.Label(hardcoreRect, hardcoreHeaderText);
⋮----
Rect extraRect = new Rect(currentX, pinnedHeaderRect.y + 2f, columnWidth, pinnedHeaderRect.height - 4f);
GUI.color = new Color(1f, 0.5f, 0.5f);
⋮----
Widgets.Label(extraRect, extraHardcoreHeaderText);
⋮----
// ---- Scrollable Content Area ----
Rect contentAreaRect = new Rect(tableRect.x + pad, pinnedHeaderRect.yMax + 3f, tableRect.width - pad * 2f, actualContentHeight);
⋮----
// Use scroll view for content. Ensure view height is at least the visible content area to prevent clipping
Rect viewRect = new Rect(0, 0, contentAreaRect.width - 20f, Mathf.Max(contentAreaRect.height, contentHeight));
Widgets.BeginScrollView(contentAreaRect, ref enhancedScrollPosition, viewRect);
// Draw rows in scroll view
⋮----
Rect rowRect = new Rect(0, rowY, viewRect.width, rowHeight);
⋮----
GUI.color = new Color(1f, 1f, 1f, 0.05f);
⋮----
settings.DrawJobCategoryRowInTable(rowRect, category, jobLabelWidth, columnWidth, columnSpacing,
⋮----
// Draw rows directly without scrolling
⋮----
Rect rowRect = new Rect(contentAreaRect.x, rowY, contentAreaRect.width, rowHeight);
⋮----
// Reset text state
⋮----
// restore GUI state
⋮----
private float CountVisibleJobs()
⋮----
// Count jobs that will be displayed in the table
// Use a simple estimate since we don't need the exact method
return 12f; // Approximate number of job types typically shown
</file>

<file path="About/About.xml">
<?xml version="1.0" encoding="utf-8"?>
<ModMetaData>
    <packageId>jellypowered.survivaltools</packageId>
    <name>Survival Tools Reborn</name>
    <author>Jellypowered</author>
    <url>https://github.com/Jellypowered/SurvivalTools/</url>
    <supportedVersions>
        <li>1.6</li>
    </supportedVersions>
    <description><![CDATA[
Current version: v1.6 (September 2025)
Transforms RimWorld into a challenging tool-dependent survival experience where proper equipment becomes essential for colony success.
KEY FEATURES:
• Smart Tool System: Colonists automatically acquire optimal tools before starting work
• Hardcore Mode: Tools become essential - most work impossible without proper equipment
• Extra Hardcore Mode: Ultimate difficulty with 87.5% faster tool wear and strict tool requirements
• Granular Controls: Choose exactly which tasks require tools (cleaning, butchery, medical)
• Intelligent Management: Advanced tool optimization and automatic swapping systems
• Realistic Degradation: Tools wear down with use and must be maintained or replaced
• Early Game Survival: Find tools in ruins or craft them to establish your colony
DIFFICULTY MODES:
• Normal: Tools improve efficiency but work remains possible without them
• Hardcore: Most tasks become impossible without proper tools, 50% faster wear
• Extra Hardcore: Maximum challenge - strict tool requirements, 87.5% faster wear
QUALITY OF LIFE:
• Automatic tool pickup before jobs begin
• Smart tool swapping for optimal efficiency
• Detailed alerts for missing or worn tools
• Comprehensive mod compatibility patches
• Extensive debugging and logging options
Originally by XeoNovaDan. Rebuilt and enhanced for RimWorld 1.6 with improvements to tool mechanics, hardcore survival features, and intelligent automation systems.
    ]]>    </description>
</ModMetaData>
</file>

</files>
